<!--
	Pingtype Cantonese
	Peter Burkimsher 2025-03-22
	
	A literal translator for Chinese to English. 
	
	+ Translate HTML
	+ Translate text
	+ Translate bilingual
	+ Word spacing
	+ Deradicalize
	+ Word search
	+ Append to file
	+ Pinyin typing, word suggestion
  	+ Rounded rectangle buttons
  	+ Decomposing numbers not just characters
	+ Matrix
	+ Save word errors
	+ Upload and read from image
	+ Hide pinyin, literal, change opacity
	+ Common characters in bold
	+ Syllables, charts. Red for mismatch. 
	+ Google translate words, input
	+ Bopomofo, with dot above
	+ Character to TurtleSheet
	+ Change tone colours
	+ Frequency sort
	+ Character spacing
	+ Break missing words
	+ Keep unspaced, spaced Chinese on lines like English
	+ Choice of dictionaries, including Unihan and zh-wiktionary and en-wiktionary
	+ Dictionary in localStorage (only up to a maximum length though)
    + Floating dictionary update panel using jQuery, with date added
	+ Type bopomofo, convert to pinyin to add word
	+ Tone numbers to tone marks
	+ Pinyin suggestion, easy to edit tone
	+ Classifiers to dictionary
	+ Auto-load text from url through API
	+ Historical phrase reader
	+ Filename save to server, auto-detect if PHP is running to save locally
	+ Upload dictionary changes to server, unsynced changes tracker
	+ Bopomofo keyboard in character search
	+ HubText direct file editor on GitHub
	+ GUI in Chinese
	+ Load chinese, english from url.
	+ Simplified
	+ Regional variants
	+ Hex, Unitype input, bulk input, and output
	+ Pinyin tone numbers, sized
	+ Large Seal script, Small Seal Script, Oracle bones with fonts
	+ Word Frequency side script
	+ Findnewwords from text area side script
	+ Taiwanese, Cantonese with font size, colours for tones. 
	+ Tang, Vietnamese, Japanese, Hangul output
	+ CNLT, Vicky's blog
	+ Monospaced font
	+ Print to PDF, page breaks
	+ Coloured movie subtitles
	+ Subtitles vocabulary with examples
	+ Word lists (TOCFL, HSK)
	+ hash out words not in tocfl
	+ Pingfang, Jhenghei fonts
	+ TOCFL8000, Bible book short names, Country names, road names, city names to dictionary
	+ Audio headings
	+ Reviewing the Hanzi in typing area
	+ KHOP videos
	+ Dinbendon restaurant menus
	+ Easier simplified translation by auto-detection
	+ Shuffle for vocabulary test
	+ Random Bible verse website
	+ LitMan Literal Manual input for Taiwanese POJ comparisons
	+ English
	+ Taiwanese
	+ Cantonese from https://cantonesetojyutping.appspot.com/canto
	+ Re-add words from addWords.txt, editWords.txt, removeWords.txt
	+ Redirect when searching lyrics or filenames to add query to url
	+ Despace, dehomonym, and deradicalise in search.
	+ Lazy load Pingfang to make Chinese appear faster
	+ Google Translate Python to get translation, pinyin without changing tab
	+ Google Translate Proxy to work while on ose-pub WiFi
	+ Floating media panel
	+ Node server
	+ Client side converting to PDF and JPG using wkhtmltopdf and wkhtmltoimage
	+ Song to Slide Pictures.scpt to split bilingual song text file into slides saved as a folder of PNGs
	+ Verse number next to lrc in media viewer
	+ English button to quickly move to Pingtype English
	+ Taiwanese romanised dictionary from TTV using Bible TTV Space from POJ.scpt. Then manually fix 108 spacing errors, sort by frequency, extract tones, paste together. 
	+ Manually add 魚 to Oracle Bones font using fontforge, from Wikipedia SVG for Tristan
	+ Line break detection using https://www.bennadel.com/blog/4310-detecting-rendered-line-breaks-in-a-text-node-in-javascript.htm
	
	To do:
	- pingtype english show pinyin
	- Taiwanese from https://raw.githubusercontent.com/anyong/taigi_tools/master/taigi_tools/TLHJ.DAT
	- Manually add more Oracle Bones characters to font using fontforge. https://zh.wikipedia.org/wiki/%E7%94%B2%E9%AA%A8%E6%96%87 and https://www.omniglot.com/chinese/jiaguwen.htm
	- Dictionaries from OpenVanilla https://groups.google.com/forum/?fromgroups/openvanilla#!forum/openvanilla https://github.com/openvanilla/openvanilla/ https://openvanilla.org
	- Hakka in subtitlesButtonClicked
	- Hakka dictionary editor
	- documentation 求 + 和 ≠ 求和
	- OCR https://blog.algorithmia.com/advanced-image-manipulation-and-data-extraction/
	- blog editor with https://www.netlifycms.org/docs/ https://github.com/netlify/netlify-cms/tree/master/example https://www.netlify.com/blog/2017/08/17/a-complete-cms-with-no-server-and-18-lines-of-code/
	- search entire index for words
	- update youling with googletrans.py
	- YouLing + Pingtype = YouPing
	- smaller dictionary for faster spacing
	- marketing page designed like https://visualping.io
	- general landing page with logos for churches and social groups (e.g. CNLT, STHP, NKJV, Dr Lin, Hai-ke, KHOP, KGCC, Zion Church), on a .com subdomain
	- simplified/traditional conversion floating window like dictionary editor
	- english ipa by local php xss
	- 4laws base page
	- lord's prayer in pingtype, static html
	- nkjv english for ariel
	- nlt english for zhenrong
	- drop first line button, useful for Taiyu LitMan space alignment
	- music search online to james yu an tung
	- voicetube base page
	- Kouyu index and base page
	- javascript bookmarklet to get text from web page and send it to pingtype
	- load bilingual stream of praise files
	- deradicalise and convert to traditional itunes
	- tocfl word label in dictionary editor search
	- pingfang font in save to html
	- links to Bible audio
	- cursor is actually really important for real-time updating to make the user know how it works. 
	- Server-side PDF export using https://github.com/alvarcarto/url-to-pdf-api
	- Change editor to use PHP to be absolutely sure that edits are made correctly instead of overwriting. 
	- Check if searched word in Dictionary Editor is in TOCFL word list
	- Auto save with quote in file
	- Taiwanese POJ Bible links page
	- Quote mark in filename breaks Ajax write
	- Examples dictionary
	- Bold word in example
	- More padding, lowercase literal, black English in Chinese 
	- Vicky blog base page with links
	- Marketing
	- CUNP manual fixing
	- reveal hidden pinyin, literal on mouseover
	- audio, vocabulary, examples
	- chinese glyphs dataset like http://yaroslavvb.blogspot.tw/2011/09/notmnist-dataset.html
	- problem in audio of zhe 著
	- https://commons.wikimedia.org/wiki/Commons%3aChinese_characters_decomposition
	- bopomofo, stroke animation in word headings
	- dictionary problems where there are too many tones because of extra spaces
	- remove extra dot in 爺爺, 奶奶, 舅舅, 妹妹, 弟弟, 姐姐, 叔叔, 寶寶
	- 5th tone from https://pedia.cloud.edu.tw/Home/List?search=也不錯
	- bopomofo of yinhang not yinxing
	- font selection menu in interface
	- png frames of clips to html file of words
	- left indent
	- find syllables in data sources
	- vocabulary test website, ask user to click/type words they know
	- tocfl pinyin comparison
	- lrc lyrics files to srt
	- subtitles plain, just spaced chinese and english
	- proper page breaks using css https://www.w3schools.com/cssref/pr_print_pageba.asp
	- Other languages (e.g. French, Slovak) with custom dictionary
	- zh-wikipedia to text files
	- Wade-giles, english, korean, japanese, vietnamese, cantonese, taiwanese first choice bulk input in simplified text box
	- pinyin sizes, disable tone numbers for wade-giles
	- Save files into folder
	- check upload, allow retry if failed.
	- options of different sounds for one word (hang, xing) to mouseover
	- Puns
	- chords above text
	- Four chords to four tones
	- number of songs in khop to get all syllables
	- pos speech tagging, could use to change grammar later
	- number of radicals to get all characters
	- use node server for automatic facebook chinese made larger and spaced
	- google translate through API with http://py-googletrans.readthedocs.io/en/latest/ hosted somewhere else e.g. heroku using XSS
	- english colours from http://english.edward.io
	- Increase font size button for simplified/traditional comparison https://stackoverflow.com/questions/30217146/changing-fontsize-for-a-class-using-javascript
	- https://www.deepl.com/en/translator
	- "singtype" for lyrics
	
	Marketing done:
	- http://www.lancaster.ac.uk/library/about-us/contact-us/library-staff/joanne-wood/
	- don't forget to re-enable appcache before release (actually no, because I'm still updating all the time)
	- Release on Hacker News
	- report errors to let's learn chinese textbook
	- https://www.plecoforums.com
	- Chris Lonsdale https://www.youtube.com/watch?v=d0yGdNEWdn0
	- http://www.chinesehorizon.com is trash
	- http://www.hskhsk.com/index.html
	- http://www.learnm.org
	- Talk to richard.sears.tn@gmail.com http://www.chineseetymology.org/CharacterEtymology.aspx?submitButton1=Etymology&characterInput=於
	- Talk to Dr Donald Sturgeon from CText http://ctext.org/faq#copyright
	- http://socialmandarin.com
	- http://www.davidpetersson.com/practice-your-chinese-writing-skills-chinese-writer-on-iphone-or-ipad/
	- https://www.chinesethehardway.com/article/hsk-6-gets-you-halfway/
	- https://www.chinesetextanalyser.com
	- https://blog.vocapouch.com/do-20-pages-of-a-book-gives-you-90-of-its-words-795a405afe70
	- https://en.wikipedia.org/wiki/Benny_Lewis
	- https://en.wikipedia.org/wiki/List_of_polyglots
	- Chinese Universities database's professors

	Marketing to do:
	- 恩雨福音敬拜 https://www.facebook.com/groups/1621704268115698/
	- How I Got My First 100 Users | Hacker News https://news.ycombinator.com/item?id=14925729
	- https://www.fluentin3months.com/forum/
	- https://blog.winnie.com/how-to-get-your-first-100k-active-users-909fa4292a27
	- https://www.reddit.com/r/Entrepreneur/comments/6ztybx/how_i_attract_high_paying_clients_to_my_design/?15
	- Lyric videos to make: Shekinah glory, deep cries out, with all I am
	- Google Translate developers
	- VoiceTube
	- Rosetta Stone
	- Wenzao professors
	- Taiwanese Tone Marks from #Author: Chen Yoxem <yoxem.tem98@nctu.edu.tw>
	- Taiwanese to http://taigi.fhl.net/TaigiIME/ fhl_ime@googlegroups.com
	- Taiwanese https://itaigi.tw
	- Huáng Yù Chún 黃鈺淳 is TEDx NCYU in Chiayi
	- Talk to zh-wikipedia editors about using spacing
	- OCR to https://en.wikipedia.org/wiki/Yann_LeCun

	Documentation:
	- Advanced
	- Chinese words that are shorter than english (mosquito, air conditioning)
	- Embarassing Chinese names 幹 in 甘尼培 Patrick Gunning http://blog.xuite.net/orz4uu/twblog/120361987-%22%E7%94%98%E5%B0%BC+%E8%80%81%E5%B8%AB%22+~%E6%88%91%E7%82%BA%E6%88%91%E7%9A%84%E5%90%8D%E5%AD%97%E6%84%9F%E5%88%B0%E6%8A%B1%E6%AD%89
	- Tones joke 來刀叉可以嗎？ 來到茶可以嗎？ https://mattandre.ws/2012/08/the-importance-of-tones-in-mandarin-chinese/
	- Docs in Chinese
	- how to use f-stop to change names to pinyin
	- Simplified characters documentation, that Carbo Kuo (ByVoid) is just as rude as Unihan maintainer
	- Unitype, hex codes documentation
	- Word frequency side script documentation
	- Documentation Vicky's blog https://vickytravelday.wordpress.com
	- monospaced text alignment when using simsun font
	- Taiwan law
	- find words in data sources
	- Language is 70% vocabulary cipher, 10% tones, 10% grammar, 10% new vocabulary concepts (broken food, big time) 

	Long-term development:
	- audio with replay from position
	- o for a thousand tounges to sing in different languages
	- be thou my vision in different languages
	- Superscript/subscript for tones, after unicode adds subscript "g" (or use 9) http://stackoverflow.com/questions/17908593/how-to-find-the-unicode-of-the-subscript-alphabet
	- Mobile theme
	- Remove hard-coded Github access token
	- Gwoyeu Romatzyh
	- cursor
	- Word segmentation from http://ckipsvr.iis.sinica.edu.tw
	- Server-side translation with REST API
	- Upload new dictionary edits to https://translate.google.com/community#zh-TW/en
	- WebASM multi-threading to translate each line separately, faster
	- Lazy load leaflet when image uploaded	
	- Seal script, after unicode adds it
	
	Data sources done:
	- TED http://www-lium.univ-lemans.fr/en/content/ted-lium-corpus bilingual: https://ted2srt.org
	- taiwanese songs - living water church, fire ex
	- VoiceTube
	- http://www.en8848.com.cn/kouyu/basic/new-english-life900/182420.html
	- http://jayko.pixnet.net/blog

	Data sources:
	- wikipedia character decomposition https://commons.wikimedia.org/wiki/Commons:Chinese_characters_decomposition
	- How to become a Christian - https://web.archive.org/web/20170108111016/http://www.treeoflife.org.tw/front/bin/ptlist.phtml?Category=2808
	- https://en.wikipedia.org/wiki/Compendium_of_Materia_Medica	https://zh.wikisource.org/zh/本草綱目
	- http://www.hitutor.com.tw/english-news-chinese.php
	- windows resource strings - Google Search https://www.google.com.tw/search?client=safari&rls=en&q=windows+resource+strings&ie=UTF-8&oe=UTF-8&gfe_rd=cr&dcr=0&ei=pBQ9Wt34JOOm8wf7l7hA
		https://stackoverflow.com/questions/2502375/find-localized-windows-strings
	- News: https://funday.asia/library/
	- TV Guide: 
		http://localhost:8080/wiki/en/Chinese%20Television%20System 
		http://localhost:8080/wiki/en/CTS%20Main%20Channel 
		http://localhost:8080/wiki/en/Media%20of%20Taiwan
		/Users/peter/Documents/Homes/Taiwan/Taipei/Wildmind/Country Deployment/Countries/International/21. Taiwan/4. Deploy/Incomplete/XML
	- Lizhi FM, Ximalaya 喜马拉雅 Mainland China Podcast https://www.lizhi.fm/ http://www.ximalaya.com/explore/
	- Profanity from https://zh.wikipedia.org/wiki/%E5%B9%B9%E4%BD%A0%E5%A8%98
	- SHINE MP3s https://www.youtube.com/user/shineyouthtaiwan/videos?sort=dd&shelf_id=0&view=0
	- Joshuaband MP3s https://www.youtube.com/channel/UC93m2yLo9G4-ZdFMgrdS2LA/videos?shelf_id=0&sort=dd&view=0
	- Lyrics from http://www.hoctoga.org/Chinese/lyrics/lyrics_index.htm
	- Train station names to dictionary
	- TED talks in Chinese with subtitles
	- XKCD Chinese
	- Chinese names to dictionary
	- Lyrics of popular songs: https://jspinyin.wordpress.com/chinese-song-lyrics/ and http://aglassofsodagreen.blogspot.com/p/translations.html
	- OpenStreetMap brand names on street (chuanlian de lian)
	- CUNP
	- Taiwanese corpus https://github.com/Taiwanese-Corpus
	- IHOP ANHP Chinese worship http://www.ihopkc.org/anpr/
	- words from 朗道漢英字典5 langdao-ce-gb.csv
	- More films: https://zh.wikipedia.org/wiki/Category:高雄市背景电影
	- Even more films: https://zh.wikipedia.org/wiki/Category:高雄市取景電影
	- tkstory
	- https://en.wikipedia.org/wiki/Siku_Quanshu
	- http://www.funtude.com
	- http://manhua.dmzj.com
	- TOCFL mock test http://www.sc-top.org.tw/mocktest.php
	- PTT BBS https://github.com/jwlin/ptt-web-crawler
	- http://2.assrt.net/xml/sub/43/43949.xml
	- wikipedia mandarin chinese profanity
	- indievox lyrics https://raw.githubusercontent.com/indievox-inc/iNDIEVOX-Dataset/master/dataset/lyrics.dataset
	- Sermons from http://www.kc7schurch.org.tw/index.php?Pgc=Sermon&SermonPgNo=1
	- https://github.com/umbrae/reddit-top-2.5-million/blob/master/data/languagelearning.csv
	- Taiwanese dramas http://sugoideas.com/
	- Paragliding manual
	- Chinese audio Bible to videos
	- Taiwanese films
	- Double subtitles from https://secure.assrt.net especially DTS-WiKi and http://www.zimuzimu.com
	- japanese songs
	- hillsong global project
	- 4 spiritual laws
	- Famous manga (Naruto, OnePiece) from Dmzj, mangafox
	- Space all of zh-wikipedia (about 11 days runtime)
	- Only common words in Pingtype dictionary
	- Dictionary of phrases from OpenCC
	- Joshuaband lyrics
	- Weather
	- Daily Bible
	- News http://www.taipeitimes.com/News/lang/archives/2017/04/16/2003668787 - load live, because people must be allowed to edit
	- Kaohsiung Q&A (back to 2014) https://www.facebook.com/groups/KaohsiungQA/
	- LINE chats, Facebook, PTT
	- Taiwanese immigration test
	- Phrases from Wendy
	- Manga from https://mangahelpers.com/m/haikyuu/translations/
	- Lyrics from http://www.5nd.com/gecilrc/69656.htm and https://www.lrcsite.com
	- Movies from http://dl.funsaber.net/animation/ and http://fs.evonetbd.com/index.php?dir=Movies%2F&search=2000&search_mode=f and http://dl2.mihanpix.com/Film/
	- Manuals from https://www.manualslib.com
	- https://github.com/skishore/makemeahanzi
	- https://www.dcard.tw/f
	- https://www.iq.com/?_from=iqiyi_tw
	
	Type in:
	- https://www.facebook.com/pg/PEIHSIU/photos/?ref=page_internal https://www.behance.net/peihsiu
	- Texts from dog
	- Reddit group to request photo transcription
	- Wendy instagram
	
	Other learning material:
	- Remembering Traditional Hanzi 1, Heisig & Richardson. Taipei Insight Guides. Chinese Pronunciation. 500 Common Chinese Idioms. Learning Chinese language & culture from movies. Illustrated Chinese-English Dictionary. Total Mandarin Chinese. https://www.fluentin3months.com/wp-content/uploads/2012/01/chinese.jpg
	- https://app.ninchanese.com/create
	- https://www.youtube.com/user/FluentUChinese/featured
	
	Other languages:
	- Japanese: https://8020japanese.com/japanese-sentence-structure/
	- Hakka Bible: http://www.bible.is/HAKTHV/Matt/1
	- Hakka resources: http://taigu.fhl.net/index.html
	- FML in French http://www.viedemerde.fr and Spanish http://www.vida-hp.com
	- simple english words in other languages
	- Other language dictionaries: http://download.huzheng.org
	- Cantonese: https://www.youtube.com/watch?v=8oJfEm69fno
	- Hakka https://en.wikipedia.org/wiki/Hakka_Bible:_Today%27s_Taiwan_Hakka_Version https://en.wikipedia.org/wiki/Pha̍k-fa-sṳ
	- Ningbo dialect romanised by Hudson Taylor https://find.bible/bibles/WUURNT/
	- one ok rock, ellegarden bilingual songs to learn japanese
	- Glagolitic script https://en.wikipedia.org/wiki/Glagolitic_script
	- Japanese/French http://jibiki.fr
	- greek and hebrew
	- Taiwanese Bible http://share35.myftp.org/taiwanese/dayplay.php?bs=12-29-1
	- Nepali for Carrie Tang
	
	Give up, this is taking too much time:
	- https://medium.com/@tonyszhou/postmortem-1b338537fabc
	- https://www.gamasutra.com/view/news/310063/The_sunk_cost_fallacy_Devs_describe_how_it_almost_destroyed_them.php

	Decompose started 2016-12-05, merged with translate on 2017-04-05. 
	Recursively breaks a Chinese character into its parts
	Pingtype first uploaded 2017-04-27.  
	
	Decomposition data from https://cjkdecomp.codeplex.com
	Simplified converstion data from https://github.com/BYVoid/OpenCC/tree/master/data/dictionary
	Taiwanese dictionary from MKDictionary http://www.taiwanesedictionary.org
	TOCFL from http://www.sc-top.org.tw/english/download.php
	HSK from https://github.com/Lemmih/lesschobo
	
	Hit counter at https://github.com/pingtype/pingtype.github.io/graphs/traffic
	
-->

<!DOCTYPE html>
<html>
  <head>
  	<title>Pingtype</title>
  	  	
	<meta charset="utf-8" />
    <style>

@font-face {
    font-family: "Charcoal CY";
    src: url("fonts/Charcoal.ttf") format("truetype");
}

@font-face {
    font-family: "Virtue";
    src: url("fonts/virtue.ttf") format("truetype");
}

@font-face {
    font-family: "Pingfang";
    src: url("fonts/PingFang1.ttf") format("truetype");
}

      body {
        font-family: Tahoma, Geneva, sans-serif;
      }
      
      table td {
      white-space: nowrap;
      }
		
	a:hover, a:visited, a:link, a:active
	{
		color:#000000;
	    text-decoration: none;
	}
		
      .chinese_1 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
        color:#000000;
		font-size: 30px;
		display:inline;
      }

      .chinese_2 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .chinese_3 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .chinese_4 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

      .chinese_5 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }

      .chinese_6 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }

      .chinese_7 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }
      
      .chinese_8 {
        font-family: "Pingfang", "Heiti TC Light", "HanaMinB", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }


      .pinyin_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .pinyin_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
display:inline;
      }

      .pinyin_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
display:inline;
      }

      .pinyin_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
display:inline;
      }

      .pinyin_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .taiwanese_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#797986;
		display:inline;
      }

      .taiwanese_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
display:inline;
      }

      .taiwanese_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#0000FF;
display:inline;
      }

      .taiwanese_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#505050;
display:inline;
      }

      .taiwanese_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#F82423;
display:inline;
      }

      .taiwanese_7 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }
      
      .taiwanese_8 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#707070;
display:inline;
      }

      .cantonese_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#929292;
		display:inline;
      }

      .cantonese_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#FF8080;
display:inline;
      }

      .cantonese_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#797986;
font-size: 30px;
display:inline;
      }

      .cantonese_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#0000FF;
display:inline;
      }

      .cantonese_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#F82423;
display:inline;
      }

      .cantonese_6 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .hakka_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#000000;
		display:inline;
      }

      .hakka_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
display:inline;
      }

      .hakka_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

      .hakka_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
display:inline;
      }

      .hakka_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#0000FF;
display:inline;
      }

      .hakka_6 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#F08000;
display:inline;
      }

      .hangul {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#000000;
		font-size: 26px;
		display:inline;
      }

      .tang {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .japanese {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .vietnamese {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .englishInChinese {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .literal {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .english {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

		.DefaultButtonOuter
		{
			border: 2px solid black ;
			border-radius: 8px;
			width: 96px;
			height: 26px;
			text-align: center;
			
			/*background-color: #99999a;*/
			background: #99999a; /* For browsers that do not support gradients */
			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */
			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */
			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */
			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */
		}

		.ButtonInner
		{
			border: 1px solid black ;
			border-radius: 5px;
			background-color: #dcdbde;
			width: 88px;
			height: 18px;
			text-align: center;
			margin: 3px;
			
		    line-height: 18px;
	        font-family: "Charcoal CY", "Virtue", Geneva, sans-serif;
			font-size: 11px;
			color: #000000;
		}
		
		.ButtonInner:active
		{
		    background:#666666;
		    color: #ffffff;
		}

		.key
		{
			border: 1px solid black ;
			border-radius: 5px;
			background-color: #dcdbde;
			width: 18px;
			height: 18px;
			text-align: center;
			margin: 3px;
			
		    line-height: 18px;
	        font-family: Geneva, sans-serif;
			font-size: 11px;
			color: #000000;
		}


			#matrix {
				background: black;
				float: center;
			}

			#matrix td {
			    padding: 7px;
    			margin: 0px;
    			float: center;
				background: black;
				font: 54px arial;
				
				height: 80px;
			}

			#matrix tr {
				height: 80px;
			}


			#matrix p {
			    opacity: 0;
			    margin-top: -25px;
			    text-align: center;

				height: 80px;

			    -webkit-transition: margin-top 2s ease-in;
			    -moz-transition: margin-top 2s ease-in;
			    -o-transition: margin-top 2s ease-in;
			    -ms-transition: margin-top 2s ease-in;
			    transition: margin-top 2s ease-in;
			}
			
			#matrix p.load {
			    opacity: 1;
			    margin-top: 25px;
			}

     .dialogWithDropShadow
     {
         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);
         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); 
     }

@font-face {
    font-family: "SmallSealScript";
    src: url("fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf") format("truetype");
}

      .smallSealScript_1 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .smallSealScript_2 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .smallSealScript_3 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .smallSealScript_4 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

@font-face {
    font-family: "LargeSealScript";
    src: url("fonts/JDFZHUANF.ttf") format("truetype");
}

      .largeSealScript_1 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .largeSealScript_2 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .largeSealScript_3 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .largeSealScript_4 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }


@font-face {
    font-family: "OracleBones";
    src: url("fonts/bnujgw-withYu.ttf") format("truetype");
}

      .oracleBones_1 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .oracleBones_2 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .oracleBones_3 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .oracleBones_4 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

	  .pingtypeBlock {
		  break-inside: avoid;
	  }

input[type='range'] {
    -webkit-appearance: none !important;
	margin:0px;
	padding:0px;
    background: #000;
    height:13px;
	border-bottom:#333 1px solid;
}
input[type='range']::-ms-fill-lower  {
	background:#000;
}
input[type='range']::-ms-fill-upper  {
	background:#000;
}
input[type='range']::-moz-range-track {
	border:none;
    background: #000;
}
input[type='range']::-webkit-slider-thumb {
    -webkit-appearance: none !important;
    background: radial-gradient(#FFF, #333);
    height:11px;
    width:11px;
	border-radius:100%;
	cursor:pointer;
}
input[type='range']::-moz-range-thumb {
    background: radial-gradient(#FFF, #333);
    height:11px;
    width:11px;
	border-radius:100%;
	cursor:pointer;
}
input[type='range']::-ms-thumb {
    -webkit-appearance: none !important;
    background: radial-gradient(#FFF, #333);
    height:11px;
    width:11px;
	border-radius:100%;
	cursor:pointer;
}


    </style>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="apple-touch-icon-precomposed" href="images/pingtypeLogo256.png" />
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<link rel="stylesheet" href="jquery-ui.css"/>

	<link rel="preload" href="chineseFontsLoaded.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<noscript><link rel="stylesheet" href="chineseFontsLoaded.css"></noscript>

  </head>
<!--  <body onkeydown="keyDown();">-->
<!--  <body onkeypress="keyPressed();">-->
  <body>
		
	<!-- Top navigation bar -->
	<div style="padding-left:0.81em;padding-top:0.51em;padding-bottom:0.51em; background:#DDDDDD">
		<table border="1" style="border-style: solid;border:1px; border-collapse: collapse;background:#FFFFFF;font-weight:bold;font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="index.html" style="text-decoration: none;color: #000000;">
						🏡 Home
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="docs/docs.html" style="text-decoration: none;color: #000000;" target=_blank>
						📘 Docs
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="docs/blog.html" style="text-decoration: none;color: #000000;" target=_blank>
						📚 Blog
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="http://peterburk.github.com/tra" style="text-decoration: none;color: #000000;" target=_blank>
						🚃 Trains
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="bible.html" style="text-decoration: none;color: #000000;" target=_blank>
						✝ Bible
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="Data/Dinbendon/map/index.html" style="text-decoration: none;color: #000000;" target=_blank>
						🍱 Food
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="Data/KHOP/index.html" style="text-decoration: none;color: #000000;" target=_blank>
						🎧 Lyrics
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="https://www.youtube.com/playlist?list=PLhIooD7mFhpjdXOJLCm4uKQitetfaglBS" style="text-decoration: none;color: #000000;" target=_blank>
						🎵 Music
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="https://www.youtube.com/playlist?list=PLhIooD7mFhphhT5nDdhK00wZuobGbMtO0" style="text-decoration: none;color: #000000;" target=_blank>
						🎬 Movies
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="english.html" style="text-decoration: none;color: #000000;" target=_blank>
						🇬🇧 English
					</a>
				</td>
				<td style="padding-left:6px;padding-top:3px;padding-right:6px;padding-bottom:3px;">
					<a href="http://peterburk.github.com/contact" style="text-decoration: none;color: #000000;" target=_blank>
						✉️ Contact
					</a>
				</td>
			</tr>
		</table>
	</div>
	<!-- End heading row -->
		
 	<table>
 		<tr>
 			<td>
				<img src="images/pingtypeLogo256.png" border="0" height="25" width="25"></img>
			</td>
			<td>
			  	<div style="font-family: 'Lucida Sans', Geneva, sans-serif; font-size: 16px;">
					翻譯 軟體 <b>Pingtype Parallel Translator</b>
			  	</div>
			</td>
		</tr>
	</table>
	
	<table id="inputTable">
		<tr>
			<td>
  				<div id="simplifiedInputTitle" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Simplified input 简化字 輸入
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Chinese input 中文 輸入
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					English input 英文 輸入
  				</div>
			</td>
			<td>
  				<div id="chineseSpacedTitle" class="advanced" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Chinese spaced 中文 空間
  				</div>
			</td>
			<td>
  				<div id="simplifiedSpacedTitle" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Simplified spaced 简化字 空間
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Text output 文本 輸出
  				</div>
			</td>
		</tr>
		<tr>
			<td>
  				<textarea id="simplifiedInputTextArea" style="visibility:hidden;width:0px" rows="10" cols="50"></textarea>
  			</td>
			<td>
				<textarea id="chineseTextArea" rows="7" cols="50" style="font-size: 16px;"></textarea>
  			</td>
  			<td>
  				<textarea id="englishTextArea" rows="10" cols="50" ></textarea>
  			</td>
  			<td>
  				<textarea id="chineseSpacedTextArea" class="advanced" style="visibility:hidden;width:0px" rows="10" cols="50" ></textarea>
  			</td>
			<td>
  				<textarea id="simplifiedSpacedTextArea" style="visibility:hidden;width:0px" rows="10" cols="50" ></textarea>
  			</td>
  			<td>
  				<textarea id="outputTextArea" rows="10" cols="50" style="font-family: 'SimSun', Geneva, sans-serif;"></textarea>
  			</td>
  		</tr>
  		
  	</table>
  	
  	<table id="translateButtonsTable" >
  		
  		<tr>
  			<!--
  			<td style="width:100px;height:10px;background-color:#BBBBBB;text-align:center;" onclick="translateHtml();">
  				Translate HTML
  			</td>
  			<td style="width:100px;height:10px;background-color:#BBBBBB;text-align:center;" onclick="translateInterface();">
  				Translate Text
  			</td>
  			-->
			<td>
				<div id="defaultTranslateButton" class="DefaultButtonOuter">
					<div id="translateButton" class="ButtonInner" onclick="translateButtonClicked();">
		  				Translate 翻譯
					</div>
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="clearButtonClicked();" style="width:70px">
					Clear 清除
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="clearLocalStorage();" style="width:30px">
					MC
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="memoryPlus();" style="width:30px">
					M+
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="loadFromLocalStorage();" style="width:30px">
					MR
				</div>
			</td>
			<td>
				<div id="editButton" class="ButtonInner" onclick="openDictionaryEditor();" style="width:60px">
	  				Edit 編輯
				</div>
			</td>
			<td>
				<div id="advancedButton" class="ButtonInner" onclick="advancedButtonClicked();" style="width:110px">
	  				Advanced 進階功能
				</div>
			</td>
			<td>
				<div id="helpButton" class="ButtonInner" onclick="helpButtonClicked();" style="width:20px">
	  				?
				</div>
			</td>
			<td>
				<div id="loadRegionalButton" class="ButtonInner advanced" onclick="loadRegionalButtonClicked();" style="visibility:hidden;">
	  				Regional 區域
				</div>
			</td>
			<td>
				<div id="matrixButton" class="ButtonInner advanced" onclick="matrixButtonClicked();" style="visibility:hidden">
					Matrix 黑客
				</div>
			</td>
			<td>
				<div id="googleTranslatePhraseButton" class="ButtonInner advanced" onclick="googleTranslatePhraseButtonClicked();" style="visibility:hidden;width:100px">
	  				Google Translate
				</div>
			</td>
			<td>
				<div id="printButton" class="ButtonInner advanced" onclick="printButtonClicked();" style="visibility:hidden;width:60px">
	  				Print 印表
				</div>
			</td>
			<td>
				<div id="onlyTranslateButton" class="ButtonInner advanced" onclick="translateInterface();" style="visibility:hidden">
	  				Translate 翻譯
				</div>
			</td>
		</tr>
	</table>
	
	<div id="advancedRows" style="visibility:hidden;height:0px;">
	
		<table id="spaceButtonsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Spacing 空間
					</div>
				</td>
				<td>
					<div id="deradicalizeButton" class="ButtonInner advanced" onclick="deradicalizeButtonClicked();" style="visibility:hidden">
						Deradicalize
					</div>
				</td>
				<td>
					<div id="spaceButton" class="ButtonInner advanced" onclick="wordSpaceButtonClicked();" style="visibility:hidden">
						Words 話
					</div>
				</td>
				<td>
					<div id="characterSpaceButton" class="ButtonInner advanced" onclick="characterSpace();" style="visibility:hidden">
						Characters 汉字
					</div>
				</td>
				<td>
					<div id="despaceButton" class="ButtonInner advanced" onclick="despaceButtonClicked();" style="visibility:hidden">
						Despace 繼續
					</div>
				</td>
				<td>
					<input type="checkbox" id="monospaceTextCheckbox"><span onclick="toggleCheckbox('monospaceTextCheckbox');">Monospace text</span>
				</td>
				<td>
					<span onclick="toggleCheckbox('breakMissingWordsCheckbox');">
					<table>
						<tr>
							<td>
								<input type="checkbox" id="breakMissingWordsCheckbox" checked="true">
							</td>
							<td style="width:132px;white-space:normal">
									Break missing words 打破 遺漏 的 單詞
							</td>
						</tr>
						<tr>
							<td>
							</td>
							<td>
					 			
							</td>
						</tr>
					</table>
					</span>
				</td>
				<td>
					<textarea id="pageBreaksTextArea" rows="1" cols="3" >10</textarea>
				</td>
				<td>
					<input type="checkbox" id="pageBreaksCheckbox"><span onclick="toggleCheckbox('pageBreaksCheckbox');">Page Breaks</span>
				</td>
				<td>
					<div id="taiwaneseSpaceButton" class="ButtonInner regional" onclick="taiwaneseWordSpaceButtonClicked();" style="visibility:hidden">
						Taiwanese Space
					</div>
				</td>
			</tr>
		</table>

		<table id="dataButtonsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Data
					</div>
				</td>
				<td>
					<div id="subtitlesButton" class="ButtonInner advanced" onclick="subtitlesButtonClicked();" style="width:65px;visibility:hidden">
						Subtitles
					</div>
				</td>
				<td>
					<div id="examplesButton" class="ButtonInner advanced" onclick="examplesButtonClicked();" style="width:65px;visibility:hidden">
						Examples
					</div>
				</td>
				<td>
					<div id="vocabularyButton" class="ButtonInner advanced" onclick="vocabularyButtonClicked();" style="visibility:hidden">
						Vocabulary
					</div>
				</td>
				<td>
					<div id="audioButton" class="ButtonInner advanced" onclick="audioButtonClicked();" style="width:55px;visibility:hidden">
						Audio
					</div>
				</td>
				<td>
					<div id="swapButton" class="ButtonInner advanced" onclick="swapButtonClicked();" style="width:55px;visibility:hidden">
						Swap
					</div>
				</td>
				<td>
					<div id="splitButton" class="ButtonInner advanced" onclick="splitButtonClicked();" style="width:55px;visibility:hidden">
						Split
					</div>
				</td>
				<td>
					<div id="lineBreaksButton" class="ButtonInner advanced" onclick="lineBreaksButtonClicked();" style="width:70px;visibility:hidden">
						Line breaks
					</div>
				</td>
				<td>
					<div id="englishButton" class="ButtonInner advanced" onclick="englishButtonClicked();" style="width:55px;visibility:hidden">
						English
					</div>
				</td>
				<td>
					<div id="lyricsButton" class="ButtonInner advanced" onclick="lyricsButtonClicked();" style="width:55px;visibility:hidden">
						Lyrics
					</div>
				</td>
				<td>
					<div id="slidesButton" class="ButtonInner advanced" onclick="slidesButtonClicked();" style="width:55px;visibility:hidden">
						Slides
					</div>
				</td>
				<td>
					<div id="shuffleButton" class="ButtonInner advanced" onclick="shuffleButtonClicked();" style="width:55px;visibility:hidden">
						Shuffle
					</div>
				</td>
				<td>
					<div id="dictionaryButton" class="ButtonInner advanced" onclick="dictionaryButtonClicked();" style="width:75px;visibility:hidden">
						Dictionary
					</div>
				</td>
				<td>
					<div id="mediaViewerButton" class="ButtonInner advanced" onclick="mediaViewerButtonClicked();" style="width:90px;visibility:hidden">
						Media Viewer
					</div>
				</td>
				<td>
					<div id="alignLiteralButton" class="ButtonInner advanced" onclick="alignLiteralButtonClicked();" style="width:90px;visibility:hidden">
						Align Literal
					</div>
				</td>
				<td>
					<div id="memorySearchButton" class="ButtonInner advanced" onclick="memorySearchButtonClicked();" style="width:100px;visibility:hidden">
						Memory search
					</div>
				</td>
				<td>
					<div id="cursorButton" class="ButtonInner advanced" onclick="showCursorButtonClicked();" style="width:60px;visibility:hidden">
						Cursor
					</div>
				</td>
				<td>
					<div id="litManSizeButton" class="ButtonInner advanced" onclick="litManSizeButtonClicked();" style="width:80px;visibility:hidden">
						LitMan Size
					</div>
				</td>
			</tr>
		</table>
	
		<div id="simplifiedButtonsDiv" style="visibility:hidden;height:0px;">
			<table id="simplifiedButtonsTable" style="font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
				<tr>
					<td>
						<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
							Regional 區域
						</div>
					</td>
					<td>
						<div id="simplifiedToTraditionalButton" class="ButtonInner" onclick="simplifiedToTraditionalButtonClicked();" style="width:150px">
							Simplified To Traditional
						</div>
					</td>
					<td>
						<div id="spacedToSimplifiedButton" class="ButtonInner" onclick="spacedToSimplifiedButtonClicked();" style="width:120px">
							Spaced to Simplified
						</div>
					</td>
					<td>
						<div id="hongKongButton" class="ButtonInner" onclick="hongKongButtonClicked();" style="width:70px">
							Hong Kong
						</div>
					</td>
					<td>
						<div id="taiwanButton" class="ButtonInner" onclick="taiwanButtonClicked();" style="width:50px">
							Taiwan
						</div>
					</td>
					<td>
						<div id="japanButton" class="ButtonInner" onclick="japanButtonClicked();" style="width:50px">
							Japan
						</div>
					</td>
					<td>
						<div id="hexToChineseButton" class="ButtonInner" onclick="hexToChineseButtonClicked();" style="width:30px">
							Hex
						</div>
					</td>
					<td>
						<div id="unitypeToChineseButton" class="ButtonInner" onclick="unitypeToChineseButtonClicked();" style="width:50px">
							Unitype
						</div>
					</td>
					<td>
						<input type="checkbox" id="oracleBonesCheckbox" ><span onclick="toggleCheckbox('oracleBonesCheckbox');">Oracle Bones 甲骨文</span>
					</td>
					<td>
						<input type="checkbox" id="largeSealScriptCheckbox" ><span onclick="toggleCheckbox('largeSealScriptCheckbox');">Large Seal Script 大篆</span>
					</td>
					<td>
						<input type="checkbox" id="smallSealScriptCheckbox" ><span onclick="toggleCheckbox('smallSealScriptCheckbox');">Small Seal Script 小篆</span>
					</td>
					<td>
						<input type="checkbox" id="tangCheckbox" ><span onclick="toggleCheckbox('tangCheckbox');">Tang 唐朝</span>
					</td>
					<td>
						<input type="checkbox" id="japaneseCheckbox" ><span onclick="toggleCheckbox('japaneseCheckbox');">Japanese 音読み</span>
					</td>
					<td>
						<input type="checkbox" id="vietnameseCheckbox" ><span onclick="toggleCheckbox('vietnameseCheckbox');">Vietnamese 越南语</span>
					</td>
					<td>
						<input type="checkbox" id="hangulCheckbox" ><span onclick="toggleCheckbox('hangulCheckbox');">Hangul 한글</span>
					</td>
					<td>
						<input type="checkbox" id="cantoneseCheckbox" checked="true"><span onclick="toggleCheckbox('cantoneseCheckbox');">Cantonese 粵語</span>
					</td>
					<td>
						<input type="checkbox" id="taiwaneseCheckbox" ><span onclick="taiwaneseCheckboxClicked('taiwaneseCheckbox');">Taiwanese 台語</span>
					</td>
					<td>
						<input type="checkbox" id="hakkaCheckbox" ><span onclick="hakkaCheckboxClicked('hakkaCheckbox');">Hakka 客語</span>
					</td>
					<td>
						<div id="editTaiyuButton" class="ButtonInner" onclick="openTaiwaneseDictionaryEditor();" style="width:60px">
							EditTaiyu
						</div>
					</td>
					<td>
						<div id="editCantoneseButton" class="ButtonInner" onclick="openCantoneseDictionaryEditor();" style="width:90px">
							EditCantonese
						</div>
					</td>
				</tr>
			</table>
		</div>
	
		<table id="dictionariesTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Dictionaries 字典
					</div>
				</td>
				<td>
					<input type="checkbox" id="cnltDictionaryCheckbox" ><span onclick="toggleCheckbox('cnltDictionaryCheckbox');">CNLT</span>
				</td>
				<td>
					<input type="checkbox" id="cunpDictionaryCheckbox" ><span onclick="toggleCheckbox('cunpDictionaryCheckbox');">CUNP</span>
				</td>
				<td>
					<input type="checkbox" id="unihanDictionaryCheckbox" ><span onclick="toggleCheckbox('unihanDictionaryCheckbox');">Unihan</span>
				</td>
				<td>
					<input type="checkbox" id="cedictDictionaryCheckbox" ><span onclick="toggleCheckbox('cedictDictionaryCheckbox');">CEDICT</span>
				</td>
				<td>
					<input type="checkbox" id="zhWiktionaryDictionaryCheckbox" ><span onclick="toggleCheckbox('zhWiktionaryDictionaryCheckbox');">zh-wiktionary</span>
				</td>
				<td>
					<input type="checkbox" id="enWiktionaryDictionaryCheckbox" ><span onclick="toggleCheckbox('enWiktionaryDictionaryCheckbox');">en-wiktionary</span>
				</td>
				<td>
					<input type="checkbox" id="pingtypeDictionaryCheckbox" checked="true" ><span onclick="toggleCheckbox('pingtypeDictionaryCheckbox');">Pingtype</span>
				</td>
				<td>
					<div id="addWordsButton" class="ButtonInner advanced" onclick="addWordsButtonClicked();" style="visibility:hidden;width:100px">
						Add Words
					</div>
				</td>
				<td>
					<div id="addWordsButton" class="ButtonInner advanced" onclick="addEditRemoveWordsButtonClicked();" style="visibility:hidden;width:130px">
						AddEditRemove Files
					</div>
				</td>
				<td>
					<div id="findNewWordsButton" class="ButtonInner advanced" onclick="findNewWords();" style="visibility:hidden;width:100px">
						Find new words
					</div>
				</td>
				<td>
					<div id="loadDictionariesButton" class="ButtonInner advanced" onclick="loadDictionaries();" style="visibility:hidden;width:150px">
						Load Dictionaries 下載 字典
					</div>
				</td>
			</tr>
		</table>

		<table id="wordListsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Word Lists
					</div>
				</td>
				<td>
					<input type="checkbox" id="reviewingTheHanziCheckbox" ><span onclick="toggleReviewingTheHanzi('reviewingTheHanziCheckbox');">Reviewing The Hanzi</span>
				</td>
				<td>
					<input type="checkbox" id="hashOutCheckbox" ><span onclick="toggleCheckbox('hashOutCheckbox');">Hash out</span>
				</td>
				<td>
					<input type="checkbox" id="commonCheckbox" ><span onclick="toggleCheckbox('commonCheckbox');">Bible</span>
				</td>
				<td>
					TOCFL
				</td>
				<td>
					<input type="checkbox" id="tocflZeroCheckbox" ><span onclick="toggleCheckbox('tocflZeroCheckbox');">0</span>
				</td>
				<td>
					<input type="checkbox" id="tocflOneCheckbox" ><span onclick="toggleCheckbox('tocflOneCheckbox');">1</span>
				</td>
				<td>
					<input type="checkbox" id="tocflTwoCheckbox" ><span onclick="toggleCheckbox('tocflTwoCheckbox');">2</span>
				</td>
				<td>
					<input type="checkbox" id="tocflThreeCheckbox" ><span onclick="toggleCheckbox('tocflThreeCheckbox');">3</span>
				</td>
				<td>
					<input type="checkbox" id="tocflFourCheckbox" ><span onclick="toggleCheckbox('tocflFourCheckbox');">4</span>
				</td>
				<td>
					<input type="checkbox" id="tocflFiveCheckbox" ><span onclick="toggleCheckbox('tocflFiveCheckbox');">5</span>
				</td>
				<td>
					<input type="checkbox" id="tocflSixCheckbox" ><span onclick="toggleCheckbox('tocflSixCheckbox');">6</span>
				</td>
				<td>
					<input type="checkbox" id="tocflAllCheckbox" ><span onclick="toggleCheckbox('tocflAllCheckbox');">TOCFL</span>
				</td>
				<td>
					HSK
				</td>
				<td>
					<input type="checkbox" id="hskOneCheckbox" ><span onclick="toggleCheckbox('hskOneCheckbox');">1</span>
				</td>
				<td>
					<input type="checkbox" id="hskTwoCheckbox" ><span onclick="toggleCheckbox('hskTwoCheckbox');">2</span>
				</td>
				<td>
					<input type="checkbox" id="hskThreeCheckbox" ><span onclick="toggleCheckbox('hskThreeCheckbox');">3</span>
				</td>
				<td>
					<input type="checkbox" id="hskFourCheckbox" ><span onclick="toggleCheckbox('hskFourCheckbox');">4</span>
				</td>
				<td>
					<input type="checkbox" id="hskFiveCheckbox" ><span onclick="toggleCheckbox('hskFiveCheckbox');">5</span>
				</td>
				<td>
					<input type="checkbox" id="hskSixCheckbox" ><span onclick="toggleCheckbox('hskSixCheckbox');">6</span>
				</td>
				<td>
					<input type="checkbox" id="hskAllCheckbox" ><span onclick="toggleCheckbox('hskAllCheckbox');">HSK</span>
				</td>
				<td>
					<input type="checkbox" id="fireExCheckbox" ><span onclick="toggleCheckbox('fireExCheckbox');">Fire Ex</span>
				</td>
				<td>
					<div id="loadWordListsButton" class="ButtonInner advanced" onclick="loadWordLists();" style="visibility:hidden;width:100px">
						Load Word Lists
					</div>
				</td>
				<td>
					<div id="wordListPercent"></div>
				</td>
			</tr>
		</table>

		<table id="annotationsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Annotations 註釋
					</div>
				</td>
				<td>
					<input type="checkbox" id="chinesePlainCheckbox" ><span onclick="toggleCheckbox('chinesePlainCheckbox');">Chinese Plain 純</span>
					<input type="checkbox" id="chineseSpacedCheckbox" ><span onclick="toggleCheckbox('chineseSpacedCheckbox');">Chinese Spaced 空間</span>
					<input type="checkbox" id="chineseCheckbox" checked="true" ><span onclick="toggleCheckbox('chineseCheckbox');">Chinese 中文</span>
					<input type="checkbox" id="linkSlidersCheckbox" checked="true" ><span onclick="toggleCheckbox('linkSlidersCheckbox');">Link</span>
					<input type="range" id="pinyinOpacity" value="100" onclick="setPinyinOpacity();">
					<input type="checkbox" id="pinyinCheckbox" ><span onclick="toggleCheckbox('pinyinCheckbox');">Pinyin 拼音</span>
					<input type="checkbox" id="toneNumbersCheckbox" ><span onclick="toggleCheckbox('toneNumbersCheckbox');">#</span>
					<input type="checkbox" id="sizeCheckbox" checked="true" ><span onclick="toggleCheckbox('sizeCheckbox');">Size</span>
					<input type="range" id="literalOpacity" value="100" onclick="setLiteralOpacity();">
					<input type="checkbox" id="literalCheckbox" checked="true" ><span onclick="toggleCheckbox('literalCheckbox');">Literal 字面</span>
					<input type="checkbox" id="litManCheckbox" ><span onclick="toggleCheckbox('litManCheckbox');">LitMan</span>
					<input type="range" id="englishOpacity" value="100" onclick="setEnglishOpacity();">
					<input type="checkbox" id="englishCheckbox" checked="true" ><span onclick="toggleCheckbox('englishCheckbox');">English 英文</span>
					<input type="checkbox" id="hexCheckbox" ><span onclick="toggleCheckbox('hexCheckbox');">Hex</span>
					<input type="checkbox" id="unitypeCheckbox" ><span onclick="toggleCheckbox('unitypeCheckbox');">Unitype</span>
					<input type="checkbox" id="syllablesCheckbox" ><span onclick="toggleCheckbox('syllablesCheckbox');">Radicals 部首</span>
					<input type="checkbox" id="wadeGilesCheckbox" ><span onclick="toggleCheckbox('wadeGilesCheckbox');">Wade-Giles</span>
					<input type="checkbox" id="bopomofoCheckbox" ><span onclick="toggleCheckbox('bopomofoCheckbox');">ㄅㄆㄇㄈ</span>
					<span id="simplifiedCheckboxSpan" style="visibility:hidden;" onclick="toggleCheckbox('simplifiedSpacedCheckbox');"><input type="checkbox" id="simplifiedSpacedCheckbox" >Simplified 简化字</span>
				</td>
			</tr>
		</table>
	
	
		<table id="toneColoursTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Colours 顏色
					</div>
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerOne" value="000000" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerTwo" value="f82423" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerThree" value="189c19" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerFour" value="178FD1" onchange="updateColours();">
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerFive" value="000000" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerSix" value="F82423" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerSeven" value="929292" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerEight" value="000000" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div id="blackButton" class="ButtonInner advanced" onclick="blackColours();" style="visibility:hidden;width:50px">
						Black
					</div>
				</td>
				<td>
					<div id="greyButton" class="ButtonInner advanced" onclick="greyColours();" style="visibility:hidden;width:40px">
						Grey
					</div>
				</td>
				<td>
					<div id="peterButton" class="ButtonInner advanced" onclick="peterColours();" style="visibility:hidden;width:60px">
						Pingtype
					</div>
				</td>
				<td>
					<div id="plecoButton" class="ButtonInner advanced" onclick="plecoColours();" style="visibility:hidden;width:50px">
						Pleco
					</div>
				</td>
				<td>
					<div id="nathanButton" class="ButtonInner advanced" onclick="nathanColours();" style="visibility:hidden;width:50px">
						Nathan
					</div>
				</td>
				<td>
					<div id="mdbgButton" class="ButtonInner advanced" onclick="mdbgColours();" style="visibility:hidden;width:40px">
						MDBG
					</div>
				</td>
				<td>
					<div id="hanpingButton" class="ButtonInner advanced" onclick="hanpingColours();" style="visibility:hidden;width:60px">
						Hanping
					</div>
				</td>
				<td>
					<div id="taiwaneseButton" class="ButtonInner regional" onclick="taiwaneseColours();" style="visibility:hidden">
						Taiwanese
					</div>
				</td>
				<td>
					<div id="cantoneseButton" class="ButtonInner regional" onclick="cantoneseColours();" style="visibility:hidden">
						Cantonese
					</div>
				</td>
				<td>
					<div id="hakkaButton" class="ButtonInner regional" onclick="hakkaColours();" style="visibility:hidden;width:90px">
						Hakka
					</div>
				</td>
			</tr>
		</table>
		
		<div id="toneColoursRegionalDiv" class="regional" style="visibility:hidden;height:0px;">
			<table id="toneColoursRegionalTable" style="font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
				<tr>
					<td>
						Pinyin
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerOne" value="000000" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerTwo" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerThree" value="189c19" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerFour" value="178FD1" onchange="updateColours();">
					</td>
				</tr>
				<tr>
					<td>
						Taiwanese
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerOne" value="999999" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerTwo" value="178FD1" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerThree" value="0000ff" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerFour" value="505050" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerFive" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerSeven" value="000000" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerEight" value="929292" onchange="updateColours();">
					</td>
				</tr>
				<tr>
					<td>
						Cantonese
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerOne" value="929292" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerTwo" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerThree" value="797986" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerFour" value="0000ff" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerFive" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerSix" value="000000" onchange="updateColours();">
					</td>
				</tr>
				<tr>
					<td>
						Hakka
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerOne" value="000000" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerTwo" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerThree" value="178FD1" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerFour" value="189c19" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerFive" value="0000FF" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="hakkaColourPickerSix" value="F08000" onchange="updateColours();">
					</td>
				</tr>
			</table>
		</div>
		
		<table id="filenameTable" class="advanced" style="visibility:hidden;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Filename 文件名
					</div>
				</td>
				<td>
					<textarea id="filenameTextArea" rows="1" cols="50" >filename.txt</textarea>
				</td>
				<td>
					<input type="checkbox" id="useGithubCheckbox" ><span onclick="toggleCheckbox('useGithubCheckbox');">Use Github</span>
				</td>
				<td>
					<div class="ButtonInner" onclick="saveLitMan();">
						Save LitMan
					</div>
				</td>
				<td>
					<div class="ButtonInner" onclick="saveHtml();">
						Save HTML 保存
					</div>
				</td>
				<td>
					<div class="ButtonInner" onclick="saveText();">
						Save Text 保存
					</div>
				</td>
			</tr>
		</table>
		
	
		<table id="missingWordsTable" class="advanced" style="visibility:hidden;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;"></table>
	
	</div>
	
	<div id="videoContainer" style="visibility:hidden;height:0px;" onclick="videoPlayPause();">
		<video poster="" preload="none" controls="" id="myVideo" tabindex="0">
			<source type="video/mp4" src="" id="mp4_src"></source>
			<p>Your user agent does not support the HTML5 Video element.</p>
		</video>
	</div>
	
	<table id="htmlTable">
		<tr>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					HTML output 彩色 輸出
  				</div>
			</td>
		</tr>
  		<tr>
  			<td>
  				<div id="outputHtml"></div>
  			</td>
  		</td>
	</table>
	
	<table id="textTable">
  		<tr>
  		</tr>
  	</table>

	<table id="matrix"></table>

	
	<table id="imageTable">
  		<tr>
  			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Image 照片
  				</div>
  			</td>
  		</tr>
  		<tr>
  			<td>
  				<input type="file" id="imageLoader" name="imageLoader"/>
  			</td>
  		</tr>
	</table>

	<div id="drawing" style="width: 0px; height: 0px;"></div>

	<table id="decomposeTable" style="font-size: 32px;font-family: 'Pingfang', 'Jhenghei', 'HanaMinB', 'Heiti TC Light', 'Tahoma', 'Geneva', sans-serif;">

		

		<tr>
			<td>
				<div id="thisPhraseTable" class="advanced" style="visibility:hidden;height:0px;width:0px">
					<table>
						<tr>
  							<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  								Phrase 短語
  							</div>
						</tr>
						<tr>
							<td>	
								<textarea id="thisPhrase" name="thisPhrase" rows="3" cols="30" style="font-size: 16px;"></textarea>
							</td>
						</tr>
					</table>
				</div>
    		</td>
    	</tr>

		<tr>
			<td>
				<table>
					<tr>
						<td>
							<div id="leftCharacter"></div>
						</td>
						<td>
							<div id="rightCharacter"></div>
						</td>
					</tr>
				</table>
			</td>
    	</tr>
    	
    	<tr>
    		<td>
    			<div id="reviewArea" style="width:100px;font-family: sans-serif; font-size: 10px;"></div>
    		</td>
    	</tr>


		<tr>
			<table>
				<tr>
					<td>
						<div id="pinyinKeyboard" style="width:0px;height:0px;">
							<table>
								<tr>
									<td><div class="key" onclick="typeCharacter('q')">q</div></td>
									<td><div class="key" onclick="typeCharacter('w')">w</div></td>
									<td><div class="key" onclick="typeCharacter('e')">e</div></td>
									<td><div class="key" onclick="typeCharacter('r')">r</div></td>
									<td><div class="key" onclick="typeCharacter('t')">t</div></td>
									<td><div class="key" onclick="typeCharacter('y')">y</div></td>
									<td><div class="key" onclick="typeCharacter('u')">u</div></td>
									<td><div class="key" onclick="typeCharacter('i')">i</div></td>
									<td><div class="key" onclick="typeCharacter('o')">o</div></td>
									<td><div class="key" onclick="typeCharacter('p')">p</div></td>
								</tr>
							</table>
							<table style="margin-left:10px">
								<tr>
									<td><div class="key" onclick="typeCharacter('a')">a</div></td>
									<td><div class="key" onclick="typeCharacter('s')">s</div></td>
									<td><div class="key" onclick="typeCharacter('d')">d</div></td>
									<td><div class="key" onclick="typeCharacter('f')">f</div></td>
									<td><div class="key" onclick="typeCharacter('g')">g</div></td>
									<td><div class="key" onclick="typeCharacter('h')">h</div></td>
									<td><div class="key" onclick="typeCharacter('j')">j</div></td>
									<td><div class="key" onclick="typeCharacter('k')">k</div></td>
									<td><div class="key" onclick="typeCharacter('l')">l</div></td>
								</tr>
							</table>
							<table style="margin-left:20px">
								<tr>
									<td><div class="key" onclick="typeCharacter('z')">z</div></td>
									<td><div class="key" onclick="typeCharacter('x')">x</div></td>
									<td><div class="key" onclick="typeCharacter('c')">c</div></td>
									<td><div class="key" onclick="typeCharacter('v')">v</div></td>
									<td><div class="key" onclick="typeCharacter('b')">b</div></td>
									<td><div class="key" onclick="typeCharacter('n')">n</div></td>
									<td><div class="key" onclick="typeCharacter('m')">m</div></td>
									<td><div class="key" onclick="typeCharacter('delete')">⌫</div></td>
									<td><div class="key" onclick="searchPinyinButtonClicked()">⏎</div></td>
								</tr>
							</table>
							<table style="margin-left:90px">
								<tr>
									<td><div class="key" style="width:100px;align:center" onclick="typeCharacter(' ')">space</div></td>
								</tr>
							</table>
						 </div>
					</td>
					
					<td>
						<div id="radicalKeyboard" style="width:0px;height:0px;visibility:hidden">
							<table>
						  <tr>
							   <td><div onclick="typeCharacter('一')">一</div></td>
							   <td><div onclick="typeCharacter('乙')">乙</div></td>
							   <td><div onclick="typeCharacter('丁')">丁</div></td>
							   <td><div onclick="typeCharacter('七')">七</div></td>
							   <td><div onclick="typeCharacter('乂')">乂</div></td>
							   <td><div onclick="typeCharacter('乜')">乜</div></td>
							   <td><div onclick="typeCharacter('九')">九</div></td>
							   <td><div onclick="typeCharacter('了')">了</div></td>
							   <td><div onclick="typeCharacter('二')">二</div></td>
							   <td><div onclick="typeCharacter('人')">人</div></td>
							   <td><div onclick="typeCharacter('八')">八</div></td>
							   <td><div onclick="typeCharacter('刀')">刀</div></td>
							   <td><div onclick="typeCharacter('刁')">刁</div></td>
							   <td><div onclick="typeCharacter('力')">力</div></td>
							   <td><div onclick="typeCharacter('匕')">匕</div></td>
							   <td><div onclick="typeCharacter('十')">十</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('又')">又</div></td>
							   <td><div onclick="typeCharacter('上')">上</div></td>
							   <td><div onclick="typeCharacter('下')">下</div></td>
							   <td><div onclick="typeCharacter('久')">久</div></td>
							   <td><div onclick="typeCharacter('乞')">乞</div></td>
							   <td><div onclick="typeCharacter('也')">也</div></td>
							   <td><div onclick="typeCharacter('兀')">兀</div></td>
							   <td><div onclick="typeCharacter('凢')">凢</div></td>
							   <td><div onclick="typeCharacter('勺')">勺</div></td>
							   <td><div onclick="typeCharacter('及')">及</div></td>
							   <td><div onclick="typeCharacter('口')">口</div></td>
							   <td><div onclick="typeCharacter('女')">女</div></td>
							   <td><div onclick="typeCharacter('子')">子</div></td>
							   <td><div onclick="typeCharacter('孓')">孓</div></td>
							   <td><div onclick="typeCharacter('山')">山</div></td>
							   <td><div onclick="typeCharacter('川')">川</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('工')">工</div></td>
							   <td><div onclick="typeCharacter('己')">己</div></td>
							   <td><div onclick="typeCharacter('巳')">巳</div></td>
							   <td><div onclick="typeCharacter('巾')">巾</div></td>
							   <td><div onclick="typeCharacter('幺')">幺</div></td>
							   <td><div onclick="typeCharacter('弋')">弋</div></td>
							   <td><div onclick="typeCharacter('弓')">弓</div></td>
							   <td><div onclick="typeCharacter('彳')">彳</div></td>
							   <td><div onclick="typeCharacter('不')">不</div></td>
							   <td><div onclick="typeCharacter('丏')">丏</div></td>
							   <td><div onclick="typeCharacter('丹')">丹</div></td>
							   <td><div onclick="typeCharacter('予')">予</div></td>
							   <td><div onclick="typeCharacter('互')">互</div></td>
							   <td><div onclick="typeCharacter('亢')">亢</div></td>
							   <td><div onclick="typeCharacter('仉')">仉</div></td>
							   <td><div onclick="typeCharacter('仍')">仍</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('允')">允</div></td>
							   <td><div onclick="typeCharacter('勾')">勾</div></td>
							   <td><div onclick="typeCharacter('勿')">勿</div></td>
							   <td><div onclick="typeCharacter('匀')">匀</div></td>
							   <td><div onclick="typeCharacter('匹')">匹</div></td>
							   <td><div onclick="typeCharacter('升')">升</div></td>
							   <td><div onclick="typeCharacter('卞')">卞</div></td>
							   <td><div onclick="typeCharacter('卬')">卬</div></td>
							   <td><div onclick="typeCharacter('尹')">尹</div></td>
							   <td><div onclick="typeCharacter('尺')">尺</div></td>
							   <td><div onclick="typeCharacter('巴')">巴</div></td>
							   <td><div onclick="typeCharacter('廿')">廿</div></td>
							   <td><div onclick="typeCharacter('心')">心</div></td>
							   <td><div onclick="typeCharacter('戈')">戈</div></td>
							   <td><div onclick="typeCharacter('户')">户</div></td>
							   <td><div onclick="typeCharacter('方')">方</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('止')">止</div></td>
							   <td><div onclick="typeCharacter('氏')">氏</div></td>
							   <td><div onclick="typeCharacter('水')">水</div></td>
							   <td><div onclick="typeCharacter('火')">火</div></td>
							   <td><div onclick="typeCharacter('爪')">爪</div></td>
							   <td><div onclick="typeCharacter('片')">片</div></td>
							   <td><div onclick="typeCharacter('牙')">牙</div></td>
							   <td><div onclick="typeCharacter('瓦')">瓦</div></td>
							   <td><div onclick="typeCharacter('𠙶')">𠙶</div></td>
							   <td><div onclick="typeCharacter('仫')">仫</div></td>
							   <td><div onclick="typeCharacter('冊')">冊</div></td>
							   <td><div onclick="typeCharacter('凸')">凸</div></td>
							   <td><div onclick="typeCharacter('凹')">凹</div></td>
							   <td><div onclick="typeCharacter('匄')">匄</div></td>
							   <td><div onclick="typeCharacter('印')">印</div></td>
							   <td><div onclick="typeCharacter('囙')">囙</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('四')">四</div></td>
							   <td><div onclick="typeCharacter('宂')">宂</div></td>
							   <td><div onclick="typeCharacter('廵')">廵</div></td>
							   <td><div onclick="typeCharacter('弁')">弁</div></td>
							   <td><div onclick="typeCharacter('斥')">斥</div></td>
							   <td><div onclick="typeCharacter('母')">母</div></td>
							   <td><div onclick="typeCharacter('氕')">氕</div></td>
							   <td><div onclick="typeCharacter('永')">永</div></td>
							   <td><div onclick="typeCharacter('氾')">氾</div></td>
							   <td><div onclick="typeCharacter('犯')">犯</div></td>
							   <td><div onclick="typeCharacter('瓜')">瓜</div></td>
							   <td><div onclick="typeCharacter('皿')">皿</div></td>
							   <td><div onclick="typeCharacter('矛')">矛</div></td>
							   <td><div onclick="typeCharacter('艿')">艿</div></td>
							   <td><div onclick="typeCharacter('邙')">邙</div></td>
							   <td><div onclick="typeCharacter('㠯')">㠯</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('乒')">乒</div></td>
							   <td><div onclick="typeCharacter('乓')">乓</div></td>
							   <td><div onclick="typeCharacter('争')">争</div></td>
							   <td><div onclick="typeCharacter('亙')">亙</div></td>
							   <td><div onclick="typeCharacter('兆')">兆</div></td>
							   <td><div onclick="typeCharacter('刑')">刑</div></td>
							   <td><div onclick="typeCharacter('匠')">匠</div></td>
							   <td><div onclick="typeCharacter('危')">危</div></td>
							   <td><div onclick="typeCharacter('回')">回</div></td>
							   <td><div onclick="typeCharacter('州')">州</div></td>
							   <td><div onclick="typeCharacter('曳')">曳</div></td>
							   <td><div onclick="typeCharacter('氖')">氖</div></td>
							   <td><div onclick="typeCharacter('氘')">氘</div></td>
							   <td><div onclick="typeCharacter('汎')">汎</div></td>
							   <td><div onclick="typeCharacter('竹')">竹</div></td>
							   <td><div onclick="typeCharacter('羽')">羽</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('而')">而</div></td>
							   <td><div onclick="typeCharacter('臣')">臣</div></td>
							   <td><div onclick="typeCharacter('舟')">舟</div></td>
							   <td><div onclick="typeCharacter('艸')">艸</div></td>
							   <td><div onclick="typeCharacter('芃')">芃</div></td>
							   <td><div onclick="typeCharacter('芒')">芒</div></td>
							   <td><div onclick="typeCharacter('衣')">衣</div></td>
							   <td><div onclick="typeCharacter('邢')">邢</div></td>
							   <td><div onclick="typeCharacter('阨')">阨</div></td>
							   <td><div onclick="typeCharacter('卵')">卵</div></td>
							   <td><div onclick="typeCharacter('形')">形</div></td>
							   <td><div onclick="typeCharacter('戼')">戼</div></td>
							   <td><div onclick="typeCharacter('汧')">汧</div></td>
							   <td><div onclick="typeCharacter('汽')">汽</div></td>
							   <td><div onclick="typeCharacter('沂')">沂</div></td>
							   <td><div onclick="typeCharacter('沉')">沉</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('芹')">芹</div></td>
							   <td><div onclick="typeCharacter('苉')">苉</div></td>
							   <td><div onclick="typeCharacter('苊')">苊</div></td>
							   <td><div onclick="typeCharacter('苣')">苣</div></td>
							   <td><div onclick="typeCharacter('近')">近</div></td>
							   <td><div onclick="typeCharacter('邱')">邱</div></td>
							   <td><div onclick="typeCharacter('兔')">兔</div></td>
							   <td><div onclick="typeCharacter('所')">所</div></td>
							   <td><div onclick="typeCharacter('泖')">泖</div></td>
							   <td><div onclick="typeCharacter('茆')">茆</div></td>
							   <td><div onclick="typeCharacter('洄')">洄</div></td>
							   <td><div onclick="typeCharacter('派')">派</div></td>
							   <td><div onclick="typeCharacter('茫')">茫</div></td>
							   <td><div onclick="typeCharacter('茴')">茴</div></td>
							   <td><div onclick="typeCharacter('迴')">迴</div></td>
							   <td><div onclick="typeCharacter('飛')">飛</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('展')">展</div></td>
							   <td><div onclick="typeCharacter('流')">流</div></td>
							   <td><div onclick="typeCharacter('烏')">烏</div></td>
							   <td><div onclick="typeCharacter('芻')">芻</div></td>
							   <td><div onclick="typeCharacter('偽')">偽</div></td>
							   <td><div onclick="typeCharacter('康')">康</div></td>
							   <td><div onclick="typeCharacter('涵')">涵</div></td>
							   <td><div onclick="typeCharacter('痐')">痐</div></td>
							   <td><div onclick="typeCharacter('菡')">菡</div></td>
							   <td><div onclick="typeCharacter('逮')">逮</div></td>
							   <td><div onclick="typeCharacter('鳥')">鳥</div></td>
							   <td><div onclick="typeCharacter('無')">無</div></td>
							   <td><div onclick="typeCharacter('虜')">虜</div></td>
							   <td><div onclick="typeCharacter('𦵏')">𦵏</div></td>
							 </tr>
						   <tr>
							   <td><div onclick="typeCharacterBefore('⿰')">⿰</div></td>
							   <td><div onclick="typeCharacterBefore('⿱')">⿱</div></td>
							   <td><div onclick="typeCharacterBefore('⿲')">⿲</div></td>
							   <td><div onclick="typeCharacterBefore('⿳')">⿳</div></td>
							   <td><div onclick="typeCharacterBefore('⿴')">⿴</div></td>
							   <td><div onclick="typeCharacterBefore('⿵')">⿵</div></td>
							   <td><div onclick="typeCharacterBefore('⿶')">⿶</div></td>
							   <td><div onclick="typeCharacterBefore('⿷')">⿷</div></td>
							   <td><div onclick="typeCharacterBefore('⿸')">⿸</div></td>
							   <td><div onclick="typeCharacterBefore('⿹')">⿹</div></td>
							   <td><div onclick="typeCharacterBefore('⿺')">⿺</div></td>
							   <td><div onclick="typeCharacterBefore('⿻')">⿻</div></td>
							   <td><div onclick="typeCharacterBefore('.')">.</div></td>
							   <td><div onclick="typeCharacterBefore('.*')">.*</div></td>
						   </tr>
							
					  </table>
						 </div>
    				</td>
    				
    				<td>
    					<div id="decomposeBopomofoKeyboard" style="width:0px;height:0px;visibility:hidden">
							<table>
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄅ')">ㄅ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄉ')">ㄉ</div></td>
									<td><div class="key" onclick="typeCharacter('ˇ')">ˇ</div></td>
									<td><div class="key" onclick="typeCharacter('ˋ')">ˋ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄓ')">ㄓ</div></td>
									<td><div class="key" onclick="typeCharacter('ˊ')">ˊ</div></td>
									<td><div class="key" onclick="typeCharacter('˙')">˙</div></td>
									<td><div class="key" onclick="typeCharacter('ㄚ')">ㄚ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄞ')">ㄞ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄢ')">ㄢ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄦ')">ㄦ</div></td>
								</tr>
							</table>
							<table style="margin-left:10px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄆ')">ㄆ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄊ')">ㄊ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄍ')">ㄍ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄐ')">ㄐ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄔ')">ㄔ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄗ')">ㄗ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄧ')">ㄧ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄛ')">ㄛ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄟ')">ㄟ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄣ')">ㄣ</div></td>
								</tr>
							</table>
							<table style="margin-left:20px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄇ')">ㄇ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄋ')">ㄋ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄎ')">ㄎ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄑ')">ㄑ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄕ')">ㄕ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄘ')">ㄘ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄨ')">ㄨ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄜ')">ㄜ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄠ')">ㄠ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄤ')">ㄤ</div></td>
								</tr>
							</table>
							<table style="margin-left:30px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄈ')">ㄈ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄌ')">ㄌ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄏ')">ㄏ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄒ')">ㄒ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄖ')">ㄖ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄙ')">ㄙ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄩ')">ㄩ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄝ')">ㄝ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄡ')">ㄡ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄥ')">ㄥ</div></td>
								</tr>
							</table>
							<table style="margin-left:90px">
								<tr>
									<td><div class="key" style="width:100px;align:center" onclick="typeCharacter(' ')">space</div></td>
									<td><div class="key" onclick="typeCharacter('delete')">⌫</div></td>
									<td><div class="key" onclick="searchCharacter()">⏎</div></td>
								</tr>
							</table>
    					</div>
    				</td>
				</tr>
			</table>
    	</tr>


		<tr>
			<td>
				<table>
					<tr>
						<td>	
							<textarea id="startCharacter" name="startCharacter" rows="2" cols="6" style="font-size: 32px;font-family: 'Pingfang', 'Jhenghei', 'HanaMinB', 'Heiti TC Light', 'Tahoma', 'Geneva', sans-serif;">隹</textarea>
						</td>
						
						<td>
							
							<table>
							
								<tr>
									<td>
									  	<div class="ButtonInner" onclick="togglePinyinKeyboard();">
									  	<!-- ⌨ -->
	  										Keyboard 鍵盤
										</div>
									</td>
									<td>
										<div id="searchPinyinButton" class="ButtonInner advanced" onclick="searchPinyinButtonClicked();" style="visibility:hidden">
										Pinyin
										</div>
									</td>
									<td>
										<div id="drawGenealogyButton" class="ButtonInner advanced" onclick="drawGenealogyButtonClicked();" style="visibility:hidden">
										Genealogy 家譜
										</div>
									</td>
									<td>
										<div id="wadeGilesButton" class="ButtonInner regional" onclick="searchWadeGilesButtonClicked();" style="visibility:hidden">
											Wade-Giles
										</div>
									</td>
									<td>
										<div id="searchTaiwaneseButton" class="ButtonInner regional" onclick="searchTaiwaneseButtonClicked();" style="visibility:hidden">
											Taiwanese
										</div>
									</td>
									<td>
										<div id="searchHakkaButton" class="ButtonInner regional" onclick="searchHakkaButtonClicked();" style="width:100px;visibility:hidden">
											Hakka
										</div>
									</td>
								</tr>
								<tr>
									<td>
									  	<div class="DefaultButtonOuter">
					  						<div class="ButtonInner" onclick="searchCharacter();">
	  											Search 找
											</div>
										</div>
									</td>
									<td>
										<div id="decomposeBopomofoButton" class="ButtonInner advanced" onclick="toggleDecomposeBopomofoKeyboard();" style="visibility:hidden;">
										ㄅㄆㄇㄈ
										</div>
									</td>
									<td>
										<div id="hexButton" class="ButtonInner regional" onclick="searchHexButtonClicked();" style="visibility:hidden">
											Hex
										</div>
									</td>
									<td>
										<div id="hangulButton" class="ButtonInner regional" onclick="searchHangulButtonClicked();" style="visibility:hidden">
											Hangul
										</div>
									</td>
									<td>
										<div id="searchCantoneseButton" class="ButtonInner regional" onclick="searchCantoneseButtonClicked();" style="visibility:hidden">
											Cantonese
										</div>
									</td>
									<td>
									</td>
								</tr>
								
								<tr>
									<td>
								  		<div class="ButtonInner" onclick="insertButtonClicked();">
	  										Insert 插
										</div>
									</td>
									<td>
									  	<div id="radicalButton" class="ButtonInner advanced" onclick="toggleRadicalKeyboard();"  style="visibility:hidden">
	  										Radicals 部首
										</div>
									</td>
									<td>
										<div id="unitypeButton" class="ButtonInner regional" onclick="searchUnitypeButtonClicked();" style="visibility:hidden">
											Unitype
										</div>
									</td>
									<td>
										<div id="japaneseButton" class="ButtonInner regional" onclick="searchJapaneseButtonClicked();" style="visibility:hidden">
											Japanese
										</div>
									</td>
									<td>
										<div id="vietnameseButton" class="ButtonInner regional" onclick="searchVietnameseButtonClicked();" style="visibility:hidden">
											Vietnamese
										</div>
									</td>
									<td>
									</td>
								</tr>
								
							
							</table>
							
							
						</td>
						
					</tr>
				</table>
    		</td>
    	</tr>
    	
		<tr>
			<td>
				<table>
					<tr>
						<td>
							<div id="charCode"></div>
						</td>
						<td>
							<div id="pinyin" style="font-family: 'Heiti TC Light', 'Tahoma', 'Geneva', sans-serif;"></div>
						</td>
						<td>
							<div id="definition"></div>
						</td>
					</tr>
				</table>
			</td>
    	</tr>
    	
		<tr>
			<td>
				<div id="childCharacters" style="font-family: 'Pingfang', 'Jhenghei', 'HanaMinB', 'Heiti TC Light', 'Tahoma', 'Geneva', sans-serif;">
				
				</div>
			</td>
		</tr>

		<tr>
			<td>
				<div id="characterWords" style="font-family: 'Pingfang', 'Jhenghei', 'HanaMinB', 'Heiti TC Light', 'Tahoma', 'Geneva', sans-serif;">
				
				</div>
			</td>
		</tr>

    </table>

	<div id="debugDiv" class="advanced" style="visibility:hidden">
		<p style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">Debug 調試</p>
  		<textarea id="debugTextArea" rows="10" cols="50" ></textarea>
	</div>

  	<div id="resultsHtml"></div>
	
	<!-- Dictionary editor dialog -->
	<div id="dictionaryEditor" title="Dictionary Editor" style="visibility:hidden">

	    <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		    Upload
	    </div>
	    
	    <table style="width:100%">
	    	<tr>
	    		<td>
	    			<div id="addedLabel">0 added</div>
	    		</td>
	    		<td>
	    			<div id="editedLabel">0 edited</div>
	    		</td>
	    		<td>
	    			<div id="deletedLabel">0 deleted</div>
	    		</td>
	    		<td>
	    			<div id="uploadedLabel">0 uploaded</div>
	    		</td>
	    		<td>
	    			<div id="uploadButtonTable" onclick="uploadButtonClicked();">
		    			<table>
		    				<tr>
	    						<td>
	    							<!--<img src="sync.png"</img>-->
	    							<div style="font-size:16px">
	    								🔄
	    							</div>
	    						</td>
	    						<td>
	    							Upload
	    						</td>
		    				</tr>
		    			</table>
		    		</div>
	    		</td>
	    	</tr>
	    </table>
		
	   <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		   Add/Edit
	   </div>


	   <div id="bopomofoKeyboard" style="width:100px;height:5px;visibility:hidden">
		   <table>
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄅ')">ㄅ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄉ')">ㄉ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˇ')">ˇ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˋ')">ˋ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄓ')">ㄓ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˊ')">ˊ</div></td>
				   <td><div class="key" onclick="typeBopomofo('˙')">˙</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄚ')">ㄚ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄞ')">ㄞ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄢ')">ㄢ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄦ')">ㄦ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:10px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄆ')">ㄆ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄊ')">ㄊ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄍ')">ㄍ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄐ')">ㄐ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄔ')">ㄔ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄗ')">ㄗ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄧ')">ㄧ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄛ')">ㄛ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄟ')">ㄟ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄣ')">ㄣ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:20px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄇ')">ㄇ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄋ')">ㄋ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄎ')">ㄎ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄑ')">ㄑ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄕ')">ㄕ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄘ')">ㄘ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄨ')">ㄨ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄜ')">ㄜ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄠ')">ㄠ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄤ')">ㄤ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:30px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄈ')">ㄈ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄌ')">ㄌ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄏ')">ㄏ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄒ')">ㄒ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄖ')">ㄖ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄙ')">ㄙ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄩ')">ㄩ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄝ')">ㄝ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄡ')">ㄡ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄥ')">ㄥ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:90px">
			   <tr>
				   <td><div class="key" style="width:100px;align:center" onclick="typeBopomofo(' ')">space</div></td>
				   <td><div class="key" onclick="typeBopomofo('delete')">⌫</div></td>
				   <td><div class="key" onclick="bopomofoToPinyin()">⏎</div></td>
			   </tr>
		   </table>
		</div>
	
		<table>
			<tr>
				<td>
					Chinese
				</td>
				<td>
					<textarea id="dictionaryEditorChineseTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="dictionaryEditorCharsButton" class="ButtonInner" onclick="dictionaryEditorCharsButtonClicked();" style="width:100px">
									Chars to Pinyin
								</div>
							</td>
							<td>
								<div id="dictionaryEditorSearchKey" class="key" onclick="dictionaryEditorSearch()">🔍</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<table>
						<tr>
							<td>
								Pinyin
							</td>
						</tr>
						<tr>
							<td>
								(e.g. píng xíng)
							</td>
						</tr>
					</table>
				</td>
				<td>
					<textarea id="dictionaryEditorPinyinTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="dictionaryEditorBopomofoButton" class="ButtonInner" onclick="dictionaryEditorBopomofoButtonClicked();" style="width:60px">
									ㄅㄆㄇㄈ
								</div>
							</td>
							<td>
								<div id="dictionaryEditorNumbersToMarksButton" class="ButtonInner" onclick="toneNumbersToToneMarks();" style="width:70px">
									# to marks
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					English
				</td>
				<td>
					<textarea id="dictionaryEditorEnglishTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="dictionaryEditorGoogleTranslateButton" class="ButtonInner" onclick="dictionaryEditorGoogleTranslateButtonClicked();" style="width:60px">
									Google
								</div>
							</td>
							<td>
								<div id="dictionaryEditorGoogleTransPyButton" class="ButtonInner" onclick="dictionaryEditorGoogleTransPyButtonClicked();" style="width:40px" style="visibility:hidden">
									GtPy
								</div>
							</td>
							<td>
								<div id="dictionaryEditorGoogleTransProxyButton" class="ButtonInner" onclick="dictionaryEditorGoogleTransProxyButtonClicked();" style="width:40px" style="visibility:hidden">
									GtPx
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="dictionaryEditorAddButton" class="ButtonInner" onclick="dictionaryEditorAddButtonClicked();">
							Add
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<table>
			<tr>
				<td>
			  		<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  						Remove
			  		</div>
		  		</td>
		  	</tr>
			<tr>
				<td>
					<textarea id="dictionaryEditorRemoveTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="dictionaryEditorRemoveButton" class="ButtonInner" onclick="dictionaryEditorRemoveButtonClicked();">
							Remove
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<div style="margin-left:120px">
			<div id="defaultTranslateButton" class="DefaultButtonOuter">
				<div id="retranslateButton" class="ButtonInner" onclick="translateButtonClicked();">
					Retranslate
				</div>
			</div>
		</div>
		
	</div>
	
	
	<div id="taiwaneseDictionaryEditor" title="Taiwanese Editor" style="visibility:hidden">
		
		<table>
			<tr>
				<td>
			    	<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
				    	Options
			    	</div>
			    </td>
			    <td>
					<select id="taiwaneseDefinitionDropdown" onchange="taiwaneseDictionaryEditorDropdownChanged();">
						<option value="1"></option>
					</select>
			    </td>
			    <td>
					<div id="taiwaneseDictionaryEditorTopButton" class="ButtonInner" onclick="taiwaneseMoveDefinitionToTop();" style="width:25px">
						Top
					</div>
			    </td>
			    <td>
					<div id="taiwaneseDictionaryEditorUpButton" class="ButtonInner" onclick="taiwaneseMoveDefinitionUp();" style="width:25px">
						Up
					</div>
			    </td>
			    <td>
					<div id="taiwaneseDictionaryEditorDownButton" class="ButtonInner" onclick="taiwaneseMoveDefinitionDown();" style="width:40px">
						Down
					</div>
			    </td>
			</tr>
		</table>
	   
	   
		
	   <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		   Add/Edit
	   </div>

		<table>
			<tr>
				<td>
					Chinese
				</td>
				<td>
					<textarea id="taiwaneseDictionaryEditorChineseTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="taiwaneseDictionaryEditorCharsToPojButton" class="ButtonInner" onclick="taiwaneseCharsToPoj();" style="width:70px">
									Chars to POJ
								</div>
							</td>
							<td>
								<div id="taiwaneseDictionaryEditorSearchKey" class="key" onclick="taiwaneseDictionaryEditorSearch()">🔍</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<table>
						<tr>
							<td>
								POJ
							</td>
						</tr>
					</table>
				</td>
				<td>
					<textarea id="taiwaneseDictionaryEditorPojTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="taiwaneseDictionaryEditorMarksToNumbersButton" class="ButtonInner" onclick="taiwaneseToneMarksToNumbers();" style="width:70px">
									Marks to #
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					Tones
				</td>
				<td>
					<textarea id="taiwaneseDictionaryEditorTonesTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="taiwaneseDictionaryEditorAddButton" class="ButtonInner" onclick="taiwaneseDictionaryEditorAddButtonClicked();" style="width:70px">
									Append
								</div>
							</td>
							<td>
								<div id="taiwaneseDictionaryEditorEditButton" class="ButtonInner" onclick="taiwaneseDictionaryEditorEditButtonClicked();" style="width:50px">
									Edit
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		
		<table>
			<tr>
				<td>
			  		<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  						Remove
			  		</div>
		  		</td>
		  	</tr>
			<tr>
				<td>
					<textarea id="taiwaneseDictionaryEditorRemoveTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="taiwaneseDictionaryEditorRemoveButton" class="ButtonInner" onclick="taiwaneseDictionaryEditorRemoveButtonClicked();">
							Remove
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<div style="margin-left:120px">
			<div id="defaultTranslateButton" class="DefaultButtonOuter">
				<div id="retranslateButton" class="ButtonInner" onclick="translateButtonClicked();">
					Retranslate
				</div>
			</div>
		</div>
		
	</div>

	<div id="cantoneseDictionaryEditor" title="Cantonese Editor" style="visibility:hidden">
		
		<table>
			<tr>
				<td>
			    	<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
				    	Options
			    	</div>
			    </td>
			    <td>
					<select id="cantoneseDefinitionDropdown" onchange="cantoneseDictionaryEditorDropdownChanged();">
						<option value="1"></option>
					</select>
			    </td>
			    <td>
					<div id="cantoneseDictionaryEditorUpButton" class="ButtonInner" onclick="cantoneseMoveDefinitionUp();" style="width:25px">
						Up
					</div>
			    </td>
			    <td>
					<div id="cantoneseDictionaryEditorDownButton" class="ButtonInner" onclick="cantoneseMoveDefinitionDown();" style="width:40px">
						Down
					</div>
			    </td>
			</tr>
		</table>
	   
	   
		
	   <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		   Add/Edit
	   </div>

		<table>
			<tr>
				<td>
					Chinese
				</td>
				<td>
					<textarea id="cantoneseDictionaryEditorChineseTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="cantoneseDictionaryEditorSearchKey" class="key" onclick="cantoneseDictionaryEditorSearch()">🔍</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<table>
						<tr>
							<td>
								Yale
							</td>
						</tr>
					</table>
				</td>
				<td>
					<textarea id="cantoneseDictionaryEditorYaleTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="cantoneseDictionaryEditorMarksToNumbersButton" class="ButtonInner" onclick="cantoneseToneMarksToNumbers();" style="width:70px">
									Marks to #
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					Tones
				</td>
				<td>
					<textarea id="cantoneseDictionaryEditorTonesTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="cantoneseDictionaryEditorAddButton" class="ButtonInner" onclick="cantoneseDictionaryEditorAddButtonClicked();" style="width:70px">
									Append
								</div>
							</td>
							<td>
								<div id="cantoneseDictionaryEditorEditButton" class="ButtonInner" onclick="cantoneseDictionaryEditorEditButtonClicked();" style="width:50px">
									Edit
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		
		<table>
			<tr>
				<td>
			  		<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  						Remove
			  		</div>
		  		</td>
		  	</tr>
			<tr>
				<td>
					<textarea id="cantoneseDictionaryEditorRemoveTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="cantoneseDictionaryEditorRemoveButton" class="ButtonInner" onclick="cantoneseDictionaryEditorRemoveButtonClicked();">
							Remove
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<div style="margin-left:120px">
			<div id="defaultTranslateButton" class="DefaultButtonOuter">
				<div id="retranslateButton" class="ButtonInner" onclick="translateButtonClicked();">
					Retranslate
				</div>
			</div>
		</div>
		
	</div>

	<!-- Cursor dialog -->
	<div id="cursor" title="cursor" style="visibility:hidden">
	
	</div>

	<!-- Slide viewer dialog -->
	<div id="slideViewer" title="Slide Viewer" style="visibility:hidden">
		<table>
			<tr>
				<td>
					<div id="thisSlideHtml" style="font-size: 16px;background-color:white;width:500px;overflow:scroll;">
		
					</div>
				</td>
				<td valign="top">
					<table>
						<tr>
							<td>
								<textarea id="thisSubtitlesTextArea" style="width:250px;height:300px"></textarea>
							</td>
						</tr>
						<tr>
							<td>
								<table>
									<tr>
										<td>
											<div id="previousButton" class="ButtonInner" style="width:60px" onclick="previousButtonClicked();">
												Previous
											</div>
										</td>
										<td>
											<div id="blackButton" class="ButtonInner" style="width:60px" onclick="blackButtonClicked();">
												Black
											</div>
										</td>
										<td>
											<div id="nextButton" class="ButtonInner" style="width:60px" onclick="nextButtonClicked();">
												Next
											</div>
										</td>
									</tr>
									<tr>
										<td>
											<div id="durationsButton" class="ButtonInner" style="width:60px" onclick="durationsButtonClicked();">
												Durations
											</div>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
	
	
	<!-- Media viewer dialog -->
	<div id="mediaViewer" title="Media Viewer" style="visibility:hidden">
		<table>
			<tr>
				<td>
					<table>
						<tr>
							<td>
								<div id="imageControls">
									<table>
										<tr>
										   <td>
											   <div id="previousPageButton" class="ButtonInner" style="width:60px" onclick="previousPageButtonClicked();">
												   Previous
											   </div>
										   </td>
										   <td>
											   <div id="nextPageButton" class="ButtonInner" style="width:60px" onclick="nextPageButtonClicked();">
												   Next
											   </div>
										   </td>
										   <td>
											   Open JPG
											   <input type="file" id="imageLoaderMediaViewer" name="imageLoaderMediaViewer" style="width:90px;overflow:hidden"/>
										   </td>
										   <td>
											   <div id="imagePath" style="width:90px;overflow:hidden">JPG Path</div>
										   </td>
										</tr>
									</table>
								</div>
							</td>
							<td>
								<div id="audioControls">
									<table>
										<tr>
											<td>
												Open MP3
												<input type="file" id="audioLoaderMediaViewer" name="audioLoaderMediaViewer" style="width:90px;overflow:hidden"/>
											</td>
											<td>
												<div id="audioPath" style="width:90px;overflow:hidden">MP3 Path</div>
											</td>
											<td>
												<div id="rewindPauseTimesButton" class="ButtonInner" style="width:30px" onclick="rewindPauseTimesButtonClicked();">
													<<
												</div>
											</td>
											<td>
												<div id="deleteLastPauseTimeButton" class="ButtonInner" style="width:30px" onclick="deleteLastPauseTimeButtonClicked();">
													⌫
												</div>
											</td>
											<td>
												<div id="savePauseTimesButton" class="ButtonInner" style="width:90px" onclick="savePauseTimesButtonClicked();">
													Save Timings
												</div>
											</td>
											<td>
												<div id="nextPauseTimesButton" class="ButtonInner" style="width:30px" onclick="nextPauseTimesButtonClicked();">
													>>
												</div>
											</td>
											<td>
												<textarea id="dictionaryEditorMediaViewerChineseTextArea" rows="1" cols="6" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 20px;"></textarea>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerCharsButton" class="ButtonInner" onclick="dictionaryEditorCharsButtonClicked();" style="width:100px">
													Chars to Pinyin
												</div>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerSearchKey" class="key" onclick="dictionaryEditorSearch()">🔍</div>
											</td>
											<td>
												<textarea id="dictionaryEditorMediaViewerPinyinTextArea" rows="2" cols="12" style="background-color: #ffffff;resize: none;"></textarea>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerNumbersToMarksButton" class="ButtonInner" onclick="toneNumbersToToneMarks();" style="width:70px">
													# to marks
												</div>
											</td>
											<td>
												<textarea id="dictionaryEditorMediaViewerEnglishTextArea" rows="2" cols="12" style="background-color: #ffffff;resize: none;"></textarea>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerGoogleTranslateButton" class="ButtonInner" onclick="dictionaryEditorGoogleTranslateButtonClicked();" style="width:60px">
													Google
												</div>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerGoogleTransPyButton" class="ButtonInner" onclick="dictionaryEditorGoogleTransPyButtonClicked();" style="width:40px" style="visibility:hidden">
													GtPy
												</div>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerGoogleTransProxyButton" class="ButtonInner" onclick="dictionaryEditorGoogleTransProxyButtonClicked();" style="width:40px" style="visibility:hidden">
													GtPx
												</div>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerAddButton" class="ButtonInner" onclick="dictionaryEditorAddButtonClicked();" style="width:40px">
													Add
												</div>
											</td>
											<td>
												<div id="dictionaryEditorMediaViewerRemoveButton" class="ButtonInner" onclick="dictionaryEditorRemoveButtonClicked();" style="width:70px">
													Remove
												</div>
											</td>
											<td>
												<div id="defaultRetranslateButtonMediaViewer" class="DefaultButtonOuter">
													<div id="retranslateMediaViewerButton" class="ButtonInner" style="width:88px" onclick="translateButtonClicked();">
														Retranslate
													</div>
												</div>
											</td>
											<td>
												<select id="taiwaneseMediaViewerDefinitionDropdown" onchange="taiwaneseDictionaryEditorDropdownChanged();">
													<option value="1"></option>
												</select>
											</td>
											<td>
												<div id="taiwaneseDictionaryEditorMediaViewerTopButton" class="ButtonInner" onclick="taiwaneseMoveDefinitionToTop();" style="width:25px">
													Top
												</div>
											</td>
											<td>
												<div id="taiwaneseDictionaryEditorMediaViewerAddButton" class="ButtonInner" onclick="taiwaneseDictionaryEditorAddButtonClicked();" style="width:70px">
													Append
												</div>
											</td>
											<td>
												<textarea id="dictionaryEditorMediaViewerPojTextArea" rows="1" cols="6" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 20px;"></textarea>
											</td>
											<td>
												<div id="taiwaneseDictionaryEditorMediaViewerSearchKey" class="key" onclick="taiwaneseDictionaryEditorSearch()">🔍</div>
											</td>
											<td>
												<div id="taiwaneseDictionaryEditorMediaViewerCharsToPojButton" class="ButtonInner" onclick="taiwaneseCharsToPoj();" style="width:70px">
													Chars to POJ
												</div>
											</td>
											<td>
												<textarea id="dictionaryEditorMediaViewerTonesTextArea" rows="1" cols="6" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 20px;"></textarea>
											</td>
										</tr>
									</table>
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
		<table>
			<tr>
				<td>
					<div id="drawingMediaViewer"></div>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<textarea id="lrcTextArea" style="width:180px;height:105px"></textarea>
							</td>
							<td>
								<div id="verseCountDiv" style="width:20px;height:15px"></div>
							</td>
						</tr>
						<tr>
							<td>
								<div id="videoContainerMediaViewer" style="width:180px;" onclick="videoMediaViewerPlayPause();">
									<video poster="" preload="none" controls="" id="mediaViewerVideo" tabindex="0" style="width:180px;" >
										<source type="video/mp4" src="" id="mp4_srcMediaViewer"></source>
										<p>Your user agent does not support the HTML5 Video element.</p>
									</video>
								</div>
								<input id="seekslider" type="range" min="0" max="100" value="0" step="1" style="width:180px">
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>
	</div>
	
	<!-- Start of SimpleHitCounter Code -->
	
	<!--<div align="left"><a href="http://simplehitcounter.com" target="_blank"><img src="http://simplehitcounter.com/hit.php?uid=2288206&f=0&b=16777215" border="0" height="18" width="83" alt=""></a><br><a href="http://simplehitcounter.com" target="_blank" style="text-decoration:none;"></a></div>-->
	<!-- End of SimpleHitCounter Code -->
	
	<!--Phone support (Peter, the sole developer): (+886) 966-925-756-->
	
  </body>
  
  <!-- External scripts -->
  <script src="leaflet/leaflet.js"></script>
  <script src="jscolor.js"></script>
  <script src="jquery-3.2.1.min.js"></script>
  <script src="jquery-ui.js"></script>
  <script src="onloadCSS.js"></script>
  <script src="loadCSS.js"></script>
  <script src="cssrelpreload.js"></script>

	<script>
	// https://raw.githubusercontent.com/nodeca/pako/refs/heads/master/dist/pako_inflate.min.js
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(this,(function(e){"use strict";var t=(e,t,i,n)=>{let a=65535&e|0,r=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{a=a+t[n++]|0,r=r+a|0}while(--o);a%=65521,r%=65521}return a|r<<16|0};const i=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var n=(e,t,n,a)=>{const r=i,o=a+n;e^=-1;for(let i=a;i<o;i++)e=e>>>8^r[255&(e^t[i])];return-1^e};const a=16209;var r=function(e,t){let i,n,r,o,s,l,d,f,c,h,u,w,b,m,k,_,g,p,v,x,y,E,R,A;const Z=e.state;i=e.next_in,R=e.input,n=i+(e.avail_in-5),r=e.next_out,A=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),l=Z.dmax,d=Z.wsize,f=Z.whave,c=Z.wnext,h=Z.window,u=Z.hold,w=Z.bits,b=Z.lencode,m=Z.distcode,k=(1<<Z.lenbits)-1,_=(1<<Z.distbits)-1;e:do{w<15&&(u+=R[i++]<<w,w+=8,u+=R[i++]<<w,w+=8),g=b[u&k];t:for(;;){if(p=g>>>24,u>>>=p,w-=p,p=g>>>16&255,0===p)A[r++]=65535&g;else{if(!(16&p)){if(0==(64&p)){g=b[(65535&g)+(u&(1<<p)-1)];continue t}if(32&p){Z.mode=16191;break e}e.msg="invalid literal/length code",Z.mode=a;break e}v=65535&g,p&=15,p&&(w<p&&(u+=R[i++]<<w,w+=8),v+=u&(1<<p)-1,u>>>=p,w-=p),w<15&&(u+=R[i++]<<w,w+=8,u+=R[i++]<<w,w+=8),g=m[u&_];i:for(;;){if(p=g>>>24,u>>>=p,w-=p,p=g>>>16&255,!(16&p)){if(0==(64&p)){g=m[(65535&g)+(u&(1<<p)-1)];continue i}e.msg="invalid distance code",Z.mode=a;break e}if(x=65535&g,p&=15,w<p&&(u+=R[i++]<<w,w+=8,w<p&&(u+=R[i++]<<w,w+=8)),x+=u&(1<<p)-1,x>l){e.msg="invalid distance too far back",Z.mode=a;break e}if(u>>>=p,w-=p,p=r-o,x>p){if(p=x-p,p>f&&Z.sane){e.msg="invalid distance too far back",Z.mode=a;break e}if(y=0,E=h,0===c){if(y+=d-p,p<v){v-=p;do{A[r++]=h[y++]}while(--p);y=r-x,E=A}}else if(c<p){if(y+=d+c-p,p-=c,p<v){v-=p;do{A[r++]=h[y++]}while(--p);if(y=0,c<v){p=c,v-=p;do{A[r++]=h[y++]}while(--p);y=r-x,E=A}}}else if(y+=c-p,p<v){v-=p;do{A[r++]=h[y++]}while(--p);y=r-x,E=A}for(;v>2;)A[r++]=E[y++],A[r++]=E[y++],A[r++]=E[y++],v-=3;v&&(A[r++]=E[y++],v>1&&(A[r++]=E[y++]))}else{y=r-x;do{A[r++]=A[y++],A[r++]=A[y++],A[r++]=A[y++],v-=3}while(v>2);v&&(A[r++]=A[y++],v>1&&(A[r++]=A[y++]))}break}}break}}while(i<n&&r<s);v=w>>3,i-=v,w-=v<<3,u&=(1<<w)-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<s?s-r+257:257-(r-s),Z.hold=u,Z.bits=w};const o=15,s=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),d=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var c=(e,t,i,n,a,r,c,h)=>{const u=h.bits;let w,b,m,k,_,g,p=0,v=0,x=0,y=0,E=0,R=0,A=0,Z=0,S=0,T=0,O=null;const U=new Uint16Array(16),D=new Uint16Array(16);let I,B,N,C=null;for(p=0;p<=o;p++)U[p]=0;for(v=0;v<n;v++)U[t[i+v]]++;for(E=u,y=o;y>=1&&0===U[y];y--);if(E>y&&(E=y),0===y)return a[r++]=20971520,a[r++]=20971520,h.bits=1,0;for(x=1;x<y&&0===U[x];x++);for(E<x&&(E=x),Z=1,p=1;p<=o;p++)if(Z<<=1,Z-=U[p],Z<0)return-1;if(Z>0&&(0===e||1!==y))return-1;for(D[1]=0,p=1;p<o;p++)D[p+1]=D[p]+U[p];for(v=0;v<n;v++)0!==t[i+v]&&(c[D[t[i+v]]++]=v);if(0===e?(O=C=c,g=20):1===e?(O=s,C=l,g=257):(O=d,C=f,g=0),T=0,v=0,p=x,_=r,R=E,A=0,m=-1,S=1<<E,k=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){I=p-A,c[v]+1<g?(B=0,N=c[v]):c[v]>=g?(B=C[c[v]-g],N=O[c[v]-g]):(B=96,N=0),w=1<<p-A,b=1<<R,x=b;do{b-=w,a[_+(T>>A)+b]=I<<24|B<<16|N|0}while(0!==b);for(w=1<<p-1;T&w;)w>>=1;if(0!==w?(T&=w-1,T+=w):T=0,v++,0==--U[p]){if(p===y)break;p=t[i+c[v]]}if(p>E&&(T&k)!==m){for(0===A&&(A=E),_+=x,R=p-A,Z=1<<R;R+A<y&&(Z-=U[R+A],!(Z<=0));)R++,Z<<=1;if(S+=1<<R,1===e&&S>852||2===e&&S>592)return 1;m=T&k,a[m]=E<<24|R<<16|_-r|0}}return 0!==T&&(a[_+T]=p-A<<24|64<<16|0),h.bits=E,0},h={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{Z_FINISH:u,Z_BLOCK:w,Z_TREES:b,Z_OK:m,Z_STREAM_END:k,Z_NEED_DICT:_,Z_STREAM_ERROR:g,Z_DATA_ERROR:p,Z_MEM_ERROR:v,Z_BUF_ERROR:x,Z_DEFLATED:y}=h,E=16180,R=16190,A=16191,Z=16192,S=16194,T=16199,O=16200,U=16206,D=16209,I=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function B(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const N=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<E||t.mode>16211?1:0},C=e=>{if(N(e))return g;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=E,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,m},z=e=>{if(N(e))return g;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,C(e)},F=(e,t)=>{let i;if(N(e))return g;const n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,z(e))},L=(e,t)=>{if(!e)return g;const i=new B;e.state=i,i.strm=e,i.window=null,i.mode=E;const n=F(e,t);return n!==m&&(e.state=null),n};let M,H,j=!0;const K=e=>{if(j){M=new Int32Array(512),H=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(c(1,e.lens,0,288,M,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;c(2,e.lens,0,32,H,0,e.work,{bits:5}),j=!1}e.lencode=M,e.lenbits=9,e.distcode=H,e.distbits=5},P=(e,t,i,n)=>{let a;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),r.window.set(t.subarray(i-n,i-n+a),r.wnext),(n-=a)?(r.window.set(t.subarray(i-n,i),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0};var Y={inflateReset:z,inflateReset2:F,inflateResetKeep:C,inflateInit:e=>L(e,15),inflateInit2:L,inflate:(e,i)=>{let a,o,s,l,d,f,h,B,C,z,F,L,M,H,j,Y,G,X,W,q,J,Q,V=0;const $=new Uint8Array(4);let ee,te;const ie=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(N(e)||!e.output||!e.input&&0!==e.avail_in)return g;a=e.state,a.mode===A&&(a.mode=Z),d=e.next_out,s=e.output,h=e.avail_out,l=e.next_in,o=e.input,f=e.avail_in,B=a.hold,C=a.bits,z=f,F=h,Q=m;e:for(;;)switch(a.mode){case E:if(0===a.wrap){a.mode=Z;break}for(;C<16;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(2&a.wrap&&35615===B){0===a.wbits&&(a.wbits=15),a.check=0,$[0]=255&B,$[1]=B>>>8&255,a.check=n(a.check,$,2,0),B=0,C=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&B)<<8)+(B>>8))%31){e.msg="incorrect header check",a.mode=D;break}if((15&B)!==y){e.msg="unknown compression method",a.mode=D;break}if(B>>>=4,C-=4,J=8+(15&B),0===a.wbits&&(a.wbits=J),J>15||J>a.wbits){e.msg="invalid window size",a.mode=D;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&B?16189:A,B=0,C=0;break;case 16181:for(;C<16;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(a.flags=B,(255&a.flags)!==y){e.msg="unknown compression method",a.mode=D;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=D;break}a.head&&(a.head.text=B>>8&1),512&a.flags&&4&a.wrap&&($[0]=255&B,$[1]=B>>>8&255,a.check=n(a.check,$,2,0)),B=0,C=0,a.mode=16182;case 16182:for(;C<32;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.head&&(a.head.time=B),512&a.flags&&4&a.wrap&&($[0]=255&B,$[1]=B>>>8&255,$[2]=B>>>16&255,$[3]=B>>>24&255,a.check=n(a.check,$,4,0)),B=0,C=0,a.mode=16183;case 16183:for(;C<16;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.head&&(a.head.xflags=255&B,a.head.os=B>>8),512&a.flags&&4&a.wrap&&($[0]=255&B,$[1]=B>>>8&255,a.check=n(a.check,$,2,0)),B=0,C=0,a.mode=16184;case 16184:if(1024&a.flags){for(;C<16;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.length=B,a.head&&(a.head.extra_len=B),512&a.flags&&4&a.wrap&&($[0]=255&B,$[1]=B>>>8&255,a.check=n(a.check,$,2,0)),B=0,C=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(L=a.length,L>f&&(L=f),L&&(a.head&&(J=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(o.subarray(l,l+L),J)),512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),f-=L,l+=L,a.length-=L),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===f)break e;L=0;do{J=o[l+L++],a.head&&J&&a.length<65536&&(a.head.name+=String.fromCharCode(J))}while(J&&L<f);if(512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),f-=L,l+=L,J)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===f)break e;L=0;do{J=o[l+L++],a.head&&J&&a.length<65536&&(a.head.comment+=String.fromCharCode(J))}while(J&&L<f);if(512&a.flags&&4&a.wrap&&(a.check=n(a.check,o,L,l)),f-=L,l+=L,J)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;C<16;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(4&a.wrap&&B!==(65535&a.check)){e.msg="header crc mismatch",a.mode=D;break}B=0,C=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=A;break;case 16189:for(;C<32;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}e.adler=a.check=I(B),B=0,C=0,a.mode=R;case R:if(0===a.havedict)return e.next_out=d,e.avail_out=h,e.next_in=l,e.avail_in=f,a.hold=B,a.bits=C,_;e.adler=a.check=1,a.mode=A;case A:if(i===w||i===b)break e;case Z:if(a.last){B>>>=7&C,C-=7&C,a.mode=U;break}for(;C<3;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}switch(a.last=1&B,B>>>=1,C-=1,3&B){case 0:a.mode=16193;break;case 1:if(K(a),a.mode=T,i===b){B>>>=2,C-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=D}B>>>=2,C-=2;break;case 16193:for(B>>>=7&C,C-=7&C;C<32;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if((65535&B)!=(B>>>16^65535)){e.msg="invalid stored block lengths",a.mode=D;break}if(a.length=65535&B,B=0,C=0,a.mode=S,i===b)break e;case S:a.mode=16195;case 16195:if(L=a.length,L){if(L>f&&(L=f),L>h&&(L=h),0===L)break e;s.set(o.subarray(l,l+L),d),f-=L,l+=L,h-=L,d+=L,a.length-=L;break}a.mode=A;break;case 16196:for(;C<14;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(a.nlen=257+(31&B),B>>>=5,C-=5,a.ndist=1+(31&B),B>>>=5,C-=5,a.ncode=4+(15&B),B>>>=4,C-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=D;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;C<3;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.lens[ie[a.have++]]=7&B,B>>>=3,C-=3}for(;a.have<19;)a.lens[ie[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,ee={bits:a.lenbits},Q=c(0,a.lens,0,19,a.lencode,0,a.work,ee),a.lenbits=ee.bits,Q){e.msg="invalid code lengths set",a.mode=D;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;V=a.lencode[B&(1<<a.lenbits)-1],j=V>>>24,Y=V>>>16&255,G=65535&V,!(j<=C);){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(G<16)B>>>=j,C-=j,a.lens[a.have++]=G;else{if(16===G){for(te=j+2;C<te;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(B>>>=j,C-=j,0===a.have){e.msg="invalid bit length repeat",a.mode=D;break}J=a.lens[a.have-1],L=3+(3&B),B>>>=2,C-=2}else if(17===G){for(te=j+3;C<te;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}B>>>=j,C-=j,J=0,L=3+(7&B),B>>>=3,C-=3}else{for(te=j+7;C<te;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}B>>>=j,C-=j,J=0,L=11+(127&B),B>>>=7,C-=7}if(a.have+L>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=D;break}for(;L--;)a.lens[a.have++]=J}}if(a.mode===D)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=D;break}if(a.lenbits=9,ee={bits:a.lenbits},Q=c(1,a.lens,0,a.nlen,a.lencode,0,a.work,ee),a.lenbits=ee.bits,Q){e.msg="invalid literal/lengths set",a.mode=D;break}if(a.distbits=6,a.distcode=a.distdyn,ee={bits:a.distbits},Q=c(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,ee),a.distbits=ee.bits,Q){e.msg="invalid distances set",a.mode=D;break}if(a.mode=T,i===b)break e;case T:a.mode=O;case O:if(f>=6&&h>=258){e.next_out=d,e.avail_out=h,e.next_in=l,e.avail_in=f,a.hold=B,a.bits=C,r(e,F),d=e.next_out,s=e.output,h=e.avail_out,l=e.next_in,o=e.input,f=e.avail_in,B=a.hold,C=a.bits,a.mode===A&&(a.back=-1);break}for(a.back=0;V=a.lencode[B&(1<<a.lenbits)-1],j=V>>>24,Y=V>>>16&255,G=65535&V,!(j<=C);){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(Y&&0==(240&Y)){for(X=j,W=Y,q=G;V=a.lencode[q+((B&(1<<X+W)-1)>>X)],j=V>>>24,Y=V>>>16&255,G=65535&V,!(X+j<=C);){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}B>>>=X,C-=X,a.back+=X}if(B>>>=j,C-=j,a.back+=j,a.length=G,0===Y){a.mode=16205;break}if(32&Y){a.back=-1,a.mode=A;break}if(64&Y){e.msg="invalid literal/length code",a.mode=D;break}a.extra=15&Y,a.mode=16201;case 16201:if(a.extra){for(te=a.extra;C<te;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.length+=B&(1<<a.extra)-1,B>>>=a.extra,C-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;V=a.distcode[B&(1<<a.distbits)-1],j=V>>>24,Y=V>>>16&255,G=65535&V,!(j<=C);){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(0==(240&Y)){for(X=j,W=Y,q=G;V=a.distcode[q+((B&(1<<X+W)-1)>>X)],j=V>>>24,Y=V>>>16&255,G=65535&V,!(X+j<=C);){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}B>>>=X,C-=X,a.back+=X}if(B>>>=j,C-=j,a.back+=j,64&Y){e.msg="invalid distance code",a.mode=D;break}a.offset=G,a.extra=15&Y,a.mode=16203;case 16203:if(a.extra){for(te=a.extra;C<te;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}a.offset+=B&(1<<a.extra)-1,B>>>=a.extra,C-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=D;break}a.mode=16204;case 16204:if(0===h)break e;if(L=F-h,a.offset>L){if(L=a.offset-L,L>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=D;break}L>a.wnext?(L-=a.wnext,M=a.wsize-L):M=a.wnext-L,L>a.length&&(L=a.length),H=a.window}else H=s,M=d-a.offset,L=a.length;L>h&&(L=h),h-=L,a.length-=L;do{s[d++]=H[M++]}while(--L);0===a.length&&(a.mode=O);break;case 16205:if(0===h)break e;s[d++]=a.length,h--,a.mode=O;break;case U:if(a.wrap){for(;C<32;){if(0===f)break e;f--,B|=o[l++]<<C,C+=8}if(F-=h,e.total_out+=F,a.total+=F,4&a.wrap&&F&&(e.adler=a.check=a.flags?n(a.check,s,F,d-F):t(a.check,s,F,d-F)),F=h,4&a.wrap&&(a.flags?B:I(B))!==a.check){e.msg="incorrect data check",a.mode=D;break}B=0,C=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;C<32;){if(0===f)break e;f--,B+=o[l++]<<C,C+=8}if(4&a.wrap&&B!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=D;break}B=0,C=0}a.mode=16208;case 16208:Q=k;break e;case D:Q=p;break e;case 16210:return v;default:return g}return e.next_out=d,e.avail_out=h,e.next_in=l,e.avail_in=f,a.hold=B,a.bits=C,(a.wsize||F!==e.avail_out&&a.mode<D&&(a.mode<U||i!==u))&&P(e,e.output,e.next_out,F-e.avail_out),z-=e.avail_in,F-=e.avail_out,e.total_in+=z,e.total_out+=F,a.total+=F,4&a.wrap&&F&&(e.adler=a.check=a.flags?n(a.check,s,F,e.next_out-F):t(a.check,s,F,e.next_out-F)),e.data_type=a.bits+(a.last?64:0)+(a.mode===A?128:0)+(a.mode===T||a.mode===S?256:0),(0===z&&0===F||i===u)&&Q===m&&(Q=x),Q},inflateEnd:e=>{if(N(e))return g;let t=e.state;return t.window&&(t.window=null),e.state=null,m},inflateGetHeader:(e,t)=>{if(N(e))return g;const i=e.state;return 0==(2&i.wrap)?g:(i.head=t,t.done=!1,m)},inflateSetDictionary:(e,i)=>{const n=i.length;let a,r,o;return N(e)?g:(a=e.state,0!==a.wrap&&a.mode!==R?g:a.mode===R&&(r=1,r=t(r,i,n,0),r!==a.check)?p:(o=P(e,i,n,n),o?(a.mode=16210,v):(a.havedict=1,m)))},inflateInfo:"pako inflate (from Nodeca project)"};const G=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var X=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)G(i,t)&&(e[t]=i[t])}}return e},W=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];i.set(a,n),n+=a.length}return i};let q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){q=!1}const J=new Uint8Array(256);for(let e=0;e<256;e++)J[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;J[254]=J[254]=1;var Q=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,n,a,r,o=e.length,s=0;for(a=0;a<o;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),r=0,a=0;r<s;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},V=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,a;const r=new Array(2*i);for(a=0,n=0;n<i;){let t=e[n++];if(t<128){r[a++]=t;continue}let o=J[t];if(o>4)r[a++]=65533,n+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&n<i;)t=t<<6|63&e[n++],o--;o>1?r[a++]=65533:t<65536?r[a++]=t:(t-=65536,r[a++]=55296|t>>10&1023,r[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&q)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i})(r,a)},$=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+J[e[i]]>t?i:t},ee={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var te=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};var ie=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ne=Object.prototype.toString,{Z_NO_FLUSH:ae,Z_FINISH:re,Z_OK:oe,Z_STREAM_END:se,Z_NEED_DICT:le,Z_STREAM_ERROR:de,Z_DATA_ERROR:fe,Z_MEM_ERROR:ce}=h;function he(e){this.options=X({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new te,this.strm.avail_out=0;let i=Y.inflateInit2(this.strm,t.windowBits);if(i!==oe)throw new Error(ee[i]);if(this.header=new ie,Y.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Q(t.dictionary):"[object ArrayBuffer]"===ne.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Y.inflateSetDictionary(this.strm,t.dictionary),i!==oe)))throw new Error(ee[i])}function ue(e,t){const i=new he(t);if(i.push(e),i.err)throw i.msg||ee[i.err];return i.result}he.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let r,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?re:ae,"[object ArrayBuffer]"===ne.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),r=Y.inflate(i,o),r===le&&a&&(r=Y.inflateSetDictionary(i,a),r===oe?r=Y.inflate(i,o):r===fe&&(r=le));i.avail_in>0&&r===se&&i.state.wrap>0&&0!==e[i.next_in];)Y.inflateReset(i),r=Y.inflate(i,o);switch(r){case de:case fe:case le:case ce:return this.onEnd(r),this.ended=!0,!1}if(s=i.avail_out,i.next_out&&(0===i.avail_out||r===se))if("string"===this.options.to){let e=$(i.output,i.next_out),t=i.next_out-e,a=V(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==oe||0!==s){if(r===se)return r=Y.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},he.prototype.onData=function(e){this.chunks.push(e)},he.prototype.onEnd=function(e){e===oe&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=W(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var we=he,be=ue,me=function(e,t){return(t=t||{}).raw=!0,ue(e,t)},ke=ue,_e=h,ge={Inflate:we,inflate:be,inflateRaw:me,ungzip:ke,constants:_e};e.Inflate=we,e.constants=_e,e.default=ge,e.inflate=be,e.inflateRaw=me,e.ungzip=ke,Object.defineProperty(e,"__esModule",{value:!0})}));
    
		function loadGzDictionary(filename)
		{
			//debugLog("loadDictionary(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();
			xmlhttp.responseType = 'arraybuffer';

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
					    combinedDictionaryData = combinedDictionaryData + (pako.inflate(xmlhttp.response, { to: 'string'}));

					    //saveDictionaryToLocalStorage(combinedDictionaryData.length);

						//debugLog("saving " + savedDictionaryData.length);
						
						if (lastDictionary == true)
						{
							dictionariesLoaded();
						}
						
						//localStorage["dictionary"] = savedDictionaryData;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading dictionary');
				   }
				   else {
					   alert('error loading dictionary');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadGzDictionary
		
		// Create gz using `gzip -k PinyinDefinitionsSorted.txt`
		//loadGzDictionary("PinyinDefinitionsSorted.txt.gz")

	</script>

  <!-- Native scripts -->
  <script>
		var token = "";
		var githubUsername = "pingtype";
		var githubRepo = "pingtype.github.io";

  
		var combinedDictionaryData = "";
		
		var fiveWords = "\n";
		var fourWords = "\n";
		var threeWords = "\n";
		var twoWords = "\n";
		var oneWords = "\n";

		var fiveWordsTaiwanese = "\n";
		var fourWordsTaiwanese = "\n";
		var threeWordsTaiwanese = "\n";
		var twoWordsTaiwanese = "\n";
		var oneWordsTaiwanese = "\n";

		var fiveWordsHakka = "\n";
		var fourWordsHakka = "\n";
		var threeWordsHakka = "\n";
		var twoWordsHakka = "\n";
		var oneWordsHakka = "\n";

		var longWords;
		var radicals;
		var toneNumbersMarks;

		var chineseText = "";
		var englishText = "";
		var literalText = "";
		
		var compositionData;
		var genealogiesData;
		var dictionaryData;
		var pinyinDefinitionData;
		var longWords;
		var commonWords = "";
		var bopomofoData;
		var reviewingTheHanziData = "\n";
		var idsData;
		
		var taiwaneseData = "";
		var cantoneseData = "";
		var hakkaData = "";
		var hangulData = "";
		var tangData = "";
		var japaneseData = "";
		var vietnameseData = "";
		
		var simplifiedCharacters = "";
		var simplifiedData = "";
		var traditionalData = "";
		var taiwanData = "";
		var hongKongData = "";
		var japanData = "";
				
		var ancestors = "";
		var highestLevel = 0;
		var genealogy = "";
		var children = "";
		
		var lastDictionary = false;
		
		var slideTextArray = [];
		var lastSlideText = "";
		var lastSlideStartTime = "";
		var currentSlide = 0;
		var currentSlideSubtitle = 1;
		
		var imageFolderList = "";
		
		// No idea where this magic number comes from. It's used for truncating the dictionary to fit in localStorage. 
		// Found by checking for errors in Safari. 
		var localStorageLength = 863185;
		
		// Add, Edit, Remove words
		var addWords = localStorage["addWords"];
		var editWords = localStorage["editWords"];
		var removeWords = localStorage["removeWords"];
		
		var useMediaViewer = false;
		
		var useCursor = false;
		var cursorEventListener;
		
		var cursorTargetElementId;

		var Base64 = {
		// private property
		_keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",

		// public method for encoding
		encode : function (input) {
			var output = "";
			var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
			var i = 0;

			input = Base64._utf8_encode(input);

			while (i < input.length) {

				chr1 = input.charCodeAt(i++);
				chr2 = input.charCodeAt(i++);
				chr3 = input.charCodeAt(i++);

				enc1 = chr1 >> 2;
				enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
				enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
				enc4 = chr3 & 63;

				if (isNaN(chr2)) {
					enc3 = enc4 = 64;
				} else if (isNaN(chr3)) {
					enc4 = 64;
				}

				output = output +
				Base64._keyStr.charAt(enc1) + Base64._keyStr.charAt(enc2) +
				Base64._keyStr.charAt(enc3) + Base64._keyStr.charAt(enc4);

			}

			return output;
		},

		// public method for decoding
		decode : function (input) {
			var output = "";
			var chr1, chr2, chr3;
			var enc1, enc2, enc3, enc4;
			var i = 0;

			input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

			while (i < input.length) {

				enc1 = Base64._keyStr.indexOf(input.charAt(i++));
				enc2 = Base64._keyStr.indexOf(input.charAt(i++));
				enc3 = Base64._keyStr.indexOf(input.charAt(i++));
				enc4 = Base64._keyStr.indexOf(input.charAt(i++));

				chr1 = (enc1 << 2) | (enc2 >> 4);
				chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
				chr3 = ((enc3 & 3) << 6) | enc4;

				output = output + String.fromCharCode(chr1);

				if (enc3 != 64) {
					output = output + String.fromCharCode(chr2);
				}
				if (enc4 != 64) {
					output = output + String.fromCharCode(chr3);
				}

			}

			output = Base64._utf8_decode(output);

			return output;

		},

		// private method for UTF-8 encoding
		_utf8_encode : function (string) {
			string = string.replace(/\r\n/g,"\n");
			var utftext = "";

			for (var n = 0; n < string.length; n++) {

				var c = string.charCodeAt(n);

				if (c < 128) {
					utftext += String.fromCharCode(c);
				}
				else if((c > 127) && (c < 2048)) {
					utftext += String.fromCharCode((c >> 6) | 192);
					utftext += String.fromCharCode((c & 63) | 128);
				}
				else {
					utftext += String.fromCharCode((c >> 12) | 224);
					utftext += String.fromCharCode(((c >> 6) & 63) | 128);
					utftext += String.fromCharCode((c & 63) | 128);
				}

			}

			return utftext;
		},

		// private method for UTF-8 decoding
		_utf8_decode : function (utftext) {
			var string = "";
			var i = 0;
			var c = c1 = c2 = 0;

			while ( i < utftext.length ) {

				c = utftext.charCodeAt(i);

				if (c < 128) {
					string += String.fromCharCode(c);
					i++;
				}
				else if((c > 191) && (c < 224)) {
					c2 = utftext.charCodeAt(i+1);
					string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
					i += 2;
				}
				else {
					c2 = utftext.charCodeAt(i+1);
					c3 = utftext.charCodeAt(i+2);
					string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
					i += 3;
				}

			}
			return string;
		}
		} // end Base64

		var QueryString = function () 
		{
			// This function is anonymous, is executed immediately and 
			// the return value is assigned to QueryString!
			var query_string = {};
			var query = window.location.search.substring(1);
			var vars = query.split("&");
			for (var i=0;i<vars.length;i++) {
			  var pair = vars[i].split("=");
				  // If first entry with this name
			  if (typeof query_string[pair[0]] === "undefined") {
				query_string[pair[0]] = decodeURIComponent(pair[1]);
				  // If second entry with this name
			  } else if (typeof query_string[pair[0]] === "string") {
				var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
				query_string[pair[0]] = arr;
				  // If third or later entry with this name
			  } else {
				query_string[pair[0]].push(decodeURIComponent(pair[1]));
			  }
			} 
			return query_string;
		}();


		/* Image upload */
		
		var imageLoader = document.getElementById('imageLoader');

		imageLoader.addEventListener('change', uploadImage, false);

		function uploadImage(event)
		{
			//debugLog("uploadImage");

			var reader = new FileReader();
			
			reader.onload = function(event)
			{
				var img = new Image();
				
				img.onload = function()
				{
					//canvas.width = img.width;
					//canvas.height = img.height;
					//ctx.drawImage(img,0,0);
					
					var width = img.width;
					var height = img.height;
					
					var southWest = drawing.unproject([0, height], 3);
					var northEast = drawing.unproject([width, 0], 3);
					
					var bounds = new L.LatLngBounds(southWest, northEast);

					//var bounds = new L.LatLngBounds(0, 0);

					L.imageOverlay(img.src, bounds).addTo(drawing);
					
				}
				
				img.src = event.target.result;
			}
			
			reader.readAsDataURL(event.target.files[0]);

			document.getElementById("drawing").style.width = "640px";
			document.getElementById("drawing").style.height = "200px";

		} // end function uploadImage
		
		// Leaflet drawing area
		function initialiseLeaflet()
		{
			//debugLog("initialiseLeaflet");
			
			var zoomLevel = 10;
			
			drawing = new L.Map("drawing",{
				zoom: zoomLevel,
				center: [0, 0],
				zoomControl:true,
				crs: L.CRS.Simple
			});

			drawing.setZoom(2);


			drawing.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.


			var zoomLevel = 10;
			
			drawingMediaViewer = new L.Map("drawingMediaViewer",{
				zoom: zoomLevel,
				center: [0, 0],
				zoomControl:true,
				crs: L.CRS.Simple
			});

			drawingMediaViewer.setZoom(2);


			drawingMediaViewer.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

		} // end function initialiseLeaflet
		
		initialiseLeaflet();
		
				
		var imageLoaderMediaViewer = document.getElementById('imageLoaderMediaViewer');

		imageLoaderMediaViewer.addEventListener('change', uploadImageMediaViewer, false);

		function uploadImageMediaViewer(event)
		{
			//debugLog("uploadImageMediaViewer");

			var reader = new FileReader();
			
			reader.onload = function(event)
			{
				var img = new Image();
				
				img.onload = function()
				{
					//canvas.width = img.width;
					//canvas.height = img.height;
					//ctx.drawImage(img,0,0);
					
					var width = img.width;
					var height = img.height;
					
					var southWest = drawingMediaViewer.unproject([0, height], 3);
					var northEast = drawingMediaViewer.unproject([width, 0], 3);
					
					var bounds = new L.LatLngBounds(southWest, northEast);

					//var bounds = new L.LatLngBounds(0, 0);

					L.imageOverlay(img.src, bounds).addTo(drawingMediaViewer);
					
				}
				
				img.src = event.target.result;
			}
			
			reader.readAsDataURL(event.target.files[0]);

			document.getElementById("drawingMediaViewer").style.width = "1450px";
			document.getElementById("drawingMediaViewer").style.height = "210px";

		} // end function uploadImageMediaViewer

		function loadImageMediaViewer(imageUrl)
		{
			var img = new Image();
				
			img.onload = function()
			{
				//canvas.width = img.width;
				//canvas.height = img.height;
				//ctx.drawImage(img,0,0);
				
				var width = img.width;
				var height = img.height;
				
				var southWest = drawingMediaViewer.unproject([0, height], 3);
				var northEast = drawingMediaViewer.unproject([width, 0], 3);
				
				var bounds = new L.LatLngBounds(southWest, northEast);

				//var bounds = new L.LatLngBounds(0, 0);

				L.imageOverlay(img.src, bounds).addTo(drawingMediaViewer);
				
			}
			
			img.src = imageUrl;
			
			document.getElementById("drawingMediaViewer").style.width = "1450px";
			document.getElementById("drawingMediaViewer").style.height = "210px";

		} // end function loadImageMediaViewer
				

		var audioLoaderMediaViewer = document.getElementById('audioLoaderMediaViewer');

		audioLoaderMediaViewer.addEventListener('change', uploadAudioMediaViewer, false);
		
		
		// Seek in audio viewer (this used to be built into Safari 9!)		
		var seeking = false;
		var seekslider = document.getElementById('seekslider');
		
		seekslider.addEventListener("mousedown", function(event){ seeking=true; seek(event); });
		seekslider.addEventListener("mousemove", function(event){ seek(event); });
		seekslider.addEventListener("mouseup",function(){ seeking=false; });
		
		document.getElementById("mediaViewerVideo").addEventListener("timeupdate", function(){ seektimeupdate(); });

		function seek(event)
		{
	    	if(seeking)
	    	{
		    	//var seekSliderValue = event.clientX - seekslider.offsetLeft;
		    	var seekSliderValue = document.getElementById('seekslider').value;
		        var seekto = document.getElementById("mediaViewerVideo").duration * (seekSliderValue / 100);
		        document.getElementById("mediaViewerVideo").currentTime = seekto;
	    	}
    	} // end function seek
    	
		function seektimeupdate()
		{
			var nt = document.getElementById("mediaViewerVideo").currentTime * (100 / document.getElementById("mediaViewerVideo").duration);
			seekslider.value = nt;
			var curmins = Math.floor(document.getElementById("mediaViewerVideo").currentTime / 60);
			var cursecs = Math.floor(document.getElementById("mediaViewerVideo").currentTime - curmins * 60);
			var durmins = Math.floor(document.getElementById("mediaViewerVideo").duration / 60);
			var dursecs = Math.floor(document.getElementById("mediaViewerVideo").duration - durmins * 60);
			if(cursecs < 10){ cursecs = "0"+cursecs; }
			if(dursecs < 10){ dursecs = "0"+dursecs; }
			if(curmins < 10){ curmins = "0"+curmins; }
			if(durmins < 10){ durmins = "0"+durmins; }
		} // end function seektimeupdate

		function uploadAudioMediaViewer(event)
		{
			//debugLog("uploadAudioMediaViewer");

			var reader = new FileReader();
			
			reader.onload = function(event)
			{
				document.getElementById("mp4_srcMediaViewer").src = event.target.result;
				document.getElementById("mediaViewerVideo").load();
			}
			
			reader.readAsDataURL(event.target.files[0]);

			//document.getElementById("audioMediaViewer").style.width = "1450px";
			//document.getElementById("audioMediaViewer").style.height = "200px";

		} // end function uploadAudioMediaViewer
		
		function loadAudioMediaViewer(audioUrl)
		{
			document.getElementById("mp4_srcMediaViewer").src = audioUrl;
			document.getElementById("mediaViewerVideo").load();
		} // end function loadAudioMediaViewer
		
		
		function previousPageButtonClicked()
		{
			var imageUrl = document.getElementById("imagePath").innerText;
			
			// Get the name of the file inside, not the folder
			var imageUrlParts = imageUrl.split("/");
			var imageFilename = imageUrlParts.pop();
			var imageFolder = imageUrlParts.join("/");
			
			var imageFolderListBeforeFile = textBetween(imageFolderList, "start", imageFilename);
			
			var imageFolderListBeforeFileArray = imageFolderListBeforeFile.split(";");
			
			// Pop twice because I didn't remove the ";"
			var previousImageFilename = imageFolderListBeforeFileArray.pop();
			previousImageFilename = imageFolderListBeforeFileArray.pop();
			
			if (previousImageFilename == undefined)
			{
				return;
			}
			
			var previousImageUrl = imageFolder + "/" + previousImageFilename;
			
			document.getElementById("imagePath").innerText = previousImageUrl;
			
			loadImageMediaViewer(previousImageUrl);
			
		} // end function previousPageButtonClicked

		function nextPageButtonClicked()
		{
			var imageUrl = document.getElementById("imagePath").innerText;
			
			// Get the name of the file inside, not the folder
			var imageUrlParts = imageUrl.split("/");
			var imageFilename = imageUrlParts.pop();
			var imageFolder = imageUrlParts.join("/");
			
			var nextImageFilename = textBetween(imageFolderList + ";", imageFilename + ";", ";");
			
			var nextImageUrl = imageFolder + "/" + nextImageFilename;
			
			document.getElementById("imagePath").innerText = nextImageUrl;

			loadImageMediaViewer(nextImageUrl);
			
		} // end function nextPageButtonClicked
		
		
		
		/* File readers */
		
		function saveIndexToLocalStorage(dictionaryLength)
		{
			//debugLog("saveDictionaryToLocalStorage(" + dictionaryLength + ")");
			
			var indexText = document.getElementById("chineseTextArea").value;
			
			var savedIndex = indexText.substring(0,dictionaryLength);

			try 
			{
				localStorage.setItem("indexText", indexText);
			} catch (error) {
				if (contains(error.name,"Quota"))
				{
					dictionaryLength = dictionaryLength * 0.9;
					dictionaryLength = Math.floor(dictionaryLength);
					saveIndexToLocalStorage(dictionaryLength);
				} else {
					debugLog("error saving to localstorage");
					console.log("error saving to localstorage");
				}
			}

		} // end function saveIndexToLocalStorage

		function saveDictionaryToLocalStorage(dictionaryLength)
		{
			//debugLog("saveDictionaryToLocalStorage(" + dictionaryLength + ")");

			var savedDictionaryData = combinedDictionaryData.substring(0,dictionaryLength);

			try 
			{
				localStorage.setItem("dictionary", savedDictionaryData);
			} catch (error) {
				if (contains(error.name,"Quota"))
				{
					dictionaryLength = dictionaryLength * 0.9;
					dictionaryLength = Math.floor(dictionaryLength);
					saveDictionaryToLocalStorage(dictionaryLength);
				} else {
					debugLog("error saving to localstorage");
					console.log("error saving to localstorage");
				}
			}

		} // end function saveDictionaryToLocalStorage

		function loadDictionary(filename)
		{
			//debugLog("loadDictionary(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						combinedDictionaryData = combinedDictionaryData + xmlhttp.responseText;
					    
					    saveDictionaryToLocalStorage(combinedDictionaryData.length);

						//debugLog("saving " + savedDictionaryData.length);
						
						if (lastDictionary == true)
						{
							dictionariesLoaded();
						}
						
						//localStorage["dictionary"] = savedDictionaryData;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading dictionary');
				   }
				   else {
					   alert('error loading dictionary');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadDictionary
		
		function listImageFolder(imageUrl)
		{
			//debugLog("listImageFolder(" + filename + ")");
			
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						imageFolderList = xmlhttp.responseText;
					    					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading imageFolderList');
				   }
				   else {
					   alert('error loading imageFolderList');
				   }
				}
			};
			
			// Get the name of the folder, not the file inside
			var imageUrlParts = imageUrl.split("/");
			imageUrlParts.pop();
			var imageFolder = imageUrlParts.join("/");
			
			var listCommandUrl = "listFolder.php?folder=" + imageFolder;
			
			xmlhttp.open("GET", listCommandUrl, true);
			xmlhttp.send();
		} // end function listImageFolder
		
		function loadSimplifiedList(filename)
		{
			//debugLog("loadSimplifiedList(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						simplifiedCharacters = simplifiedCharacters + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading simplified characters');
				   }
				   else {
					   alert('error loading simplified characters');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadSimplifiedList
		
		function loadSimplified(filename)
		{
			//debugLog("loadSimplified(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						simplifiedData = simplifiedData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading simplified characters');
				   }
				   else {
					   alert('error loading simplified characters');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadSimplified

		function loadTraditional(filename)
		{
			//debugLog("loadTraditional(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						traditionalData = traditionalData + xmlhttp.responseText;
					    
						if (lastDictionary == true)
						{
							dictionariesLoaded();
						}
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading traditional characters');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadTraditional

		function loadGoogleTransPyTranslation(thisChinese)
		{
			//debugLog("loadGoogleTransPy(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						var thisEnglish = xmlhttp.responseText;
						
						thisEnglish = thisEnglish.toLowerCase();
						
						if (useMediaViewer == true)
						{
							document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = thisEnglish;
						} else {
							document.getElementById("dictionaryEditorEnglishTextArea").value = thisEnglish;
						}
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading Google Translate Python Chinese');
				   }
				}
			};
						
			xmlhttp.open("GET", "googletrans.php?from=zh-tw&to=en&text=" + thisChinese, true);
			xmlhttp.send();
				
		} // end function loadGoogleTransPy


		function loadGoogleTransPy(thisChinese)
		{
			//debugLog("loadGoogleTransPy(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						var thisPinyin = xmlhttp.responseText;
						
						thisPinyin = thisPinyin.toLowerCase();
						
						// auto-split the words using ToneNumbersMarks.txt - not working reliably
						/*
						var toneNumbersMarksArray = toneNumbersMarks.split("\n");
						var numberPinyin = toneNumbersMarksArray.length;
						
						
						for (var currentPinyin = 0; currentPinyin < numberPinyin; currentPinyin++)
						{
							var thisPinyinLine = toneNumbersMarksArray[currentPinyin];
							var thisPinyinSyllable = textBetween(thisPinyinLine, "	", "end");
							
							if (thisPinyinSyllable.length >= 3)
							{
								thisPinyin = replaceChars(thisPinyin, thisPinyinSyllable, " " + thisPinyinSyllable + " ");
							}
							
						} // end for every pinyin syllable
						
						while (contains(thisPinyin, "  ") == true)
						{
							thisPinyin = replaceChars(thisPinyin, "  ", " ");
						}
						
						thisPinyin = thisPinyin.trim();
					   */						
						
						if (useMediaViewer == true)
						{
							document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisPinyin;
						} else {
							document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
					    }
					    
					    loadGoogleTransPyTranslation(thisChinese);
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading Google Translate Python pinyin');
				   }
				}
			};

			xmlhttp.open("GET", "googletrans.php?from=zh-tw&to=pn&text=" + thisChinese, true);
			xmlhttp.send();
				
		} // end function loadGoogleTransPy


		function loadGoogleTransProxy(thisChinese)
		{
			//debugLog("loadGoogleTransProxy(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						var thisResponse = xmlhttp.responseText;
						
						var thisPinyin = textBetween(thisResponse, "transliteration\":\"", "\"");
						var thisEnglish = textBetween(thisResponse, "translation\":\"", "\"");
						
						thisPinyin = thisPinyin.toLowerCase();
						
						if (useMediaViewer == true)
						{
							document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisPinyin;
							document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = thisEnglish;
						} else {
							document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
							document.getElementById("dictionaryEditorEnglishTextArea").value = thisEnglish;
						}
					    
					    loadGoogleTransPyTranslation(thisChinese);
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
				       //console.log(XMLHttpRequest);
					   alert('error loading Google Translate Proxy');
				   }
				}
			};
			
			xmlhttp.open("GET", "proxy.php?url=https://google-translate-proxy.herokuapp.com/api/translate?query=" + thisChinese + "&targetLang=zh-tw&sourceLang=en", true);
			xmlhttp.send();
				
		} // end function loadGoogleTransProxy

		function loadTaiwan(filename)
		{
			//debugLog("loadTaiwan(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						taiwanData = taiwanData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading taiwan regional');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadTaiwan

		function loadHongKong(filename)
		{
			//debugLog("loadHongKong(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						hongKongData = hongKongData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading hong kong regional');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadHongKong

		function loadJapan(filename)
		{
			//debugLog("loadJapan(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						japanData = japanData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading japanese regional');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadJapan

		
		function loadToneNumbersMarks(filename)
		{
			//debugLog("loadToneNumbersMarks(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						toneNumbersMarks = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading tone numbers marks');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadToneNumbersMarks

		function loadBopomofo(filename)
		{
			//debugLog("loadBopomofo(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						bopomofoData = xmlhttp.responseText;
					    
				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading bopomofo');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadBopomofo

		function loadIds(filename)
		{
			//debugLog("loadIds(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						idsData = xmlhttp.responseText;
					    
				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading ids');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadIds
		
		function loadReviewingTheHanzi(filename)
		{
			//debugLog("loadReviewingTheHanzi(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						reviewingTheHanziData = xmlhttp.responseText;
					    
				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading reviewing the hanzi');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadReviewingTheHanzi

		function loadToken()
		{			
			var thisTokenBase64 = "OTA3ZTBkMDE1ODAzNDE5OTU3ZmRhMzllZjJjZDBjMTlmNDVmNWJkNw==";
			
			token = Base64.decode(thisTokenBase64);			
							
		} // end loadToken

		function loadSimplifiedInput(filename)
		{
			//debugLog("loadSimplifiedInput(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						chineseText = xmlhttp.responseText;
						document.getElementById("simplifiedInputTextArea").value = chineseText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading simplified input');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadSimplifiedInput

		function loadLrcMediaViewer(filename)
		{
			//debugLog("loadLrcMediaViewer(" + filename + ")");
			
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						lrcText = xmlhttp.responseText;
						
						if (lrcText == "\n")
						{
							lrcText = "[00:00.000]\n";
						}
						
						document.getElementById("lrcTextArea").value = lrcText;
						
						var lrcArray = lrcText.split("\n");
						var verseNumber = lrcArray.length - 1;
						document.getElementById("verseCountDiv").innerHTML = verseNumber;
						

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading lrc file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
		
		} // end loadLrcMediaViewer

		function loadBilingual(filename)
		{
			//debugLog("loadChinese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						var bilingualFileText = xmlhttp.responseText;
						
						var chineseFileText = "";
						var englishFileText = "";
						
						var inputLines = bilingualFileText.split("\n");
		   
						var numberLines = inputLines.length;
		   
						var outputHtml = "";
						var outputText = "";
		   
						var lastEnglishLine = "";
		   
						var lastWasEnglish = false;

						for (var currentLine = 0; currentLine < numberLines; currentLine = currentLine + 1)
						{
							var thisLine = inputLines[currentLine];
			   
							if (thisLine == "")
							{
								if (lastWasEnglish == false)
								{
									chineseFileText = chineseFileText + "\n";
									englishFileText = englishFileText + "\n";
								}
				   
								outputHtml = outputHtml + "\n<br></br>";
								outputText = outputText + "\n";
				   
							} else {
								if (containsChineseString(thisLine) == true)
								{
									lastWasEnglish = false;

									chineseFileText = chineseFileText + thisLine + "\n";

								} else {
				   
									englishFileText = englishFileText + thisLine + "\n";
				   
									lastWasEnglish = true;
				   
								} // end if the line contains chinese
							} // end if the line is not blank
							   
						} // end for every line
						
						document.getElementById("chineseTextArea").value = chineseFileText;
						document.getElementById("englishTextArea").value = englishFileText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading bilingual file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadBilingual

		function loadChinese(filename)
		{
			//debugLog("loadChinese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						chineseText = xmlhttp.responseText;
						document.getElementById("chineseTextArea").value = chineseText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading chinese file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadChinese
		
		function loadTaiwaneseFile(filename)
		{
			//debugLog("loadTaiwanese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						chineseText = xmlhttp.responseText;
						document.getElementById("chineseTextArea").value = chineseText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading Taiwanese file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTaiwaneseFile

		function loadEnglish(filename)
		{
			//debugLog("loadEnglish(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						englishText = xmlhttp.responseText;
						document.getElementById("englishTextArea").value = englishText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading english file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadEnglish

		function loadLiteral(filename)
		{
			//debugLog("loadLiteral(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						literalText = xmlhttp.responseText;
						document.getElementById("simplifiedInputTextArea").value = literalText;
					    
						document.getElementById("simplifiedInputTitle").style.width = "auto";
						document.getElementById("simplifiedInputTitle").style.visibility = "visible";

						document.getElementById("simplifiedInputTitle").innerHTML = "Literal";

						document.getElementById("simplifiedInputTextArea").style.width = "250px";
						document.getElementById("simplifiedInputTextArea").style.visibility = "visible";

				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading literal file');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadLiteral


		function loadLongWords(filename)
		{
			//debugLog("loadLongWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						longWords = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading long words');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadLongWords

		function loadRadicals(filename)
		{
			//debugLog("loadRadicals(" + filename + ")");
			
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						radicals = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading radicals');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadRadicals

		function loadGenealogies(filename)
		{
			//debugLog("loadGenealogies(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						genealogiesData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading genealogies');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadGenealogies

		function loadComposition(filename)
		{
			//debugLog("loadComposition(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						compositionData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading composition');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadComposition

		function loadCommonWords(filename)
		{
			//debugLog("loadCommonWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						commonWords = commonWords + "\n" + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading common words');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadCommonWords
		
		function loadTaiwanese(filename)
		{
			//debugLog("loadTaiwanese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						taiwaneseData = xmlhttp.responseText;
					    
					    taiwaneseToWordLengths();
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading taiwanese');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTaiwanese

		function loadHakka(filename)
		{
			//debugLog("loadHakka(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						hakkaData = xmlhttp.responseText;
					    
					    hakkaToWordLengths();
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading hakka');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadHakka

		function loadTaiwaneseAndTranslate(filename)
		{
			//debugLog("loadTaiwaneseAndTranslate(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						taiwaneseData = xmlhttp.responseText;
					    
					    taiwaneseToWordLengths();

					    wordSpaceButtonClicked();
			    
					    translateBilingualInterface();
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading taiwanese');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTaiwaneseAndTranslate

		function loadTaiwaneseAndFile(dictionaryFilename, inputFilename)
		{
			//debugLog("loadTaiwaneseAndFile(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {

						taiwaneseData = xmlhttp.responseText;
						
						taiwaneseToWordLengths();
						
						loadTaiwaneseFile(inputFilename);

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading Taiwanese dictionary and file');
				   }
				}
			};

			xmlhttp.open("GET", dictionaryFilename, true);
			xmlhttp.send();
				
		} // end loadTaiwaneseAndFile


		function loadCantonese(filename)
		{
			//debugLog("loadCantonese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						cantoneseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading cantonese');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadCantonese

		function loadHangul(filename)
		{
			//debugLog("loadHangul(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						hangulData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading hangul');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadHangul

		function loadTang(filename)
		{
			//debugLog("loadTang(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						tangData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading tang');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTang

		function loadJapanese(filename)
		{
			//debugLog("loadJapanese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						japaneseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading japanese');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadJapanese

		function loadVietnamese(filename)
		{
			//debugLog("loadVietnamese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						vietnameseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error loading vietnamese');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadVietnamese

		function loadAddWords(filename)
		{
			//debugLog("loadAddWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						addWords = addWords + xmlhttp.responseText;
					    
					    loadEditWords("editWords.txt");
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading addWords');
				   }
				   else {
					   alert('error loading addWords');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadAddWords

		function loadEditWords(filename)
		{
			//debugLog("loadEditWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						editWords = editWords + xmlhttp.responseText;
					    
					    loadRemoveWords("removeWords.txt");
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading editWords');
				   }
				   else {
					   alert('error loading editWords');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadEditWords

		function loadRemoveWords(filename)
		{
			//debugLog("loadRemoveWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						removeWords = removeWords + xmlhttp.responseText;
					    
					    addEditRemoveWordsFromFiles();
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error loading removeWords');
				   }
				   else {
					   alert('error loading removeWords');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadRemoveWords


		
		/* Library functions */
		
		// From https://mathiasbynens.be/notes/javascript-unicode
		function stringLength(thisString)
		{
			if (thisString.length == 0)
			{
				return 0;
			}
		
			var regexAstralSymbols = /[\uD800-\uDBFF][\uDC00-\uDFFF]/g;
			
			try
			{
			return thisString
			//;
			// Replace every surrogate pair with a BMP symbol.
			.replace(regexAstralSymbols, '_')
			// …and *then* get the length.
			.length;
			} catch (error) {
				return thisString.length;
			}
		} // end function stringLength
		
		// From https://mathiasbynens.be/notes/javascript-unicode
		function stringToCharacterArray(string) 
		{
			var index = 0;
			var length = string.length;
			var output = [];
			for (; index < length - 1; ++index) {
				var charCode = string.charCodeAt(index);
				if (charCode >= 0xD800 && charCode <= 0xDBFF) {
					charCode = string.charCodeAt(index + 1);
					if (charCode >= 0xDC00 && charCode <= 0xDFFF) {
						output.push(string.slice(index, index + 2));
						++index;
						continue;
					}
				}
				output.push(string.charAt(index));
			}
			output.push(string.charAt(index));
			return output;
		} // end function stringToCharacterArray
		
		function replaceChars(thisString, searchString, replaceString)
		{
		
			if (thisString == undefined)
			{
				return "";
			}
			//debugLog("replaceChars(" + thisString + "," + searchString + "," + replaceString + ")");

			return thisString.split(searchString).join(replaceString);
		} // end function replaceChars

		function textBetween(thisText, startString, endString)
		{
			//debugLog("textBetween(" + thisText + "," + startString + "," + endString + ")");
			
			if (thisText == undefined)
			{
				return "";
			}
			
			var start_pos = 0;
			if (startString != 'start')
			{
				start_pos = thisText.indexOf(startString);

				// If the text does not contain the start string, return a blank string
				if (start_pos < 0)
				{
					return '';
				}

				// Skip the first startString characters
				start_pos = start_pos + startString.length;
			}

			var end_pos = stringLength(thisText);
			if (endString != 'end')
			{
				end_pos = thisText.indexOf(endString,start_pos);
			}

			// If the text does not have the end string after the start string, return the whole string after the start
			if (end_pos < start_pos)
			{
				end_pos = thisText.length;
			}

			var newText = thisText.substring(start_pos,end_pos);

			return newText;
		} // end textBetween

		// contains - Does thisText contain searchString?
		function contains(thisText, searchString)
		{
			//debugLog("contains(" + thisText + "," + searchString + ")");

			if (thisText == null)
			{
				return false;
			}
			
			return thisText.indexOf(searchString) != -1;
		} // end function contains

		function containsLineStartingWith(thisText, searchString)
		{
			//debugLog("containsLineStartingWith(" + thisText + "," + searchString + ")");

			var searchRegexString = "^" + "(" + searchString + ".*)";
				
			searchRegexString = searchRegexString + "$";
				
			var searchRegex = new RegExp(searchRegexString, "gm");
				
			//document.write(searchRegex);
				
			var searchResultsArray = thisText.match(searchRegex);
			
			if (searchResultsArray == null)
			{
				return false;
			}
			
			if (searchResultsArray.length > 0)
			{
				return true;
			} else {
				return false;
			}
		
		} // end function containsLineStartingWith

		function getDateString()
		{
			//debugLog("getDateString");
		
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1; //January is 0!
			var hour = today.getHours();
			var mins = today.getMinutes();
			var sec = today.getSeconds();

			var yyyy = today.getFullYear();
			if(dd<10)
			{
				dd='0'+dd;
			} 

			if(mm<10)
			{
				mm='0'+mm;
			}

			if(mins<10)
			{
				mins='0'+mins;
			}
			
			if(sec<10)
			{
				sec='0'+sec;
			}
			
			var today = dd+'/'+mm+'/'+yyyy+" "+hour+":"+mins+":"+sec;
			
			return today;
		} // end function getDateString

		// isChinese - check if the character is in the unihan dictionary 
		function isChinese(thisCharacter)
		{
			//debugLog("isChinese(" + thisCharacter + ")");
			
			// Shem, Ham
			if (thisCharacter == "、")
			{
				return true;
			}

			// Pi-hahiroth
			if (thisCharacter == "．")
			{
				return true;
			}
			
			var charCode = thisCharacter.charCodeAt(0);
		
			if (charCode >= 13312)
			{
				if (charCode <= 64217)
				{
					return true;
				}
			}
			
			if (charCode >= 131072)
			{
				if (charCode <= 195101)
				{
					return true;
				}
			}
			
			return false;
			
		} // end function isChinese
		
		function isChineseString(thisString)
		{
			//debugLog("isChineseString(" + thisString + ")");

			var numberCharacters = stringLength(thisString);
			
			var stringIsChinese = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isChinese(thisCharacter) == false)
				{
					stringIsChinese = false;
					break;
				}
			} // end for every character
			
			return stringIsChinese;
		} // end function isChineseString

		function containsChineseString(thisString)
		{
			//debugLog("isChineseString(" + thisString + ")");

			var numberCharacters = stringLength(thisString);
			
			var stringIsChinese = false;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isChinese(thisCharacter) == true)
				{
					stringIsChinese = true;
					break;
				}
			} // end for every character
			
			return stringIsChinese;
		} // end function containsChineseString

		
		function isEnglish(thisCharacter)
		{
			//debugLog("isEnglish(" + thisCharacter + ")");

			var alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890-";
			
			if (contains(alphabet, thisCharacter) == true)
			{
				return true;
			} else {
				return false;
			}
			
		} // end function isEnglish
		
		function isEnglishString(thisString)
		{
			//debugLog("isEnglishString(" + thisString + ")");

			var numberCharacters = stringLength(thisString);
			
			var stringIsEnglish = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isEnglish(thisCharacter) == false)
				{
					stringIsEnglish = false;
					break;
				}
			} // end for every character
			
			return stringIsEnglish;
		} // end function isEnglishString
		
		function isBopomofo(thisCharacter)
		{
			//debugLog("isBopomofo(" + thisCharacter + ")");

			var alphabet = "ㄅㄉˇˋㄓˊ˙ㄚㄞㄢㄦㄆㄊㄍㄐㄔㄗㄧㄛㄟㄣㄇㄋㄎㄑㄕㄘㄨㄜㄠㄤㄈㄌㄏㄒㄖㄙㄩㄝㄡㄥ ";
			
			if (contains(alphabet, thisCharacter) == true)
			{
				return true;
			} else {
				return false;
			}
			
		} // end function isBopomofo
		
		function isBopomofoString(thisString)
		{
			//debugLog("isBopomofoString(" + thisString + ")");

			var numberCharacters = stringLength(thisString);
			
			var stringIsBopomofo = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isBopomofo(thisCharacter) == false)
				{
					stringIsBopomofo = false;
					break;
				}
			} // end for every character
			
			return stringIsBopomofo;
		} // end function isBopomofoString
		
		function isIdsString(thisString)
		{
			//debugLog("isIdsString(" + thisString + ")");
			
			var idsCharacters = "⿰⿱⿲⿳⿴⿵⿶⿷⿸⿹⿺⿻";
			
			var numberCharacters = idsCharacters.length;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisIdsCharacter = idsCharacters[currentCharacter];
				
				if (contains(thisString, thisIdsCharacter) == true)
				{
					return true;
				}
			} // end for every IDS character
			
			return false;
		} // end function isIdsString
		
		// Check if a value is a number
		function isNumeric(n) 
		{
			//debugLog("isNumeric(" + n + ")");
			
			return !isNaN(parseFloat(n)) && isFinite(n);
		} // end function isNumeric

		function isNumberString(thisString)
		{
			//debugLog("isNumberString(" + thisString + ")");

			var numberCharacters = stringLength(thisString);
			
			var stringIsNumber = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isNumeric(thisCharacter) == false)
				{
					stringIsNumber = false;
					break;
				}
			} // end for every character
			
			return stringIsNumber;
		} // end function isNumberString
		
		function sendGithubPutResponseHandler(request, thisData, thisUrl, filename)
		{

			var thisResponse = request.responseText;
			//console.log(thisResponse);

			if (request.readyState == 4)
			{
				// The request is done
				if (request.status == 200)
				{
					// All is well
										
				} else {
				
					var thisResponseString = request.responseText;
		
					var thisResponse = JSON.parse(thisResponseString);
		
					var thisMessage = thisResponse.message;
			
					if (contains(thisMessage, "sha"))
					{
						// We need to overwrite, not write a new file
  						readGithubFileToModify(thisData, thisUrl, filename, false);
					}
				
				}
			}
		
			return;
		}  // end function sendGithubPutResponseHandler
  
		function sendGithubPut(thisString, thisUrl, thisData, filename)
		{
			var request = new XMLHttpRequest();
			request.open('PUT', thisUrl, true);
			request.setRequestHeader('Authorization', 'token ' + token);

			request.onreadystatechange = function(e) { return sendGithubPutResponseHandler.call(e, request, thisData, thisUrl, filename); };

			var requestData = thisString;

			request.send(requestData);

		} // end function sendGithubPut
  
		function sendGithubRequest(thisUrl)
		{
			var xmlhttp = new XMLHttpRequest();

				xmlhttp.onreadystatechange = function() 
				{
					if (xmlhttp.readyState == XMLHttpRequest.DONE ) 
					{
						if (xmlhttp.status == 200)
						{
						
							var thisResponse = xmlhttp.responseText;
						
							//console.log(thisResponse);
						
					   } // end if it loaded the KML
					   else if (xmlhttp.status == 400) 
					   {
						  alert('There was an error 400');
					   }
					   else 
					   {
						   alert('error sending github request');
					   }
					}
				};

				xmlhttp.open("GET", thisUrl, true);
				xmlhttp.send();
				
			} // end function sendGithubRequest
  		
		function githubModifyResponseHandler(request, thisData, filename, append)
		{
			if (request.readyState == 4)
			{
				// The request is done
				if (request.status == 200)
				{
					// All is well
					
					var thisResponseString = request.responseText;
		
					var thisResponse = JSON.parse(thisResponseString);
					
					var thisSha = thisResponse.sha;
					
					var thisFileBase64 = thisResponse.content;
					
					var thisFileText = Base64.decode(thisFileBase64);
					
					// Append the data
					if (append == true)
					{
						thisData = thisFileText + thisData;
					}
					
					var thisDataBase64 = Base64.encode(thisData);
					
					//debugLog(thisSha + "<br></br>" + thisDataBase64);
					
					// Just append to the base64
					//var newFileBase64 = thisFileBase64 + thisDataBase64;
					
					// Write the new file
  					var message = "append";
  					var committer = "Peter Burkimsher";
  					var email = "peterburk@gmail.com";
  			
  					var thisString = "{\"path\": \"" + filename + "\", \"message\": \"" + message + "\", \"sha\":\"" + thisSha + "\", \"committer\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"content\": \"" + thisDataBase64 + "\", \"branch\": \"master\"}"
  					
  					//debugLog(thisString);
		
		  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  		
  					sendGithubPut(thisString, thisUrl);
										
				} // end if request status is 200
			} // end if request is ready
		} // end function githubAppendResponseHandler
		
		function readGithubFileToModify(thisData, thisUrl, filename, append)
		{
			var request = new XMLHttpRequest();
			request.open('GET', thisUrl, true);
			request.setRequestHeader('Authorization', 'token ' + token);

			request.onreadystatechange = function(e) { return githubModifyResponseHandler.call(e, request, thisData, filename, append); };

			request.send();

		} // end function readGithubFileToAppend

  		function appendToGithub(filename, thisData)
  		{
  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  			
  			readGithubFileToModify(thisData, thisUrl, filename, true);
  		} // end function appendToGithub

  		function writeToGithub(filename, thisData)
  		{
  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  			
  			var thisDataBase64 = Base64.encode(thisData);
  			
  			var message = "write";
  			var committer = "peter";
  			var email = "peter";
  			
  			var thisString = "{\"path\": \"" + filename + "\", \"message\": \"" + message + "\", \"committer\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"author\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"content\": \"" + thisDataBase64 + "\", \"branch\": \"master\"}"
  			
  			sendGithubPut(thisString, thisUrl, thisData, filename);
  		} // end function writeToGithub
  				
		// Write to file response handler
		function writeToFileResponseHandler(e, request)
		{
		
		} // end function writeToFile


		// Write to file - call a PHP script to write a file
		function writeToFile(filename, thisString)
		{
			//debugLog("writeToFile(" + filename + "," + thisString + ")");

	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				var request = new XMLHttpRequest();
				request.open('POST', 'writeToFile.php', true);
				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

				thisString = replaceChars(thisString, "&", "and")

				request.onreadystatechange = function(e) { return writeToFileResponseHandler.call(e, request); };
				
				var requestData = "filename=" + filename + "&" + "data=" + thisString;

				request.send(requestData);
			} else {
				writeToGithub(filename, thisString);
				
			}

		} // end function writeToFile

		function appendToFileResponseHandler(request)
		{
		  //debugLog("appendToFileResponseHandler");
		  if (request.readyState == 4)
		  {
			// The request is done
			if (request.status == 200)
			{
			  // All is well	  
			}
		  }

		  return;
		}
		  
		function appendToFile(filename, thisString)
		{
			//debugLog("appendToFile(" + filename + "," + thisString + ")");
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;
			
			if (useGithub == false)
			{
				var request = new XMLHttpRequest();
				request.open('POST', 'appendToFile.php', true);
				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

				request.onreadystatechange =
		  		function(e) { return appendToFileResponseHandler.call(e, request); };

				var requestData = "filename=" + filename + "&" + "data=" + thisString;

				request.send(requestData);
			} else {
			
				// github writing doesn't work
				//appendToGithub(filename, thisString);

			}

		} // end function appendToFile
		
		function editInFileResponseHandler(request)
		{
		  //debugLog("editInFileResponseHandler");
		  if (request.readyState == 4)
		  {
			// The request is done
			if (request.status == 200)
			{
			  // All is well	  
			}
		  }

		  return;
		}
		
		function editInFile(filename, oldDefinition, newDefinition)
		{
			//debugLog("appendToFile(" + filename + "," + thisString + ")");
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;
			
			if (useGithub == false)
			{
				var request = new XMLHttpRequest();
				request.open('POST', 'editInFile.php', true);
				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

				request.onreadystatechange =
		  		function(e) { return appendToFileResponseHandler.call(e, request); };

				var requestData = "filename=" + filename + "&" + "old=" + oldDefinition + "&" + "new=" + newDefinition;

				request.send(requestData);
			} else {
			
				// github writing doesn't work
				//appendToGithub(filename, thisString);

			}
		} // end function editInFile

		// returns a char's Unicode codepoint, of the char at index idx of string str
		// 2013-07-16 from https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/String/charCodeAt
		function fixedCharCodeAt (str, idx) 
		{
			//debugLog("fixedCharCodeAt(" + str + "," + idx + ")");
			
			// ex. fixedCharCodeAt ('\uD800\uDC00', 0); // 65536
			// ex. fixedCharCodeAt ('\uD800\uDC00', 1); // 65536
			idx = idx || 0;
			var code = str.charCodeAt(idx);
			var hi, low;
			if (0xD800 <= code && code <= 0xDBFF) 
			{ // High surrogate (could change last hex to 0xDB7F to treat high private surrogates as single characters)
        		hi = code;
        		low = str.charCodeAt(idx+1);
        		if (isNaN(low)) 
        		{
            		throw 'High surrogate not followed by low surrogate in fixedCharCodeAt()';
        		}
        		return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;
    		}
    		if (0xDC00 <= code && code <= 0xDFFF) 
    		{ 
    			// Low surrogate
        		// We return false to allow loops to skip this iteration since should have already handled high surrogate above in the previous iteration
        	return false;
        	/*hi = str.charCodeAt(idx-1);
        	low = code;
        	return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;*/
    		}
    		return code;
		} // end function fixedCharCodeAt

		/* Translate */
		
		function getBopomofo(thisCharacter, thisTone)
		{
			//debugLog("getBopomofo(" + thisCharacter + ")");
			
			var tones = ["", "ˊ", "ˇ", "ˋ", "˙"];
			
			var thisBopomofoHtml = "<table style=\"font-size: 10px;\"><tr>";

			var thisBopomofoString = textBetween(bopomofoData,"\n" + thisCharacter + " ","\n");
			
			if (thisBopomofoString == "")
			{
				return "";
			}
			
			var toneSet = false;
			

			thisBopomofoString = replaceChars(thisBopomofoString, "˙", "");
			
			//if (contains(thisBopomofoString,"˙"))
			//{
				if (thisTone == 5)
				{
					thisBopomofoString = "˙" + thisBopomofoString;
				}
			//}


			
			var thisBopomofoArray = stringToCharacterArray(thisBopomofoString);
			
			var numberBopomofo = thisBopomofoArray.length;
			
			for (var currentBopomofo = 0; currentBopomofo < numberBopomofo; currentBopomofo++)
			{
				var thisBopomofo = thisBopomofoArray[currentBopomofo];
				
				if (contains(tones,thisBopomofo))
				{
					// Pinyin tone overrides zhuyin tone from file
					if (thisTone != 5)
					{
						thisBopomofo = tones[thisTone - 1];
						thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
					} else {
						if (thisBopomofo == "˙")
						{
							thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
						}
					}
					
					toneSet = true;
					
				} else {
					thisBopomofoHtml = thisBopomofoHtml + "</tr><tr><td>" + thisBopomofo + "</td>";
				} // end if this bopomofo is a tone
				
			} // end for every bopomofo
			
			if (toneSet == false)
			{
				if (thisTone > 1)
				{
					thisBopomofo = tones[thisTone - 1];
					thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
				}
			}
			
			thisBopomofoHtml = thisBopomofoHtml + "</tr></table>";
			
			return thisBopomofoHtml;
			
		} // end function getBopomofo
		
		function getWadeGiles(thisToneless, thisTone)
		{
			//debugLog("getWadeGiles(" + thisToneless + "," + thisTone + ")");

			var pinyinArray = ["zhuang", "zhuan", "zhuai", "zhong", "zheng", "zhang", "xiong", "xiang", "sheng", "qiong", "qiang", "jiong", "jiang", "guang", "chong", "cheng", "zuan", "zong", "zhuo", "zhun", "zhui", "zhua", "zhou", "zhen", "zhei", "zhao", "zhan", "zhai", "zeng", "zang", "yuan", "yong", "xuan", "xing", "xiao", "xian", "weng", "tong", "tian", "teng", "song", "shen", "seng", "ruan", "rong", "reng", "rang", "quan", "qing", "qiao", "qian", "pian", "peng", "nong", "nian", "neng", "mian", "meng", "long", "lian", "leng", "kong", "keng", "juan", "jing", "jiao", "jian", "hong", "heng", "guan", "guai", "gong", "geng", "gang", "feng", "duan", "dong", "ding", "diao", "dian", "deng", "dang", "cuan", "cong", "chuo", "chen", "ceng", "cang", "bing", "biao", "bian", "beng", "bang", "zuo", "zun", "zui", "zou", "zhu", "zhi", "zhe", "zha", "zen", "zei", "zao", "zan", "zai", "yun", "yue", "you", "yan", "xun", "xue", "xiu", "xin", "xie", "xia", "wen", "tuo", "tie", "suo", "shi", "sen", "ruo", "run", "rui", "rou", "ren", "rao", "ran", "qun", "que", "qiu", "qin", "qie", "qia", "pie", "pen", "nuo", "nüe", "nie", "nen", "mie", "men", "luo", "lüe", "lie", "kui", "ken", "jun", "jue", "jiu", "jin", "jie", "jia", "hen", "guo", "gun", "gui", "gua", "gou", "gen", "gei", "gao", "gan", "gai", "fen", "duo", "dun", "dui", "dou", "diu", "die", "dei", "dao", "dan", "dai", "cuo", "cun", "cui", "cou", "chi", "che", "cen", "cao", "can", "cai", "bin", "bie", "ben", "bei", "bao", "ban", "bai", "zu", "zi", "ze", "za", "yu", "yi", "ye", "xu", "xi", "te", "si", "se", "ru", "ri", "re", "qu", "qi", "le", "ke", "ju", "ji", "he", "gu", "ge", "ga", "er", "en", "du", "di", "de", "da", "cu", "ci", "ce", "ca", "bu", "bo", "bi", "ba", "e"];
			
			var wadeGilesArray = ["chuang", "chuan", "chuai", "chung", "chêng", "chang", "hsiung", "hsiang", "shêng", "chiung", "chiang", "chiung", "chiang", "kuang", "chung", "chêng", "tsuan", "tsung", "cho", "chun", "chui", "chua", "chou", "chên", "chei", "chao", "chan", "chai", "tsêng", "tsang", "yüan", "yung", "hsüan", "hsing", "hsiao", "hsien", "wêng", "tung", "tien", "têng", "sung", "shên", "sêng", "juan", "jung", "jêng", "jang", "chüan", "ching", "chiao", "chien", "pien", "pêng", "nung", "nien", "nêng", "mien", "mêng", "lung", "lien", "lêng", "kung", "kêng", "chüan", "ching", "chiao", "chien", "hung", "hêng", "kuan", "kuai", "kung", "kêng", "kang", "fêng", "tuan", "tung", "ting", "tiao", "tien", "têng", "tang", "tsuan", "tsung", "cho", "chên", "tsêng", "tsang", "ping", "piao", "pien", "pêng", "pang", "tso", "tsun", "tsui", "tsou", "chu", "chih", "chê", "cha", "tsên", "tsei", "tsao", "tsan", "tsai", "yün", "yüeh", "yu", "yen", "hsün", "hsüeh", "hsiu", "hsin", "hsieh", "hsia", "wên", "to", "tieh", "so", "shih", "sên", "jo", "jun", "jui", "jou", "jên", "jao", "jan", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "pieh", "pên", "no", "nüeh", "nieh", "nên", "mieh", "mên", "lo", "lüeh", "lieh", "kuei", "kên", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "hên", "kuo", "kun", "kuei", "kua", "kou", "kên", "kei", "kao", "kan", "kai", "fên", "to", "tun", "tui", "tou", "tiu", "tieh", "tei", "tao", "tan", "tai", "tso", "tsun", "tsui", "tsou", "chih", "chê", "tsên", "tsao", "tsan", "tsai", "pin", "pieh", "pên", "pei", "pao", "pan", "pai", "tsu", "tzu", "tsê", "tsa", "yü", "i", "yeh", "hsü", "hsi", "tê", "ssu", "sê", "ju", "jih", "jê", "chü", "chi", "lê", "ko", "chü", "chi", "ho", "ku", "ko", "ka", "êrh", "ên", "tu", "ti", "tê", "ta", "tsu", "tzu", "tsê", "tsa", "pu", "po", "pi", "pa", "o"];		
			
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵"];
			
			var thisToneSuperscript = toneSuperscripts[thisTone];
			
			var thisWadeGiles = "";
			
			var pinyinIndex = pinyinArray.indexOf(thisToneless);
			
			if (pinyinIndex != -1)
			{
				thisWadeGiles = wadeGilesArray[pinyinIndex] + thisToneSuperscript;
			} else {
				thisWadeGiles = thisToneless + thisToneSuperscript;
			}
			
			return thisWadeGiles;
			
		} // end function getWadeGiles
		
		function dictionaryContainsTaiwanese(thisWordChinese)
		{
			//debugLog("dictionaryContainsTaiwanese");
			
			var wordLength = stringLength(thisWordChinese);
			
			switch (wordLength)
			{
				case 5: return contains(fiveWordsTaiwanese, "\n" + thisWordChinese + "\n"); break;
				case 4: return contains(fourWordsTaiwanese, "\n" + thisWordChinese + "\n"); break;
				case 3: return contains(threeWordsTaiwanese, "\n" + thisWordChinese + "\n"); break;
				case 2: return contains(twoWordsTaiwanese, "\n" + thisWordChinese + "\n"); break;
				case 1: return contains(oneWordsTaiwanese, "\n" + thisWordChinese + "\n"); break;
				default: return false; break;
			}		
		} // end function dictionaryContainsTaiwanese
		
		function dictionarySearchTaiwanese(thisWordChinese)
		{
			//debugLog("dictionarySearchTaiwanese");
			
			var searchResults = [];
			
			if (dictionaryContainsTaiwanese(thisWordChinese) == false)
			{
				return searchResults;
			}
			
			var taiwaneseDataArray = taiwaneseData.split("\n" + thisWordChinese + "	");
			
			var numberResults = taiwaneseDataArray.length;
			
			for (var currentResult = 0; currentResult < numberResults; currentResult++)
			{
				var thisResult = taiwaneseDataArray[currentResult];
				
				thisResult = textBetween(thisResult, "start", "\n");
				
				// Index 0 is just the first line of the dictionary, so we read results from index 1
				searchResults.push(thisResult);
				
			} // end for every result
			
			//debugLog(searchResults.join(","));
			
			return searchResults;
			
		} // end function dictionarySearchTaiwanese
		
		function dictionarySearchCantonese(thisWordChinese)
		{
			//debugLog("dictionarySearchCantonese");
			
			var searchResults = [];
			
			if (contains(cantoneseData, "\n" + thisWordChinese + "	") == false)
			{
				return searchResults;
			}
			
			var cantoneseDataArray = cantoneseData.split("\n" + thisWordChinese + "	");
			
			var numberResults = cantoneseDataArray.length;
			
			for (var currentResult = 0; currentResult < numberResults; currentResult++)
			{
				var thisResult = cantoneseDataArray[currentResult];
				
				thisResult = textBetween(thisResult, "start", "\n");
				
				// Index 0 is just the first line of the dictionary, so we read results from index 1
				searchResults.push(thisResult);
				
			} // end for every result
			
			//debugLog(searchResults.join(","));
			
			return searchResults;
			
		} // end function dictionarySearchCantonese
		
		function dictionaryContainsHakka(thisWordChinese)
		{
			//debugLog("dictionaryContainsHakka");
			
			var wordLength = stringLength(thisWordChinese);
			
			switch (wordLength)
			{
				case 5: return contains(fiveWordsHakka, "\n" + thisWordChinese + "\n"); break;
				case 4: return contains(fourWordsHakka, "\n" + thisWordChinese + "\n"); break;
				case 3: return contains(threeWordsHakka, "\n" + thisWordChinese + "\n"); break;
				case 2: return contains(twoWordsHakka, "\n" + thisWordChinese + "\n"); break;
				case 1: return contains(oneWordsHakka, "\n" + thisWordChinese + "\n"); break;
				default: return false; break;
			}		
		} // end function dictionaryContainsHakka

		function dictionarySearchHakka(thisWordChinese)
		{
			//debugLog("dictionarySearchHakka");
			
			var searchResults = [];
			
			if (dictionaryContainsHakka(thisWordChinese) == false)
			{
				return searchResults;
			}
			
			var hakkaDataArray = hakkaData.split("\n" + thisWordChinese + "	");
			
			var numberResults = hakkaDataArray.length;
			
			for (var currentResult = 0; currentResult < numberResults; currentResult++)
			{
				var thisResult = hakkaDataArray[currentResult];
				
				thisResult = textBetween(thisResult, "start", "\n");
				
				// Index 0 is just the first line of the dictionary, so we read results from index 1
				searchResults.push(thisResult);
				
			} // end for every result
			
			//debugLog(searchResults.join(","));
			
			return searchResults;
			
		} // end function dictionarySearchHakka
		
		function getTaiwanese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getTaiwanese(" + thisWordChinese + "," + thisPinyinWord + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var thisTaiwanese = "";
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var mouseoverText = "";
			
			var thisTaiwaneseTonesArray = [];
			
			if (numberResults > 0)
			{
				/*
				thisTaiwanese = textBetween(taiwaneseData, "\n" + thisWordChinese + "	","	");
				
				thisTaiwanese = textBetween(thisTaiwanese, "start","(");
				
				
				thisTaiwanese = textBetween(taiwaneseData, "\n" + thisWordChinese + "	","\n");
				*/
				
				if (numberResults > 1)
				{
					var mouseoverArray = [];
					
					for (var currentResult = 2; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						mouseoverArray.push(thisResult);
					} // end for every other result
					
					mouseoverText = mouseoverArray.join(",");
					
				} // end if there is more than one result
				
				// Use index 1 because index 0 is just the first line of the dictionary
				thisTaiwanese = dictionaryResultsArray[1];
				
				thisTaiwaneseTones = textBetween(thisTaiwanese, "	","end");
				thisTaiwanese = textBetween(thisTaiwanese, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisTaiwaneseWordsArray = thisTaiwanese.split(" ");
				thisTaiwaneseTonesArray = stringToCharacterArray(thisTaiwaneseTones);
				
				thisTaiwanese = "";
				
				var numberTaiwaneseWords = thisTaiwaneseWordsArray.length;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisTaiwaneseWord = thisTaiwaneseWordsArray[currentCharacter];
					var thisCharacterTaiwanese = thisTaiwanese[currentCharacter];
					var thisCharacterTaiwaneseTone = thisTaiwaneseTonesArray[currentCharacter];
					
					if (currentCharacter >= numberTaiwaneseWords)
					{
						thisTaiwaneseWord = "";
					}
										
					if (addToneNumbers == true)
					{
						var thisTone = toneSuperscripts[thisCharacterTaiwaneseTone];
					   
						if (thisTone != undefined)
						{
							thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + thisTone + " ";
						} else {
							thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + " ";
						}
					} else {
						thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + " ";
					}
					
				} // end for every character
								
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisTaiwanese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						var thisCharacterTaiwaneseResults = getTaiwanese(thisCharacterChinese, thisCharacterPinyin);
						var thisCharacterTaiwanese = thisCharacterTaiwaneseResults[0];
						var thisCharacterTaiwaneseOptions = thisCharacterTaiwaneseResults[1];
						var thisCharacterTone = thisCharacterTaiwaneseResults[2];
						
						thisTaiwaneseTonesArray.push(thisCharacterTone);
						
						thisTaiwanese = thisTaiwanese + thisCharacterTaiwanese;
						
						mouseoverText = mouseoverText + thisCharacterTaiwaneseOptions + ",";
						
						//thisTaiwanese = thisTaiwanese + getTaiwanese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the taiwanese is in the dictionary
			
			var thisTaiwaneseArray = [thisTaiwanese, mouseoverText, thisTaiwaneseTonesArray];
			
			return thisTaiwaneseArray;
			
			//return thisTaiwanese;
			
		} // end function getTaiwanese
		
		function getTaiwaneseTonesHtml(thisWord, thisTone)
		{
			//debugLog("getTaiwaneseTonesHtml(" + thisWord + "," + thisTone + ")");
			
			if (thisWord == undefined)
			{
				return thisWord;
			}

			if (thisTone == undefined)
			{
				return thisWord;
			}

			if (thisTone == 1)
			{
				return thisWord;
			}
			
			var thisWordArray = stringToCharacterArray(thisWord);
			
			var numberCharacters = thisWordArray.length;
			
			// Longest is 7
			var thisWordSized;
			
			if (numberCharacters == 1)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
			
				return thisWord;
			}
			
			if (numberCharacters == 2)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}
			
			if (numberCharacters == 7)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
				
			}
			
			return thisWord;
			
		} // end function getTaiwaneseTonesHtml
		
		function getTaiwaneseHtml(theseWordsChinese, theseWordsTaiwanese, currentLine, currentLineTaiwaneseWord)
		{
			//debugLog("getTaiwaneseHtml(" + theseWordsChinese + "," + theseWordsTaiwanese + ")");
			
			var taiwaneseHtmlWords = "";

			var dictionaryResultsArray = dictionarySearchTaiwanese(theseWordsChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var mouseoverText = "";
			
			if (numberResults > 0)
//			if (contains(taiwaneseData, "\n" + theseWordsChinese + "	"))
			{
				
				if (numberResults > 1)
				{
					var mouseoverArray = [];
					
					for (var currentResult = 2; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						mouseoverArray.push(thisResult);
					} // end for every other result
					
					mouseoverText = mouseoverArray.join(" ");
					
				} // end if there is more than one result
				
				
				// Read from result index 1, because index 0 is the first text item in the dictionary
				var thisResult = dictionaryResultsArray[1];
				
				//var thisTaiwaneseTones = textBetween(taiwaneseData, "\n" + theseWordsChinese + "	","\n");
				var thisTaiwaneseTones = thisResult;
				thisTaiwaneseTones = textBetween(thisTaiwaneseTones, "	", "end");
				var numberTones = thisTaiwaneseTones.length;
				
				var theseWordsChineseArray = stringToCharacterArray(theseWordsChinese);
				var thisTaiwaneseArray = theseWordsTaiwanese.split(" ");
				var thisTaiwaneseTonesArray = stringToCharacterArray(thisTaiwaneseTones);
				var numberWords = theseWordsChineseArray.length;
				var numberTaiwaneseWords = thisTaiwaneseArray.length;
				
				if (numberTones < numberWords)
				{
					taiwaneseHtmlWords = getTaiwaneseHtmlCharacters(theseWordsChinese, theseWordsTaiwanese, currentLine, currentLineTaiwaneseWord);
				} else {
					for (var currentCharacter = 0; currentCharacter < numberWords; currentCharacter++)
					{
						var thisCharacterTaiwanese = thisTaiwaneseArray[currentCharacter];
						var thisCharacterTaiwaneseTone = thisTaiwaneseTonesArray[currentCharacter];
					
						//debugLog(thisCharacterTaiwanese + "," + thisCharacterTaiwaneseTone);
					
						if (currentCharacter >= numberTaiwaneseWords)
						{
							thisCharacterTaiwanese = "";
						}
					
						var thisTaiwaneseHtmlWordTonesHtml = getTaiwaneseTonesHtml(thisCharacterTaiwanese, thisCharacterTaiwaneseTone);
					
						// Default to black
						if (thisCharacterTaiwaneseTone == undefined)
						{
							thisCharacterTaiwaneseTone = 7;
						}
					
						thisTaiwaneseHtmlWord = "<div ";
						
						var pojId = "pojLine" + currentLine + "Word" + currentLineTaiwaneseWord + "Character" + currentCharacter;
						
						thisTaiwaneseHtmlWord = thisTaiwaneseHtmlWord + "id=\"" + pojId + "\" ";
					
						if (mouseoverText != "")
						{
							thisTaiwaneseHtmlWord = thisTaiwaneseHtmlWord + "title=\"" + mouseoverText + "\" ";
						} // if there are other options
					
					
						thisTaiwaneseHtmlWord = thisTaiwaneseHtmlWord + "class=\"taiwanese_" + thisCharacterTaiwaneseTone + "\">" + thisTaiwaneseHtmlWordTonesHtml + "</div>";
					
						taiwaneseHtmlWords = taiwaneseHtmlWords + thisTaiwaneseHtmlWord + " ";
					} // end for every character in the Taiwanese
					
				} // end if numberTones < numberTaiwaneseWords then automatically charsToPoj
				
			} else {
				taiwaneseHtmlWords = getTaiwaneseHtmlCharacters(theseWordsChinese, theseWordsTaiwanese, currentLine, currentLineTaiwaneseWord);
			} // end if the word is in the dictionary	
						
			return taiwaneseHtmlWords;
			
		} // end function getTaiwaneseHtml
		
		function getTaiwaneseHtmlCharacters(theseWordsChinese, theseWordsTaiwanese, currentLine, currentLineTaiwaneseWord)
		{
			//debugLog("getTaiwaneseHtmlCharacters(" + theseWordsChinese + ", " + theseWordsTaiwanese + ")");

			var taiwaneseHtmlWords = "";

			var thisChineseArray = stringToCharacterArray(theseWordsChinese);
			var thisTaiwaneseArray = theseWordsTaiwanese.split(" ");
			var numberWords = thisChineseArray.length;
			var numberTaiwaneseWords = thisTaiwaneseArray.length;
							
			for (var currentCharacter = 0; currentCharacter < numberWords; currentCharacter++)
			{
				var thisCharacterChinese = thisChineseArray[currentCharacter];
				var thisCharacterTaiwanese = thisTaiwaneseArray[currentCharacter];
				
				//debugLog(thisCharacterChinese);
				
				if (currentCharacter >= numberTaiwaneseWords)
				{
					thisCharacterTaiwanese = "";
				}
				
				var thisTaiwaneseTone = 1;
				
				var thisTaiwaneseHtmlWord = "";

				var pojId = "pojLine" + currentLine + "Word" + currentLineTaiwaneseWord + "Character" + currentCharacter;

				if (dictionaryContainsTaiwanese(thisCharacterChinese) == true)
				{
					thisTaiwaneseTone = textBetween(taiwaneseData, "\n" + thisCharacterChinese + "	","\n");
					thisCharacterTaiwanese = textBetween(thisTaiwaneseTone, "start", "	");
					thisTaiwaneseTone = textBetween(thisTaiwaneseTone, "	","end");
					
					thisTaiwaneseHtmlWord = getTaiwaneseTonesHtml(thisCharacterTaiwanese, thisTaiwaneseTone);

					thisTaiwaneseHtmlWord = "<div id=\"" + pojId + "\" class=\"taiwanese_" + thisTaiwaneseTone + "\">" + thisTaiwaneseHtmlWord + "</div>";
					
				} else {
					thisTaiwaneseHtmlWord = "<div id=\"" + pojId + "\" class=\"taiwanese_" + thisTaiwaneseTone + "\">" + thisCharacterTaiwanese + "</div>";
				}
				
				//debugLog(thisTaiwaneseHtmlWord);
				
				taiwaneseHtmlWords = taiwaneseHtmlWords + thisTaiwaneseHtmlWord + " ";
				
			} // end for every character in the word
			
			return taiwaneseHtmlWords;
			
		} // end function getTaiwaneseHtmlCharacters

		function getHakka(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getHakka(" + thisWordChinese + "," + thisPinyinWord + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var thisHakka = "";
			
			var dictionaryResultsArray = dictionarySearchHakka(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var mouseoverText = "";
			
			var thisHakkaTonesArray = [];
			
			if (numberResults > 0)
			{
				/*
				thisHakka = textBetween(hakkaData, "\n" + thisWordChinese + "	","	");
				
				thisHakka = textBetween(thisHakka, "start","(");
				
				
				thisHakka = textBetween(hakkaData, "\n" + thisWordChinese + "	","\n");
				*/
				
				if (numberResults > 1)
				{
					var mouseoverArray = [];
					
					for (var currentResult = 2; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						mouseoverArray.push(thisResult);
					} // end for every other result
					
					mouseoverText = mouseoverArray.join(",");
					
				} // end if there is more than one result
				
				// Use index 1 because index 0 is just the first line of the dictionary
				thisHakka = dictionaryResultsArray[1];
				
				thisHakkaTones = textBetween(thisHakka, "	","end");
				thisHakka = textBetween(thisHakka, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisHakkaWordsArray = thisHakka.split(" ");
				thisHakkaTonesArray = stringToCharacterArray(thisHakkaTones);
				
				thisHakka = "";
				
				var numberHakkaWords = thisHakkaWordsArray.length;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisHakkaWord = thisHakkaWordsArray[currentCharacter];
					var thisCharacterHakka = thisHakka[currentCharacter];
					var thisCharacterHakkaTone = thisHakkaTonesArray[currentCharacter];
					
					if (currentCharacter >= numberHakkaWords)
					{
						thisHakkaWord = "";
					}
										
					if (addToneNumbers == true)
					{
						var thisTone = toneSuperscripts[thisCharacterHakkaTone];
					   
						if (thisTone != undefined)
						{
							thisHakka = thisHakka + thisHakkaWord + thisTone + " ";
						} else {
							thisHakka = thisHakka + thisHakkaWord + " ";
						}
					} else {
						thisHakka = thisHakka + thisHakkaWord + " ";
					}
					
				} // end for every character
								
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisHakka = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						var thisCharacterHakkaResults = getHakka(thisCharacterChinese, thisCharacterPinyin);
						var thisCharacterHakka = thisCharacterHakkaResults[0];
						var thisCharacterHakkaOptions = thisCharacterHakkaResults[1];
						var thisCharacterTone = thisCharacterHakkaResults[2];
						
						thisHakkaTonesArray.push(thisCharacterTone);
						
						thisHakka = thisHakka + thisCharacterHakka;
						
						mouseoverText = mouseoverText + thisCharacterHakkaOptions + ",";
						
						//thisHakka = thisHakka + getHakka(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the hakka is in the dictionary
			
			var thisHakkaArray = [thisHakka, mouseoverText, thisHakkaTonesArray];
			
			return thisHakkaArray;
			
			//return thisHakka;
			
		} // end function getHakka
		
		function getHakkaTonesHtml(thisWord, thisTone)
		{
			//debugLog("getHakkaTonesHtml(" + thisWord + "," + thisTone + ")");
			
			var thisWordSized;

			if (thisWord == undefined)
			{
				return thisWord;
			}

			if (thisTone == undefined)
			{
				return thisWord;
			}

			if (thisTone == 1)
			{
				return thisWord;
			}
			
			var thisWordArray = stringToCharacterArray(thisWord);
			
			var numberCharacters = thisWordArray.length;
			
			// Longest is 7
			
			if (numberCharacters == 1)
			{
				thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>";
				return thisWordSized;
			}
			
			if (numberCharacters == 2)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}
			
			if (numberCharacters == 7)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				return thisWord;
				
			}
			
			return thisWord;
			
		} // end function getHakkaTonesHtml
		
		function getHakkaHtml(theseWordsChinese, theseWordsHakka, currentLine, currentLineHakkaWord)
		{
			//debugLog("getHakkaHtml(" + theseWordsChinese + "," + theseWordsHakka + ")");
			
			var hakkaHtmlWords = "";

			var dictionaryResultsArray = dictionarySearchHakka(theseWordsChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var mouseoverText = "";
			
			if (numberResults > 0)
//			if (contains(hakkaData, "\n" + theseWordsChinese + "	"))
			{
				
				if (numberResults > 1)
				{
					var mouseoverArray = [];
					
					for (var currentResult = 2; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						mouseoverArray.push(thisResult);
					} // end for every other result
					
					mouseoverText = mouseoverArray.join(" ");
					
				} // end if there is more than one result
				
				
				// Read from result index 1, because index 0 is the first text item in the dictionary
				var thisResult = dictionaryResultsArray[1];
				
				//var thisHakkaTones = textBetween(hakkaData, "\n" + theseWordsChinese + "	","\n");
				var thisHakkaTones = thisResult;
				thisHakkaTones = textBetween(thisHakkaTones, "	", "end");
				var numberTones = thisHakkaTones.length;
				
				var theseWordsChineseArray = stringToCharacterArray(theseWordsChinese);
				var thisHakkaArray = theseWordsHakka.split(" ");
				var thisHakkaTonesArray = stringToCharacterArray(thisHakkaTones);
				var numberWords = theseWordsChineseArray.length;
				var numberHakkaWords = thisHakkaArray.length;
				
				if (numberTones < numberWords)
				{
					hakkaHtmlWords = getHakkaHtmlCharacters(theseWordsChinese, theseWordsHakka, currentLine, currentLineHakkaWord);
				} else {
					for (var currentCharacter = 0; currentCharacter < numberWords; currentCharacter++)
					{
						var thisCharacterHakka = thisHakkaArray[currentCharacter];
						var thisCharacterHakkaTone = thisHakkaTonesArray[currentCharacter];
					
						//debugLog(thisCharacterHakka + "," + thisCharacterHakkaTone);
					
						if (currentCharacter >= numberHakkaWords)
						{
							thisCharacterHakka = "";
						}
					
						var thisHakkaHtmlWordTonesHtml = getHakkaTonesHtml(thisCharacterHakka, thisCharacterHakkaTone);
					
						// Default to black
						if (thisCharacterHakkaTone == undefined)
						{
							thisCharacterHakkaTone = 7;
						}
					
						thisHakkaHtmlWord = "<div ";
						
						var pfsId = "pfsLine" + currentLine + "Word" + currentLineHakkaWord + "Character" + currentCharacter;
						
						thisHakkaHtmlWord = thisHakkaHtmlWord + "id=\"" + pfsId + "\" ";
					
						if (mouseoverText != "")
						{
							thisHakkaHtmlWord = thisHakkaHtmlWord + "title=\"" + mouseoverText + "\" ";
						} // if there are other options
					
					
						thisHakkaHtmlWord = thisHakkaHtmlWord + "class=\"hakka_" + thisCharacterHakkaTone + "\">" + thisHakkaHtmlWordTonesHtml + "</div>";
					
						hakkaHtmlWords = hakkaHtmlWords + thisHakkaHtmlWord + " ";
					} // end for every character in the Hakka
					
				} // end if numberTones < numberHakkaWords then automatically charsToPoj
				
			} else {
				hakkaHtmlWords = getHakkaHtmlCharacters(theseWordsChinese, theseWordsHakka, currentLine, currentLineHakkaWord);
			} // end if the word is in the dictionary	
						
			return hakkaHtmlWords;
			
		} // end function getHakkaHtml
		
		function getHakkaHtmlCharacters(theseWordsChinese, theseWordsHakka, currentLine, currentLineHakkaWord)
		{
			//debugLog("getHakkaHtmlCharacters(" + theseWordsChinese + ", " + theseWordsHakka + ")");

			var hakkaHtmlWords = "";

			var thisChineseArray = stringToCharacterArray(theseWordsChinese);
			var thisHakkaArray = theseWordsHakka.split(" ");
			var numberWords = thisChineseArray.length;
			var numberHakkaWords = thisHakkaArray.length;
							
			for (var currentCharacter = 0; currentCharacter < numberWords; currentCharacter++)
			{
				var thisCharacterChinese = thisChineseArray[currentCharacter];
				var thisCharacterHakka = thisHakkaArray[currentCharacter];
				
				//debugLog(thisCharacterChinese);
				
				if (currentCharacter >= numberHakkaWords)
				{
					thisCharacterHakka = "";
				}
				
				var thisHakkaTone = 1;
				
				var thisHakkaHtmlWord = "";

				var pfsId = "pfsLine" + currentLine + "Word" + currentLineHakkaWord + "Character" + currentCharacter;

				if (dictionaryContainsHakka(thisCharacterChinese) == true)
				{
					thisHakkaTone = textBetween(hakkaData, "\n" + thisCharacterChinese + "	","\n");
					thisCharacterHakka = textBetween(thisHakkaTone, "start", "	");
					thisHakkaTone = textBetween(thisHakkaTone, "	","end");
					
					thisHakkaHtmlWord = getHakkaTonesHtml(thisCharacterHakka, thisHakkaTone);

					thisHakkaHtmlWord = "<div id=\"" + pfsId + "\" class=\"hakka_" + thisHakkaTone + "\">" + thisHakkaHtmlWord + "</div>";
					
				} else {
					thisHakkaHtmlWord = "<div id=\"" + pfsId + "\" class=\"hakka_" + thisHakkaTone + "\">" + thisCharacterHakka + "</div>";
				}
				
				//debugLog(thisHakkaHtmlWord);
				
				hakkaHtmlWords = hakkaHtmlWords + thisHakkaHtmlWord + " ";
				
			} // end for every character in the word
			
			return hakkaHtmlWords;
			
		} // end function getHakkaHtmlCharacters


		function getCantonese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getCantonese(" + thisWordChinese + "," + thisPinyinWord + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var thisCantonese = "";
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var mouseoverText = "";
			
			var thisCantoneseTonesArray = [];
			
			if (numberResults > 0)
			{

				if (numberResults > 1)
				{
					var mouseoverArray = [];
					
					for (var currentResult = 2; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						mouseoverArray.push(thisResult);
					} // end for every other result
					
					mouseoverText = mouseoverArray.join(",");
					
				} // end if there is more than one result
				
				// Use index 1 because index 0 is just the first line of the dictionary
				thisCantonese = dictionaryResultsArray[1];
				
				thisCantoneseTones = textBetween(thisCantonese, "	","end");
				thisCantonese = textBetween(thisCantonese, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisCantoneseWordsArray = thisCantonese.split(" ");
				thisCantoneseTonesArray = stringToCharacterArray(thisCantoneseTones);
				
				thisCantonese = "";
				
				var numberCantoneseWords = thisCantoneseWordsArray.length;
			
			//if (contains(cantoneseData, "\n" + thisWordChinese + "	"))
			//{
			//	thisCantonese = textBetween(cantoneseData, "\n" + thisWordChinese + "	","\n");
			//	thisCantoneseTones = textBetween(thisCantonese, "	","end");
			//	thisCantonese = textBetween(thisCantonese, "start", "	");
				
			//	var numberCharacters = thisWordChinese.length;
				
			//	var thisCantoneseWordsArray = thisCantonese.split(" ");
			//	var thisCantoneseTonesArray = thisCantoneseTones.split("");
				
			//	thisCantonese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCantoneseWord = thisCantoneseWordsArray[currentCharacter];
					var thisCharacterCantonese = thisCantonese[currentCharacter];
					var thisCharacterCantoneseTone = thisCantoneseTonesArray[currentCharacter];
					
					if (currentCharacter >= numberCantoneseWords)
					{
						thisCantoneseWord = "";
					}
					
					if (addToneNumbers == true)
					{
						var thisTone = toneSuperscripts[thisCharacterCantoneseTone];
					   
						if (thisTone != undefined)
						{
							thisCantonese = thisCantonese + thisCantoneseWord + thisTone + " ";
						} else {
							thisCantonese = thisCantonese + thisCantoneseWord + " ";
						}
					} else {
						thisCantonese = thisCantonese + thisCantoneseWord + " ";
					}
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisCantonese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						var thisCharacterCantoneseResults = getCantonese(thisCharacterChinese, thisCharacterPinyin);
						var thisCharacterCantonese = thisCharacterCantoneseResults[0];
						var thisCharacterCantoneseOptions = thisCharacterCantoneseResults[1];
						var thisCharacterTone = thisCharacterCantoneseResults[2];
						
						thisCantoneseTonesArray.push(thisCharacterTone);
						
						thisCantonese = thisCantonese + thisCharacterCantonese;
						
						mouseoverText = mouseoverText + thisCharacterCantoneseOptions + ",";
						
						//thisCantonese = thisCantonese + getCantonese(thisCharacterChinese, thisCharacterPinyin);
						//thisCantonese = thisCantonese + getCantonese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the cantonese is in the dictionary
			
			var thisCantoneseArray = [thisCantonese, mouseoverText, thisCantoneseTonesArray];
			
			return thisCantoneseArray;
			
			//return thisCantonese;
		} // end function getCantonese

		function getCantoneseTonesHtml(thisWord, thisTone)
		{
			//debugLog("getCantoneseTonesHtml(" + thisWord + "," + thisTone + ")");
			
			if (thisTone == undefined)
			{
				return thisWord;
			}

			var thisWordArray = stringToCharacterArray(thisWord);
			
			var numberCharacters = thisWordArray.length;
			
			// Longest is 6
			var thisWordSized;
			
			if (numberCharacters == 1)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:17px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:17px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
			
				return thisWord;
			}
			
			if (numberCharacters == 2)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}
						
			return thisWord;
		} // end function getCantoneseTonesHtml

		function getCantoneseHtml(theseWordsChinese, theseWordsCantonese, thisCantoneseTones)
		{
			//debugLog("getCantoneseHtml(" + theseWordsChinese + "," + theseWordsCantonese + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var cantoneseHtmlWords = "";
			
			if (contains(combinedDictionaryData, "\n" + theseWordsChinese + "	"))
			{
				//var thisCantoneseTones = textBetween(cantoneseData, "\n" + theseWordsChinese + "	","\n");
				//thisCantoneseTones = textBetween(thisCantoneseTones, "	", "end");
				
				//debugLog(theseWordsChinese + "," + thisCantoneseTones);
				
				var thisCantoneseArray = theseWordsCantonese.split(" ");
				var thisCantoneseTonesArray = stringToCharacterArray(thisCantoneseTones);
				var numberWords = thisCantoneseArray.length;
				
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterCantonese = thisCantoneseArray[currentWord];
					var thisCharacterCantoneseTone = thisCantoneseTonesArray[currentWord];
					
					var thisCantoneseHtmlWord = getCantoneseTonesHtml(thisCharacterCantonese, thisCharacterCantoneseTone);
					
					//debugLog(thisCharacterCantonese + "," + thisCharacterCantoneseTone);
					
					//thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCharacterCantoneseTone + "\">" + thisCharacterCantonese + "</div>";
					thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCharacterCantoneseTone + "\">" + thisCantoneseHtmlWord + "</div>";
					
					cantoneseHtmlWords = cantoneseHtmlWords + thisCantoneseHtmlWord + " ";
				} // end for every character in the Cantonese
				
				
			} else {
				var thisChineseArray = stringToCharacterArray(theseWordsChinese);
				var thisCantoneseArray = theseWordsCantonese.split(" ");
				var numberWords = thisCantoneseArray.length;
								
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterChinese = thisChineseArray[currentWord];
					var thisCharacterCantonese = thisCantoneseArray[currentWord];
					
					var thisCantoneseTone = 1;
					
					var thisCantoneseHtmlWord = "";
					
					if (contains(cantoneseData, "\n" + thisCharacterChinese + "	"))
					{
						thisCantoneseTone = textBetween(cantoneseData, "\n" + thisCharacterChinese + "	","\n");
						thisCantoneseTone = textBetween(thisCantoneseTone, "	", "end");
						
						thisCantoneseHtmlWord = getCantoneseTonesHtml(thisCharacterCantonese, thisCantoneseTone);
						
						thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCantoneseTone + "\">" + thisCantoneseHtmlWord + "</div>";
						
					} else {
						thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCantoneseTone + "\">" + thisCharacterCantonese + "</div>";
					}
					
					cantoneseHtmlWords = cantoneseHtmlWords + thisCantoneseHtmlWord + " ";
					
				} // end for every character in the word
				
			} // end if the word is in the dictionary	
						
			return cantoneseHtmlWords;
		} // end function getCantoneseHtml
		
		function getHangul(thisWordChinese)
		{
			var thisHangul = "";
			
			if (contains(hangulData, "\n" + thisWordChinese + "	"))
			{
			
				thisHangul = textBetween(hangulData, "\n" + thisWordChinese + "	","\n");
				thisHangul = textBetween(thisHangul, "start", " ");
				
			} else {
					
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use Hanja
					thisHangul = thisWordChinese;
				} else {
										
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						
						thisHangul = thisHangul + getHangul(thisCharacterChinese);
					}
				} // end if the word is more than one character
				
			} // end if the hangul is in the dictionary
			
			return thisHangul;
			
		} // end function getHangul

		function getHangulHtml(thisWordHangul)
		{
			var thisHangulArray = stringToCharacterArray(thisWordHangul);
			var numberWords = thisHangulArray.length;
			
			var hangulHtmlWords = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacter = thisHangulArray[currentWord];
					
				var thisHangulHtmlWord = "<div class=\"hangul\">" + thisCharacter + "</div>";
				
				hangulHtmlWords = hangulHtmlWords + thisHangulHtmlWord + " ";
				
			} // end for every character in the word
			
			return hangulHtmlWords;
			
		} // end function getHangulHtml

		function getTang(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getTang(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisTang = "";
			
			if (contains(tangData, "\n" + thisWordChinese + "	"))
			{
				thisTang = textBetween(tangData, "\n" + thisWordChinese + "	","\n");
				thisTang = textBetween(thisTang, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisTangWordsArray = thisTang.split(" ");
				
				thisTang = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisTangWord = thisTangWordsArray[currentCharacter];
					var thisCharacterTang = thisTang[currentCharacter];
					
					thisTang = thisTang + thisTangWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisTang = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisTang = thisTang + getTang(thisCharacterChinese, thisCharacterPinyin);
						thisTang = thisTang + getTang(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the tang is in the dictionary
			
			return thisTang;
		} // end function getTang

		function getTangHtml(thisWordTang)
		{
			//debugLog("getTangHtml(" + theseWordsChinese + "," + theseWordsTang + ")");
						
			var tangHtmlWords = "";
			
			var thisTangArray = thisWordTang.split(" ");
			var numberWords = thisTangArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterTang = thisTangArray[currentWord];
								
				var thisTangHtmlWord = "<div class=\"tang\">" + thisCharacterTang + "</div>";
				
				tangHtmlWords = tangHtmlWords + thisTangHtmlWord + " ";
				
			} // end for every character in the word
			
			return tangHtmlWords;
			
		} // end function getTangHtml
		
		function getJapanese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getJapanese(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisJapanese = "";
			
			if (contains(japaneseData, "\n" + thisWordChinese + "	"))
			{
				thisJapanese = textBetween(japaneseData, "\n" + thisWordChinese + "	","\n");
				thisJapanese = textBetween(thisJapanese, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisJapaneseWordsArray = thisJapanese.split(" ");
				
				thisJapanese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisJapaneseWord = thisJapaneseWordsArray[currentCharacter];
					var thisCharacterJapanese = thisJapanese[currentCharacter];
					
					thisJapanese = thisJapanese + thisJapaneseWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisJapanese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisJapanese = thisJapanese + getJapanese(thisCharacterChinese, thisCharacterPinyin);
						thisJapanese = thisJapanese + getJapanese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the japanese is in the dictionary
			
			return thisJapanese;
		} // end function getJapanese

		function getJapaneseHtml(thisWordJapanese)
		{
			//debugLog("getJapaneseHtml(" + theseWordsChinese + "," + theseWordsJapanese + ")");
						
			var japaneseHtmlWords = "";
			
			var thisJapaneseArray = thisWordJapanese.split(" ");
			var numberWords = thisJapaneseArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterJapanese = thisJapaneseArray[currentWord];
								
				var thisJapaneseHtmlWord = "<div class=\"japanese\">" + thisCharacterJapanese + "</div>";
				
				japaneseHtmlWords = japaneseHtmlWords + thisJapaneseHtmlWord + " ";
				
			} // end for every character in the word
			
			return japaneseHtmlWords;
			
		} // end function getJapaneseHtml
		
		function getVietnamese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getVietnamese(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisVietnamese = "";
			
			if (contains(vietnameseData, "\n" + thisWordChinese + "	"))
			{
				thisVietnamese = textBetween(vietnameseData, "\n" + thisWordChinese + "	","\n");
				thisVietnamese = textBetween(thisVietnamese, "start", "	");
				
				var numberCharacters = stringLength(thisWordChinese);
				
				var thisVietnameseWordsArray = thisVietnamese.split(" ");
				
				thisVietnamese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisVietnameseWord = thisVietnameseWordsArray[currentCharacter];
					var thisCharacterVietnamese = thisVietnamese[currentCharacter];
					
					thisVietnamese = thisVietnamese + thisVietnameseWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = stringLength(thisWordChinese);
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisVietnamese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisVietnamese = thisVietnamese + getVietnamese(thisCharacterChinese, thisCharacterPinyin);
						thisVietnamese = thisVietnamese + getVietnamese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the vietnamese is in the dictionary
			
			return thisVietnamese;
		} // end function getVietnamese

		function getVietnameseHtml(thisWordVietnamese)
		{
			//debugLog("getVietnameseHtml(" + theseWordsChinese + "," + theseWordsVietnamese + ")");
						
			var vietnameseHtmlWords = "";
			
			var thisVietnameseArray = thisWordVietnamese.split(" ");
			var numberWords = thisVietnameseArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterVietnamese = thisVietnameseArray[currentWord];
								
				var thisVietnameseHtmlWord = "<div class=\"vietnamese\">" + thisCharacterVietnamese + "</div>";
				
				vietnameseHtmlWords = vietnameseHtmlWords + thisVietnameseHtmlWord + " ";
				
			} // end for every character in the word
			
			return vietnameseHtmlWords;
			
		} // end function getVietnameseHtml
		
		function hexToCharacter(thisHex)
		{
			//debugLog("hexToCharacter(" + thisHex + ")");
						
			var thisDecimal = parseInt(thisHex, 16);
			
			var thisCharacter = String.fromCharCode(thisDecimal);
			
			return thisCharacter;
			
		} // end function hexToCharacter

		function getHex(thisCharacterChinese)
		{
			//debugLog("getHex(" + thisCharacterChinese + ")");
			
			if (thisCharacterChinese == "")
			{
				return "";
			}
			
			var thisHex = thisCharacterChinese.charCodeAt(0).toString(16);
			
			if (thisHex == undefined)
			{
				return "";
			}
			
			return thisHex;
			
		} // end function getHex
		
		function unitypeToCharacter(thisUnitype)
		{
			// debugLog("unitypeToCharacter(" + thisUnitype + ")");
			
			var hexCharacters = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
			var unitypeCodes =  ["e", "r", "t", "y", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];

			var thisUnitypeArray = stringToCharacterArray(thisUnitype);
			
			if (thisUnitypeArray == null)
			{
				return;
			}
			
			var numberUnitype = thisUnitypeArray.length;
			
			var thisHex = "";
			
			for (var currentUnitype = 0; currentUnitype < numberUnitype; currentUnitype++)
			{
				var thisUnitypeCharacter = thisUnitype[currentUnitype];
				
				var thisIndex = unitypeCodes.indexOf(thisUnitypeCharacter);
				
				if (thisIndex == null)
				{
					return;
				}
				
				var thisHexCharacter = hexCharacters[thisIndex];
				
				thisHex = thisHex + thisHexCharacter;
				
			} // end for every character
			
			return hexToCharacter(thisHex);
			
		} // end function unitypeToCharacter
		
		function getUnitype(thisCharacterChinese)
		{
			//debugLog("getUnitype(" + thisCharacterChinese + ")");
			
			var thisHex = getHex(thisCharacterChinese);
			
			var hexCharacters = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
	
			// From Chinese Hex Coding.scpt, 2015-09-02
			var unitypeCodes =  ["e", "r", "t", "y", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];
			//var unitypeCodes =  ["q", "w", "e", "r", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];
			
			var thisUnitype = "";
			
			var numberHexDigits = thisHex.length;
			
			for (var currentHexDigit = 0; currentHexDigit < numberHexDigits; currentHexDigit++)
			{
				var thisHexDigit = thisHex[currentHexDigit];
			
				var hexIndex = hexCharacters.indexOf(thisHexDigit);
			
				if (hexIndex != -1)
				{
					thisUnitype = thisUnitype + unitypeCodes[hexIndex];
				} else {
					thisUnitype = thisUnitype + thisHexDigit;
				}
			}
			
			return thisUnitype;
			
		} // end function getUnitype
		
		function getPinyinSized(thisPinyin, thisTone)
		{
			//debugLog("getPinyinSized(" + thisPinyin + "," + thisTone + ")");
			
			if (thisTone == 1)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}

			if (thisTone == 5)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}
			
			var thisPinyinArray = stringToCharacterArray(thisPinyin);
			
			var numberCharacters = thisPinyinArray.length;
			
			// Longest is 6
			
			if (numberCharacters == 1)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}
			
			var thisPinyinSized;
			
			if (numberCharacters == 2)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[1] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}
			}

			
			return thisPinyin;
			
		} // end function getPinyinSized
		
		function getSyllable(thisCharacter, thisToneless)
		{
			//debugLog("getSyllable(" + thisCharacter + "," + thisToneless + ")");

			var syllables = ["木", "厂", "大", "令", "女", "卯", "非", "帀", "𢀳", "𠫔", "甘", "分", "𦚏", "己", "亼", "𡗜", "禸", "古", "舛", "尞", "畾", "方", "⺙", "俞", "𠱠", "粦", "留", "七", "韋", "付", "冡", "民", "氏", "殳", "交", "主", "皇", "曼", "旲", "业", "柬", "包", "加", "刁", "五", "釆", "弗", "尼", "凶", "者", "户", "巴", "央", "唐", "同", "來", "扁", "龹", "票", "求", "此", "录", "巨", "夗", "夆", "半", "畢", "東", "必", "它", "孚", "夫", "賏", "英", "糹", "沓", "尃", "宛", "孛", "侯", "于", "䜌", "廷", "刃", "兼", "亘", "胡", "朱", "是", "早", "少", "夬", "卜", "冋", "余", "介", "文", "卉", "不"];
			
			var syllablesPinyin = ["li", "li", "yi", "ling", "lou", "liu", "fei", "ling", "lang", "zhi", "qi", "fen", "long", "long", "yu", "liao", "li", "gu hu", "lin", "liao", "lei", "fang", "ao", "yu", "ling", "lin", "liu", "lu hu", "wei", "fu", "meng", "min", "di", "yi", "jiao", "zhu", "huang", "man", "mo", "pu", "lan", "bao pao", "jia", "deng", "wu", "fan", "fu fei", "ni", "li", "zhu", "bian", "ba", "ying yang", "tang", "tong", "lai", "bian pian", "juan quan", "piao biao", "qiu", "zi ci", "lu", "ju qu", "wan yuan", "feng", "juan quan", "bi", "dong", "bi mi", "tuo", "fu", "fu", "ying", "ying", "luan luo", "ta", "bo", "wan", "bo", "hou", "yu", "luan", "ting", "ren", "lian", "xuan", "hu", "zhu", "ti", "zhang", "sha", "jue", "pi", "qiao jiao", "tu", "jie", "wen", "fen", "pi pei"];
			
			var characterAncestors = textBetween(genealogiesData,"\n" + thisCharacter + " ","\n");
			
			var characterAncestorsArray = characterAncestors.split(",");
			
			var numberAncestors = characterAncestorsArray.length;
			
			for (var currentAncestor = 0; currentAncestor < numberAncestors; currentAncestor++)
			{
				var thisAncestor = characterAncestorsArray[currentAncestor];
				
				var syllableIndex = syllables.indexOf(thisAncestor);
				
				if (syllableIndex != -1)
				{
					var syllablePinyin = syllablesPinyin[syllableIndex];
					
					if (contains(syllablePinyin,thisToneless) == true)
					{
						var thisSyllable = "<a href=\"Charts/" + thisAncestor + ".html\" target=_blank>" + thisAncestor + "</a>";
						return thisSyllable;
					} else {
					
						var thisSyllable = "<a href=\"Charts/" + thisAncestor + ".html\" target=_blank><font style=\"color:red\">" + thisAncestor + "</font></a>";
						return thisSyllable;
						//return "";
					}
					
				}
			} // end for every ancestor
			
			return "";
		} // end function getSyllable
		
		function pad(thisText, startLength, thisLength) 
		{
			//debugLog("pad(" + thisText + "," + startLength + "," + thisLength + ")");

			for (var currentLength = startLength; currentLength < thisLength; currentLength++)
			{
				thisText = thisText + " ";
			}
			
			//debugLog(thisText);
			
			return thisText;
		} // end function pad
		
		function searchDictionary(thisWord)
		{
			//debugLog("searchDictionary(" + thisWord + ")");

			var wordLength = stringLength(thisWord);
			
			switch (wordLength)
			{
				case 5: return contains(fiveWords, "\n" + thisWord + "\n"); break;
				case 4: return contains(fourWords, "\n" + thisWord + "\n"); break;
				case 3: return contains(threeWords, "\n" + thisWord + "\n"); break;
				case 2: return contains(twoWords, "\n" + thisWord + "\n"); break;
				case 1: return contains(oneWords, "\n" + thisWord + "\n"); break;
				default: return false; break;
			}
			
		} // end function searchDictionary
		
		
		function litManLineToHtml(litManLine, currentLitManLine)
		{
			// debugLog(litManLineToHtml)
			
			var litManHtmlLine = "";
			
			var litManLineWords = litManLine.split(" ");
			var numberLitManLineWords = litManLineWords.length;
			
			for (var currentLitManLineWord = 0; currentLitManLineWord < numberLitManLineWords; currentLitManLineWord++)
			{
				var thisLitManLineWord = litManLineWords[currentLitManLineWord];
				
				litManHtmlLine = litManHtmlLine + "<td>";
				
				var litManLineWordCharacters = thisLitManLineWord.split("-");
				var numberthisLitManLineWordCharacters = litManLineWordCharacters.length;
				
				for (var currentLitManLineWordCharacter = 0; currentLitManLineWordCharacter < numberthisLitManLineWordCharacters; currentLitManLineWordCharacter++)
				{
					var thisLitManLineWordCharacter = litManLineWordCharacters[currentLitManLineWordCharacter];
					 
					var thisLitManLineWordId = "litManLine" + currentLitManLine + "Word" + currentLitManLineWord + "Character" + currentLitManLineWordCharacter;
				
					litManHtmlLine = litManHtmlLine + "<span onclick=\"moveCursorToElement('" + thisLitManLineWordId + "')\" class=\"litManWord\" id=\"" + thisLitManLineWordId + "\">" + thisLitManLineWordCharacter;
					
					if (numberthisLitManLineWordCharacters > (currentLitManLineWordCharacter + 1))
					{
						litManHtmlLine = litManHtmlLine + "-";
					}
					
					litManHtmlLine = litManHtmlLine + "</div>";
				}

				litManHtmlLine = litManHtmlLine + "</td>";
				
			} // end for every litMan word
			
			return litManHtmlLine;
		
		} // end function litManLineToHtml
		
		function removeTones(thisPinyin)
		{
			var toneCharacters = "aáàǎāeéèěēiíìǐīoóòǒōuúùǔūüǘǜǚǖ";
			var noToneCharacters = "aaaaaeeeeeiiiiiooooouuuuuüüüüü";
			
			var numberToneCharacters = toneCharacters.length;
			
			for (var currentToneCharacter = 0; currentToneCharacter < numberToneCharacters; currentToneCharacter++)
			{
				var thisToneCharacter = toneCharacters[currentToneCharacter];
				var noToneCharacter = noToneCharacters[currentToneCharacter];
				
				thisPinyin = replaceChars(thisPinyin, thisToneCharacter, noToneCharacter);
			}
			
			return thisPinyin;
		} // end function removeTones

//		function getTones(thisPinyin)
//		{
//			if (thisPinyin == undefined)
//			{
//				return 1;
//			}
//		
//			var toneCharacters = "aáàǎāeéèěēiíìǐīoóòǒōuúùǔūüǘǜǚǖ";
//			var toneNumbers = "124351243512435124351243512435";
//			
//			var numberToneCharacters = toneCharacters.length;
//			
//			for (var currentToneCharacter = 0; currentToneCharacter < numberToneCharacters; currentToneCharacter++)
//			{
//				var thisToneCharacter = toneCharacters[currentToneCharacter];
//				var thisToneNumber = toneNumbers[currentToneCharacter];
//				
//				thisPinyin = replaceChars(thisPinyin, thisToneCharacter, thisToneNumber);
//			}
//			
//			console.log(thisPinyin);
//
//			var alphabetCharacters = "abcdefghijklmnopqrstuvwxyzüABCDEFGHIJKLMNOPQRSTUVWXYZÜ "
//			
//			var numberAlphabetCharacters = alphabetCharacters.length;
//			
//			for (var currentAlphabetCharacter = 0; currentAlphabetCharacter < numberAlphabetCharacters; currentAlphabetCharacter++)
//			{
//				var thisAlphabetCharacter = alphabetCharacters[currentAlphabetCharacter];
//				
//				thisPinyin = replaceChars(thisPinyin, thisAlphabetCharacter, "");
//			}
//			
//			console.log(thisPinyin);
//			
//			return thisPinyin;
//		} // end function getTones
		
		// translateText - translate Chinese to English
		function translateText(inputText, englishText)
		{		
			//debugLog("translateText(" + inputText + "," + englishText + ")");
			
			var outputText = "";			
			var outputHtml = "";			
			
			var inputArray = inputText.split("\n");
			var englishArray = englishText.split("\n");
			
			var numberLines = inputArray.length;
			var numberEnglishLines = englishArray.length;
			
			var addChinesePlain = document.getElementById('chinesePlainCheckbox').checked;
			var addChineseSpaced = document.getElementById('chineseSpacedCheckbox').checked;
			var addChinese = document.getElementById('chineseCheckbox').checked;
			//var addPinyin = document.getElementById('pinyinCheckbox').checked;
			var addPinyin = false;
			var pinyinToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var pinyinSize = document.getElementById('sizeCheckbox').checked;
			var addLiteral = document.getElementById('literalCheckbox').checked;
			var addLitMan = document.getElementById('litManCheckbox').checked;
			var addEnglish = document.getElementById('englishCheckbox').checked;
			var addHex = document.getElementById('hexCheckbox').checked;
			var addUnitype = document.getElementById('unitypeCheckbox').checked;
			var addSyllables = document.getElementById('syllablesCheckbox').checked;
			var addLargeSealScript = document.getElementById('largeSealScriptCheckbox').checked;
			var addSmallSealScript = document.getElementById('smallSealScriptCheckbox').checked;
			var addOracleBones = document.getElementById('oracleBonesCheckbox').checked;
			var addBopomofo = document.getElementById('bopomofoCheckbox').checked;
			var addWadeGiles = document.getElementById('wadeGilesCheckbox').checked;
			var addSimplified = document.getElementById('simplifiedSpacedCheckbox').checked;
			var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;
			//var addCantonese = document.getElementById('cantoneseCheckbox').checked;
			var addCantonese = true;
			var addHakka = document.getElementById('hakkaCheckbox').checked;
			var monospaceText = document.getElementById('monospaceTextCheckbox').checked;
			var addHangul = document.getElementById('hangulCheckbox').checked;
			var addVietnamese = document.getElementById('vietnameseCheckbox').checked;
			var addJapanese = document.getElementById('japaneseCheckbox').checked;
			var addTang = document.getElementById('tangCheckbox').checked;
			var addPageBreaks = document.getElementById('pageBreaksCheckbox').checked;
			var hashOut = document.getElementById('hashOutCheckbox').checked;
			
			var addCommon = false;
			
			if (commonWords != "")
			{
				addCommon = true;
			}
			
			var missingWords = "";
			
			if (englishText == "")
			{
				addEnglish = false;
			}
			
			if (addSimplified == true)
			{
				var simplifiedText = document.getElementById('simplifiedSpacedTextArea').value;
			
				var simplifiedArray = simplifiedText.split("\n");
			} // end if addSimplified
			
			if (addLitMan == true)
			{
				var litManText = document.getElementById('simplifiedInputTextArea').value;
			
				var litManArray = litManText.split("\n");
			} // end if addLitMan

			
			if (addPageBreaks == true)
			{
				var pageBreaksLine = pageBreaksTextArea.value;
			} // end if addPageBreaks
			
			var currentLitManLine = 0;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = inputArray[currentLine];
				var englishLine = englishArray[currentLine];

				if (currentLine >= numberEnglishLines)
				{
					if (thisLine == "")
					{
						englishLine = "";
					} else {
						// Could show "undefined" to warn the user, but that might be more confusing. 
						englishLine = "";
					}
				}
				
				if (addSimplified == true)
				{
					var simplifiedLine = simplifiedArray[currentLine];
				} // end if addSimplified
				
				if (addLitMan == true)
				{
					var litManLine = litManArray[currentLitManLine];
				} // end if litMan
				
				var chinesePlainLine = "";
				
				if (addChinesePlain == true)
				{
					chinesePlainLine = thisLine;
					chinesePlainLine = replaceChars(thisLine, " ", "");
				} // end if addChinesePlain

				var chineseSpacedLine = "";
				
				if (addChineseSpaced == true)
				{
					chineseSpacedLine = thisLine;
				} // end if addChineseSpaced
				
				var chineseHtml = "";
				var pinyinHtml = "";			
				var syllablesHtml = "";
				var translatedHtml = "";

				var chineseText = "";
				var pinyinText = "";			
				var translatedText = "";
				
				var simplifiedHtml = "";
				var simplifiedText = "";
				
				var wadeGilesHtml = "";
				var wadeGilesText = "";
				
				var hexHtml = "";
				var hexText = "";
				
				var unitypeHtml = "";
				var unitypeText = "";
				
				var smallSealScriptHtml = "";
				var largeSealScriptHtml = "";
				var oracleBonesHtml = "";
				
				var taiwaneseHtml = "";
				var taiwaneseText = "";
				
				var cantoneseHtml = "";
				var cantoneseText = "";
				
				var hakkaHtml = "";
				var hakkaText = "";

				var hangulHtml = "";
				var hangulText = "";

				var tangHtml = "";
				var tangText = "";

				var japaneseHtml = "";
				var japaneseText = "";

				var vietnameseHtml = "";
				var vietnameseText = "";
				

				//var thisLineWords = spacedLine.split(" ");
				
				var thisLineWords = thisLine.split(" ");
				
				if (addSimplified == true)
				{
					var thisSimplifiedWords = [];
					if (simplifiedLine != undefined)
					{
						thisSimplifiedWords = simplifiedLine.split(" ");
					}
				} // end if addSimplified
				
				var currentLineChineseWord = 0;
				var currentLineTaiwaneseWord = 0;
				var currentLineHakkaWord = 0;
				
				var numberLineWords = thisLineWords.length;
				for (var currentLineWord = 0; currentLineWord < numberLineWords; currentLineWord++)
				{
			
					var thisWord = thisLineWords[currentLineWord];
					
					var chineseHtmlWord = "";
					var pinyinHtmlWord = "";
					var syllablesHtmlWord = "";
					
					var chineseTextWord = "";
					var pinyinTextWord = "";
					var translatedTextWord = "";
					var chineseLength = 0;
					
					if (addBopomofo == true)
					{
						chineseHtmlWord = "<table><tr>";
					}
					
					if (addSimplified == true)
					{
						var simplifiedHtmlWord = "";
						var thisSimplifiedWord = thisSimplifiedWords[currentLineWord];
					} // end if addSimplified

					if (addSmallSealScript == true)
					{
						var smallSealScriptHtmlWord = "";
					} // end if addSmallSealScript

					if (addLargeSealScript == true)
					{
						var largeSealScriptHtmlWord = "";
					} // end if addLargeSealScript

					if (addOracleBones == true)
					{
						var oracleBonesHtmlWord = "";
					} // end if addOracleBones

					if (addWadeGiles == true)
					{
						var wadeGilesHtmlWord = "";
					} // end if addWadeGiles

					if (addTaiwanese == true)
					{
						var taiwaneseHtmlWord = "";
						
					} // end if addTaiwanese
					
					if (addCantonese == true)
					{
						var cantoneseHtmlWord = "";
					} // end if addCantonese

					if (addHakka == true)
					{
						var hakkaHtmlWord = "";
						
					} // end if addHakka
					
					if (addHangul == true)
					{
						var hangulHtmlWord = "";
					} // end if addHangul

					if (addTang == true)
					{
						var tangHtmlWord = "";
					} // end if addTang

					if (addJapanese == true)
					{
						var japaneseHtmlWord = "";
					} // end if addJapanese

					if (addVietnamese == true)
					{
						var vietnameseHtmlWord = "";
					} // end if addVietnamese

					
					if (addHex == true)
					{
						var hexHtmlWord = "";
					} // end if addHex

					if (addUnitype == true)
					{
						var unitypeHtmlWord = "";
					} // end if addUnitype
					
					if (searchDictionary(thisWord) == true)
					{
						var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWord + "	", "\n");
						
						var thisDictionaryLineArray = thisDictionaryLine.split("	");
						
						var lineLength = thisDictionaryLineArray.length;
						
						var thisDefinition = "";
						var thisPinyin = "";
						var thisToneless = "";
						var thisTone = "";
						
						thisDefinition = thisDictionaryLineArray[0];

						if (lineLength >= 1)
						{
							thisPinyin = thisDictionaryLineArray[1];
						}
												
						thisToneless = removeTones(thisPinyin);
												
						thisTone = getTones(thisPinyin);
						
						//console.log(thisPinyin);
						//console.log(thisToneless);
						//console.log(thisTone);
						
						//var thisPinyin = textBetween(thisCharacterLine, "start", "	");
						//var thisDefinitionTone = textBetween(thisCharacterLine, "	", "end");
						//var thisDefinition = textBetween(thisDefinitionTone, "start", "	");
						//var thisTone = textBetween(thisDefinitionTone, "	", "end");
						
						thisPinyin = thisToneless;
						
						var thisWordLength = stringLength(thisWord);
						
						var thisPinyinArray = [];
						
						if (contains(thisPinyin," ") == true)
						{
							thisPinyinArray = thisPinyin.split(" ");
						} else {
							thisPinyinArray = [thisPinyin];
						}
												
						var thisPinyinLength = thisPinyinArray.length;
						var thisToneLength = thisTone.length;
						
						if ((addSyllables == true) || (addWadeGiles == true))
						{
							var thisTonelessArray = thisToneless.split(" ");
							var thisTonelessLength = thisTonelessArray.length;
						} // only use toneless when showing syllables
						
						var pinyinWord = "";
						
						
						// Get Taiwanese and/or Cantonese first, because those tone colours replace the Chinese tone colours
						
						if (addTaiwanese == true)
						{
							var thisTaiwaneseWordResults = getTaiwanese(thisWord, pinyinWord);

							var thisTaiwaneseWord = thisTaiwaneseWordResults[0];
							var thisTaiwaneseWordOptions = thisTaiwaneseWordResults[1];
							var thisTaiwaneseTonesArray = thisTaiwaneseWordResults[2];
							
							thisTone = thisTaiwaneseTonesArray.join("");
							
							//debugLog(thisTone);
							
							var thisTaiwaneseWordArray = [];
							
							if (thisTaiwaneseWord != "")
							{
								thisTaiwaneseWordArray = thisTaiwaneseWord.split(" ");
							}
							
							taiwaneseHtmlWord = getTaiwaneseHtml(thisWord, thisTaiwaneseWord, currentLine, currentLineTaiwaneseWord);
							currentLineTaiwaneseWord = currentLineTaiwaneseWord + 1;
							
							taiwaneseText = taiwaneseText + thisTaiwaneseWord + " ";
						} // end if addTaiwanese
						
						if (addCantonese == true)
						{
							pinyinWord = thisToneless;
							var thisCantoneseWordResults = getCantonese(thisWord, pinyinWord);
							
							var thisCantoneseWord = thisCantoneseWordResults[0];
							var thisCantoneseWordOptions = thisCantoneseWordResults[1];
							//var thisCantoneseTonesArray = thisCantoneseWordResults[2];
							
							var thisCantoneseTonesArray = thisTone;
							
							//thisTone = thisCantoneseTonesArray.join("");
							
							var thisCantoneseWordArray = [];
														
							if (thisCantoneseWord != "")
							{
								thisCantoneseWordArray = thisCantoneseWord.split(" ");
							}
							
							thisCantoneseWord = thisToneless;
							
							cantoneseHtmlWord = getCantoneseHtml(thisWord, thisCantoneseWord, thisTone);
							
							cantoneseText = cantoneseText + thisCantoneseWord + " ";
						} // end if addCantonese

						if (addHakka == true)
						{
							var thisHakkaWordResults = getHakka(thisWord, pinyinWord);

							var thisHakkaWord = thisHakkaWordResults[0];
							var thisHakkaWordOptions = thisHakkaWordResults[1];
							var thisHakkaTonesArray = thisHakkaWordResults[2];
							
							thisTone = thisHakkaTonesArray.join("");
							
							//debugLog(thisTone);
							
							var thisHakkaWordArray = [];
							
							if (thisHakkaWord != "")
							{
								thisHakkaWordArray = thisHakkaWord.split(" ");
							}
							
							hakkaHtmlWord = getHakkaHtml(thisWord, thisHakkaWord, currentLine, currentLineHakkaWord);
							currentLineHakkaWord = currentLineHakkaWord + 1;
							
							hakkaText = hakkaText + thisHakkaWord + " ";
						} // end if addHakka
						
						var thisWordArray = stringToCharacterArray(thisWord);
						
						// For every character in the word
						for (var currentWordCharacter = 0; currentWordCharacter < thisWordLength; currentWordCharacter++)
						{
							var thisCharacterChinese = thisWordArray[currentWordCharacter];
							
							var thisCharacterPinyin = "";
							
							if (currentWordCharacter < thisPinyinLength)
							{
								thisCharacterPinyin = thisPinyinArray[currentWordCharacter];
								
								if (pinyinToneNumbers == true)
								{
									thisCharacterPinyin = toneMarksToNumbers(thisCharacterPinyin);
								} // if we should convert to to numbers
								
							} // if there is a pinyin word
							
							if ((addSyllables == true) || (addWadeGiles == true))
							{
								var thisCharacterToneless = "";
							
								if (currentWordCharacter < thisTonelessLength)
								{
									thisCharacterToneless = thisTonelessArray[currentWordCharacter];
								}
							} // end if addSyllables then get toneless
							
							
							var thisCharacterTone = 1;
							
							if (currentWordCharacter < thisToneLength)
							{
								thisCharacterTone = thisTone[currentWordCharacter];
								
								if (thisCharacterTone < 1)
								{
									thisCharacterTone = 1;
								}
							} // end set the tone
							
							var chineseCharacterId = "chineseLine" + currentLine + "Word" + currentLineChineseWord + "Character" + currentWordCharacter;
							var chineseCharacterHtml = "<div id=\"" + chineseCharacterId + "\" class=\"chinese_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
							
							if (hashOut == true)
							{
								if (contains(commonWords,thisCharacterChinese) == false)
								{
									chineseCharacterHtml = "<div class=\"chinese_" + thisCharacterTone + "\">" + "#</div>";
								}
							}
							
							if (addSimplified == true)
							{
								var thisCharacterSimplified = "";
								if ((currentWordCharacter != undefined) && (thisSimplifiedWord != undefined))
								{
									thisCharacterSimplified = thisSimplifiedWord[currentWordCharacter];
								}
								var simplifiedCharacterHtml = "<div class=\"chinese_" + thisCharacterTone + "\">" + thisCharacterSimplified + "</div>";
								
								simplifiedHtmlWord = simplifiedHtmlWord + simplifiedCharacterHtml;
							}
							
							if (addSmallSealScript == true)
							{
								var smallSealScriptCharacterHtml = "<div class=\"smallSealScript_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								smallSealScriptHtmlWord = smallSealScriptHtmlWord + smallSealScriptCharacterHtml;
							} // end if addSmallSealScript

							if (addLargeSealScript == true)
							{
								var largeSealScriptCharacterHtml = "<div class=\"largeSealScript_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								largeSealScriptHtmlWord = largeSealScriptHtmlWord + largeSealScriptCharacterHtml;
							} // end if addLargeSealScript


							if (addOracleBones == true)
							{
								var oracleBonesCharacterHtml = "<div class=\"oracleBones_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								oracleBonesHtmlWord = oracleBonesHtmlWord + oracleBonesCharacterHtml;
							} // end if addOracleBones

														
							if (addBopomofo == true)
							{
								var thisBopomofo = getBopomofo(thisCharacterChinese, thisCharacterTone);
								
								chineseHtmlWord = chineseHtmlWord + "<td>" + "<table><tr><td>" + chineseCharacterHtml + "</td><td>" + thisBopomofo + "</td></tr></table>" + "</td>";
								
							} else {
								
								chineseHtmlWord = chineseHtmlWord + chineseCharacterHtml;
								
							} // end if addBopomofo
							
							var pinyinId = "pinyinLine" + currentLine + "Word" + currentLineChineseWord + "Character" + currentWordCharacter;

							if (pinyinSize == true)
							{
								var pinyinSized = getPinyinSized(thisCharacterPinyin, thisCharacterTone);
								pinyinHtmlWord = pinyinHtmlWord + "<div id=\"" + pinyinId + "\" class=\"cantonese_" + thisCharacterTone + "\">" + pinyinSized + "</div> ";
								
							} else {
								pinyinHtmlWord = pinyinHtmlWord + "<div id=\"" + pinyinId + "\" class=\"cantonese_" + thisCharacterTone + "\">" + thisCharacterPinyin + "</div> ";
							}
														
							if (addWadeGiles == true)
							{
								var thisWadeGiles = getWadeGiles(thisCharacterToneless, thisCharacterTone);
								
								wadeGilesHtmlWord = wadeGilesHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisWadeGiles + "</div> ";
								
								wadeGilesText = wadeGilesText + thisWadeGiles + " ";
							} // end if addWadeGiles

							if (addHex == true)
							{
								var thisHex = getHex(thisCharacterChinese);
								
								hexHtmlWord = hexHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisHex + "</div> ";
								
								hexText = hexText + thisHex + " ";
							} // end if addHex

							if (addUnitype == true)
							{
								var thisUnitype = getUnitype(thisCharacterChinese);
								
								unitypeHtmlWord = unitypeHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisUnitype + "</div> ";
								
								unitypeText = unitypeText + thisUnitype + " ";
							} // end if addUnitype

							
							if (addSyllables == true)
							{
								var thisCharacterSyllable = getSyllable(thisCharacterChinese, thisCharacterToneless);
								
								syllablesHtmlWord = syllablesHtmlWord + thisCharacterSyllable;
							} // end if addSyllables
							
							chineseTextWord = chineseTextWord + thisCharacterChinese;
							pinyinWord = pinyinWord + thisCharacterPinyin + " ";
							
						} // end for every character in the word
						
						
						if (addHangul == true)
						{
							var thisHangulWord = getHangul(thisWord);
							
							var thisHangulWordArray = [];
							
							if (thisHangulWord != "")
							{
								thisHangulWordArray = thisHangulWord.split(" ");
							}
							
							hangulHtmlWord = getHangulHtml(thisHangulWord);
							
							hangulText = hangulText + thisHangulWord + " ";
							
						} // end if addHangul

						if (addTang == true)
						{
							var thisTangWord = getTang(thisWord, pinyinWord);
							
							var thisTangWordArray = [];
							
							if (thisTangWord != "")
							{
								thisTangWordArray = thisTangWord.split(" ");
							}
							
							tangHtmlWord = getTangHtml(thisTangWord);
							
							tangText = tangText + thisTangWord + " ";
							
						} // end if addTang

						if (addJapanese == true)
						{
							var thisJapaneseWord = getJapanese(thisWord, pinyinWord);
							
							var thisJapaneseWordArray = [];
							
							if (thisJapaneseWord != "")
							{
								thisJapaneseWordArray = thisJapaneseWord.split(" ");
							}
							
							japaneseHtmlWord = getJapaneseHtml(thisJapaneseWord);
							
							japaneseText = japaneseText + thisJapaneseWord + " ";
							
						} // end if addJapanese

						if (addVietnamese == true)
						{
							var thisVietnameseWord = getVietnamese(thisWord, pinyinWord);
							
							var thisVietnameseWordArray = [];
							
							if (thisVietnameseWord != "")
							{
								thisVietnameseWordArray = thisVietnameseWord.split(" ");
							}
							
							vietnameseHtmlWord = getVietnameseHtml(thisVietnameseWord);
							
							vietnameseText = vietnameseText + thisVietnameseWord + " ";
							
						} // end if addVietnamese
						
						
						
						var thisDefinitionWordsArray = thisDefinition.split(" ");
						var numberDefinitionWords = thisDefinitionWordsArray.length;
						
						for (var currentDefinitionWord = 0; currentDefinitionWord < numberDefinitionWords; currentDefinitionWord++)
						{
							var thisDefinitionWord = thisDefinitionWordsArray[currentDefinitionWord];
							
							var literalId = "literalLine" + currentLine + "Word" + currentLineChineseWord + "Character" + currentDefinitionWord;
							translatedHtml = translatedHtml + " " + "<div id=\"" + literalId + "\"class=\"literal\">" + thisDefinitionWord + "</div>";
							
						} // end for every english word in the literal translation
						
						
						chineseLength = stringLength(chineseTextWord) * 2;
						
						//pinyinText = pinyinText + pinyinWord + " ";
						//pinyinText = pinyinText + pinyinWord;
						pinyinTextWord = pinyinWord;
						
						//translatedText = translatedText + thisDefinition + " ";
						translatedTextWord = thisDefinition;

						//alert(thisTone);
						if (addBopomofo == true)
						{
							chineseHtmlWord = chineseHtmlWord + "</tr></table>";
						}
												
						chineseHtml = chineseHtml + chineseHtmlWord;
						
						if (addSmallSealScript == true)
						{
							smallSealScriptHtml = smallSealScriptHtml + smallSealScriptHtmlWord;
						} // end if addSmallSealScript

						if (addLargeSealScript == true)
						{
							largeSealScriptHtml = largeSealScriptHtml + largeSealScriptHtmlWord;
						} // end if addLargeSealScript

						if (addOracleBones == true)
						{
							oracleBonesHtml = oracleBonesHtml + oracleBonesHtmlWord;
						} // end if addOracleBones
						
						if (addCommon == true)
						{
							if (thisWord != "")
							{							
								if (contains(commonWords,thisWord) == true)
								{
									pinyinHtmlWord = "<b>" + pinyinHtmlWord + "</b>";
								}

							} // end if the word is not blank
						} // end if addCommon
						
						currentLineChineseWord = currentLineChineseWord + 1;
						
					} else {
						
						// If the word is not blank
						if (thisWord != "")
						{
					
							if (isChineseString(thisWord) == true)
							{
								appendToFile("missingWords.txt", thisWord);
								missingWords = missingWords + thisWord + "\n";
							}
							
							chineseHtml = chineseHtml + "<div class=\"englishInChinese\">" + thisWord + "</div>";
							pinyinHtmlWord = pinyinHtmlWord + "<div class=\"englishInChinese\">" + thisWord + "</div>";
							translatedHtml = translatedHtml + thisWord;

							chineseTextWord = thisWord;
							pinyinTextWord = thisWord;
							translatedTextWord = thisWord;
							
							chineseLength = stringLength(thisWord);
							
							if (addSimplified == true)
							{
								simplifiedHtmlWord = thisSimplifiedWord;
							} // end if addSimplified
							
							if (addWadeGiles == true)
							{
								wadeGilesHtmlWord = wadeGilesHtmlWord + thisWord;
							} // end if addWadeGiles
							
							if (addTaiwanese == true)
							{
								taiwaneseHtmlWord = taiwaneseHtmlWord + thisWord;

								taiwaneseText = taiwaneseText + thisWord + "	";
							} // end if addTaiwanese
							
							if (addCantonese == true)
							{
								cantoneseHtmlWord = cantoneseHtmlWord + thisWord;
							} // end if addCantonese

							if (addHakka == true)
							{
								hakkaHtmlWord = hakkaHtmlWord + thisWord;

								hakkaText = hakkaText + thisWord + "	";
							} // end if addHakka

							if (addHangul == true)
							{
								hangulHtmlWord = hangulHtmlWord + thisWord;
							} // end if addHangul

							if (addTang == true)
							{
								tangHtmlWord = tangHtmlWord + thisWord;
							} // end if addTang

							if (addJapanese == true)
							{
								japaneseHtmlWord = japaneseHtmlWord + thisWord;
							} // end if addJapanese

							if (addVietnamese == true)
							{
								vietnameseHtmlWord = vietnameseHtmlWord + thisWord;
							} // end if addVietnamese

							
							if (addHex == true)
							{
								var thisWordHex = getHex(thisWord);
								hexHtmlWord = hexHtmlWord + thisWordHex;
								hexText = hexText + thisWordHex + " ";
							} // end if addHex

							if (addUnitype == true)
							{
								var thisWordUnitype = getUnitype(thisWord);
								unitypeHtmlWord = unitypeHtmlWord + thisWordUnitype;
								unitypeText = unitypeText + thisWordUnitype + " ";
							} // end if addHex

							if (addSmallSealScript == true)
							{
								smallSealScriptHtml = smallSealScriptHtml + thisWord;
							} // end if addSmallSealScript

							if (addLargeSealScript == true)
							{
								largeSealScriptHtml = largeSealScriptHtml + thisWord;
							} // end if addLargeSealScript

							if (addOracleBones == true)
							{
								oracleBonesHtml = oracleBonesHtml + thisWord;
							} // end if addOracleBones

						} // end if the word is not blank

					} // end if the dictionary contains the word already
					
					// Add links to nanoLyrics if we're on localhost
					if (location.hostname === "localhost" || location.hostname === "127.0.0.1")
					{
						pinyinHtmlWord = "<a href=\"http://localhost/nanoLyrics/nanoLyrics.html?text=" + thisWord + "\" target=_blank>" + pinyinHtmlWord + "</a>";
					}
					
					// There is a space between each word
					chineseHtml = chineseHtml + "</td><td>";
					pinyinHtml = pinyinHtml + pinyinHtmlWord + "</td><td>";						
					translatedHtml = translatedHtml + "</td><td>";						
					
					if (addSyllables == true)
					{
						syllablesHtml = syllablesHtml + syllablesHtmlWord + "</td><td>";						
					}
					
					if (addSimplified == true)
					{
						simplifiedHtml = simplifiedHtml + simplifiedHtmlWord+ "</td><td>";
					} // end if addSimplified
					
					if (addWadeGiles == true)
					{
						wadeGilesHtml = wadeGilesHtml + wadeGilesHtmlWord+ "</td><td>";
						wadeGilesText = wadeGilesText + "  ";
					} // end if addWadeGiles

					if (addTaiwanese == true)
					{
						if (addCommon == true)
						{
							if (thisWord != "")
							{							
								if (contains(commonWords,thisWord) == true)
								{
									taiwaneseHtmlWord = "<b>" + taiwaneseHtmlWord + "</b>";
								}

							} // end if the word is not blank
						} // end if addCommon

						taiwaneseHtml = taiwaneseHtml + taiwaneseHtmlWord + "</td><td>";
						taiwaneseText = taiwaneseText + "	";
					} // end if addTaiwanese
					
					if (addCantonese == true)
					{
						cantoneseHtml = cantoneseHtml + cantoneseHtmlWord + "</td><td>";
						cantoneseText = cantoneseText + "  ";
					} // end if addCantonese

					if (addHakka == true)
					{
						if (addCommon == true)
						{
							if (thisWord != "")
							{							
								if (contains(commonWords,thisWord) == true)
								{
									hakkaHtmlWord = "<b>" + hakkaHtmlWord + "</b>";
								}

							} // end if the word is not blank
						} // end if addCommon

						hakkaHtml = hakkaHtml + hakkaHtmlWord + "</td><td>";
						hakkaText = hakkaText + "	";
					} // end if addHakka

					if (addHangul == true)
					{
						hangulHtml = hangulHtml + hangulHtmlWord+ "</td><td>";
						hangulText = hangulText + "  ";
					} // end if addHangul

					if (addTang == true)
					{
						tangHtml = tangHtml + tangHtmlWord+ "</td><td>";
						tangText = tangText + "  ";
					} // end if addTang

					if (addJapanese == true)
					{
						japaneseHtml = japaneseHtml + japaneseHtmlWord+ "</td><td>";
						japaneseText = japaneseText + "  ";
					} // end if addJapanese

					if (addVietnamese == true)
					{
						vietnameseHtml = vietnameseHtml + vietnameseHtmlWord+ "</td><td>";
						vietnameseText = vietnameseText + "  ";
					} // end if addVietnamese
					
					if (addHex == true)
					{
						hexHtml = hexHtml + hexHtmlWord+ "</td><td>";
					} // end if addHex

					if (addUnitype == true)
					{
						unitypeHtml = unitypeHtml + unitypeHtmlWord+ "</td><td>";
					} // end if addUnitype

					if (addSmallSealScript == true)
					{
						smallSealScriptHtml = smallSealScriptHtml + "</td><td>";
					} // end if addSmallSealScript

					if (addLargeSealScript == true)
					{
						largeSealScriptHtml = largeSealScriptHtml + "</td><td>";
					} // end if addLargeSealScript

					if (addOracleBones == true)
					{
						oracleBonesHtml = oracleBonesHtml + "</td><td>";
					} // end if addOracleBones
					
					//pinyinTextWord = pinyinTextWord + " ";
					//translatedTextWord = translatedTextWord + " ";
					
					if (monospaceText == true)
					{
						//var chineseLength = chineseTextWord.length * 2;
						//var chineseLength = chineseTextWord.length;
						var pinyinLength = stringLength(pinyinTextWord);
						var translatedLength = stringLength(translatedTextWord);
						
						//debugLog("thisWord" + thisWord);
						
						//var chineseUnspaced = replaceChars(chineseTextWord, " ", "");
						//var chineseUnspacedLength = chineseUnspaced.length;
						//var chineseSpacesLength = chineseLength - chineseUnspacedLength;
						// Because of Unicode weirdness, Chinese characters take up 2x monospaced size
						//chineseUnspacedLength = chineseUnspacedLength * 2;
						//chineseLength = chineseUnspacedLength + chineseSpacesLength;
						
						
						var longestLength = chineseLength;

						if (pinyinLength > longestLength)
						{
							longestLength = pinyinLength;
						}

						if (translatedLength > longestLength)
						{
							longestLength = translatedLength;
						}
						
						longestLength = longestLength + 1;
						
						chineseTextWord = pad(chineseTextWord, chineseLength, longestLength);
						pinyinTextWord = pad(pinyinTextWord, pinyinLength, longestLength);
						translatedTextWord = pad(translatedTextWord, translatedLength, longestLength);
						
						chineseText = chineseText + chineseTextWord;
						pinyinText = pinyinText + pinyinTextWord;
						translatedText = translatedText + translatedTextWord;

					} else {
						chineseText = chineseText + chineseTextWord + " ";
						pinyinText = pinyinText + pinyinTextWord + "	";
						translatedText = translatedText + translatedTextWord + "	";
					}
					
				} // end for every word
				
				
				/* Lines to text */
				
				if (addChinesePlain == true)
				{
					outputText = outputText + chinesePlainLine + "\n";
				}

				if (addChineseSpaced == true)
				{
					outputText = outputText + chineseSpacedLine + "\n";
				}

				if (addSimplified == true)
				{
					outputText = outputText + simplifiedLine + "\n";
				} // end if addSimplified

				if (addHangul == true)
				{
					outputText = outputText + hangulText + "\n";
				} // end if addHangul
				
				if (addChinese == true)
				{
					outputText = outputText + chineseText + "\n";
				}
				
				if (addPinyin == true)
				{
					outputText = outputText + pinyinText + "\n";
				}
				
				if (addLitMan == true)
				{
					if (litManLine != undefined)
					{
						outputText = outputText + litManLine + "\n";
					}
				} // end if litMan
				
				if (addTaiwanese == true)
				{
					outputText = outputText + taiwaneseText + "\n";
				} // end if addTaiwanese
				
				if (addCantonese == true)
				{
					outputText = outputText + cantoneseText + "\n";
				} // end if addCantonese
				
				if (addHakka == true)
				{
					outputText = outputText + hakkaText + "\n";
				} // end if addHakka

				if (addTang == true)
				{
					outputText = outputText + tangText + "\n";
				} // end if addTang

				if (addJapanese == true)
				{
					outputText = outputText + japaneseText + "\n";
				} // end if addJapanese

				if (addVietnamese == true)
				{
					outputText = outputText + vietnameseText + "\n";
				} // end if addVietnamese
				
				if (addWadeGiles == true)
				{
					outputText = outputText + wadeGilesText + "\n";
				} // end if addWadeGiles
				
				if (addHex == true)
				{
					outputText = outputText + hexText + "\n";
				} // end if addHex

				if (addUnitype == true)
				{
					outputText = outputText + unitypeText + "\n";
				} // end if adUnitype

				
				if (addLiteral == true)
				{
					outputText = outputText + translatedText + "\n";
				}
				
				if (addEnglish == true)
				{
					outputText = outputText + englishLine + "\n";
				}
				
				outputText = outputText + "\n";
				
				
				/* Lines to HTML */
				
				outputHtml = outputHtml + "<p>";
				
				if (addChinesePlain == true)
				{
					outputHtml = outputHtml + "<div class=\"chinesePlain\">" + chinesePlainLine + "</div>";
				}

				if (addChineseSpaced == true)
				{
					outputHtml = outputHtml + "<div class=\"chineseSpaced\">" + chineseSpacedLine + "</div>";
				}
				
				outputHtml = outputHtml + "<table>";
				
				if (addOracleBones == true)
				{
					outputHtml = outputHtml + "<tr><td>" + oracleBonesHtml + "</td></tr>";
				} // end if addOracleBones
				
				if (addLargeSealScript == true)
				{
					outputHtml = outputHtml + "<tr><td>" + largeSealScriptHtml + "</td></tr>";
				} // end if addLargeSealScript

				if (addSmallSealScript == true)
				{
					outputHtml = outputHtml + "<tr><td>" + smallSealScriptHtml + "</td></tr>";
				} // end if addSealScript

				if (addChinese == true)
				{
					outputHtml = outputHtml + "<tr class=\"chineseLine\"><td>" + chineseHtml + "</td></tr>";
				}

				if (addSimplified == true)
				{
					outputHtml = outputHtml + "<tr><td>" + simplifiedHtml + "</td></tr>";
				} // end if addSimplified

				if (addHangul ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + hangulHtml + "</td></tr>";
				}
				
				if (addSyllables == true)
				{
					outputHtml = outputHtml + "<tr><td>" + syllablesHtml + "</td></tr>";
				} // end if addSyllables
								
				if (addPinyin == true)
				{
					outputHtml = outputHtml + "<tr class=\"pinyinLine\"><td>" + pinyinHtml + "</td></tr>";
				}

				if (addWadeGiles == true)
				{
					outputHtml = outputHtml + "<tr><td>" + wadeGilesHtml + "</td></tr>";
				} // end if addWadeGiles

				if (addLitMan == true)
				{
					if (litManLine != undefined)
					{
						var litManHtml = "<tr id=\"litManLine" + currentLitManLine + "\" class=\"litManLine\">";
						
						litManHtml = litManHtml + litManLineToHtml(litManLine, currentLitManLine);
						
						litManHtml = litManHtml + "</tr>";
						
						outputHtml = outputHtml + litManHtml + "\n";
						
						currentLitManLine = currentLitManLine + 1;
					}
				} // end if litMan

				if (addTaiwanese ==  true)
				{
					outputHtml = outputHtml + "<tr class=\"taiwaneseLine\"><td>" + taiwaneseHtml + "</td></tr>";
				}
				
				if (addCantonese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + cantoneseHtml + "</td></tr>";
				}

				if (addHakka ==  true)
				{
					outputHtml = outputHtml + "<tr class=\"hakkaLine\"><td>" + hakkaHtml + "</td></tr>";
				}
				
				if (addTang ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + tangHtml + "</td></tr>";
				}

				if (addJapanese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + japaneseHtml + "</td></tr>";
				}

				if (addVietnamese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + vietnameseHtml + "</td></tr>";
				}

				if (addHex == true)
				{
					outputHtml = outputHtml + "<tr><td>" + hexHtml + "</td></tr>";
				} // end if addHex

				if (addUnitype == true)
				{
					outputHtml = outputHtml + "<tr><td>" + unitypeHtml + "</td></tr>";
				} // end if addUnitype
				
				if (addLiteral == true)
				{
					outputHtml = outputHtml + "<tr class=\"literalLine\"><td>" + translatedHtml + "</td></tr>";
				} // end if addLiteral

				outputHtml = outputHtml + "</table>\n";

				if (addEnglish == true)
				{
				
					var englishLineArray = englishLine.split(" ");
					var numberEnglishWords = englishLineArray.length;
					
					for (var currentEnglishWord = 0; currentEnglishWord < numberEnglishWords; currentEnglishWord++)
					{
						var thisEnglishWord = englishLineArray[currentEnglishWord];
						
						var thisEnglishWordArray = thisEnglishWord.split("");
						var thisEnglishWordLength = thisEnglishWord.length;

						for (var currentEnglishWordCharacter = 0; currentEnglishWordCharacter < thisEnglishWordLength; currentEnglishWordCharacter++)
						{
							var thisEnglishWordCharacter = thisEnglishWordArray[currentEnglishWordCharacter];
						
							var englishId = "englishLine" + currentLine + "Word" + currentEnglishWord + "Character" + currentEnglishWordCharacter;
							outputHtml = outputHtml + "<div id=\"" + englishId + "\"class=\"english\">" + thisEnglishWordCharacter + "</div>";
						}
						
						outputHtml = outputHtml + " ";
					} // end for every english word in the literal translation
				
					//outputHtml = outputHtml + "<div class=\"english\">" + englishLine + "</div>\n";
				} // end if addEnglish
				
				outputHtml = outputHtml + "</p>";
				
				if (addPageBreaks == true)
				{
					if ((currentLine % pageBreaksLine) == (pageBreaksLine - 1))
					{
						outputHtml = outputHtml + "<br></br>" + "<br></br>";
					}
				} // end if addPageBreaks
				
			} // end for every line
						
			showMissingWords(missingWords);
			
			return [outputHtml, outputText];
			
		} // end function translateText

		// translateInterface - Read values from the GUI, set them, and do a translation
		function translateInterface()
		{
			//debugLog("translateInterface");
		
			var inputText = document.getElementById("chineseSpacedTextArea").value;
			
			if (inputText == "")
			{
				inputText = document.getElementById("chineseTextArea").value;
			}
			
			var englishText = document.getElementById("englishTextArea").value;
						
			var translationOutput = translateText(inputText, englishText);
			
			outputHtml = translationOutput[0];
			outputText = translationOutput[1];			
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			
			outputText = replaceChars(outputText, "	", "  ");
			document.getElementById("outputTextArea").value = outputText;
			
			if (commonWords != "")
			{
				//var addCommon = true;
				
				commonStatistics();
				
			} // end if we should count common words
			
			// Load Pingfang slower
			updateFont();
			
			var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;
			if (addTaiwanese == true)
			{
				taiwaneseColours();
			} // end if addTaiwanese

			var addCantonese = document.getElementById('cantoneseCheckbox').checked;
			if (addCantonese == true)
			{
				cantoneseColours();
			} // end if addCantonese

			var addHakka = document.getElementById('hakkaCheckbox').checked;
			if (addHakka == true)
			{
				hakkaColours();
			} // end if addHakka

		} // end function translateInterface

		function translateHtml()
		{
			//debugLog("translateHtml");

			translateInterface();
			
			document.getElementById("inputTable").hidden = true;
			document.getElementById("textTable").hidden = true;
		} // end function translateHtml
				
		function deradicalize(thisText)
		{
			//debugLog("deradicalize(" + thisText + ")");

			var radicalLines = radicals.split("\n");
			var numberLines = radicalLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine = currentLine + 1)
			{
				var thisLine = radicalLines[currentLine];
				
				var thisLineArray = thisLine.split(" ");
				
				var thisRadical = thisLineArray[0];
				var thisIdeograph = thisLineArray[1];
				
				//thisText = thisText.replace(/thisRadical/g, thisIdeograph);
				//thisText = thisText.split(thisRadical).join(thisIdeograph);
				thisText = replaceChars(thisText, thisRadical, thisIdeograph)

			} // end for every radical
			
			return thisText;
			
		} // end function deradicalize
		
		function dehomonym(thisText)
		{
			thisText = replaceChars(thisText, "祢", "你");
			thisText = replaceChars(thisText, "妳", "你");
			thisText = replaceChars(thisText, "禰", "你");
			thisText = replaceChars(thisText, "她", "他");
			thisText = replaceChars(thisText, "祂", "他");

			return thisText;
		} // end function dehomonym
		
		function deradicalizeButtonClicked()
		{
			//debugLog("deradicalizeButtonClicked");

			var thisText = document.getElementById("chineseTextArea").value;
			
			var deradicalisedChinese = deradicalize(thisText);
			
			document.getElementById("chineseTextArea").value = deradicalisedChinese;
			document.getElementById("outputTextArea").value = deradicalisedChinese;
			
		} // end function deradicalizeButtonClicked
		
		function translateBilingual(inputText)
		{
			//debugLog("translateBilingual");
			
			var inputLines = inputText.split("\n");
			
			var numberLines = inputLines.length;
			
			var outputHtml = "";
			var outputText = "";
			
			var lastEnglishLine = "";
			
			var lastWasEnglish = false;
			
			var currentChineseLine = 0;

			for (var currentLine = 0; currentLine < numberLines; currentLine = currentLine + 1)
			{
				var thisLine = inputLines[currentLine];
				
				if (thisLine == "")
				{
					if (lastWasEnglish == false)
					{
						outputHtml = outputHtml + "</p>";
					}
					
					outputHtml = outputHtml + "\n<br></br>";
					outputText = outputText + "\n";
					
				} else {
					if (containsChineseString(thisLine) == true)
					{
						lastWasEnglish = false;

						var translationOutput = translateText(thisLine, "");
						
						var translationHtmlChinese = translationOutput[0];
						
						translationHtmlChinese = replaceChars(translationHtmlChinese, "</p>", "");
						
						if (contains(translationHtmlChinese, "id=\"chineseLine0") == true)
						{
							translationHtmlChinese = replaceChars(translationHtmlChinese, "id=\"chineseLine0", "id=\"chineseLine" + currentChineseLine);
							currentChineseLine = currentChineseLine + 1;
						}
						
						outputHtml = outputHtml + "\n" + translationHtmlChinese;
						outputText = outputText + "\n" + translationOutput[1];			

					} else {
					
						var thisEnglishHtml = "<div class=\"english\">" + thisLine + "</div></p>";
											
						outputHtml = outputHtml + "\n" + thisEnglishHtml;
						outputText = outputText + "\n" + thisLine;
					
						lastWasEnglish = true;
					
					} // end if the line contains chinese
				} // end if the line is not blank
				
				/*
				var thisLineCharacters = thisLine.split("");
				var numberCharacters = thisLineCharacters.length;
				
				var lineHasChinese = false;

				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCharacter = thisLineCharacters[currentCharacter];
					
					if (isChinese(thisCharacter))
					{
						lineHasChinese = true;
						
						// Exit the loop
						currentCharacter = numberCharacters;
					} // end if the character is Chinese
				} // end for every character on the line
				
				if (lineHasChinese == true)
				{
					var translationOutput = translateText(thisLine, lastEnglishLine);
					
					outputHtml = outputHtml + "\n" + translationOutput[0];
					outputText = outputText + "\n" + translationOutput[1];			
					
					lastEnglishLine = "";
					
				} else {
					
					if (thisLine == "")
					{
						outputHtml = outputHtml + "\n" + "<br></br><br></br>";
						outputText = outputText + "\n\n";
					}
					
					if (lastEnglishLine == "")
					{
						lastEnglishLine = thisLine;
					} else {
						outputHtml = outputHtml + "\n" + "<p>" + lastEnglishLine + "</p>";
						outputText = outputText + "\n" + lastEnglishLine;
						
						lastEnglishLine = thisLine;
					}
				} // end if the line has a Chinese character
				*/
				
			} // end for every line
			
			//outputText = replaceChars(outputText, "\n\n", "\n");
			
			return [outputHtml, outputText];
			
		} // end function translateBilingual
		
		function translateBilingualInterface()
		{
			//debugLog("translateBilingualInterface");
			
			var inputText = document.getElementById("chineseSpacedTextArea").value;
			
			if (inputText == "")
			{
				inputText = document.getElementById("chineseTextArea").value;
			}
			
			var translations = translateBilingual(inputText);
			
			var outputHtml=translations[0];
			var outputText=translations[1];
			
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			outputText = replaceChars(outputText, "	", "  ");
			document.getElementById("outputTextArea").value = outputText;
			
		} // end function translateBilingualInterface 

		function clearInterface()
		{
			//debugLog("clearInterface");

			document.getElementById("chineseTextArea").value = "";
			document.getElementById("chineseSpacedTextArea").value = "";
			document.getElementById("englishTextArea").value = "";
			document.getElementById("outputHtml").innerHTML = "";
			document.getElementById("outputTextArea").value = "";
			document.getElementById("filenameTextArea").value = "";
		} // end function clearInterface
	
		function interfaceLoaded()
		{
			//debugLog("interfaceLoaded");

			var chineseText = document.getElementById("chineseTextArea").value;
			//var englishText = document.getElementById("englishTextArea").value;
			var filenameText = document.getElementById("filenameTextArea").value;
			
			if (chineseText == "")
			{
				return false;
			}

			//if (englishText == "")
			//{
			//	return false;
			//}

			if (filenameText == "")
			{
				return false;
			}			
			
			return true;
			
		} // end function clearInterface
	
		function translateCnlt()
		{
			//debugLog("translateCnlt");

			var translationOutput = translateText(chineseText, nltText);
			
			outputHtml = translationOutput[0];
			outputText = translationOutput[1];			
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			
			return outputHtml;
			
		} // end function translateFiles

		function getOutputHtml()
		{
			//debugLog("getOutputHtml");

			return document.getElementById("outputHtml").innerHTML;
		} // end function getOutputHtml
		
		function setFilename(thisFilename)
		{
			//debugLog("setFilename(" + thisFilename + ")");

			document.getElementById("filenameTextArea").value = thisFilename;
		} // end function setFilename
		
		function saveLitMan()
		{
			var literalFilePath = "";
		
			// If we have a literal file
			if ((QueryString.literalFile != "") && (QueryString.literalFile != undefined))
			{
				var literalUrl = QueryString.literalFile;
				
				var literalFilePath = replaceChars(literalUrl, "%20", " ");
				
				var litManText = document.getElementById('simplifiedInputTextArea').value;
				
				writeToFile(literalFilePath, litManText);
			}
		} // end function saveLitMan
		
		function saveHtml()
		{
			//debugLog("saveHtml");

			var filename = document.getElementById("filenameTextArea").value;
			var thisString = document.getElementById("outputHtml").innerHTML;
			
			var htmlHeaders = "<!DOCTYPE html>\n<html>\n  <head>\n	<meta charset=\"utf-8\" />\n        <style>\n\n@font-face {\n    font-family: \"Charcoal CY\";\n    src: url(\"fonts/Charcoal.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Virtue\";\n    src: url(\"fonts/virtue.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"SimSun\";\n    src: url(\"fonts/SimSun.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Jhenghei\";\n    src: url(\"fonts/MicrosoftJhengHeiRegular.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"PingfangLocal\";\n    src: local(\"PingFang-TC-Regular\");\n}\n\n@font-face {\n    font-family: \"Pingfang\";\n    src: url(\"fonts/PingFang1.ttf\") format(\"truetype\");\n}\n\n      body {\n        font-family: Tahoma, Geneva, sans-serif;\n      }\n      \n      table td {\n      white-space: nowrap;\n      }\n		\n	a:hover, a:visited, a:link, a:active\n	{\n		color:#000000;\n	    text-decoration: none;\n	}\n		\n      .chinese_1 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .chinese_2 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_3 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_4 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_5 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_6 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_7 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n      \n      .chinese_8 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n      .pinyin_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .pinyin_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\ndisplay:inline;\n      }\n\n      .pinyin_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\ndisplay:inline;\n      }\n\n      .pinyin_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .pinyin_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .taiwanese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#797986;\n		display:inline;\n      }\n\n      .taiwanese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .taiwanese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .taiwanese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#505050;\ndisplay:inline;\n      }\n\n      .taiwanese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .taiwanese_7 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n      \n      .taiwanese_8 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#707070;\ndisplay:inline;\n      }\n\n      .cantonese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#929292;\n		display:inline;\n      }\n\n      .cantonese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#FF8080;\ndisplay:inline;\n      }\n\n      .cantonese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#797986;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .cantonese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .cantonese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .cantonese_6 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .hangul {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 26px;\n		display:inline;\n      }\n\n      .tang {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .japanese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .vietnamese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .englishInChinese {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .literal {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .english {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n\n		.DefaultButtonOuter\n		{\n			border: 2px solid black ;\n			border-radius: 8px;\n			width: 96px;\n			height: 26px;\n			text-align: center;\n			\n			/*background-color: #99999a;*/\n			background: #99999a; /* For browsers that do not support gradients */\n			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */\n			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */\n			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */\n			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */\n		}\n\n		.ButtonInner\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 88px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: \"Charcoal CY\", \"Virtue\", Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n		\n		.ButtonInner:active\n		{\n		    background:#666666;\n		    color: #ffffff;\n		}\n\n		.key\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 18px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n\n\n			#matrix {\n				background: black;\n				float: center;\n			}\n\n			#matrix td {\n			    padding: 7px;\n    			margin: 0px;\n    			float: center;\n				background: black;\n				font: 54px arial;\n				\n				height: 80px;\n			}\n\n			#matrix tr {\n				height: 80px;\n			}\n\n\n			#matrix p {\n			    opacity: 0;\n			    margin-top: -25px;\n			    text-align: center;\n\n				height: 80px;\n\n			    -webkit-transition: margin-top 2s ease-in;\n			    -moz-transition: margin-top 2s ease-in;\n			    -o-transition: margin-top 2s ease-in;\n			    -ms-transition: margin-top 2s ease-in;\n			    transition: margin-top 2s ease-in;\n			}\n			\n			#matrix p.load {\n			    opacity: 1;\n			    margin-top: 25px;\n			}\n\n     .dialogWithDropShadow\n     {\n         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);\n         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); \n     }\n\n@font-face {\n    font-family: \"SmallSealScript\";\n    src: url(\"fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf\") format(\"truetype\");\n}\n\n      .smallSealScript_1 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .smallSealScript_2 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_3 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_4 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n@font-face {\n    font-family: \"LargeSealScript\";\n    src: url(\"fonts/JDFZHUANF.ttf\") format(\"truetype\");\n}\n\n      .largeSealScript_1 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .largeSealScript_2 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_3 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_4 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n@font-face {\n    font-family: \"OracleBones\";\n    src: url(\"fonts/bnujgw.ttf\") format(\"truetype\");\n}\n\n      .oracleBones_1 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .oracleBones_2 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_3 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_4 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n    </style>\n\n  </head>\n  <body>\n	";
			
			var htmlFooters = "\n  </body>\n</html>\n";
			
			// Pingtype is a literal translator for Chinese. Pingtype 是 一個 中文 詞彙 翻譯. 
			
			var thisHtml = htmlHeaders + thisString + htmlFooters;
			
			writeToFile(filename, thisHtml);
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == true)
			{
				var thisUrl = "https://github.com/peterburk/pingxing/blob/master/" + filename;
				window.open(thisUrl,'_blank');
			}
		} // end function saveHtml
		
		function saveText()
		{
			//debugLog("saveText");

			var filename = document.getElementById("filenameTextArea").value;
			var thisString = document.getElementById("outputTextArea").value;
			
			writeToFile(filename, thisString);

	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == true)
			{
				var thisUrl = "https://github.com/peterburk/pingxing/blob/master/" + filename;
				window.open(thisUrl,'_blank');
			}

		} // end function saveText
		
		// To do: wordSpaceAdditive not working
		function wordSpaceAdditive(thisChinese)
		{
			//debugLog("wordSpace(" + thisChinese + ")");
			
			var breakMissingWords = document.getElementById('breakMissingWordsCheckbox').checked;
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var spacedChineseLine = "";
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				/*
				if (numberCharacters >= 1)
				{
					
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				*/
				
				// Skip all-English lines
				//if (lineIsEnglish == true)
				//{
				//	spacedChinese = spacedChinese + thisChineseLine + "\n";
				//} else {
				
				var lastCharacter = 0;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisWord = "";
				
					var wordFound = false;
					
					for (var wordLength = 2; wordLength <= 5; wordLength++)
					{
				
						lastCharacter = currentCharacter + wordLength;
						
						if (lastCharacter > numberCharacters)
						{
							lastCharacter = numberCharacters;
						}
						
						thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
						var thisCharacter = thisChineseLine[currentCharacter];

						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							//spacedChineseLine = spacedChineseLine + thisCharacter;
						
							//lastWasNotChinese = true;
							
							// Move the character along in the string
							//currentCharacter = currentCharacter + 1;
							
							wordFound == false;
							
							currentCharacter = currentCharacter - 1;

							// Exit the loop cleanly
							wordLength = 10;
							
						} else {

							//lastWasNotChinese = false;
							
							var inDictionary = false;
							
							if (breakMissingWords == false)
							{
								inDictionary = contains(combinedDictionaryData, thisWord + "	");
							} else {
								//inDictionary = contains(combinedDictionaryData, "\n" + thisWord + "	");
								inDictionary = searchDictionary(thisWord);
							}
							
							//if (contains(longWords, " " + thisWord) == true)
							if (inDictionary == true)
							{
								// Move the character along in the string
								currentCharacter = currentCharacter + wordLength - 1;
							
								wordFound = true;
						
								// Exit the loop cleanly
								//wordLength = 10;
							} else {
								
								lastCharacter = lastCharacter - 1;

								// Exit the loop cleanly
								wordLength = 10;

							} // end if the character is not Chinese
							
						} // if the word exists
					
					} // end for every word length
										
					thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
					
					spacedChineseLine = spacedChineseLine + thisWord + " ";
								
				
				} // end for every character
				
				spacedChinese = spacedChinese + spacedChineseLine + "\n";
				//} // end if the line is English
				
			} // end for every line
			
			
			var spacedLine = "";
		   
			var numberLineCharacters = stringLength(spacedChinese);
		   
			// Add spaces for punctuation
			for (var currentLineCharacter = 0; currentLineCharacter < numberLineCharacters; currentLineCharacter++)
			{
				var thisLineCharacter = spacedChinese[currentLineCharacter];
			   
				if (isChinese(thisLineCharacter) == true)
				{
					spacedLine = spacedLine + thisLineCharacter;
				} else {
					if (isEnglish(thisLineCharacter) == true)
					{
						spacedLine = spacedLine + thisLineCharacter;
					} else {
						spacedLine = spacedLine + thisLineCharacter + " ";
					}
				}
			   
			} // end add spaces after every non-Chinese character
			
			return spacedLine;
			
		} // end function wordSpaceAdditive
		
		function wordSpaceTaiwanese(thisChinese)
		{
			//debugLog("wordSpace(" + thisChinese + ")");
			
			var breakMissingWords = document.getElementById('breakMissingWordsCheckbox').checked;
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var spacedChineseLine = "";
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				/*
				if (numberCharacters >= 1)
				{
					
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				*/
				
				// Skip all-English lines
		   		if (containsChineseString(thisChineseLine) == false)
				{
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				} else {
				
					 for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					 {
						 var thisWord = "";
				
						 var wordFound = false;
					
						 for (var wordLength = 5; wordLength >= 2; wordLength--)
						 {
				
							 var lastCharacter = currentCharacter + wordLength;
						
							 if (lastCharacter > numberCharacters)
							 {
								 lastCharacter = numberCharacters;
							 }
						
							 thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
							 var thisCharacter = thisChineseLine[currentCharacter];

							 if (isChinese(thisCharacter) == false)
							 {
								 // Don't add spaces between non-Chinese characters
								 //spacedChineseLine = spacedChineseLine + thisCharacter;
						
								 //lastWasNotChinese = true;
							
								 // Move the character along in the string
								 //currentCharacter = currentCharacter + 1;
							
								 wordFound == false;
							
							 } else {

								 //lastWasNotChinese = false;
							
								 var inDictionary = false;
							
								 if (breakMissingWords == false)
								 {
									 inDictionary = contains(taiwaneseData, thisWord + "	");
								 } else {
								 	inDictionary = dictionaryContainsTaiwanese(thisWord);
									//inDictionary = contains(taiwaneseData, "\n" + thisWord + "	");
								 }
							
								 //if (contains(longWords, " " + thisWord) == true)
								 if (inDictionary == true)
								 {
									 // Move the character along in the string
									 currentCharacter = currentCharacter + wordLength - 1;
							
									 wordFound = true;
						
									 // Exit the loop cleanly
									 wordLength = 0;
								 } // end if the character is not Chinese
							
							 } // if the word exists
					
						 } // end for every word length
				
						 // If the word is not found, just use the character
						 if (wordFound == false)
						 {
							 var thisCharacter = thisChineseLine[currentCharacter];
					
							 if (isChinese(thisCharacter) == false)
							 {
								 // Don't add spaces between non-Chinese characters
								 spacedChineseLine = spacedChineseLine + thisCharacter;
						
								 lastWasNotChinese = true;
						
							 } else {
						
								 // Add a space if we're back to parsing Chinese
								 if (lastWasNotChinese == true)
								 {
									 spacedChineseLine = spacedChineseLine + " ";
									 lastWasNotChinese = false;
								 }
						
								 spacedChineseLine = spacedChineseLine + thisCharacter + " ";					

							 } // end if this character is not Chinese
					
						 } else {

							 // Add a space if we're back to parsing Chinese
							 if (lastWasNotChinese == true)
							 {
								 spacedChineseLine = spacedChineseLine + " ";
								 lastWasNotChinese = false;
							 }

							 spacedChineseLine = spacedChineseLine + thisWord + " ";

						 } // end if the word was not found
								
				
					 } // end for every character
				
					 spacedChinese = spacedChinese + spacedChineseLine + "\n";
				} // end if the line is English
				
			} // end for every line
			
			
			var spacedLines = "";
		   
			var spacedChineseLines = spacedChinese.split("\n");
			
			var numberLines = spacedChineseLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
			
				var spacedChineseLine = spacedChineseLines[currentLine];


				if (containsChineseString(spacedChineseLine) == true)
				{
					var spacedLine = "";
				
					var numberLineCharacters = stringLength(spacedChineseLine);
		   			
		   			// Add spaces for punctuation
					for (var currentLineCharacter = 0; currentLineCharacter < numberLineCharacters; currentLineCharacter++)
					{
						var thisLineCharacter = spacedChineseLine[currentLineCharacter];
			   			
						if (isChinese(thisLineCharacter) == true)
						{
							spacedLine = spacedLine + thisLineCharacter;
						} else {
							if (isEnglish(thisLineCharacter) == true)
							{
								spacedLine = spacedLine + thisLineCharacter;
							} else {
								spacedLine = spacedLine + thisLineCharacter + " ";
							}
						}			   			
					} // end add spaces after every non-Chinese character
					
					spacedLines = spacedLines + spacedLine + "\n";
					
				} else {
					// Don't add spaces on English lines
					spacedLines = spacedLines + spacedChineseLine + "\n";
				
				} // end if the line is english
				
			} // end for every line
			
			return spacedLines;
			
		} // end function wordSpaceTaiwanese
		
		function taiwaneseWordSpaceButtonClicked()
		{
			//debugLog("wordSpaceButtonClicked()");

			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedLine = wordSpaceTaiwanese(thisChinese);
			
			document.getElementById("chineseSpacedTextArea").value = spacedLine;
			//document.getElementById("outputTextArea").value = spacedChinese;
			
		} // end function taiwaneseWordSpaceButtonClicked
		
		function isEmoji(thisCharacter)
		{
			//debugLog(thisCharacter + "	" + parseInt("0x" + thisCharacter.charCodeAt(0).toString(16), 16));
			var thisCharacterInt = parseInt("0x" + thisCharacter.charCodeAt(0).toString(16), 16);
			
			if (thisCharacterInt >= parseInt("0xD800"))
			{
				if (thisCharacterInt <= parseInt("0xDB7F"))
				{
					return true;
				}
			}
			return false;
		} // end function isEmoji
		
		function wordSpace(thisChinese)
		{
			//debugLog("wordSpace(" + thisChinese + ")");
			
			var breakMissingWords = document.getElementById('breakMissingWordsCheckbox').checked;
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var spacedChineseLine = "";
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				/*
				if (numberCharacters >= 1)
				{
					
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				*/
				
				// Skip all-English lines
		   		if (containsChineseString(thisChineseLine) == false)
				{
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				} else {
				
					 for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					 {
						 var thisWord = "";
				
						 var wordFound = false;
					
						 for (var wordLength = 5; wordLength >= 2; wordLength--)
						 {
				
							 var lastCharacter = currentCharacter + wordLength;
						
							 if (lastCharacter > numberCharacters)
							 {
								 lastCharacter = numberCharacters;
							 }
						
							 thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
							 var thisCharacter = thisChineseLine[currentCharacter];

							 if (isChinese(thisCharacter) == false)
							 {
								 // Don't add spaces between non-Chinese characters
								 //spacedChineseLine = spacedChineseLine + thisCharacter;
						
								 //lastWasNotChinese = true;
							
								 // Move the character along in the string
								 //currentCharacter = currentCharacter + 1;
							
								 wordFound == false;
							
							 } else {

								 //lastWasNotChinese = false;
							
								 var inDictionary = false;
							
								 if (breakMissingWords == false)
								 {
									 inDictionary = contains(combinedDictionaryData, "\n" + thisWord + "	");
								 } else {
									 //inDictionary = contains(combinedDictionaryData, "\n" + thisWord + "	");
									 inDictionary = searchDictionary(thisWord);
								 }
							
 								 if (isEmoji(thisCharacter) == true)
								 {
								 	inDictionary = true;
								 }

								 //if (contains(longWords, " " + thisWord) == true)
								 if (inDictionary == true)
								 {
									 // Move the character along in the string
									 currentCharacter = currentCharacter + wordLength - 1;
							
									 wordFound = true;
						
									 // Exit the loop cleanly
									 wordLength = 0;
								 } // end if the character is not Chinese
							
							 } // if the word exists
					
						 } // end for every word length
				
						 // If the word is not found, just use the character
						 if (wordFound == false)
						 {
							 var thisCharacter = thisChineseLine[currentCharacter];
					
							 if (isChinese(thisCharacter) == false)
							 {
								 // Don't add spaces between non-Chinese characters
								 spacedChineseLine = spacedChineseLine + thisCharacter;
						
								 lastWasNotChinese = true;
						
							 } else {
						
								 // Add a space if we're back to parsing Chinese
								 if (lastWasNotChinese == true)
								 {
									 spacedChineseLine = spacedChineseLine + " ";
									 lastWasNotChinese = false;
								 }
						
								 spacedChineseLine = spacedChineseLine + thisCharacter + " ";					

							 } // end if this character is not Chinese
					
						 } else {

							 // Add a space if we're back to parsing Chinese
							 if (lastWasNotChinese == true)
							 {
								 spacedChineseLine = spacedChineseLine + " ";
								 lastWasNotChinese = false;
							 }

							 spacedChineseLine = spacedChineseLine + thisWord + " ";

						 } // end if the word was not found
								
				
					 } // end for every character
				
					 spacedChinese = spacedChinese + spacedChineseLine + "\n";
				} // end if the line is English
				
			} // end for every line
			
			
			var spacedLines = "";
		   
			var spacedChineseLines = spacedChinese.split("\n");
			
			var numberLines = spacedChineseLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
			
				var spacedChineseLine = spacedChineseLines[currentLine];


				if (containsChineseString(spacedChineseLine) == true)
				{
					var spacedLine = "";
				
					var numberLineCharacters = stringLength(spacedChineseLine);
		   			
		   			// Add spaces for punctuation
					for (var currentLineCharacter = 0; currentLineCharacter < numberLineCharacters; currentLineCharacter++)
					{
						var thisLineCharacter = spacedChineseLine[currentLineCharacter];
			   			
						if (isChinese(thisLineCharacter) == true)
						{
							spacedLine = spacedLine + thisLineCharacter;
						} else {
							if (isEnglish(thisLineCharacter) == true)
							{
								spacedLine = spacedLine + thisLineCharacter;
							} else {
								spacedLine = spacedLine + thisLineCharacter + " ";
							}
						}			   			
					} // end add spaces after every non-Chinese character
					
					spacedLines = spacedLines + spacedLine + "\n";
					
				} else {
					// Don't add spaces on English lines
					spacedLines = spacedLines + spacedChineseLine + "\n";
				
				} // end if the line is english
				
			} // end for every line
			
			return spacedLines;
			
		} // end function wordSpace
		
		function wordSpaceButtonClicked()
		{
			//debugLog("wordSpaceButtonClicked()");

			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedLine = wordSpace(thisChinese);
			
			document.getElementById("chineseSpacedTextArea").value = spacedLine;
			//document.getElementById("outputTextArea").value = spacedChinese;
			
		} // end function wordSpaceButtonClicked
		
		
		
		function characterSpace()
		{
			//debugLog("characterSpace()");
			
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedChinese = "";
			
			var thisChineseCharacters = stringToCharacterArray(thisChinese);
			
			var numberCharacters = stringLength(thisChineseCharacters);

			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisChineseCharacters[currentCharacter];
				
				spacedChinese = spacedChinese + thisCharacter + " ";
			} // end for every character
			
			document.getElementById("chineseSpacedTextArea").value = spacedChinese;
		} // end function characterSpace
		
		function despace(thisChinese)
		{
			//debugLog("despace(" + thisChinese + ")");
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = stringLength(thisChineseLine);
				var lastWasNotChinese = false;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCharacter = thisChineseLine[currentCharacter];
					
					if (isChinese(thisCharacter) == true)
					{
						spacedChinese = spacedChinese + thisCharacter;
						lastWasNotChinese = false;
					} else {
					
						if (lastWasNotChinese == false)
						{
							if (thisCharacter != " ")
							{
								spacedChinese = spacedChinese + thisCharacter;
							}
						} else {
							spacedChinese = spacedChinese + thisCharacter;
						}
						
						lastWasNotChinese = true;
					}
				} // end for every character
				
				spacedChinese = spacedChinese + "\n";
				
				
				/*
				var spacedChineseLine = "";
				
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				if (numberCharacters >= 1)
				{
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				
				
				// Skip all-English lines
				if (lineIsEnglish == true)
				{
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				} else {
					
					thisChineseLine = replaceChars(thisChineseLine," ", "");
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				
				} // end if line is english
				*/
								
			} // end for every line
			
			return spacedChinese;
			
		} // end function despace
		
		function despaceButtonClicked()
		{
			//debugLog("despaceButtonClicked");

			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedChinese = despace(thisChinese);
			
			document.getElementById("chineseTextArea").value = spacedChinese;
			document.getElementById("outputTextArea").value = spacedChinese;
			
		} // end function despace
		
		function showMissingWords(theseWords)
		{
			//debugLog("showMissingWords(" + theseWords + ")");

			var missingWordsHtml = "";

			var headers = "<tr><td><div style=\"font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;\">Missing words</div></td><td><textarea id=\"missingWordsTextArea\" rows=\"5\" cols=\"50\" >";
		
			var footers = "</textarea></td></tr>";
			
			var missingWordsArray = theseWords.split("\n");
			
			var missingWordsString = "";
			
			var numberWords = missingWordsArray.length;
			
			if (numberWords <= 1)
			{
				return;
			}
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = missingWordsArray[currentWord];
				
				if (contains(missingWordsString,thisWord) == false)
				{
					missingWordsString = missingWordsString + thisWord + "\n";
				}
			} // end for every word
			
			missingWordsHtml = headers + missingWordsString + footers;
		
			var missingWordsTable = document.getElementById("missingWordsTable");
			missingWordsTable.innerHTML = missingWordsHtml;
		
		} // end function showMissingWords
		
		
		/* Decompose */
		
		function searchHexButtonClicked()
		{
			//debugLog("searchHexButtonClicked");
	
			var inputHex = document.getElementById("startCharacter").value;
			
			var inputCharacter = hexToCharacter(inputHex);
			
			document.getElementById("startCharacter").value = inputCharacter;
			
		} // end function searchHexButtonClicked

		function searchUnitypeButtonClicked()
		{
			//debugLog("searchUnitypeButtonClicked");

			var inputUnitype = document.getElementById("startCharacter").value;
			
			var inputCharacter = unitypeToCharacter(inputUnitype);
			
			document.getElementById("startCharacter").value = inputCharacter;

		} // end function searchUnitypeButtonClicked

		function searchWadeGilesButtonClicked()
		{
			//debugLog("searchWadeGilesButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var pinyinArray = ["zhuang", "zhuan", "zhuai", "zhong", "zheng", "zhang", "xiong", "xiang", "sheng", "qiong", "qiang", "jiong", "jiang", "guang", "chong", "cheng", "zuan", "zong", "zhuo", "zhun", "zhui", "zhua", "zhou", "zhen", "zhei", "zhao", "zhan", "zhai", "zeng", "zang", "yuan", "yong", "xuan", "xing", "xiao", "xian", "weng", "tong", "tian", "teng", "song", "shen", "seng", "ruan", "rong", "reng", "rang", "quan", "qing", "qiao", "qian", "pian", "peng", "nong", "nian", "neng", "mian", "meng", "long", "lian", "leng", "kong", "keng", "juan", "jing", "jiao", "jian", "hong", "heng", "guan", "guai", "gong", "geng", "gang", "feng", "duan", "dong", "ding", "diao", "dian", "deng", "dang", "cuan", "cong", "chuo", "chen", "ceng", "cang", "bing", "biao", "bian", "beng", "bang", "zuo", "zun", "zui", "zou", "zhu", "zhi", "zhe", "zha", "zen", "zei", "zao", "zan", "zai", "yun", "yue", "you", "yan", "xun", "xue", "xiu", "xin", "xie", "xia", "wen", "tuo", "tie", "suo", "shi", "sen", "ruo", "run", "rui", "rou", "ren", "rao", "ran", "qun", "que", "qiu", "qin", "qie", "qia", "pie", "pen", "nuo", "nüe", "nie", "nen", "mie", "men", "luo", "lüe", "lie", "kui", "ken", "jun", "jue", "jiu", "jin", "jie", "jia", "hen", "guo", "gun", "gui", "gua", "gou", "gen", "gei", "gao", "gan", "gai", "fen", "duo", "dun", "dui", "dou", "diu", "die", "dei", "dao", "dan", "dai", "cuo", "cun", "cui", "cou", "chi", "che", "cen", "cao", "can", "cai", "bin", "bie", "ben", "bei", "bao", "ban", "bai", "zu", "zi", "ze", "za", "yu", "yi", "ye", "xu", "xi", "te", "si", "se", "ru", "ri", "re", "qu", "qi", "le", "ke", "ju", "ji", "he", "gu", "ge", "ga", "er", "en", "du", "di", "de", "da", "cu", "ci", "ce", "ca", "bu", "bo", "bi", "ba", "e"];
	
			var wadeGilesArray = ["chuang", "chuan", "chuai", "chung", "chêng", "chang", "hsiung", "hsiang", "shêng", "chiung", "chiang", "chiung", "chiang", "kuang", "chung", "chêng", "tsuan", "tsung", "cho", "chun", "chui", "chua", "chou", "chên", "chei", "chao", "chan", "chai", "tsêng", "tsang", "yüan", "yung", "hsüan", "hsing", "hsiao", "hsien", "wêng", "tung", "tien", "têng", "sung", "shên", "sêng", "juan", "jung", "jêng", "jang", "chüan", "ching", "chiao", "chien", "pien", "pêng", "nung", "nien", "nêng", "mien", "mêng", "lung", "lien", "lêng", "kung", "kêng", "chüan", "ching", "chiao", "chien", "hung", "hêng", "kuan", "kuai", "kung", "kêng", "kang", "fêng", "tuan", "tung", "ting", "tiao", "tien", "têng", "tang", "tsuan", "tsung", "cho", "chên", "tsêng", "tsang", "ping", "piao", "pien", "pêng", "pang", "tso", "tsun", "tsui", "tsou", "chu", "chih", "chê", "cha", "tsên", "tsei", "tsao", "tsan", "tsai", "yün", "yüeh", "yu", "yen", "hsün", "hsüeh", "hsiu", "hsin", "hsieh", "hsia", "wên", "to", "tieh", "so", "shih", "sên", "jo", "jun", "jui", "jou", "jên", "jao", "jan", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "pieh", "pên", "no", "nüeh", "nieh", "nên", "mieh", "mên", "lo", "lüeh", "lieh", "kuei", "kên", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "hên", "kuo", "kun", "kuei", "kua", "kou", "kên", "kei", "kao", "kan", "kai", "fên", "to", "tun", "tui", "tou", "tiu", "tieh", "tei", "tao", "tan", "tai", "tso", "tsun", "tsui", "tsou", "chih", "chê", "tsên", "tsao", "tsan", "tsai", "pin", "pieh", "pên", "pei", "pao", "pan", "pai", "tsu", "tzu", "tsê", "tsa", "yü", "i", "yeh", "hsü", "hsi", "tê", "ssu", "sê", "ju", "jih", "jê", "chü", "chi", "lê", "ko", "chü", "chi", "ho", "ku", "ko", "ka", "êrh", "ên", "tu", "ti", "tê", "ta", "tsu", "tzu", "tsê", "tsa", "pu", "po", "pi", "pa", "o"];
			
			var thisIndex = wadeGilesArray.indexOf(inputWord);
			
			if (thisIndex >= 0)
			{
				var thisPinyin = pinyinArray[thisIndex];
				
				dictionaryCharacter(thisPinyin);
				
			} // if the word is in the wade-giles array

		} // end function searchWadeGilesButtonClicked



		function searchHangulButtonClicked()
		{
			//debugLog("searchHangulButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = hangulData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchHangulButtonClicked

		function searchJapaneseButtonClicked()
		{
			//debugLog("searchJapaneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = japaneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchJapaneseButtonClicked

		function searchVietnameseButtonClicked()
		{
			//debugLog("searchVietnameseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = vietnameseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchVietnameseButtonClicked

		function searchCantoneseButtonClicked()
		{
			//debugLog("searchCantoneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = cantoneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchCantoneseButtonClicked
	
		function searchPinyinButtonClicked()
		{
			//debugLog("searchPinyinButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = combinedDictionaryData.match(searchRegex);
	   
	   		if (contains(toneNumbersMarks, inputWord + "1"))
			{
				var inputWord1 = textBetween(toneNumbersMarks, inputWord + "1" + "	", "\n");
				
				var searchRegexString = "^(.*" + "	" + inputWord1 + ".*)$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				var characterWordsArray1 = combinedDictionaryData.match(searchRegex);
				
				characterWordsArray.push(...characterWordsArray1);
			}

	   		if (contains(toneNumbersMarks, inputWord + "2"))
			{
				var inputWord2 = textBetween(toneNumbersMarks, inputWord + "2" + "	", "\n");
				
				var searchRegexString = "^(.*" + "	" + inputWord2 + ".*)$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				var characterWordsArray2 = combinedDictionaryData.match(searchRegex);
				
				characterWordsArray.push(...characterWordsArray2);
			}

	   		if (contains(toneNumbersMarks, inputWord + "3"))
			{
				var inputWord3 = textBetween(toneNumbersMarks, inputWord + "3" + "	", "\n");
				
				var searchRegexString = "^(.*" + "	" + inputWord3 + ".*)$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				var characterWordsArray3 = combinedDictionaryData.match(searchRegex);
				
				characterWordsArray.push(...characterWordsArray3);
			}
			
	   		if (contains(toneNumbersMarks, inputWord + "4"))
			{
				var inputWord4 = textBetween(toneNumbersMarks, inputWord + "4" + "	", "\n");
				
				var searchRegexString = "^(.*" + "	" + inputWord4 + ".*)$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				var characterWordsArray4 = combinedDictionaryData.match(searchRegex);
				
				characterWordsArray.push(...characterWordsArray4);
			}
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;
			
		} // end function searchPinyinButtonClicked
		
		function searchTaiwaneseButtonClicked()
		{
			//debugLog("searchTaiwaneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");
			
			var tonelessTaiwaneseData = removeTones(taiwaneseData);
			
			
			
			var characterWordsArray = tonelessTaiwaneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchTaiwaneseButtonClicked
		
		function searchHakkaButtonClicked()
		{
			//debugLog("searchHakkaButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");
			
			var tonelessHakkaData = removeTones(hakkaData);
			
			
			
			var characterWordsArray = tonelessHakkaData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchHakkaButtonClicked

		function dictionaryCharacter(thisCharacter)
		{
			//debugLog("dictionaryCharacter(" + thisCharacter + ")");

			//if (contains(combinedDictionaryData, thisCharacter) == true)
			if (contains(oneWords, thisCharacter) == true)
			{
				var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisCharacter + "	", "\n");
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
				var lineLength = thisDictionaryLineArray.length;
				
				var thisDefinition = "";
				var thisCharacterPinyin = "";
				var thisToneless = "";
				var thisTone = "";
				
				thisDefinition = thisDictionaryLineArray[0];

				if (lineLength >= 1)
				{
					thisCharacterPinyin = thisDictionaryLineArray[1];
				}
				
				if (lineLength >= 2)
				{
					thisToneless = thisDictionaryLineArray[2];
				}
				
				if (lineLength >= 3)
				{
					thisTone = thisDictionaryLineArray[3];
				}

			
				document.getElementById("pinyin").innerHTML = thisCharacterPinyin;
				document.getElementById("definition").innerHTML = thisDefinition;
				
				
				// If this is an English word
				if (isChineseString(thisCharacter) == false)
				{
					var searchRegexString = "^(.*" + "	" + thisCharacter + "	" + ".*)$";
		   
					var searchRegex = new RegExp(searchRegexString, "gm");
		   
					var characterWordsArray = combinedDictionaryData.match(searchRegex);
					   
					var characterWords = "<tr>";
		   
					var numberWords = 0;

					for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
					{
						var thisItem = characterWordsArray[currentItem];
		   
						var thisItemLines = thisItem.split(/\r?\n/);
		   
						var lastLine = thisItemLines[thisItemLines.length - 1];
		   
						var thisWord = textBetween(lastLine, "start", "	");
			   
				   
						var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

						characterWords = characterWords + "<td>" + thisWordHtml + "</td>";
		   
						numberWords = numberWords + 1;
		   
						if ((numberWords % 3) == 0)
						{
							characterWords = characterWords + "</tr><tr class='children'>";
						}
			   		} // end if the word is english
			   
				} // end for every word containing the character
			
			characterWords = "<table>" + characterWords + "</table>";
			
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;
				
				return;
			} // end if the dictionary contains the character already
			
			if (stringLength(thisCharacter) > 1)
			{
				return;
			}
			
			var codePointDecimal = fixedCharCodeAt(thisCharacter, 0);
			
			var hexCode = codePointDecimal.toString(16).toUpperCase();
			
			document.getElementById("charCode").innerHTML = hexCode;

			var dictionaryUrl = "dictionary.php?charCode=" + hexCode;
		
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						var thisChinese = xmlhttp.responseText;
					    
						var thisPinyin = textBetween(thisChinese, "kMandarin=\"", "\"");
						var thisDefinition = textBetween(thisChinese, "kDefinition=\"", "\"");
						
						document.getElementById("pinyin").innerHTML = thisPinyin;
						document.getElementById("definition").innerHTML = thisDefinition;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('error searching php dictionary');
				   }
				}
			};
			
			xmlhttp.open("GET", dictionaryUrl, true);
			xmlhttp.send();
		} // end function dictionaryCharacter
		
		function searchBopomofo(thisWord)
		{
			//debugLog("searchBopomofo(" + thisWord + ")");
			
			if (contains(bopomofoData, thisWord) == true)
			{
				var searchRegexString = "^";
				searchRegexString = searchRegexString + "(.* " + thisWord + ".*)";
				searchRegexString = searchRegexString + "$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				
				var childCharacterArray = bopomofoData.match(searchRegex);
				
				//console.log(childCharacterArray);
				
				var numberChildren = 0;
				
				childCharacters = "";
				
				// If no children were found, skip the rest
				if (childCharacterArray == null)
				{
					return;
				}
				
				var childrenArrayLength = childCharacterArray.length;
								
				for (var currentItem = 0; currentItem < childrenArrayLength; currentItem++)
				{
					var thisItem = childCharacterArray[currentItem];
				
					var thisItemLines = thisItem.split(/\r?\n/);
				
					var lastLine = thisItemLines[thisItemLines.length - 1];
				
					var thisChild = textBetween(lastLine, "start", " ");
					
					thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChild + "</div>";

					childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		   
					numberChildren = numberChildren + 1;
		   
					if ((numberChildren % 3) == 0)
					{
						childCharacters = childCharacters + "</tr><tr class='children'>";
					}
					
				} // end for every child
				
				childCharacters = "<table>" + childCharacters + "</table>";
			
				var childTable = document.getElementById("childCharacters");
				childTable.innerHTML = childCharacters;
			} // end if the bopomofo data contains the word
			
		} // end function searchBopomofo

		function searchIds(thisWord)
		{
			//debugLog("searchIds(" + thisWord + ")");
			
			// Don't use contains to speed it up, because you want to be able to use regex "."
			//if (contains(idsData, thisWord) == true)
			//{
				var searchRegexString = "^";
				searchRegexString = searchRegexString + "(.*" + thisWord + ".*)";
				searchRegexString = searchRegexString + "$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				
				var childCharacterArray = idsData.match(searchRegex);
				
				//console.log(childCharacterArray);
				
				var numberChildren = 0;
				
				childCharacters = "";
				
				// If no children were found, skip the rest
				if (childCharacterArray == null)
				{
					//debugLog("childCharacterArray is null");
					return;
				}
				
				var childrenArrayLength = childCharacterArray.length;
								
				for (var currentItem = 0; currentItem < childrenArrayLength; currentItem++)
				{
					var thisItem = childCharacterArray[currentItem];
				
					var thisItemLines = thisItem.split(/\r?\n/);
				
					var lastLine = thisItemLines[thisItemLines.length - 1];
					
					var thisChild = textBetween(lastLine, "	", "	");
					
					thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChild + "</div>";

					childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		   
					numberChildren = numberChildren + 1;
		   
					if ((numberChildren % 3) == 0)
					{
						childCharacters = childCharacters + "</tr><tr class='children'>";
					}
					
				} // end for every child
				
				childCharacters = "<table>" + childCharacters + "</table>";
			
				var childTable = document.getElementById("childCharacters");
				childTable.innerHTML = childCharacters;
			//} // end if the ids data contains the word

			
		} // end function searchIds
		
		function searchManyCharacters(inputCharacters)
		{
				//debugLog("searchManyCharacters(" + inputCharacters + ")");
				
				// If the characters are an IDS code, search the IDS table instead
				if (isIdsString(inputCharacters) == true)
				{
					return searchIds(inputCharacters);
				}
				
				// If the word is in the dictionary, find the definition and pinyin
				dictionaryCharacter(inputCharacters);
				
				// If the characters are bopomofo, search the zhuyintable instead
				if (isBopomofoString(inputCharacters) == true)
				{
					return searchBopomofo(inputCharacters);
				} // end if thisString is bopomofo
				
				var numberInput = stringLength(inputCharacters);
				
				var startCharacter = inputCharacters[0];
				
				var childCharacterArray = genealogiesData.split(startCharacter + ",");

				//var childCharacterArray = genealogiesData.match(/^(.*木,.*回,.*)$/gm);
				
				// 木回
				
				var searchRegexString = "^";
				
				for (var currentInput = 0; currentInput < numberInput; currentInput++)
				{
					var thisInput = inputCharacters[currentInput];
					
					searchRegexString = searchRegexString + "(.*" + thisInput + ",.*)";
				}
				
				searchRegexString = searchRegexString + "$";
				
				var searchRegex = new RegExp(searchRegexString, "gm");
				
				//document.write(searchRegex);
				
				var childCharacterArray = genealogiesData.match(searchRegex);
				//var childCharacterArray = genealogiesData.match(/^(.*木,.*)(.*回,.*)$/gm);
								
				var numberChildren = 0;
				
				childCharacters = "";
				
				// If no children were found, skip the rest
				if (childCharacterArray == null)
				{
					return;
				}
				
				var childrenArrayLength = childCharacterArray.length;
				
				for (var currentItem = 0; currentItem < childrenArrayLength; currentItem++)
				{
					var thisItem = childCharacterArray[currentItem];
				
					var thisItemLines = thisItem.split(/\r?\n/);
				
					var lastLine = thisItemLines[thisItemLines.length - 1];
				
					var thisChild = textBetween(lastLine, "start", " ");
					
					
					var childGenealogy = textBetween(genealogiesData, thisChild + " ", "\n");
				
					// algorithm problem: must search whole genealogy not only filter direct children.
				
					var keepChild = true;
				
					for (var currentInput = 1; currentInput < numberInput; currentInput++)
					{
						var thisInput = inputCharacters[currentInput];
					
						if (contains(childGenealogy, thisInput) == false)
						{
							keepChild = false;
						}
						
					} // end for every other input character
					
					if (keepChild == true)
					{
				
						 var thisChildTag = thisChild;
					
						 if (isNumeric(thisChild) == true)
						 {
				
							 childComposition = textBetween(compositionData, thisChild + ":", ")");
							 //childComposition = textBetween(compositionData, thisChild + " ", "\n");
					
							 childLeft = textBetween(thisComposition, "(", ",");
							 childRight = textBetween(thisComposition, ",", "end");

							 //childLeft = textBetween(thisComposition, " ", ",");
							 //childRight = textBetween(thisComposition, ",", ",");
				
							 thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
						 }
		
						 thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

						 childCharacters = childCharacters + "<td>" + thisChild + "</td>";
				
						 numberChildren = numberChildren + 1;
				
						 if ((numberChildren % 3) == 0)
						 {
							 childCharacters = childCharacters + "</tr><tr class='children'>";
						 }
					}
					
					
				} // end for every descendant of the first character

			childCharacters = "<table>" + childCharacters + "</table>";
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = childCharacters;
			

		} // end function searchManyCharacters
				
		function searchCharacter()
		{			
			//debugLog("searchCharacter");

			var inputCharacters = document.getElementById("startCharacter").value;
						
			var numberInput = stringLength(inputCharacters);
			
			if (numberInput == 0)
			{
				return;
			}
			
			if (isNumberString(inputCharacters) == true)
			{
				numberInput = 1;
			}

			if (numberInput > 1)
			{
				return searchManyCharacters(inputCharacters);
			} // end if there are more than one character
			
			//startCharacter = inputCharacters[0];
			startCharacter = inputCharacters;
			
			
			// The iPhone can't cope with loading the dictionary into RAM
			//var thisChinese = textBetween(dictionaryData, "<char cp=\"" + hexCode, "/>");
			
			//alert(startCharacter);
			
			thisComposition = textBetween(compositionData, startCharacter + ":", ")");
			
			//thisComposition = textBetween(compositionData, startCharacter + " ", "end");
			
			//thisLeft = textBetween(thisComposition, "start", ",");
			//thisRight = textBetween(thisComposition, ",", ",");
			
			thisLeft = textBetween(thisComposition, "(", ",");
			thisRight = textBetween(thisComposition, ",", "end");
			
			
			thisLeft = "<div onclick='clickCharacter(\"" + thisLeft + "\")'>" + thisLeft + "</div>";
			thisRight = "<div onclick='clickCharacter(\"" + thisRight + "\")'>" + thisRight + "</div>";
			
			document.getElementById("leftCharacter").innerHTML = thisLeft;
			document.getElementById("rightCharacter").innerHTML = thisRight;
			
			//alert(thisComposition);
			
			var childCharacters = "";
			
			var numberChildren = 0;
			
			var childCharacterLeftArray = compositionData.split(startCharacter + ",");  

			for (var currentItem = 0; currentItem < childCharacterLeftArray.length; currentItem++)
			{
				var thisItem = childCharacterLeftArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
								
				var thisChildTag = thisChild;
		  
				if (isNumeric(thisChild) == true)
				{
		  
					childComposition = textBetween(compositionData, thisChild + ":", ")");
					//childComposition = textBetween(compositionData, thisChild + " ", "\n");
			  
					childLeft = textBetween(thisComposition, "(", ",");
					childRight = textBetween(thisComposition, ",", "end");

					//childLeft = textBetween(thisComposition, " ", ",");
					//childRight = textBetween(thisComposition, ",", ",");
		  
					thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
				}
  
				thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

				childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		  
				numberChildren = numberChildren + 1;
		  
				if ((numberChildren % 3) == 0)
				{
					childCharacters = childCharacters + "</tr><tr class='children'>";
				}
				
			} // end for every child character where startCharacter is on the left
						
			childCharacters = childCharacters + "</tr><tr>";
			
			var childCharacterRightArray = compositionData.split("," + startCharacter);  

			for (var currentItem = 0; currentItem < childCharacterRightArray.length; currentItem++)
			{
				var thisItem = childCharacterRightArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
				
				var thisChildTag = thisChild;
		   
				if (isNumeric(thisChild) == true)
				{
		   
					childComposition = textBetween(compositionData, thisChild + ":", ")");
					//childComposition = textBetween(compositionData, thisChild + " ", "\n");

					childLeft = textBetween(thisComposition, "(", ",");
					childRight = textBetween(thisComposition, ",", "end");
			   
					//childLeft = textBetween(thisComposition, " ", ",");
					//childRight = textBetween(thisComposition, ",", ",");
		   
		   
					thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
				}
   
				thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

				childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		   
				numberChildren = numberChildren + 1;
		   
				if ((numberChildren % 3) == 0)
				{
					childCharacters = childCharacters + "</tr><tr class='children'>";
				}
				
			} // end for every child character where startCharacter is on the left
			
			childCharacters = "<table>" + childCharacters + "</table>";
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = childCharacters;

			//$('#characterTable tr:last').after("<tr id='children'>" + childCharacters + "</tr>");
			
			dictionaryCharacter(startCharacter);
			
			
			
			// Words
			var searchRegexString = "^(.*" + startCharacter + ".*)$";
			
			var searchRegex = new RegExp(searchRegexString, "gm");
			
			var characterWordsArray = combinedDictionaryData.match(searchRegex);
						
			var characterWords = "<tr>";
			
			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];
			
				var thisItemLines = thisItem.split(/\r?\n/);
			
				var lastLine = thisItemLines[thisItemLines.length - 1];
			
				var thisWord = textBetween(lastLine, "start", "	");
				
					
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";
			
				numberWords = numberWords + 1;
			
				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
				
				
			} // end for every word containing the character
			
			characterWords = "<table>" + characterWords + "</table>";
			
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

			var addReviewingTheHanzi = document.getElementById('reviewingTheHanziCheckbox').checked;
			
			if (addReviewingTheHanzi == true)
			{
				if (contains(reviewingTheHanziData, "\n" + startCharacter + "	"))
				{
					var thisReview = textBetween(reviewingTheHanziData, "\n" + startCharacter + "	", "\n");
					
					document.getElementById("reviewArea").innerHTML = thisReview;
					
				} // if reviewing the hanzi has the character
			} // if we should add reviewing the hanzi
			
		} // end function searchCharacter

		function typeCharacterBefore(thisCharacter)
		{
			//debugLog("typeCharacterBefore(" + thisCharacter + ")");

			var inputCharacters = document.getElementById("startCharacter").value;
			inputCharacters = thisCharacter + inputCharacters;

			document.getElementById("startCharacter").value = inputCharacters;
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = "";
			
			if (inputCharacters != "")
			{
				//searchCharacter();
			}
			
		} // end function typeCharacterBefore

		function typeCharacter(thisCharacter)
		{
			//debugLog("typeCharacter(" + thisCharacter + ")");

			var inputCharacters = document.getElementById("startCharacter").value;

			if (thisCharacter == "delete")
			{
				var inputLength = stringLength(inputCharacters);
				
				if (inputLength == 1)
				{
					inputCharacters = "";
				} else {
					inputCharacters = inputCharacters.substring(0, inputLength - 1);
				}
			} else {
				inputCharacters = inputCharacters + thisCharacter;
			}
								
			document.getElementById("startCharacter").value = inputCharacters;
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = "";
			
			if (inputCharacters != "")
			{
				//searchCharacter();
			}
			
		} // end function typeCharacter

		function clickCharacter(thisCharacter)
		{
			//debugLog("clickCharacter(" + thisCharacter + ")");

			document.getElementById("startCharacter").value = thisCharacter;
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = "";
			
			searchCharacter();
			
		} // end function clickCharacter
		
		function getGenealogy()
		{
			//debugLog("getGenealogy");

			//genealogy = genealogy.replace(/,\s*$/, "");

			return genealogy;
		} // end getAncestors		
		
		function getAncestors()
		{
			//debugLog("getAncestors");
			//ancestors = ancestors.replace(/,\s*$/, "");

			return ancestors;
		} // end getAncestors
		
		function findAncestors(thisCharacter, maxLevel, thisLevel)
		{
			//debugLog("findAncestors(" + thisCharacter + "," + maxLevel + "," + thisLevel + ")");

			var thisParents = getParents(thisCharacter, thisLevel);
			var thisLeft = thisParents[0];
			var thisRight = thisParents[1];
			
			if (thisLevel < maxLevel)
			{
				findAncestors(thisLeft, maxLevel, thisLevel + 1);
				findAncestors(thisRight, maxLevel, thisLevel + 1);
			} // if there are still more levels of recursion to continue

		} // end function findAncestors
		
		function getParents(thisCharacter, thisLevel)
		{
			//debugLog("getParents(" + thisCharacter + "," + thisLevel + ")");

			var thisParents = new Array();
			var numberParents = 0;
			
			thisComposition = textBetween(compositionData, thisCharacter + ":", ")");

			thisLeft = textBetween(thisComposition, "(", ",");
			thisRight = textBetween(thisComposition, ",", "end");
			
			if (thisLeft != "")
			{
				thisParents.push(thisLeft);
				numberParents = numberParents + 1;
				
				//if (isCharacter(thisLeft) == true)
				//{
					if (contains(genealogy, thisLeft) == false)
					{
						genealogy = genealogy + thisLeft + ",";
						
					} // end if the genealogy does not already contain thisLeft
				//} // end if thisLeft is a character
				
			} // end left
			
			if (thisRight != "")
			{
				thisParents.push(thisRight);
				numberParents = numberParents + 1;
				
				//if (isCharacter(thisRight) == true)
				//{
					if (contains(genealogy, thisRight) == false)
					{
						genealogy = genealogy + thisRight + ",";
						
					} // end if the genealogy does not already contain thisLeft
				//} // end if thisLeft is a character
				
			} // end right
			
			if (thisLeft == "")
			{
				if (thisRight == "")
				{
					if (thisCharacter != undefined)
					{
						if (contains(ancestors, thisCharacter) == false)
						{
							ancestors = ancestors + thisCharacter + ",";
							
							if (highestLevel < thisLevel)
							{
								highestLevel = thisLevel;
							} // end set the highest level
						} // end add to ancestors
					} // end if this character is undefined
					
				} // end if it has no right
			} // end if it has no left
			
			
			return thisParents;
			
		} // end function getParents
		
		function findChildren(thisCharacter)
		{
			//debugLog("findChildren(" + thisCharacter + ")");

			var numberLeft = 0;
			var numberRight = 0;
			
			var leftChildren = new Array();
			var rightChildren = new Array();
			var allChildren = new Array();
			
			var childCharacterLeftArray = compositionData.split(thisCharacter + ",");  

			for (var currentItem = 0; currentItem < childCharacterLeftArray.length; currentItem++)
			{
				var thisItem = childCharacterLeftArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
				
				leftChildren.push(thisChild);
				allChildren.push(thisChild);
								
				numberLeft = numberLeft + 1;
				
			} // end for every child character where startCharacter is on the left
			
			numberLeft = numberLeft - 1;
			

			var childCharacterRightArray = compositionData.split("," + thisCharacter);  

			for (var currentItem = 0; currentItem < childCharacterRightArray.length; currentItem++)
			{
				var thisItem = childCharacterRightArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
								
				rightChildren.push(thisChild);
				allChildren.push(thisChild);
				
			} // end for every child character where startCharacter is on the left

			numberRight = numberRight - 1;
			
			return allChildren;
			
		} // end function findChildren

		function fourHundredGenealogy()
		{
			//debugLog("fourHundredGenealogy");

			var theseCharacters = ["愛", "吧", "爸", "罷", "把", "八", "巴", "白", "佰", "半", "板", "搬", "幫", "抱", "包", "杯", "盃", "本", "比", "筆", "便", "病", "丙", "不", "布", "步", "才", "菜", "彩", "採", "草", "操", "茶", "常", "唱", "場", "晨", "池", "吃", "蟲", "出", "船", "穿", "窗", "吹", "春", "次", "從", "答", "大", "打", "當", "倒", "到", "稻", "的", "得", "等", "燈", "弟", "第", "低", "店", "掉", "碟", "蝶", "丁", "動", "洞", "冬", "東", "讀", "肚", "短", "對", "堆", "多", "兒", "二", "耳", "法", "房", "方", "粉", "分", "蜂", "服", "該", "糕", "個", "各", "哥", "歌", "給", "根", "共", "公", "功", "工", "狗", "故", "掛", "瓜", "光", "果", "哈", "孩", "害", "汗", "好", "和", "河", "禾", "喝", "很", "紅", "候", "後", "蝴", "忽", "畫", "話", "花", "換", "回", "會", "火", "級", "記", "己", "幾", "假", "甲", "加", "家", "件", "見", "叫", "教", "腳", "角", "交", "潔", "結", "姐", "接", "街", "今", "巾", "淨", "睛", "就", "九", "句", "看", "客", "課", "可", "肯", "空", "口", "哭", "塊", "快", "拉", "來", "老", "了", "樂", "冷", "力", "禮", "裏", "臉", "涼", "亮", "兩", "林", "留", "六", "綠", "落", "嗎", "媽", "慢", "滿", "忙", "毛", "帽", "貓", "沒", "妹", "每", "們", "蜜", "米", "棉", "名", "明", "木", "母", "拿", "男", "呢", "能", "泥", "你", "年", "牛", "女", "爬", "怕", "排", "拍", "旁", "朋", "匹", "片", "婆", "破", "氣", "七", "期", "前", "強", "橋", "親", "情", "晴", "請", "清", "球", "秋", "去", "全", "熱", "人", "認", "日", "容", "肉", "入", "三", "掃", "色", "扇", "山", "上", "少", "燒", "甚", "深", "勝", "升", "生", "聲", "十", "實", "時", "石", "事", "室", "是", "師", "手", "熟", "數", "樹", "耍", "刷", "誰", "睡", "水", "說", "四", "司", "算", "歲", "他", "她", "太", "談", "糖", "桃", "甜", "田", "條", "停", "聽", "同", "痛", "兔", "娃", "外", "完", "玩", "晚", "碗", "位", "尾", "問", "溫", "我", "物", "五", "午", "屋", "習", "細", "喜", "洗", "西", "下", "夏", "現", "先", "像", "向", "想", "校", "笑", "小", "寫", "些", "信", "心", "新", "行", "姓", "興", "星", "學", "呀", "牙", "燕", "眼", "羊", "樣", "搖", "要", "咬", "葉", "也", "冶", "易", "乙", "以", "已", "椅", "一", "衣", "應", "用", "油", "游", "又", "右", "友", "有", "元", "園", "圓", "月", "約", "再", "在", "早", "澡", "站", "張", "找", "爪", "著", "真", "正", "只", "指", "紙", "枝", "知", "種", "中", "竹", "住", "煮", "豬", "捉", "桌", "子", "字", "自", "仔", "姊", "走", "最", "昨", "作", "做", "坐", "左"];
			
			var numberCharacters = theseCharacters.length;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = theseCharacters[currentCharacter];
								
				getAncestors(thisCharacter, 10, 1);
			} // end for every character
			
			ancestors = ancestors + highestLevel;
			
			document.write(ancestors);
			
			return ancestors;
			
		} // end function fourHundredGenealogy

		function findGenealogy(thisCharacter)
		{
			//debugLog("findGenealogy(" + thisCharacter + ")");

			//var thisCharacter = "愛";
			//var thisCharacter = "高";
			
			ancestors = "";
			genealogy = "";
			
			findAncestors(thisCharacter, 10, 1);
			var thisAncestors = getAncestors();
			
			//var thisChildren = findChildren(thisCharacter);
			
			var thisGenealogy = getGenealogy();
			
			return thisGenealogy;
			
		} // end function findGenealogy

		function firstWord(thisString)
		{
			//debugLog("firstWord(" + thisString + ")");

			thisString = thisString.replace(/;/g, ',');
			thisString = thisString.replace(/ /g, ',');			
			
			var thisWord = textBetween(thisString, "start", ",");
			
			return thisWord;
		} // end function firstWord

		function insertButtonClicked()
		{
			//debugLog("insertButtonClicked");

			var thisCharacter = document.getElementById("startCharacter").value;
			var thisPinyin = document.getElementById("pinyin").innerHTML;
			var thisEnglish = firstWord(document.getElementById("definition").innerHTML);
			
			var thisPhrase = document.getElementById("thisPhrase").value;
			
			var thisPhraseLines = thisPhrase.split("\n");
			
			thisPhraseLines[0] = thisPhraseLines[0] + thisCharacter;
			
			if (thisPhraseLines[1] == undefined)
			{
				thisPhraseLines[1] = "";
			}
			
			thisPhraseLines[1] = thisPhraseLines[1] + thisPinyin + " ";

			if (thisPhraseLines[2] == undefined)
			{
				thisPhraseLines[2] = "";
			}
			
			thisPhraseLines[2] = thisPhraseLines[2] + thisEnglish + " ";
			
			thisPhrase = thisPhraseLines.join("\n");
			
			document.getElementById("thisPhrase").value = thisPhrase;
			
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			thisChinese = thisChinese + thisCharacter;
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
			document.getElementById("startCharacter").value = "";
			
			memoryPlus();
			
		} // end function addToPhrase

		function togglePinyinKeyboard()
		{
			//debugLog("togglePinyinKeyboard");

			var currentVisibility = document.getElementById("pinyinKeyboard").style.visibility;
			
			if (currentVisibility == "visible")
			{
				document.getElementById("pinyinKeyboard").style.visibility = "hidden";
				document.getElementById("pinyinKeyboard").style.height = "0px";
				document.getElementById("pinyinKeyboard").style.width = "0px";
			} else {
				document.getElementById("pinyinKeyboard").style.visibility = "visible";
				document.getElementById("pinyinKeyboard").style.height = "auto";
				document.getElementById("pinyinKeyboard").style.width = "auto";
			}
		} // end function togglePinyinKeyboard

		function toggleRadicalKeyboard()
		{
			//debugLog("toggleRadicalKeyboard");

			var currentVisibility = document.getElementById("radicalKeyboard").style.visibility;

			if (currentVisibility == "visible")
			{
				document.getElementById("radicalKeyboard").style.visibility = "hidden";
				document.getElementById("radicalKeyboard").style.height = "0px";
				document.getElementById("radicalKeyboard").style.width = "0px";
			} else {
				document.getElementById("radicalKeyboard").style.visibility = "visible";
				document.getElementById("radicalKeyboard").style.height = "auto";
				document.getElementById("radicalKeyboard").style.width = "auto";
			}
		} // end function toggleRadicalKeyboard
		
		function toggleDecomposeBopomofoKeyboard()
		{
			//debugLog("toggleDecomposeBopomofoKeyboard");

			var currentVisibility = document.getElementById("decomposeBopomofoKeyboard").style.visibility;

			if (currentVisibility == "visible")
			{
				document.getElementById("decomposeBopomofoKeyboard").style.visibility = "hidden";
				document.getElementById("decomposeBopomofoKeyboard").style.height = "0px";
				document.getElementById("decomposeBopomofoKeyboard").style.width = "0px";
			} else {
				document.getElementById("decomposeBopomofoKeyboard").style.visibility = "visible";
				document.getElementById("decomposeBopomofoKeyboard").style.height = "auto";
				document.getElementById("decomposeBopomofoKeyboard").style.width = "auto";
			}
		} // end function decomposeBopomofoKeyboard
		
		
		
		function clearLocalStorage()
		{
			//debugLog("clearLocalStorage");

			localStorage["phrase"] = "";
			
		} // end function clearLocalStorage
		
		function saveToLocalStorage(key, thisText)
		{
			//debugLog("saveToLocalStorage(" + key + "," + thisText + ")");
			
			var oldText = localStorage[key];
			
			if (oldText == undefined)
			{
				oldText = "";
			}
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				//appendToFile(key + ".txt", thisText);
				localStorage[key] = oldText + thisText + "\n";
			} else {
				localStorage[key] = oldText + thisText + "\n";
			}
		} // end function saveToLocalStorage
		
		function memoryPlus()
		{
			//debugLog("memoryPlus");

			var thisPhrase = document.getElementById("chineseTextArea").value;
			
			var thisKey = "phrase";
			
			saveToLocalStorage(thisKey, thisPhrase);
			
		} // end function memoryPlus

		function loadFromLocalStorage()
		{
			//debugLog("loadFromLocalStorage");

			document.getElementById("chineseTextArea").value = localStorage["phrase"];
		} // end function load

		function clearButtonClicked()
		{
			//debugLog("clearButtonClicked");

			document.getElementById("chineseTextArea").value = "";
			document.getElementById("englishTextArea").value = "";

			//document.getElementById("startCharacter").value = "";
		} // end function clear

		function copyToTranslator()
		{
			//debugLog("copyToTranslator");

			var thisText = document.getElementById("thisPhrase").value;
			
			var thisTextArray = thisText.split("\n");
			
			var thisChinese = thisTextArray[0];
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
			deradicalizeButtonClicked();
			
			wordSpaceButtonClicked();
			
			translateBilingualInterface();
		} // end function copyToTranslator

		function buildMatrix(thisPhrase)
		{
			//debugLog("buildMatrix(" + thisPhrase + ")");

			var thisPhraseArray = stringToCharacterArray(thisPhrase);
			
			var numberCharacters = thisPhraseArray.length;
			
			var thisPhraseGenealogies = new Array();
			
			var matrixHtml = "";
			
			var longestGenealogy = 0;
			
			
			
			// Create spaces for the drops in the table
			matrixHtml = matrixHtml + "<tr>";
			
			for (var currentColumn = 0; currentColumn < numberCharacters; currentColumn++)
			{
				matrixHtml = matrixHtml + "<td><p id=\"dropP" + currentColumn + "\"><table id=\"dropTable" + currentColumn + "\"></table></p></td>";				
			}
			
			matrixHtml = matrixHtml + "</tr></table>";

			var matrixTable = document.getElementById("matrix");
			matrixTable.innerHTML = matrixHtml;
			
			
			
			
			// Build the genealogies
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisPhraseArray[currentCharacter];
				var thisGenealogy = textBetween(genealogiesData, thisCharacter + " ", "\n");
				
				// If there's no genealogy data, figure it out
				if (thisGenealogy == "")
				{
					findGenealogy(thisCharacter);
					thisGenealogy = getGenealogy();
				}
				
				thisGenealogy = thisCharacter + "," + thisGenealogy;
				
				var thisGenealogyArray = thisGenealogy.split(",");
				
				var cleanGenealogy = "";
				var genealogyLength = 0;
				
				for (var currentGenealogyCharacter = 0; currentGenealogyCharacter < thisGenealogyArray.length; currentGenealogyCharacter++)
				{
					var thisGenealogyCharacter = thisGenealogyArray[currentGenealogyCharacter];
					
					if (isChinese(thisGenealogyCharacter) == true)
					{
						cleanGenealogy = cleanGenealogy + thisGenealogyCharacter + ",";
						genealogyLength = genealogyLength + 1;
					}
				} // end filter only real characters in the genealogy
				
				
				if (longestGenealogy < genealogyLength)
				{
					longestGenealogy = genealogyLength;
				}
				
				thisPhraseGenealogies.push(cleanGenealogy);
				
				//alert(cleanGenealogy);
				
			} // end for every character
			
			
			// New algorithm idea: generate a one-column table for each drop (thisPhraseGenealogies.pop), and display within a larger multi-column table of all drops. 
						
			matrixHtml = matrixHtml + "<table><tr>";
			
			var numberRows = longestGenealogy - 1;
			numberColumns = numberCharacters;
			
			for (var currentColumn = 0; currentColumn < numberColumns; currentColumn++)
			{
			
				var dropHtml = "";
			
				var thisGenealogy = thisPhraseGenealogies[currentColumn];
			
				for (var currentRow = 0; currentRow <= numberRows; currentRow++)
				{
					dropHtml = dropHtml + "<tr><td>";
				
					var inverseRow = numberRows - currentRow;
					
					var thisGenealogyArray = thisGenealogy.split(",");
					
					var thisGenealogyLength = thisGenealogyArray.length;
					
					if (thisGenealogyLength > inverseRow)
					{
						var thisCharacter = thisGenealogyArray[inverseRow];

						var rowProportion = inverseRow / thisGenealogyLength;
				
						var colourRow = Math.floor(12 * rowProportion) + 3;
						var thisColour = "#00FF00";
						
						colourRow = 16 - colourRow;
				
						//123,456,789,ABC,DEF
						switch (colourRow)
						{
							case 15: thisColour = "#00FF00"; break;
							case 14: thisColour = "#00EE00"; break;
							case 13: thisColour = "#00DD00"; break;
							case 12: thisColour = "#00CC00"; break;
							case 11: thisColour = "#00BB00"; break;
							case 10: thisColour = "#00AA00"; break;
							default: thisColour = "#00" + colourRow + colourRow + "00"; break;
						}
						
						if (thisCharacter == "")
						{
							dropHtml = dropHtml + "&nbsp;";
							
						} else {

						
							if (currentRow < numberRows)
							{
								dropHtml = dropHtml + "<div class=\"row" + colourRow + "\" style=\"color: " + thisColour + ";\">";
							} else {
								dropHtml = dropHtml + "<div class=\"row" + colourRow + "\" style=\"color: #EEEEEE;\">";
							}
						
						
							dropHtml = dropHtml + thisCharacter;
							
							dropHtml = dropHtml + "</div>";
							
						} // end if this character is not blank
						
						
					} else {
						
						dropHtml = dropHtml + "&nbsp;";
						
					}// end if the genealogy is long enough
					
					dropHtml = dropHtml + "</td></tr>";

				} // end for every row
							
				var dropTable = document.getElementById("dropTable" + currentColumn);
				dropTable.innerHTML = dropHtml;
				
				var dropP = document.getElementById("dropP" + currentColumn);
				dropP.className += "load";

			} // end for every column
			
			/*
			var numberRows = longestGenealogy - 1;
			
			numberColumns = numberCharacters;
			
			for (var currentRow = 0; currentRow <= numberRows; currentRow++)
			{
				var inverseRow = numberRows - currentRow;
							
				matrixHtml = matrixHtml + "<tr>";
			
				for (var currentColumn = 0; currentColumn < numberColumns; currentColumn++)
				{
					var thisGenealogy = thisPhraseGenealogies[currentColumn];
					
					matrixHtml = matrixHtml + "<td>";
					
					var thisGenealogyArray = thisGenealogy.split(",");
					
					var thisGenealogyLength = thisGenealogyArray.length;
					
					if (thisGenealogyLength > inverseRow)
					{
						var thisCharacter = thisGenealogyArray[inverseRow];

						var rowProportion = inverseRow / thisGenealogyLength;
				
						var colourRow = Math.floor(12 * rowProportion) + 3;
						var thisColour = "#00FF00";
						
						colourRow = 16 - colourRow;
				
						//123,456,789,ABC,DEF
						switch (colourRow)
						{
							case 15: thisColour = "#00FF00"; break;
							case 14: thisColour = "#00EE00"; break;
							case 13: thisColour = "#00DD00"; break;
							case 12: thisColour = "#00CC00"; break;
							case 11: thisColour = "#00BB00"; break;
							case 10: thisColour = "#00AA00"; break;
							default: thisColour = "#00" + colourRow + colourRow + "00"; break;
						}
				
						if (currentRow < numberRows)
						{
							matrixHtml = matrixHtml + "<div class=\"row" + colourRow + "\" style=\"color: " + thisColour + ";\">";
						} else {
							matrixHtml = matrixHtml + "<div class=\"row" + colourRow + "\" style=\"color: #EEEEEE;\">";
						}

						matrixHtml = matrixHtml + thisCharacter;
						
						matrixHtml = matrixHtml + "</div>";
						
						
					} // end if the genealogy is long enough
					
					matrixHtml = matrixHtml + "</td>";
					
				} // end for every column
				
				matrixHtml = matrixHtml + "</tr>";
				
			} // end for every row
			*/
			
			// Hide all rows
			/*
			for (var currentColour = 0; currentColour <= 16; currentColour = currentColour + 1)
			{
				var rowName = "row" + currentColour;
			
				var thisColourCells = document.getElementsByClassName(rowName);
				
				var numberCells = thisColourCells.length;
				
				for (var currentCell = 0; currentCell < numberCells; currentCell = currentCell + 1) 
				{
					thisColourCells[currentCell].style.visibility = "hidden";
				}
			} // end for every row
			*/
			
			// Show rows slowly
			//showRow(0);
			
			//console.log(thisPhraseGenealogies);

			
		} // end function buildMatrix

		function showRow(currentColour)
		{
			//debugLog("showRow(" + currentColour + ")");
		
			var rowName = "row" + currentColour;
			
			var thisColourCells = document.getElementsByClassName(rowName);
				
			var numberCells = thisColourCells.length;
				
			for (var currentCell = 0; currentCell < numberCells; currentCell = currentCell + 1) 
			{
				thisColourCells[currentCell].style.visibility = "visible";
			}
			
			//alert(rowName);
			
			currentColour = currentColour + 1;
			
			if (currentColour <= 16)
			{
				setTimeout(showRow(currentColour),1000); 		
			}
			
		} // end function showRow

		function matrixButtonClicked()
		{
			//debugLog("matrixButtonClicked");

			var thisText = document.getElementById("chineseTextArea").value;
			
			var thisTextArray = thisText.split("\n");
			
			var thisChinese = thisTextArray[0];
			
			buildMatrix(thisChinese);
			
			
			
		} // end function matrixButtonClicked
		
		function b64EncodeUnicode(str) 
		{
			//debugLog("b64EncodeUnicode(" + str + ")");

	    	return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, 
	    		function(match, p1) 
	    		{
	        		return String.fromCharCode('0x' + p1);
    			}));
		} // end function b64EncodeUnicode
		
		function printButtonClicked()
		{
			//debugLog ("printButtonClicked");

			var thisString = document.getElementById("outputHtml").innerHTML;
			
			thisString = replaceChars(thisString, "<p></p>", "</div><p></p><div class=\"pingtypeBlock\">");
			
			var htmlHeaders = "<!DOCTYPE html>\n<html>\n  <head>\n	<meta charset=\"utf-8\" />\n        <style>\n\n@font-face {\n    font-family: \"Charcoal CY\";\n    src: url(\"fonts/Charcoal.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Virtue\";\n    src: url(\"fonts/virtue.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"SimSun\";\n    src: url(\"fonts/SimSun.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Jhenghei\";\n    src: url(\"fonts/MicrosoftJhengHeiRegular.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"PingfangLocal\";\n    src: local(\"PingFang-TC-Regular\");\n}\n\n@font-face {\n    font-family: \"Pingfang\";\n    src: url(\"fonts/PingFang1.ttf\") format(\"truetype\");\n}\n\n      body {\n        font-family: Tahoma, Geneva, sans-serif;\n      }\n      \n      table td {\n      white-space: nowrap;\n      }\n		\n	a:hover, a:visited, a:link, a:active\n	{\n		color:#000000;\n	    text-decoration: none;\n	}\n		\n      .chinese_1 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .chinese_2 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_3 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_4 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_5 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_6 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_7 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n      \n      .chinese_8 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n      .pinyin_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .pinyin_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\ndisplay:inline;\n      }\n\n      .pinyin_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\ndisplay:inline;\n      }\n\n      .pinyin_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .pinyin_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .taiwanese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#797986;\n		display:inline;\n      }\n\n      .taiwanese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .taiwanese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .taiwanese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#505050;\ndisplay:inline;\n      }\n\n      .taiwanese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .taiwanese_7 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n      \n      .taiwanese_8 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#707070;\ndisplay:inline;\n      }\n\n      .cantonese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#929292;\n		display:inline;\n      }\n\n      .cantonese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#FF8080;\ndisplay:inline;\n      }\n\n      .cantonese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#797986;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .cantonese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .cantonese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .cantonese_6 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .hangul {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 26px;\n		display:inline;\n      }\n\n      .tang {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .japanese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .vietnamese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .englishInChinese {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .literal {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .english {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n\n		.DefaultButtonOuter\n		{\n			border: 2px solid black ;\n			border-radius: 8px;\n			width: 96px;\n			height: 26px;\n			text-align: center;\n			\n			/*background-color: #99999a;*/\n			background: #99999a; /* For browsers that do not support gradients */\n			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */\n			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */\n			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */\n			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */\n		}\n\n		.ButtonInner\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 88px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: \"Charcoal CY\", \"Virtue\", Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n		\n		.ButtonInner:active\n		{\n		    background:#666666;\n		    color: #ffffff;\n		}\n\n		.key\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 18px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n\n\n			#matrix {\n				background: black;\n				float: center;\n			}\n\n			#matrix td {\n			    padding: 7px;\n    			margin: 0px;\n    			float: center;\n				background: black;\n				font: 54px arial;\n				\n				height: 80px;\n			}\n\n			#matrix tr {\n				height: 80px;\n			}\n\n\n			#matrix p {\n			    opacity: 0;\n			    margin-top: -25px;\n			    text-align: center;\n\n				height: 80px;\n\n			    -webkit-transition: margin-top 2s ease-in;\n			    -moz-transition: margin-top 2s ease-in;\n			    -o-transition: margin-top 2s ease-in;\n			    -ms-transition: margin-top 2s ease-in;\n			    transition: margin-top 2s ease-in;\n			}\n			\n			#matrix p.load {\n			    opacity: 1;\n			    margin-top: 25px;\n			}\n\n     .dialogWithDropShadow\n     {\n         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);\n         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); \n     }\n\n@font-face {\n    font-family: \"SmallSealScript\";\n    src: url(\"fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf\") format(\"truetype\");\n}\n\n      .smallSealScript_1 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .smallSealScript_2 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_3 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_4 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n@font-face {\n    font-family: \"LargeSealScript\";\n    src: url(\"fonts/JDFZHUANF.ttf\") format(\"truetype\");\n}\n\n      .largeSealScript_1 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .largeSealScript_2 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_3 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_4 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n@font-face {\n    font-family: \"OracleBones\";\n    src: url(\"fonts/bnujgw.ttf\") format(\"truetype\");\n}\n\n      .oracleBones_1 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .oracleBones_2 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_3 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_4 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n		.pingtypeBlock {\n			break-inside: avoid;\n		}\n\n\n    </style>\n\n  </head>\n  <body>\n	";
			
			var htmlFooters = "\n  </body>\n</html>\n";
			
			// Pingtype is a literal translator for Chinese. Pingtype 是 一個 中文 詞彙 翻譯. 
			var thisHtml = htmlHeaders + thisString + htmlFooters;
			
			document.write(thisHtml);
			
			var thisHtmlBase64 = b64EncodeUnicode(thisHtml);
			//window.open("data:text/html;charset=UTF-8;base64," + thisHtmlBase64,'_blank');
			
		} // end function printButtonClicked
		
		function removeTones(thisString)
		{
			var vowels = ["a", "e", "i", "o", "u"];
			var tonesUp = ["á", "é", "í", "ó", "ú"];
			var tonesDown = ["à", "è", "ì", "ò", "ù"];
			var tonesDownUp = ["ǎ", "ě", "ǐ", "ǒ", "ǔ"];
			var tonesFlat = ["ā", "ē", "ī", "ō", "ū"];

			thisString = replaceChars(thisString, "0", "");
			thisString = replaceChars(thisString, "1", "");
			thisString = replaceChars(thisString, "2", "");
			thisString = replaceChars(thisString, "3", "");
			thisString = replaceChars(thisString, "4", "");
			thisString = replaceChars(thisString, "5", "");
			thisString = replaceChars(thisString, "6", "");
			thisString = replaceChars(thisString, "7", "");
			thisString = replaceChars(thisString, "8", "");
			thisString = replaceChars(thisString, "9", "");

			
			thisString = replaceChars(thisString, "ń", "n");
			thisString = replaceChars(thisString, "ế", "e");
			thisString = replaceChars(thisString, "ǘ", "u");
			thisString = replaceChars(thisString, "ń", "n");
			thisString = replaceChars(thisString, "ḿ", "m");
			thisString = replaceChars(thisString, "ề", "e");
			thisString = replaceChars(thisString, "ǜ", "u");
			thisString = replaceChars(thisString, "ǹ", "n");
			thisString = replaceChars(thisString, "̀", "");
			thisString = replaceChars(thisString, "ǎ", "a");
			thisString = replaceChars(thisString, "ê", "e");
			thisString = replaceChars(thisString, "ě", "e");
			thisString = replaceChars(thisString, "ǐ", "i");
			thisString = replaceChars(thisString, "ǒ", "o");
			thisString = replaceChars(thisString, "ǚ", "u");
			thisString = replaceChars(thisString, "ň", "n");
			thisString = replaceChars(thisString, "ê", "e");
			thisString = replaceChars(thisString, "ü", "u");
			thisString = replaceChars(thisString, "â", "a");
			thisString = replaceChars(thisString, "ä", "a");
			thisString = replaceChars(thisString, "ã", "a");
			thisString = replaceChars(thisString, "ç", "c");
			thisString = replaceChars(thisString, "ê", "e");
			thisString = replaceChars(thisString, "ë", "e");
			thisString = replaceChars(thisString, "ĥ", "h");
			thisString = replaceChars(thisString, "î", "i");
			thisString = replaceChars(thisString, "ⁿ", "n");
			thisString = replaceChars(thisString, "ń", "n");
			thisString = replaceChars(thisString, "ó", "o");
			thisString = replaceChars(thisString, "ò", "o");
			thisString = replaceChars(thisString, "ô", "o");
			thisString = replaceChars(thisString, "ö", "o");
			thisString = replaceChars(thisString, "õ", "o");
			thisString = replaceChars(thisString, "ō", "o");
			thisString = replaceChars(thisString, "ŝ", "s");
			thisString = replaceChars(thisString, "û", "u");
			thisString = replaceChars(thisString, "ü", "u");
			thisString = replaceChars(thisString, "ý", "y");
			thisString = replaceChars(thisString, "̄", "");
			thisString = replaceChars(thisString, "̄", "");

			thisString = replaceChars(thisString, "ǚ", "u");
			thisString = replaceChars(thisString, "ǒ", "o");
			thisString = replaceChars(thisString, "ǐ", "i");

			thisString = replaceChars(thisString, "̂", "");			
			thisString = replaceChars(thisString, "̀", "");			
			thisString = replaceChars(thisString, "́", "");			
			thisString = replaceChars(thisString, "̍", "");			
			thisString = replaceChars(thisString, "̤", "");			
			
			var numberTones = vowels.length;
			
			for (var currentTone = 0; currentTone < numberTones; currentTone++)
			{
				var thisVowel = vowels[currentTone];
				
				var thisTone = tonesUp[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);
				
				thisTone = tonesDown[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);

				thisTone = tonesDownUp[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);

				thisTone = tonesFlat[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);
			} // end for every tone
			
			return thisString;
			
		} // end function removeTones
		
		function getTones(thisString)
		{
			var tonesUp = ["á", "é", "í", "ó", "ú", "ế", "ǘ", "ń", "ḿ"];
			var tonesDown = ["à", "è", "ì", "ò", "ù", "ề", "ǜ", "ǹ", "̀"];
			var tonesDownUp = ["ǎ", "ě", "ǐ", "ǒ", "ǔ", "ǎ", "ê̌", "ě", "ǐ", "ǒ", "ǚ", "ň"];
			var tonesFlat = ["ā", "ē", "ī", "ō", "ū", "ê", "ü", "̄", "̄"];
		
			if (thisString == undefined)
			{
				return 1;
			}
			
			thisString = replaceChars(thisString, "a", "");
			thisString = replaceChars(thisString, "b", "");
			thisString = replaceChars(thisString, "c", "");
			thisString = replaceChars(thisString, "d", "");
			thisString = replaceChars(thisString, "e", "");
			thisString = replaceChars(thisString, "f", "");
			thisString = replaceChars(thisString, "g", "");
			thisString = replaceChars(thisString, "h", "");
			thisString = replaceChars(thisString, "i", "");
			thisString = replaceChars(thisString, "j", "");
			thisString = replaceChars(thisString, "k", "");
			thisString = replaceChars(thisString, "l", "");
			thisString = replaceChars(thisString, "m", "");
			thisString = replaceChars(thisString, "n", "");
			thisString = replaceChars(thisString, "o", "");
			thisString = replaceChars(thisString, "p", "");
			thisString = replaceChars(thisString, "q", "");
			thisString = replaceChars(thisString, "r", "");
			thisString = replaceChars(thisString, "s", "");
			thisString = replaceChars(thisString, "t", "");
			thisString = replaceChars(thisString, "u", "");
			thisString = replaceChars(thisString, "v", "");
			thisString = replaceChars(thisString, "w", "");
			thisString = replaceChars(thisString, "x", "");
			thisString = replaceChars(thisString, "y", "");
			thisString = replaceChars(thisString, "z", "");
			thisString = replaceChars(thisString, " ", "");

			return thisString;
			
		} // end function getTones
		
		function toggleCheckbox(checkboxId)
		{
			//debugLog("toggleCheckbox");

			document.getElementById(checkboxId).checked = !document.getElementById(checkboxId).checked;
		} // end function toggleCheckbox
		
		function taiwaneseCheckboxClicked(checkboxId)
		{
			//debugLog("taiwaneseCheckboxClicked");
			
			var newState = !document.getElementById(checkboxId).checked;
			
			document.getElementById(checkboxId).checked = newState;
			
			if (newState == true)
			{
				document.getElementById("pinyinCheckbox").checked = false;
			} else {
				document.getElementById("pinyinCheckbox").checked = true;
			}
		
		} // end function taiwaneseCheckboxClicked
		
		function hakkaCheckboxClicked(checkboxId)
		{
			//debugLog("hakkaCheckboxClicked");
			
			var newState = !document.getElementById(checkboxId).checked;
			
			document.getElementById(checkboxId).checked = newState;
			
			if (newState == true)
			{
				document.getElementById("pinyinCheckbox").checked = false;
			} else {
				document.getElementById("pinyinCheckbox").checked = true;
			}
		
		} // end function hakkaCheckboxClicked

		
		function toggleReviewingTheHanzi(checkboxId)
		{
			//debugLog("toggleReviewingTheHanzi");
			
			var isChecked = document.getElementById(checkboxId).checked;
		
			document.getElementById(checkboxId).checked = !isChecked;
			
			if (isChecked == false)
			{
				if (reviewingTheHanziData == "\n")
				{
					loadReviewingTheHanzi("ReviewingTheHanzi.txt");
				}
			}
			
		} // end function toggleReviewingTheHanzi
		
		function containsSimplified()
		{
			//debugLog("containsSimplified");
		
			var thisText = document.getElementById("chineseTextArea").value;
			
			numberCharacters = stringLength(thisText);

			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisText[currentCharacter];
				if (thisCharacter != "\n")
				{
					if (contains(simplifiedCharacters, thisCharacter))
					{
						//alert(thisCharacter+" is simplified");
						return true;
					} // end if it contains a simplified character
				}
			} // end for every character
			
			return false;
		} // 
		
		
		function translateButtonClicked()
		{
			//debugLog("translateButtonClicked");
			var addSimplified = false;
			
			if ((QueryString.chineseFile == "") && (QueryString.chineseFile == undefined))
			{
				addSimplified = containsSimplified();
			}
			
			
			if (addSimplified == true)
			{
				document.getElementById('simplifiedSpacedCheckbox').checked = true;
				
				// If we have simplified characters, make sure we loaded everything
				if ((QueryString.simplified == "") || (QueryString.simplified == undefined))
				{
					window.location = "index.html?simplified=" + document.getElementById("chineseTextArea").value;
				}
				
				// Click the button
				simplifiedToTraditionalButtonClicked();
			}

			deradicalizeButtonClicked();
			wordSpaceButtonClicked();
			
			if (addSimplified == true)
			{
				spacedToSimplifiedButtonClicked();
			}
			
			var thisEnglish = document.getElementById("englishTextArea").value;
			
			if (thisEnglish == "")
			{
				translateBilingualInterface();			
			} else {
				translateInterface();
			}
			
			if (commonWords != "")
			{
				//var addCommon = true;
				
				commonStatistics();
				
			} // end if we should count common words
			
			// Load Pingfang slower
			updateFont();
			
			var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;
			if (addTaiwanese == true)
			{
				taiwaneseColours();
			} // end if addTaiwanese

			var addCantonese = document.getElementById('cantoneseCheckbox').checked;
			addCantonese = true;
			if (addCantonese == true)
			{
				cantoneseColours();
			} // end if addCantonese
			
			var addHakka = document.getElementById('hakkaCheckbox').checked;
			if (addHakka == true)
			{
				hakkaColours();
			} // end if addHakka

		} // end function translateButtonClicked
		
		function commonStatistics()
		{
			//debugLog(commonStatistics);

			var thisSpaced = document.getElementById("chineseSpacedTextArea").value;
			thisSpaced = thisSpaced.split(" ");
			var numberWords = thisSpaced.length;
		   
			var uniqueWordsArray = [];
			var commonWordsUniqueArray = [];
			var commonWordsTotalArray = [];
		   
			var totalWords = 0;
		   
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisSpaced[currentWord];
			   
				if (isChineseString(thisWord) == true)
				{
					if (contains(uniqueWordsArray,thisWord) == false)
					{
						uniqueWordsArray.push(thisWord);
					} // if the word is new

					if (contains(commonWords,thisWord) == true)
					{
						if (contains(commonWordsUniqueArray,thisWord) == false)
						{
							commonWordsUniqueArray.push(thisWord);
						}
				   
						commonWordsTotalArray.push(thisWord);
					} // end if the word is common
				   
					totalWords = totalWords + 1;
				   
				} // if the word is Chinese
			   
			} // end for every word
			
			//debugLog(commonWordsUniqueArray.join(" "));
		   
			var commonWordsTotal = commonWordsTotalArray.length - 1;
			var commonWordsUnique = commonWordsUniqueArray.length - 1;
			var uniqueWordsCount = uniqueWordsArray.length - 1;
		   
			var commonPercentTotal = Math.floor((commonWordsTotal / totalWords) * 100);
			var commonPercentUnique = Math.floor((commonWordsUnique / uniqueWordsCount) * 100);
		   
			var commonPercent = commonWordsTotal + "/" + totalWords + " = " + commonPercentTotal + "% Total";
			commonPercent = commonPercent + ", " + commonWordsUnique + "/" + uniqueWordsCount + " = " + commonPercentUnique + "% Unique";
			document.getElementById("wordListPercent").innerHTML = commonPercent;
			
		} // end function commonStatistics
		
		function setPinyinOpacity()
		{
			//debugLog("setPinyinOpacity");

			var pinyinOpacityPercent = document.getElementById("pinyinOpacity").value;
			
			var pinyinOpacityValue = pinyinOpacityPercent / 100;
			
			var theseClasses = "pinyin_1,pinyin_2,pinyin_3,pinyin_4,pinyin_5".split(",");
			
			var numberClasses = theseClasses.length;
			
			for (var currentClass = 0; currentClass < numberClasses; currentClass++)
			{
				var thisClass = theseClasses[currentClass];
			
				var theseElements = document.getElementsByClassName(thisClass);
			
				var numberElements = theseElements.length;
			
				for (var currentElement = 0; currentElement < numberElements; currentElement++)
				{
					var thisElement = theseElements[currentElement];
					thisElement.style.opacity = pinyinOpacityValue;
				} // end for every element
				
			} // end for every class

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
			var linkSliders = document.getElementById("linkSlidersCheckbox").checked;
			
			if (linkSliders == true)
			{
				document.getElementById("literalOpacity").value = pinyinOpacityPercent;
				setLiteralOpacity();
				
				document.getElementById("englishOpacity").value = pinyinOpacityPercent;
				setEnglishOpacity();
			}
			
		} // end function setPinyinOpacity

		function setLiteralOpacity()
		{
			//debugLog("setLiteralOpacity");

			var literalOpacityPercent = document.getElementById("literalOpacity").value;
			
			var literalOpacityValue = literalOpacityPercent / 100;
			
			var thisClass = "literal";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.opacity = literalOpacityValue;
			} // end for every element

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
		} // end function setLiteralOpacity

		function setEnglishOpacity()
		{
			//debugLog("setEnglishOpacity");

			var englishOpacityPercent = document.getElementById("englishOpacity").value;
			
			var englishOpacityValue = englishOpacityPercent / 100;
			
			var thisClass = "english";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.opacity = englishOpacityValue;
			} // end for every element

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
		} // end function setEnglishOpacity
		
		function debugLog(thisString)
		{
			document.getElementById("debugTextArea").value = document.getElementById("debugTextArea").value + thisString + "\n";
		} // end function debugLog
		
		function googleTranslatePhraseButtonClicked()
		{
			//debugLog("googleTranslateButtonClicked");
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');
		} // end function googleTranslatePhraseButtonClicked

		function googleTranslateWordsButtonClicked()
		{
			//debugLog("googleTranslateButtonClicked");
			var thisChinese = document.getElementById("dictionaryAddArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');
		} // end function googleTranslateWordsButtonClicked
		
		function dictionaryEditorGoogleTranslateButtonClicked()
		{
			//debugLog("dictionaryEditorGoogleTranslateButtonClicked");
			var thisChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');

		} // end function dictionaryEditorGoogleTranslateButtonClicked
		
		function dictionaryEditorGoogleTransPyButtonClicked()
		{
			var thisChinese = "";
			
			thisChinese = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisChinese == "")
			{
				thisChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
			}
			
			loadGoogleTransPy(thisChinese);
			
		} // end function dictionaryEditorGoogleTransPyButtonClicked
		
		function dictionaryEditorGoogleTransProxyButtonClicked()
		{
			var thisChinese = "";
			
			thisChinese = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisChinese == "")
			{
				thisChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
			}
			
			loadGoogleTransProxy(thisChinese);
		} // end function dictionaryEditorGoogleTransProxyButtonClicked
		
		function drawGenealogyButtonClicked()
		{
			//debugLog("drawGenealogyButtonClicked");

			var thisCharacter = document.getElementById("startCharacter").value;
		
			var turtleSheetUrl = "turtlesheet.html?command=drawGenealogy(%22" + thisCharacter + "%22);"
			
			window.open(turtleSheetUrl,'_blank');
		
		} // end function drawGenealogyButtonClicked
		
		function setClass(oldClass, newClass)
		{
			//debugLog("setClass(" + oldClass + ", " + newClass + ")");
			
			var theseElements = document.getElementsByClassName(oldClass);
			
			var numberElements = theseElements.length;
			
			//debugLog(oldClass + " has " + numberElements);
			
			if (numberElements > 0)
			{
				for (var currentElement = 0; currentElement < numberElements; currentElement++)
				{
					var thisElement = theseElements[currentElement];
					
					if (thisElement != undefined)
					{
						//debugLog("thisElement: " + thisElement);
					
						if (thisElement.classList)
						{
							thisElement.classList.add(newClass);
						} else {
							thisElement.className += ' ' + newClass;
						}
					
						//thisElement.className = newClass;
					
					} // end if the element is not undefined
				} // end for every element
			} // end if there are elements

		} // end function setClass

		function setFonts(oldClasses, newClasses)
		{
			//debugLog("setFonts(oldClasses, newClasses)");
			
			var numberClasses = newClasses.length;
			
			for (var currentClass = 0; currentClass < numberClasses; currentClass++)
			{
				var newClass = newClasses[currentClass];

				var oldClass = oldClasses[currentClass];
				
				setClass(oldClass, newClass);
				
			} // end for every class
			
		} // end function setFonts
		
		function updateFont()
		{
			//debugLog("updateFont");
		
			var stylesheet = loadCSS( "chineseFontsLoaded.css" );
			onloadCSS( stylesheet, function() {
				//debugLog( "Stylesheet has loaded." );
			});
			
			var oldClasses = ["chinese_1","chinese_2","chinese_3","chinese_4","chinese_5","chinese_6","chinese_7", "chinese_8"];
			var newClasses = ["chinese_1_loaded","chinese_2_loaded","chinese_3_loaded","chinese_4_loaded","chinese_5_loaded","chinese_6_loaded","chinese_7_loaded", "chinese_8_loaded"];
			
			setFonts(oldClasses, newClasses);
		} // end updateFont
		
		function setColour(thisClass, thisColour)
		{
			//debugLog("setColour(" + thisColour + ", " + thisClass + ")");
			
			var theseElements = document.getElementsByClassName(thisClass);
		
			var numberElements = theseElements.length;
			
			//debugLog(thisClass + " has " + numberElements);
			
			if (numberElements > 0)
			{
				for (var currentElement = 0; currentElement < numberElements; currentElement++)
				{
					var thisElement = theseElements[currentElement];
					
					if (thisElement != undefined)
					{
						thisElement.style.color = thisColour;
						
					} // end if the element is not undefined
				} // end for every element
			} // end if there are elements

		} // end function setColour
		
		function setColours(theseClasses, theseColours)
		{
			//debugLog("setColours(theseColours, theseClasses)");
			
			var numberColours = theseColours.length;
			
			for (var currentColour = 0; currentColour < numberColours; currentColour++)
			{
				var thisColour = "#" + theseColours[currentColour];

				var thisClass = theseClasses[currentColour];
				
				setColour(thisClass, thisColour);
				
			} // end for every class
			
		} // end function setColours
		
		function updateColours()
		{
			//debugLog("updateColours");
			
			var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
			var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
			var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
			var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
			var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
			var chineseColourSix = document.getElementById("chineseColourPickerSix").value;
			var chineseColourSeven = document.getElementById("chineseColourPickerSeven").value;
			var chineseColourEight = document.getElementById("chineseColourPickerEight").value;
			
			var theseClasses = ["chinese_1","chinese_2","chinese_3","chinese_4","chinese_5","chinese_6","chinese_7", "chinese_8"];
			var theseColours = [chineseColourOne, chineseColourTwo, chineseColourThree, chineseColourFour, chineseColourFive, chineseColourSix, chineseColourSeven, chineseColourEight];
			
			setColours(theseClasses, theseColours);
			
			var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
			var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
			var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
			var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
			var pinyinClasses = ["pinyin_1","pinyin_2","pinyin_3","pinyin_4"];
			
			theseClasses = ["pinyin_1","pinyin_2","pinyin_3","pinyin_4"];
			theseColours = [pinyinColourOne, pinyinColourTwo, pinyinColourThree, pinyinColourFour];
			
			setColours(theseClasses, theseColours);
			
			var taiwaneseColourOne = document.getElementById("taiwaneseColourPickerOne").value;
			var taiwaneseColourTwo = document.getElementById("taiwaneseColourPickerTwo").value;
			var taiwaneseColourThree = document.getElementById("taiwaneseColourPickerThree").value;
			var taiwaneseColourFour = document.getElementById("taiwaneseColourPickerFour").value;
			var taiwaneseColourFive = document.getElementById("taiwaneseColourPickerFive").value;
			var taiwaneseColourSeven = document.getElementById("taiwaneseColourPickerSeven").value;
			var taiwaneseColourEight = document.getElementById("taiwaneseColourPickerEight").value;
			
			theseClasses = ["taiwanese_1","taiwanese_2","taiwanese_3","taiwanese_4","taiwanese_5","taiwanese_7","taiwanese_8"];
			theseColours = [taiwaneseColourOne, taiwaneseColourTwo, taiwaneseColourThree, taiwaneseColourFour, taiwaneseColourFive, taiwaneseColourSeven, taiwaneseColourEight];
			
			setColours(theseClasses, theseColours);
			
			var cantoneseColourOne = document.getElementById("cantoneseColourPickerOne").value;
			var cantoneseColourTwo = document.getElementById("cantoneseColourPickerTwo").value;
			var cantoneseColourThree = document.getElementById("cantoneseColourPickerThree").value;
			var cantoneseColourFour = document.getElementById("cantoneseColourPickerFour").value;
			var cantoneseColourFive = document.getElementById("cantoneseColourPickerFive").value;
			var cantoneseColourSix = document.getElementById("cantoneseColourPickerSix").value;
			
			theseClasses = ["cantonese_1","cantonese_2","cantonese_3","cantonese_4","cantonese_5","cantonese_6"];
			theseColours = [cantoneseColourOne, cantoneseColourTwo, cantoneseColourThree, cantoneseColourFour, cantoneseColourFive, cantoneseColourSix];
			
			setColours(theseClasses, theseColours);
			
		} // function updateColours
		
		function setChineseColours(chineseColourOne, chineseColourTwo, chineseColourThree, chineseColourFour, chineseColourFive, chineseColourSix, chineseColourSeven, chineseColourEight)
		{
			document.getElementById("chineseColourPickerOne").value = chineseColourOne;
			document.getElementById("chineseColourPickerOne").style.backgroundColor = "#" + chineseColourOne;
			document.getElementById("chineseColourPickerTwo").value = chineseColourTwo;
			document.getElementById("chineseColourPickerTwo").style.backgroundColor = "#" + chineseColourTwo;
			document.getElementById("chineseColourPickerThree").value = chineseColourThree;
			document.getElementById("chineseColourPickerThree").style.backgroundColor = "#" + chineseColourThree;
			document.getElementById("chineseColourPickerFour").value = chineseColourFour;
			document.getElementById("chineseColourPickerFour").style.backgroundColor = "#" + chineseColourFour;
			document.getElementById("chineseColourPickerFive").value = chineseColourFive;
			document.getElementById("chineseColourPickerFive").style.backgroundColor = "#" + chineseColourFive;
			document.getElementById("chineseColourPickerSix").value = chineseColourSix;
			document.getElementById("chineseColourPickerSix").style.backgroundColor = "#" + chineseColourSix;
			document.getElementById("chineseColourPickerSeven").value = chineseColourSeven;
			document.getElementById("chineseColourPickerSeven").style.backgroundColor = "#" + chineseColourSeven;
			document.getElementById("chineseColourPickerEight").value = chineseColourEight;
			document.getElementById("chineseColourPickerEight").style.backgroundColor = "#" + chineseColourEight;
		} // end function setChineseColours

		function setPinyinColours(pinyinColourOne, pinyinColourTwo, pinyinColourThree, pinyinColourFour)
		{
			document.getElementById("pinyinColourPickerOne").value = pinyinColourOne;
			document.getElementById("pinyinColourPickerOne").style.backgroundColor = "#" + pinyinColourOne;
			document.getElementById("pinyinColourPickerTwo").value = pinyinColourTwo;
			document.getElementById("pinyinColourPickerTwo").style.backgroundColor = "#" + pinyinColourTwo;
			document.getElementById("pinyinColourPickerThree").value = pinyinColourThree;
			document.getElementById("pinyinColourPickerThree").style.backgroundColor = "#" + pinyinColourThree;
			document.getElementById("pinyinColourPickerFour").value = pinyinColourFour;
			document.getElementById("pinyinColourPickerFour").style.backgroundColor = "#" + pinyinColourFour;
		} // end function setPinyinColours
		
		function setTaiwaneseColours(taiwaneseColourOne, taiwaneseColourTwo, taiwaneseColourThree, taiwaneseColourFour, taiwaneseColourFive, taiwaneseColourSeven, taiwaneseColourEight)
		{
			document.getElementById("taiwaneseColourPickerOne").value = taiwaneseColourOne;
			document.getElementById("taiwaneseColourPickerOne").style.backgroundColor = "#" + taiwaneseColourOne;
			document.getElementById("taiwaneseColourPickerTwo").value = taiwaneseColourTwo;
			document.getElementById("taiwaneseColourPickerTwo").style.backgroundColor = "#" + taiwaneseColourTwo;
			document.getElementById("taiwaneseColourPickerThree").value = taiwaneseColourThree;
			document.getElementById("taiwaneseColourPickerThree").style.backgroundColor = "#" + taiwaneseColourThree;
			document.getElementById("taiwaneseColourPickerFour").value = taiwaneseColourFour;
			document.getElementById("taiwaneseColourPickerFour").style.backgroundColor = "#" + taiwaneseColourFour;
			document.getElementById("taiwaneseColourPickerFive").value = taiwaneseColourFive;
			document.getElementById("taiwaneseColourPickerFive").style.backgroundColor = "#" + taiwaneseColourFive;
			document.getElementById("taiwaneseColourPickerSeven").value = taiwaneseColourSeven;
			document.getElementById("taiwaneseColourPickerSeven").style.backgroundColor = "#" + taiwaneseColourSeven;
			document.getElementById("taiwaneseColourPickerEight").value = taiwaneseColourEight;
			document.getElementById("taiwaneseColourPickerEight").style.backgroundColor = "#" + taiwaneseColourEight;
		} // end function setTaiwaneseColours
		
		function setCantoneseColours(cantoneseColourOne, cantoneseColourTwo, cantoneseColourThree, cantoneseColourFour, cantoneseColourFive, cantoneseColourSix)
		{
			document.getElementById("cantoneseColourPickerOne").value = cantoneseColourOne;
			document.getElementById("cantoneseColourPickerOne").style.backgroundColor = "#" + cantoneseColourOne;
			document.getElementById("cantoneseColourPickerTwo").value = cantoneseColourTwo;
			document.getElementById("cantoneseColourPickerTwo").style.backgroundColor = "#" + cantoneseColourTwo;
			document.getElementById("cantoneseColourPickerThree").value = cantoneseColourThree;
			document.getElementById("cantoneseColourPickerThree").style.backgroundColor = "#" + cantoneseColourThree;
			document.getElementById("cantoneseColourPickerFour").value = cantoneseColourFour;
			document.getElementById("cantoneseColourPickerFour").style.backgroundColor = "#" + cantoneseColourFour;
			document.getElementById("cantoneseColourPickerFive").value = cantoneseColourFive;
			document.getElementById("cantoneseColourPickerFive").style.backgroundColor = "#" + cantoneseColourFive;
			document.getElementById("cantoneseColourPickerSix").value = cantoneseColourSix;
			document.getElementById("cantoneseColourPickerSix").style.backgroundColor = "#" + cantoneseColourSix;
		} // end function setCantoneseColours
		
		function blackColours()
		{
			//debugLog("blackColours");
			
			var flatColour = "000000";
			var upColour = "000000";
			var downUpColour = "000000";
			var downColour = "000000";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setCantoneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour);
			
			updateColours();
		} // end function blackColours
		
		function greyColours()
		{
			//debugLog("greyColours");
			
			var flatColour = "000000";
			var upColour = "929292";
			var downUpColour = "797986";
			var downColour = "505050";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setCantoneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour);
			
			updateColours();
		} // end function greyColours
		
		function peterColours()
		{
			//debugLog("peterColours");
			
			var flatColour = "000000";
			var upColour = "f82423";
			var downUpColour = "189c19";
			var downColour = "178FD1";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";

			var taiwaneseOneColour = "797986";
			var taiwaneseTwoColour = "178FD1";
			var taiwaneseThreeColour = "0000FF";
			var taiwaneseFourColour = "505050";
			var taiwaneseFiveColour = "000000";
			var taiwaneseSevenColour = "F82423";
			var taiwaneseEightColour = "929292";

			var cantonneseOneColour = "929292";
			var cantoneseTwoColour = "F82423";
			var cantoneseThreeColour = "797986";
			var cantoneseFourColour = "0000FF";
			var cantoneseFiveColour = "F82423";
			var cantoneseSixColour = "000000";

			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(taiwaneseOneColour, taiwaneseTwoColour, taiwaneseThreeColour, taiwaneseFourColour, taiwaneseFiveColour, taiwaneseSevenColour, taiwaneseEightColour);
			setCantoneseColours(cantonneseOneColour, cantoneseTwoColour, cantoneseThreeColour, cantoneseFourColour, cantoneseFiveColour, cantoneseSixColour);
			
			updateColours();
		} // end function peterColours
		
		function plecoColours()
		{
			//debugLog("plecoColours");
			
			// See http://laowaichinese.net/tone-colors-and-what-pleco-did-with-them.htm
			
			var flatColour = "e30000";
			var upColour = "02b31c";
			var downUpColour = "1510f0";
			var downColour = "8900bf";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function plecoColours

		function nathanColours()
		{
			//debugLog("nathanColours");

			var flatColour = "f41d2f";
			var upColour = "f9761b";
			var downUpColour = "97cd5d";
			var downColour = "589bc8";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function nathanColours

		function mdbgColours()
		{
			//debugLog("mdbgColours");

			var flatColour = "ff0000";
			var upColour = "d89000";
			var downUpColour = "00a000";
			var downColour = "0000ff";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function mdbgColours

		function hanpingColours()
		{
			//debugLog("hanpingColours");

			var flatColour = "64b4ff";
			var upColour = "30b030";
			var downUpColour = "f08000";
			var downColour = "d00020";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function hanpingColours
		
		function taiwaneseColours()
		{
			//debugLog("taiwaneseColours");
			
			var taiwaneseOneColour = document.getElementById("taiwaneseColourPickerOne").value;
			var taiwaneseTwoColour = document.getElementById("taiwaneseColourPickerTwo").value;
			var taiwaneseThreeColour = document.getElementById("taiwaneseColourPickerThree").value;
			var taiwaneseFourColour = document.getElementById("taiwaneseColourPickerFour").value;
			var taiwaneseFiveColour = document.getElementById("taiwaneseColourPickerFive").value;
			var sixColour = "000000";
			var taiwaneseSevenColour = document.getElementById("taiwaneseColourPickerSeven").value;
			var taiwaneseEightColour = document.getElementById("taiwaneseColourPickerEight").value;
			
			setChineseColours(taiwaneseOneColour, taiwaneseTwoColour, taiwaneseThreeColour, taiwaneseFourColour, taiwaneseFiveColour, sixColour, taiwaneseSevenColour, taiwaneseEightColour);
			
			updateColours();
		} // end function taiwaneseColours

		function cantoneseColours()
		{
			//debugLog("cantoneseColours");
			
			var cantoneseOneColour = document.getElementById("cantoneseColourPickerOne").value;
			var cantoneseTwoColour = document.getElementById("cantoneseColourPickerTwo").value;
			var cantoneseThreeColour = document.getElementById("cantoneseColourPickerThree").value;
			var cantoneseFourColour = document.getElementById("cantoneseColourPickerFour").value;
			var cantoneseFiveColour = document.getElementById("cantoneseColourPickerFive").value;
			var cantoneseSixColour = document.getElementById("cantoneseColourPickerSix").value;
			var sevenColour = "000000";
			var eightColour = "000000";
			
			setChineseColours(cantoneseOneColour, cantoneseTwoColour, cantoneseThreeColour, cantoneseFourColour, cantoneseFiveColour, cantoneseSixColour, sevenColour, eightColour);
			
			updateColours();
		} // end function cantoneseColours

		function hakkaColours()
		{
			//debugLog("hakkaColours");
			
			var hakkaOneColour = document.getElementById("hakkaColourPickerOne").value;
			var hakkaTwoColour = document.getElementById("hakkaColourPickerTwo").value;
			var hakkaThreeColour = document.getElementById("hakkaColourPickerThree").value;
			var hakkaFourColour = document.getElementById("hakkaColourPickerFour").value;
			var hakkaFiveColour = document.getElementById("hakkaColourPickerFive").value;
			var hakkaSixColour = document.getElementById("hakkaColourPickerSix").value;
			
			setChineseColours(hakkaOneColour, hakkaTwoColour, hakkaThreeColour, hakkaFourColour, hakkaFiveColour, hakkaSixColour, "000000", "000000");
			
			updateColours();
		} // end function hakkaColours

		
		function loadDictionaries()
		{
			//debugLog("loadDictionaries");
			
			combinedDictionaryData = "";
			
			var cnltDictionaryChecked = document.getElementById('cnltDictionaryCheckbox').checked;
			var cunpDictionaryChecked = document.getElementById('cunpDictionaryCheckbox').checked;
			var unihanDictionaryChecked = document.getElementById('unihanDictionaryCheckbox').checked;
			var cedictDictionaryChecked = document.getElementById('cedictDictionaryCheckbox').checked;
			var zhWiktionaryDictionaryChecked = document.getElementById('zhWiktionaryDictionaryCheckbox').checked;
			var enWiktionaryDictionaryChecked = document.getElementById('enWiktionaryDictionaryCheckbox').checked;
			var pingtypeDictionaryChecked = document.getElementById('pingtypeDictionaryCheckbox').checked;
						
			if (pingtypeDictionaryChecked == true)
			{
				if ((cnltDictionaryChecked == false) && (cunpDictionaryChecked == false) && (unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}

				//loadDictionary("SimplifiedDefinitionsPinyin.txt");
				
				loadGzDictionary("Cantonese/CantoneseDefinitionsPingyam.txt.gz");
				
			}

			if (cnltDictionaryChecked == true)
			{
				if ((cunpDictionaryChecked == false) && (unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cnltDictionary.txt");
			}

			if (cunpDictionaryChecked == true)
			{
				if ((unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cunpDictionary.txt");
			}

			if (unihanDictionaryChecked == true)
			{
				if ((cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("UnihanDictionary.txt");
			}

			if (cedictDictionaryChecked == true)
			{
				if ((zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cedictPlusAndtsu8Dictionary.txt");
			}

			if (zhWiktionaryDictionaryChecked == true)
			{
				if (enWiktionaryDictionaryChecked == false)
				{
					lastDictionary = true;
				}
			
				loadDictionary("zhWiktionaryDictionary.txt");
			}

			if (enWiktionaryDictionaryChecked == true)
			{
				lastDictionary = true;
			
				loadDictionary("enWiktionaryDictionary.txt");
			}
			
			// If we have simplified characters
			if ((QueryString.simplified != "") && (QueryString.simplified != undefined))
			{
			
				loadSimplified("opencc/dictionary/STCharacters.txt");
				loadSimplified("opencc/dictionary/STPhrases.txt");
				loadTraditional("opencc/dictionary/TSCharacters.txt");

				lastDictionary = true;
				loadTraditional("opencc/dictionary/TSPhrases.txt");
			}
			
		} // end function loadDictionaries
		
		function dictionaryEditorBopomofoButtonClicked()
		{
			//debugLog("dictionaryEditorBopomofoButtonClicked");
			
			if (document.getElementById("bopomofoKeyboard").style.visibility == "hidden")
			{
				document.getElementById("bopomofoKeyboard").style.visibility = "visible";
				document.getElementById("bopomofoKeyboard").style.height = "auto";
				document.getElementById("bopomofoKeyboard").style.width = "auto";
			} else {
				document.getElementById("bopomofoKeyboard").style.visibility = "hidden";
				document.getElementById("bopomofoKeyboard").style.height = "0px";
				document.getElementById("bopomofoKeyboard").style.width = "0px";
			}
			
		} // end function dictionaryEditorBopomofoButtonClicked
		
		function dictionaryEditorCharsButtonClicked()
		{
			//debugLog("dictionaryEditorCharsButtonClicked");
			var thisChineseString = "";
			
			thisChineseString = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisChineseString == "")
			{
				thisChineseString = document.getElementById("dictionaryEditorChineseTextArea").value;
				useMediaViewer = false;
			}
						
			var numberCharacters = stringLength(thisChineseString);
			
			var thisPinyinArray = [];
			var thisTones = "";
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisChineseString[currentCharacter];
								
				var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisCharacter + "	", "\n");
								
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
				var lineLength = thisDictionaryLineArray.length;
				
				var thisDefinition = "";
				var thisCharacterPinyin = "";
				var thisToneless = "";
				var thisTone = "";
				
				thisDefinition = thisDictionaryLineArray[0];

				if (lineLength >= 1)
				{
					thisCharacterPinyin = thisDictionaryLineArray[1];
				}
				
				if (lineLength >= 2)
				{
					thisToneless = thisDictionaryLineArray[2];
				}
				
				if (lineLength >= 3)
				{
					thisTone = thisDictionaryLineArray[3];
				}
						
				
				
				thisPinyinArray.push(thisCharacterPinyin);
				
				thisTones = thisTones + thisTone;
			} // end for every character
			
			var thisPinyin = thisPinyinArray.join(" ");
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisPinyin;
			} else {
				document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
			}
			
		} // end function dictionaryEditorCharsButtonClicked
		
		function taiwaneseCharsToPoj()
		{
			//debugLog("dictionaryEditorCharsButtonClicked");
			
			var thisChineseString = "";
			
			if (useMediaViewer == true)
			{
				thisChineseString = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			}
			
			if (thisChineseString == "")
			{
				thisChineseString = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
				useMediaViewer = false;
			}
						
			var numberCharacters = stringLength(thisChineseString);
			
			var thisPojArray = [];
			var thisTones = "";
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisChineseString[currentCharacter];
								
				var thisDictionaryLine = textBetween(taiwaneseData, "\n" + thisCharacter + "	", "\n");
								
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
				var lineLength = thisDictionaryLineArray.length;
				
				var thisDefinition = "";
				var thisCharacterPoj = "";
				var thisTone = "";
				
				thisCharacterPoj = thisDictionaryLineArray[0];

				if (lineLength >= 1)
				{
					thisTone = thisDictionaryLineArray[1];
				}
				
				thisPojArray.push(thisCharacterPoj);
				
				thisTones = thisTones + thisTone;
			} // end for every character
			
			var thisPoj = thisPojArray.join(" ");
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerPojTextArea").value = thisPoj;
				document.getElementById("dictionaryEditorMediaViewerTonesTextArea").value = thisTones;
			} else {
				document.getElementById("taiwaneseDictionaryEditorPojTextArea").value = thisPoj;
				document.getElementById("taiwaneseDictionaryEditorTonesTextArea").value = thisTones;
			}
		} // end function taiwaneseCharsToPoj
		
		function typeBopomofo(thisCharacter)
		{
			//debugLog("typeBopomofo(" + thisCharacter + ")");

			var thisPinyin = document.getElementById("dictionaryEditorPinyinTextArea").value;

			if (thisCharacter == "delete")
			{
				var inputLength = stringLength(thisPinyin);
				
				if (inputLength == 1)
				{
					thisPinyin = "";
				} else {
					thisPinyin = thisPinyin.substring(0, inputLength - 1);
				}
			} else {
				thisPinyin = thisPinyin + thisCharacter;
			}
								
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
			
		} // end function typeBopomofo
		
		function toneMarksToNumbers(thisPinyinString)
		{
			//debugLog("toneMarksToNumbers");
			
			var thisPinyinArray = thisPinyinString.split(" ");
			
			var numberWords = thisPinyinArray.length;
			
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵"];
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisPinyinArray[currentWord];
				
				var searchRegexString = "^" + "(.*" + thisWord + ")";
			
				searchRegexString = searchRegexString + "$";
				
				var searchRegex = new RegExp(searchRegexString, "gm");
			
				//document.write(searchRegex);
			
				var searchResultsArray = toneNumbersMarks.match(searchRegex);
				
				// If there are search results
				if (searchResultsArray != null)
				{
					thisWord = searchResultsArray[0];
					thisWord = textBetween(thisWord, "start", "	");
					
					var thisToneless = thisWord.replace(/[0-9]/g,'');
					var thisTone = thisWord.replace(/[^0-9]/g,'');
					
					if ((thisTone > 0) && (thisTone <= 5))
					{
						thisTone = toneSuperscripts[thisTone];
					}
					
					thisWord = thisToneless + thisTone;
				}
				
				thisPinyinArray[currentWord] = thisWord;
			} // end for every letter in the alphabet
			
			thisPinyinString = thisPinyinArray.join(" ");
			
			return thisPinyinString;
			
		} // end function toneMarksToNumbers
		
		function toneNumbersToToneMarks()
		{
			//debugLog("toneNumbersToToneMarks");

			var thisPinyinString = "";
			
			thisPinyinString = document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value;
			
			if (thisPinyinString == "")
			{
				thisPinyinString = document.getElementById("dictionaryEditorPinyinTextArea").value;
			}
			
			var thisPinyinArray = thisPinyinString.split(" ");
			
			var numberWords = thisPinyinArray.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisPinyinArray[currentWord];
				
				if (contains(toneNumbersMarks, "\n" + thisWord + "	") == true)
				{
					thisWord = textBetween(toneNumbersMarks, "\n" + thisWord + "	", "\n");
				}
				
				thisPinyinArray[currentWord] = thisWord;
			} // end for every letter in the alphabet
			
			thisPinyinString = thisPinyinArray.join(" ");
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisPinyinString;			
			} else {
				document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyinString;
			}
		} // end function toneNumbersToToneMarks
		
		function bopomofoToPinyin()
		{
			//debugLog("bopomofoToPinyin");

			var thisBopomofoString = document.getElementById("dictionaryEditorPinyinTextArea").value;
			
			/* Bopomofo to pinyin with tone numbers */
			var bopomofoAlphabet = ["ㄅ", "ㄆ", "ㄇ", "ㄈ", "ㄉ", "ㄊ", "ㄋ", "ㄌ", "ㄍ", "ㄎ", "ㄏ", "ㄐ", "ㄑ", "ㄒ", "ㄓ", "ㄔ", "ㄕ", "ㄖ", "ㄗ", "ㄘ", "ㄙ", "ㄩㄝ", "ㄩㄢ", "ㄩㄣ", "ㄩㄥ", "ㄩ", "ㄨㄚ", "ㄨㄛ", "ㄨㄞ", "ㄨㄟ", "ㄨㄢ", "ㄨㄣ", "ㄨㄤ", "ㄨㄥ", "ㄨ", "ㄧㄚ", "ㄧㄛ", "ㄧㄝ", "ㄧㄞ", "ㄧㄠ", "ㄧㄡ", "ㄧㄢ", "ㄧㄣ", "ㄧㄤ", "ㄧㄥ", "ㄧ", "ㄚ", "ㄛ", "ㄜ", "ㄝ", "ㄞ", "ㄟ", "ㄠ", "ㄡ", "ㄢ", "ㄣ", "ㄤ", "ㄥ", "ㄦ", "˙", "ˊ", "ˇ", "ˋ"];
			var pinyinAlphabet = ["b", "p", "m", "f", "d", "t", "n", "l", "g", "k", "h", "j", "q", "x", "zh", "ch", "sh", "r", "z", "c", "s", "üe", "üan", "ün", "iong", "ü", "ua", "uo", "uai", "ui", "uan", "un", "uang", "ong", "u", "ia", "io", "ie", "iai", "iao", "iu", "ian", "in", "iang", "ing", "i", "a", "o", "e", "ê", "ai", "ei", "ao", "ou", "an", "en", "ang", "eng", "er", "5", "2", "3", "4"];
			
			var numberLetters = bopomofoAlphabet.length;
			
			for (var currentLetter = 0; currentLetter < numberLetters; currentLetter++)
			{
				var thisBopomofoLetter = bopomofoAlphabet[currentLetter];
				var thisPinyinLetter = pinyinAlphabet[currentLetter];
				
				thisBopomofoString = replaceChars(thisBopomofoString, thisBopomofoLetter, thisPinyinLetter);
				
			} // end for every letter in the alphabet
			
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisBopomofoString;
			
			toneNumbersToToneMarks();
			
		} // end function bopomofoToPinyin
		
		function dictionaryEditorSearch()
		{
			//debugLog("dictionaryEditorSearch");
			
			var thisChineseString = "";

			thisChineseString = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisChineseString == "")
			{
				thisChineseString = document.getElementById("dictionaryEditorChineseTextArea").value;
				useMediaViewer = false;
			}
			
			thisChineseString = replaceChars(thisChineseString, "	", "");
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = thisChineseString;
			} else {
				document.getElementById("dictionaryEditorChineseTextArea").value = thisChineseString;
			}
			
			var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisChineseString + "	", "\n");
				
			var thisDictionaryLineArray = thisDictionaryLine.split("	");
						
			var lineLength = thisDictionaryLineArray.length;
			
			var thisDefinition = "";
			var thisPinyin = "";
			var thisToneless = "";
			var thisTone = "";
			
			thisDefinition = thisDictionaryLineArray[0];

			if (lineLength >= 1)
			{
				thisPinyin = thisDictionaryLineArray[1];
			}
			
			if (lineLength >= 2)
			{
				thisToneless = thisDictionaryLineArray[2];
			}
			
			if (lineLength >= 3)
			{
				thisTone = thisDictionaryLineArray[3];
			}
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisPinyin;
				document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = thisDefinition;
			
			} else {
				document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
				document.getElementById("dictionaryEditorEnglishTextArea").value = thisDefinition;
			}
		} // end function dictionaryEditorSearch
		
		function dictionaryEditorEditCounts()
		{
			//debugLog("dictionaryEditorEditCounts()");
			
			var addWords = localStorage["addWords"];
			
			if (addWords == undefined)
			{
				addWords = "";
				localStorage["addWords"] = "";
			}
			
			var addWordsLength = addWords.split("\n").length - 1;
			
			document.getElementById("addedLabel").innerText = addWordsLength + " added";
			
			var editWords = localStorage["editWords"];
			
			if (editWords == undefined)
			{
				editWords = "";
				localStorage["editWords"] = "";
			}

			var editWordsLength = editWords.split("\n").length - 1;
			
			document.getElementById("editedLabel").innerText = editWordsLength + " edited";
			
			var removeWords = localStorage["removeWords"];

			if (removeWords == undefined)
			{
				removeWords = "";
				localStorage["removeWords"] = "";
			}

			var removeWordsLength = removeWords.split("\n").length - 1;
			
			document.getElementById("deletedLabel").innerText = removeWordsLength + " deleted";
			
			var uploadedCount = localStorage["uploadedCount"];
			
			if (uploadedCount == undefined)
			{
				uploadedCount = 0;
			}
			
			document.getElementById("uploadedLabel").innerText = uploadedCount + " uploaded";
			
		} // end function dictionaryEditorEditCounts
		
		function addWordsButtonClicked()
		{
			//debugLog("addWordsButtonClicked()");
			
			var wordDefinitions = document.getElementById("chineseTextArea").value;
			
			var wordDefinitionsLines = wordDefinitions.split("\n");
			
			var numberWords = wordDefinitionsLines.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisDefinition = wordDefinitionsLines[currentWord];
				
				var thisDefinitionArray = thisDefinition.split("	");
				
				var thisWordChinese = thisDefinitionArray[0];
				var thisWordPinyin = thisDefinitionArray[1];
				//var thisWordTones = thisDefinitionArray[2];
				var thisWordEnglish = thisDefinitionArray[2];
				
				if ((thisWordChinese != undefined) && (thisWordPinyin != undefined) && (thisWordEnglish != undefined))
				{
				
					var thisWordTones = getTones(thisWordPinyin);
				
					addWordTones(thisWordChinese, thisWordPinyin, thisWordTones, thisWordEnglish)
					
					
				} // end if there is a valid definition
				
			} // end for every word
			
			writeToFile("PinyinDefinitionsSorted.txt", combinedDictionaryData);
			
		} // end function addWordsButtonClicked
		
		function dateToAlphabetic(thisDateString)
		{
			var thisDate = textBetween(thisDateString, "start", " ");
			var thisTime = textBetween(thisDateString, " ", "end");
			
			var thisDateArray = thisDate.split("/");
			var thisDateArrayReverse = thisDateArray.reverse();
			var thisDateReversed = thisDateArrayReverse.join("-");
			
			var thisDateAlphabetic = thisDateReversed + " " + thisTime;
			
			return thisDateAlphabetic;
						
		} // end function dateToAlphabetic
		
		function addEditRemoveWordsFromFiles()
		{
			document.getElementById("simplifiedInputTextArea").value = addWords;
			document.getElementById("chineseTextArea").value = editWords;
			document.getElementById("englishTextArea").value = removeWords;
			
			var addWordsArray = addWords.split("\n");
			
			var numberAddWords = addWordsArray.length - 1;
			
			var changedLines = "";
			
			for (var currentAddWord = 0; currentAddWord <= numberAddWords; currentAddWord++)
			{
				var thisAddWord = addWordsArray[currentAddWord];
				
				// The format in the addWords file is not consistent. Detect the parts by looking at them. 
				
				thisAddWord = replaceChars(thisAddWord, "		", "	");
				
				var thisAddWordArray = thisAddWord.split("	");
				
				var thisAddWordChinese = "";
				var thisAddWordEnglish = "";
				var thisAddWordPinyin = "";
				var thisAddWordToneless = "";
				var thisAddWordTones = "";
				var thisAddWordDate = "";
				
				var numberAddWordParts = thisAddWordArray.length - 1;
			
				for (var currentAddWordPart = 0; currentAddWordPart <= numberAddWordParts; currentAddWordPart++)
				{
					var thisAddWordPart = thisAddWordArray[currentAddWordPart];
					
					if ((thisAddWordPart != undefined) && (thisAddWordPart != ""))
					{
					
						if ((isChinese(thisAddWordPart) == true) && (thisAddWordChinese == ""))
						{
							thisAddWordChinese = thisAddWordPart;
						} else {
							if ((isNumberString(thisAddWordPart) == true) && (thisAddWordTones == ""))
							{
								thisAddWordTones = thisAddWordPart;
							} else {
								if ((contains(thisAddWordPart, ":") == true) && (thisAddWordDate == ""))
								{
									thisAddWordDate = thisAddWordPart;
								} else {
									// Already found Chinese, English, and date. Must be pinyin, toneless, or tones. 
									if ((isEnglishString(thisAddWordPart) == true) && (thisAddWordEnglish == ""))
									{
										thisAddWordEnglish = thisAddWordPart;
									} else {
									
										// Must be pinyin or toneless. 
										if ((isEnglishString(thisAddWordPart) == true) && (thisAddWordToneless == ""))
										{
											thisAddWordToneless = thisAddWordPart;
											
											if (thisAddWordPinyin == "")
											{
												thisAddWordPinyin = thisAddWordPart;
											} else {
												thisAddWordToneless = thisAddWordPart;
											}
											
										} else {
											if (thisAddWordPinyin == "")
											{
											
												// Can it find tones?
												var thisTonesTest = getTones(thisAddWordPart);
												thisTonesTest = replaceChars(thisTonesTest, "1", "");
												
												if (thisTonesTest == "")
												{
													if (thisAddWordEnglish == "")
													{
														thisAddWordEnglish = thisAddWordPart;
													} else {
														thisAddWordPinyin = thisAddWordPart;
													} // it can't be english because english is already set
												} else {
													thisAddWordPinyin = thisAddWordPart;
												} // end if it's probably English not pinyin
											}
										} // end if the word is the toneless
									} // end if the word is the tones
								} // end if the word is a date
							} // end if this part is English
						} // end if this part is Chinese 
					} // end if this part is not undefined
				} // end for every part of the line
				
				// Rebuild missing parts if necessary
				
				if (thisAddWordToneless == "")
				{
					thisAddWordToneless = removeTones(thisAddWordPinyin);
				}
				
				if (thisAddWordTones == "")
				{
					thisAddWordTones = getTones(thisAddWordPinyin);
				}
				
				var thisAddWordDateAlphabetic = dateToAlphabetic(thisAddWordDate);
				
				var thisAddWordLine = "";
				
				if (thisAddWordChinese != "")
				{
					thisAddWordLine = thisAddWordDateAlphabetic + "	" + "add" + "	" + thisAddWordChinese + "	" + thisAddWordEnglish + "	" + thisAddWordPinyin + "	" + thisAddWordToneless + "	" + thisAddWordTones;
				}
				
				changedLines = changedLines + thisAddWordLine + "\n";
				
			} // end for every add word
			
			
			var editWordsArray = editWords.split("\n");
			
			var numberEditWords = editWordsArray.length - 1;
			
			// For every edit word
			for (var currentEditWord = 0; currentEditWord <= numberEditWords; currentEditWord++)
			{
				var thisEditWord = editWordsArray[currentEditWord];
				
				// The format in the editWords file is not consistent. Detect the parts by looking at them. 
				
				thisEditWord = replaceChars(thisEditWord, "		", "	");
				
				var thisEditWordArray = thisEditWord.split("	");
				
				var thisEditWordChinese = "";
				var thisEditWordEnglish = "";
				var thisEditWordPinyin = "";
				var thisEditWordToneless = "";
				var thisEditWordTones = "";
				var thisEditWordDate = "";
				
				var numberEditWordParts = thisEditWordArray.length - 1;
			
				for (var currentEditWordPart = 0; currentEditWordPart <= numberEditWordParts; currentEditWordPart++)
				{
					var thisEditWordPart = thisEditWordArray[currentEditWordPart];
					
					if ((thisEditWordPart != undefined) && (thisEditWordPart != ""))
					{
					
						if ((isChinese(thisEditWordPart) == true) && (thisEditWordChinese == ""))
						{
							thisEditWordChinese = thisEditWordPart;
						} else {
							if ((isNumberString(thisEditWordPart) == true) && (thisEditWordTones == ""))
							{
								thisEditWordTones = thisEditWordPart;
							} else {
								if ((contains(thisEditWordPart, ":") == true) && (thisEditWordDate == ""))
								{
									thisEditWordDate = thisEditWordPart;
								} else {
									// Already found Chinese, English, and date. Must be pinyin, toneless, or tones. 
									if ((isEnglishString(thisEditWordPart) == true) && (thisEditWordEnglish == ""))
									{
										thisEditWordEnglish = thisEditWordPart;
									} else {
									
										// Must be pinyin or toneless. 
										if ((isEnglishString(thisEditWordPart) == true) && (thisEditWordToneless == ""))
										{
											if (thisEditWordPinyin == "")
											{
												thisEditWordPinyin = thisEditWordPart;
											} else {
												thisEditWordToneless = thisEditWordPart;
											}
										} else {
											if (thisEditWordPinyin == "")
											{
											
												// Can it find tones?
												var thisTonesTest = getTones(thisEditWordPart);
												thisTonesTest = replaceChars(thisTonesTest, "1", "");
												
												if (thisTonesTest == "")
												{
													if (thisEditWordEnglish == "")
													{
														thisEditWordEnglish = thisEditWordPart;
													} else {
														thisEditWordPinyin = thisEditWordPart;
													} // it can't be english because english is already set
												} else {
													thisEditWordPinyin = thisEditWordPart;
												} // end if it's probably English not pinyin

											}
										} // end if the word is the toneless
									} // end if the word is the tones
								} // end if the word is a date
							} // end if this part is English
						} // end if this part is Chinese 
					} // end if this part is not undefined
				} // end for every part of the line
				
				// Rebuild missing parts if necessary
				
				if (thisEditWordToneless == "")
				{
					thisEditWordToneless = removeTones(thisEditWordPinyin);
				}
				
				if (thisEditWordTones == "")
				{
					thisEditWordTones = getTones(thisEditWordPinyin);
				}
				
				var thisEditWordDateAlphabetic = dateToAlphabetic(thisEditWordDate);
				
				var thisEditWordLine = "";
				
				if (thisEditWordChinese != "")
				{
					thisEditWordLine = thisEditWordDateAlphabetic + "	" + "edit" + "	" + thisEditWordChinese + "	" + thisEditWordEnglish + "	" + thisEditWordPinyin + "	" + thisEditWordToneless + "	" + thisEditWordTones;
				}
				
				changedLines = changedLines + thisEditWordLine + "\n";
			} // end for every edit word
			
			
			
			var removeWordsArray = removeWords.split("\n");
			
			var numberRemoveWords = removeWordsArray.length - 1;
			
			// For every edit word
			for (var currentRemoveWord = 0; currentRemoveWord <= numberRemoveWords; currentRemoveWord++)
			{
				var thisRemoveWord = removeWordsArray[currentRemoveWord];
				
				var thisRemoveWordArray = thisRemoveWord.split("	");
				
				var thisRemoveWordChinese = "";
				var thisRemoveWordDate = "";
				
				var numberRemoveWordParts = thisRemoveWordArray.length - 1;
			
				for (var currentRemoveWordPart = 0; currentRemoveWordPart <= numberRemoveWordParts; currentRemoveWordPart++)
				{
					var thisRemoveWordPart = thisRemoveWordArray[currentRemoveWordPart];
					
					if ((thisRemoveWordPart != undefined) && (thisRemoveWordPart != ""))
					{
					
						if ((isChinese(thisRemoveWordPart) == true) && (thisEditWordChinese == ""))
						{
							thisRemoveWordChinese = thisRemoveWordPart;
						} else {
							if ((contains(thisRemoveWordPart, ":") == true) && (thisEditWordDate == ""))
							{
								thisRemoveWordDate = thisRemoveWordPart;
							} else {
								// Do nothing
							} // end if it's the date
						} // end if it's the Chinese word
					} // end if it's undefined or blank
				
				} // end for every remove word part
				
				var thisRemoveWordDateAlphabetic = dateToAlphabetic(thisRemoveWordDate);
				
				var thisRemoveWordLine = "";
				
				if (thisRemoveWordChinese != "")
				{
					thisRemoveWordLine = thisRemoveWordDateAlphabetic + "	" + "remove" + "	" + thisRemoveWordChinese;
				}
				
				changedLines = changedLines + thisRemoveWordLine + "\n";
				
			} // end for every remove word			
			
			// Sort the changes by date
			var changedLinesArray = changedLines.split("\n");
			changedLinesArray.sort();
			
			// Prepare to make the edits
			
			var uniqueLines = "";
			
			var numberLines = changedLinesArray.length - 1;
			
			var previousLine = "";
			
			for (var currentLine = 0; currentLine <= numberLines; currentLine++)
			{
				var thisLine = changedLinesArray[currentLine];
				
				if ((thisLine != previousLine) && (thisLine != ""))
				{
					uniqueLines = uniqueLines + thisLine + "\n";
				} // end if the row is unique
				
				previousLine = thisLine;
				
			} // end for every line in the sorted array
			
			//document.getElementById("outputTextArea").value = uniqueLines;
			//return;
			
			// Run the add, edit, remove commands in date order.
			
			var addEditRemoveLinesArray = uniqueLines.split("\n");
			
			var numberAddEditRemoveRows = addEditRemoveLinesArray.length - 1;
			
			var outputString = "";
			
			for (var currentRow = 0; currentRow < numberAddEditRemoveRows; currentRow++)
			{
				var thisRow = addEditRemoveLinesArray[currentRow];
				
				var thisRowParts = thisRow.split("	");
				
				var thisCommand = thisRowParts[1];
				
				if (thisCommand == "add")
				{
					var thisWordChinese = thisRowParts[2];
					var thisWordEnglish = thisRowParts[3];
					var thisWordPinyin = thisRowParts[4];
					var thisWordToneless = thisRowParts[5];
					var thisWordTones = thisRowParts[6];
				
					addEditWordTonesToneless(thisWordChinese, thisWordEnglish, thisWordPinyin, thisWordTones, thisWordToneless);
					//outputString = outputString + "addEditWordTonesToneless(" + thisWordChinese + ", " + thisWordEnglish + ", " + thisWordPinyin + ", " + thisWordTones + ", " + thisWordToneless + ")" + "\n";

				} // end if the command is to add or edit 

				if (thisCommand == "edit")
				{
					var thisWordChinese = thisRowParts[2];
					var thisWordEnglish = thisRowParts[3];
					var thisWordPinyin = thisRowParts[4];
					var thisWordToneless = thisRowParts[5];
					var thisWordTones = thisRowParts[6];

					addEditWordTonesToneless(thisWordChinese, thisWordEnglish, thisWordPinyin, thisWordTones, thisWordToneless);
					//outputString = outputString + "addEditWordTonesToneless(" + thisWordChinese + ", " + thisWordEnglish + ", " + thisWordPinyin + ", " + thisWordTones + ", " + thisWordToneless + ")" + "\n";

				} // end if the command is to edit

				if (thisCommand == "remove")
				{
					var thisWordChinese = thisRowParts[2];

					removeWord(thisWordChinese);
					//outputString = outputString + "removeWord(" + thisWordChinese + ")" + "\n";

				} // end if the command is to remove
				
				
			} // end for every add, edit, remove command
			
			// Write the new dictionary file
			writeToFile("PinyinDefinitionsSorted.txt", combinedDictionaryData);
			
			
			//document.getElementById("outputTextArea").value = outputString;
			
		} // end function addEditRemoveWordsFromFiles
		
		function addEditRemoveWordsButtonClicked()
		{
			// Loading the edit and remove word files happens async, which then calls back the function addEditRemoveWordsFromFiles. 
			loadAddWords("addWords.txt");
		} // end function addEditRemoveWordsButtonClicked
		

		function addEditWordTonesToneless(thisWordChinese, thisWordEnglish, thisWordPinyin, thisWordTones, thisWordToneless)
		{
			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordToneless + "	" + thisWordTones + "	";
			
			if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == false)
			{
				// Add the word to the dictionary
				combinedDictionaryData = combinedDictionaryData + thisDefinition + "\n";
			} else {
				// Edit the word
				
				var newDefintion = thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordToneless + "	" + thisWordTones + "	" ;
				
				// Get the existing word
				var oldDefinition = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");

				combinedDictionaryData = replaceChars(combinedDictionaryData, "\n" + thisWordChinese + "	" + oldDefinition, "\n" + thisWordChinese + "	" + newDefintion);
				
			} // end if the dictionary contains the word already
				
		} // end function addEditWordTonesToneless

		function addWordTones(thisWordChinese, thisWordPinyin, thisWordTones, thisWordEnglish)
		{
			//debugLog("addWordDefinition");
			
			var thisWordPinyinToneless = removeTones(thisWordPinyin);
						
			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	";
			
			//if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == false)
			if (searchDictionary(thisWordChinese) == false)
			{
				// Add the word to the dictionary
				combinedDictionaryData = combinedDictionaryData + thisDefinition + "\n";
				
				var wordLength = stringLength(thisWordChinese);
				
				if (wordLength == 5)
				{
					fiveWords = fiveWords + thisWordChinese + "\n";
				}

				if (wordLength == 4)
				{
					fourWords = fourWords + thisWordChinese + "\n";
				}

				if (wordLength == 3)
				{
					threeWords = threeWords + thisWordChinese + "\n";
				}

				if (wordLength == 2)
				{
					twoWords = twoWords + thisWordChinese + "\n";
				}

				if (wordLength == 1)
				{
					oneWords = oneWords + thisWordChinese + "\n";
				}
				
				//var addText = thisDefinition + "	" + getDateString();
				
				// Save to the file
				//appendToFile("addWords.txt", addText);
				//saveToLocalStorage("addWords", addText);
				
			} else {
				// Edit the word
				
				var newDefintion = thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	" ;
				
				// Get the existing word
				var oldDefinition = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
				
				//var oldDefinitionArray = oldDefinition.split("	");
				//var oldWordEnglish = oldDefinitionArray[0];
				//var oldWordPinyin = oldDefinitionArray[1];
				//var oldWordToneless = oldDefinitionArray[2];
				//var oldWordTones = oldDefinitionArray[3];
				
				// Push the new definition
				
				//if (oldWordTones != thisWordTones)
				//{
					//if (oldWordTones != 5)
					//{
						//if (oldWordEnglish.length > thisWordEnglish.length)
						//{
							// Replace the definition in the dictionary
							combinedDictionaryData = replaceChars(combinedDictionaryData,oldDefinition,newDefintion);
						//}
					//}
				//} // end if there is a valid definition
			
				//var editText = thisDefinition + "	" + getDateString();
					
				// Save to the file
				//appendToFile("editWords.txt", editText);
				//saveToLocalStorage("editWords", editText);
				
			} // if the dictionary contains the word already
			
			// Save the new dictionary
	  		//var useGithub = document.getElementById("useGithubCheckbox").checked;

			//if (useGithub == false)
			//{
			//	writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			//} else {
			//	saveDictionaryToLocalStorage(combinedDictionaryData.length);
			//}
			
		} // end function addWordTones
		
		function serverReloadDictionary()
		{
			//debugLog("serverReloadDictionary");
			
			var thisText = "command=reloadDictionary";
			
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   //if (xmlhttp.status == 200) 
				   if (xmlhttp.status != 400) 
				   {
						
						// No acknowledgment needed
					    //debugLog(xmlhttp.responseText);
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('error sending to server');
				   }
				   else {
					   alert('error sending to server');
				   }
				}
			};


			var url = "http://127.0.0.1:5373";
			//var url = "server.js";
			//var params = "lorem=ipsum&name=binny";
			//var params = "text=hello world";
			//var params = "text=" + thisText;
			var params = thisText;
			xmlhttp.open("POST", url, true);

			//Send the proper header information along with the request
			xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			xmlhttp.send(params);
			
		} // end function serverReloadDictionary
		
		
		function addWord(thisWordChinese, thisWordPinyin, thisWordEnglish)
		{
			//debugLog("addWord");
			
			if (thisWordChinese == "") 
			{
				return;
			}

			if (thisWordChinese == "\n") 
			{
				return;
			}
			
			var thisWordPinyinToneless = removeTones(thisWordPinyin);
			var thisWordTones = getTones(thisWordPinyin);
						
//			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	";
			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin;
			
			var edited = false;
			
			var thisWordText = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + getDateString();
				
			//if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == false)
			if (searchDictionary(thisWordChinese) == false)
			{
				// Add the word to the dictionary
				combinedDictionaryData = combinedDictionaryData + thisDefinition + "\n";
				
				appendToFile("PinyinDefinitionsSorted.txt", thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin);
				//var addText = thisDefinition + "	" + getDateString();
				
				var wordLength = stringLength(thisWordChinese);
			   
				switch (wordLength)
				{
					case 5: fiveWords = fiveWords + thisWordChinese + "\n"; break;
					case 4: fourWords = fourWords + thisWordChinese + "\n"; break;
					case 3: threeWords = threeWords + thisWordChinese + "\n"; break;
					case 2: twoWords = twoWords + thisWordChinese + "\n"; break;
					case 1: oneWords = oneWords + thisWordChinese + "\n";break;
					default: break;
				}
			    
			    
				
				// Save to the file
				appendToFile("addWords.txt", thisWordText);
				saveToLocalStorage("addWords", thisWordText);
				
				edited = false;
				
			} else {
				// Edit the word
			
				// Get the existing word
				var oldDefinition = thisWordChinese + "	" + textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
						
				//var newDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	" + "\n";
				var newDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "\n";
				
				// Replace the definition in the dictionary
				combinedDictionaryData = replaceChars(combinedDictionaryData,oldDefinition,newDefinition);
				editInFile("PinyinDefinitionsSorted.txt", oldDefinition, newDefinition);

				//var editText = thisDefinition + "	" + getDateString();
				
				// Save to the file
				appendToFile("editWords.txt", thisWordText);
				saveToLocalStorage("editWords", thisWordText);
				
				edited = true;
				
			} // if the dictionary contains the word already
			
			// Save the new dictionary
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			//if (useGithub == false)
			//{
			//	writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			//} else {
			//	saveDictionaryToLocalStorage(combinedDictionaryData.length);
			//}
			
			if (useGithub == false)
			{
				serverReloadDictionary();
			}
			
			return edited;
			
		} // end function addWord
		
		function dictionaryEditorAddButtonClicked()
		{
			//debugLog("dictionaryEditorAddButtonClicked");
			
			var thisWordChinese = "";
			var thisWordPinyin = "";
			var thisWordEnglish = "";
			
			thisWordChinese = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			thisWordPinyin = document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value;
			thisWordEnglish = document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value;			
			
			if (thisWordChinese == "")
			{
				thisWordChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
				thisWordPinyin = document.getElementById("dictionaryEditorPinyinTextArea").value;
				thisWordEnglish = document.getElementById("dictionaryEditorEnglishTextArea").value;
				useMediaViewer = false;
			}
			
			var edited = addWord(thisWordChinese, thisWordPinyin, thisWordEnglish);
			
			// Save the new dictionary
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				//writeToFile("PinyinDefinitionsSorted.txt", combinedDictionaryData);
				/*
				// This section was moved to function addWord
				
				var thisWordText = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + getDateString();
				
				if (edited == false)
				{
					// Save to the added words file
					//appendToFile("addWords.txt", thisWordText);
					saveToLocalStorage("addWords", thisWordText);

				} else {
					// Save to the edited words file
					//appendToFile("editWords.txt", thisWordText);
					saveToLocalStorage("editWords", thisWordText);
				}
				*/
				
			} else {
				saveDictionaryToLocalStorage(combinedDictionaryData.length);
			}
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = "";
				document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = "";
				document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = "";
			} else {
				document.getElementById("dictionaryEditorChineseTextArea").value = "";
				document.getElementById("dictionaryEditorPinyinTextArea").value = "";
				document.getElementById("dictionaryEditorEnglishTextArea").value = "";
			}
			
			dictionaryEditorEditCounts();
			
		} // end function dictionaryEditorAddButtonClicked
		
		function removeWord(thisWord)
		{
			if (thisWord != "")
			{
				var thisDefinition = textBetween(combinedDictionaryData,"\n"+thisWord+"	","\n");
				
				var thisDictionaryParts = combinedDictionaryData.split("\n"+thisWord+"	");
				
				var newDictionary = "";
				
				var numberParts = thisDictionaryParts.length - 1;
				
				for (var currentPart = 0; currentPart <= numberParts; currentPart++)
				{
					var thisPart = thisDictionaryParts[currentPart];
				
					// Remove the first line if it's not the first part
					if (currentPart != 0)
					{
						thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
					} // end remove first lines

					// Remove the last line if it's not the last part
					if (currentPart != numberParts)
					{
						thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
					} // end remove last lines
					
					newDictionary = newDictionary + "\n" + thisPart;
					
				} // end for every dictionary part
				
				combinedDictionaryData = newDictionary;
				
				
				var wordLength = stringLength(thisWord);
				
				if (wordLength == 5)
				{
					var thisSubdictionaryParts = fiveWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					fiveWords = newSubdictionary;
				} // end if wordLength is 5

				if (wordLength == 4)
				{
					var thisSubdictionaryParts = fourWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					fourWords = newSubdictionary;
				} // end if wordLength is 4

				if (wordLength == 3)
				{
					var thisSubdictionaryParts = threeWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					threeWords = newSubdictionary;
				} // end if wordLength is 3

				if (wordLength == 2)
				{
					var thisSubdictionaryParts = twoWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					twoWords = newSubdictionary;
				} // end if wordLength is 2

				if (wordLength == 1)
				{
					var thisSubdictionaryParts = oneWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					oneWords = newSubdictionary;
				} // end if wordLength is 1
				
		  		var useGithub = document.getElementById("useGithubCheckbox").checked;

				if (useGithub == false)
				{
					serverReloadDictionary();
				}
				
			} // end if the word is not blank
		} // end function removeWord
		
		function dictionaryEditorRemoveButtonClicked()
		{
			//debugLog("dictionaryEditorRemoveButtonClicked");
			
			var thisWord = "";
			
			thisWord = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisWord == "")
			{
				thisWord = document.getElementById("dictionaryEditorRemoveTextArea").value;
				useMediaViewer = false;
			}
			
			if (thisWord != "")
			{
				var thisDefinition = textBetween(combinedDictionaryData,"\n"+thisWord+"	","\n");
				
				var thisDictionaryParts = combinedDictionaryData.split("\n"+thisWord+"	");
				
				var newDictionary = "";
				
				var numberParts = thisDictionaryParts.length - 1;
				
				for (var currentPart = 0; currentPart <= numberParts; currentPart++)
				{
					var thisPart = thisDictionaryParts[currentPart];
				
					// Remove the first line if it's not the first part
					if (currentPart != 0)
					{
						thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
					} // end remove first lines

					// Remove the last line if it's not the last part
					if (currentPart != numberParts)
					{
						thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
					} // end remove last lines
					
					newDictionary = newDictionary + "\n" + thisPart;
					
				} // end for every dictionary part
				
				combinedDictionaryData = newDictionary;
				
				
				var wordLength = stringLength(thisWord);
				
				if (wordLength == 5)
				{
					var thisSubdictionaryParts = fiveWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					fiveWords = newSubdictionary;
				} // end if wordLength is 5

				if (wordLength == 4)
				{
					var thisSubdictionaryParts = fourWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					fourWords = newSubdictionary;
				} // end if wordLength is 4

				if (wordLength == 3)
				{
					var thisSubdictionaryParts = threeWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					threeWords = newSubdictionary;
				} // end if wordLength is 3

				if (wordLength == 2)
				{
					var thisSubdictionaryParts = twoWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					twoWords = newSubdictionary;
				} // end if wordLength is 2

				if (wordLength == 1)
				{
					var thisSubdictionaryParts = oneWords.split("\n"+thisWord+"\n");
				
					var newSubdictionary = "";
				
					var numberParts = thisDictionaryParts.length - 1;
				
					for (var currentPart = 0; currentPart <= numberParts; currentPart++)
					{
						var thisPart = thisSubdictionaryParts[currentPart];
				
						// Remove the first line if it's not the first part
						if (currentPart != 0)
						{
							thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
						} // end remove first lines

						// Remove the last line if it's not the last part
						if (currentPart != numberParts)
						{
							thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
						} // end remove last lines
					
						newSubdictionary = newSubdictionary + "\n" + thisPart;
					
					} // end for every dictionary part
				
					oneWords = newSubdictionary;
				} // end if wordLength is 1
								
				
				
				// Update the user interface
				//var removeAreaWords = document.getElementById("dictionaryRemoveArea").value;
				//removeAreaWords = replaceChars(removeAreaWords,thisWord,"");
				//document.getElementById("dictionaryRemoveArea").value = removeAreaWords;
				
				var removeText = thisWord + "	" + getDateString();

				// Save to the file
				appendToFile("removeWords.txt", removeText);
				saveToLocalStorage("removeWords", removeText);
				
			} // if the word is not blank
			
			// Save the new dictionary
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				//writeToFile("PinyinDefinitionsSorted.txt", combinedDictionaryData);
				editInFile("PinyinDefinitionsSorted.txt", "\n" + thisWord + "	" + thisDefinition + "\n", "\n");
			} else {
				saveDictionaryToLocalStorage(combinedDictionaryData.length);
			}
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = "";
				document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = "";
				document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = "";
			} else {
				document.getElementById("dictionaryEditorRemoveTextArea").value = "";
			}
				
			dictionaryEditorEditCounts();
			
		} // end function dictionaryEditorRemoveButtonClicked
		
		function taiwaneseDictionaryEditorSearch()
		{
			//debugLog("taiwaneseDictionaryEditorSearch");
			
			var thisChineseString = "";
			
			if (useMediaViewer == true)
			{
				thisChineseString = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			}
			
			if (thisChineseString == "")
			{
				thisChineseString = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
				
				useMediaViewer = false;
			}
			
			thisChineseString = replaceChars(thisChineseString, "	", "");

			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = thisChineseString;
			} else {
				document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value = thisChineseString;
			}
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisChineseString);
			
			var numberResults = dictionaryResultsArray.length;
			
			//debugLog(numberResults);
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (numberResults > 1)
				{
					var definitionDropdownInnerHtml = "";
					
					for (var currentResult = 1; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						definitionDropdownInnerHtml = definitionDropdownInnerHtml + "<option value=\"" + currentResult + "\">" + thisResult + "</option>";
						
					} // end for every other result
					
					//debugLog(definitionDropdownInnerHtml);
					
					if (useMediaViewer == true)
					{
						document.getElementById("taiwaneseMediaViewerDefinitionDropdown").innerHTML = definitionDropdownInnerHtml;
					} else {
						document.getElementById("taiwaneseDefinitionDropdown").innerHTML = definitionDropdownInnerHtml;
					}
					
				} else {
					if (useMediaViewer == true)
					{
						document.getElementById("taiwaneseMediaViewerDefinitionDropdown").innerHTML = "";
					} else {
						document.getElementById("taiwaneseDefinitionDropdown").innerHTML = "";
					}
					
				} // end if there is more than one result
				
				// First result is at index 1 because index 0 is the first part of the dictionary before the first search result
				var thisDictionaryLine = dictionaryResultsArray[1];
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				var lineLength = thisDictionaryLineArray.length;
				
				var thisPoj = "";
				var thisTones = "";
				
				thisPoj = thisDictionaryLineArray[0];
				
				if (lineLength >= 1)
				{
					thisTones = thisDictionaryLineArray[1];
				}
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerPojTextArea").value = thisPoj;
					document.getElementById("dictionaryEditorMediaViewerTonesTextArea").value = thisTones;
				} else {
					document.getElementById("taiwaneseDictionaryEditorPojTextArea").value = thisPoj;
					document.getElementById("taiwaneseDictionaryEditorTonesTextArea").value = thisTones;
				}
				
			} // end if there are search results
			
			
		} // end function taiwaneseDictionaryEditorSearch

		function taiwaneseDictionaryEditorDropdownChanged()
		{
			//debugLog("taiwaneseDictionaryEditorDropdownChanged");
			
			var thisChineseString = "";
			
			thisChineseString = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			
			if (thisChineseString == "")
			{
				thisChineseString = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
				useMediaViewer = false;
			}
			
			thisChineseString = replaceChars(thisChineseString, "	", "");
			
			if (useMediaViewer == true)
			{
				document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = thisChineseString;
			} else {
				document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value = thisChineseString;
			}
			
		   var dictionaryResultsArray = dictionarySearchTaiwanese(thisChineseString);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				var definitionNumber = -1;
				
				if (useMediaViewer == true)
				{
					definitionNumber = document.getElementById('taiwaneseMediaViewerDefinitionDropdown').value;
					definitionNumber = definitionNumber * 1;
				} else {
					definitionNumber = document.getElementById('taiwaneseDefinitionDropdown').value;
					definitionNumber = definitionNumber * 1;
				}
				
				// Show the user's requested definition number
				var thisDictionaryLine = dictionaryResultsArray[definitionNumber];
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				var lineLength = thisDictionaryLineArray.length;
				
				var thisPoj = "";
				var thisTones = "";
				
				thisPoj = thisDictionaryLineArray[0];
				
				if (lineLength >= 1)
				{
					thisTones = thisDictionaryLineArray[1];
				}
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerPojTextArea").value = thisPoj;
					document.getElementById("dictionaryEditorMediaViewerTonesTextArea").value = thisTones;
				} else {
					document.getElementById("taiwaneseDictionaryEditorPojTextArea").value = thisPoj;
					document.getElementById("taiwaneseDictionaryEditorTonesTextArea").value = thisTones;
				}
				
			} // end if there are search results
			
			
		} // end function taiwaneseDictionaryEditorDropdownChanged
		
		function taiwaneseMoveDefinitionToTop()
		{
			//debugLog("taiwaneseMoveDefinitionToTop");
			
			var definitionNumber = -1;
			
			if (useMediaViewer == true)
			{
				definitionNumber = document.getElementById('taiwaneseMediaViewerDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			} else {
				definitionNumber = document.getElementById('taiwaneseDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			}
			
			
			var thisWordChinese = "";
			
			if (useMediaViewer == true)
			{
				thisWordChinese = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
			}
			
			if (thisWordChinese == "")
			{
				thisWordChinese = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
				useMediaViewer = false;
			}
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (definitionNumber == 1)
				{
					return;
				} else {
					
					var thisDefinition = dictionaryResultsArray[definitionNumber];
										
					var taiwaneseDataArray = taiwaneseData.split("\n" + thisWordChinese + "	");
					
					var thisDefintionItem = taiwaneseDataArray[definitionNumber];
										
					thisDefintionItem = textBetween(thisDefintionItem, "start", "\n");
					//thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
					
					thisDefintionItem = "\n" + thisWordChinese + "	" + thisDefintionItem;
					
					taiwaneseData = replaceChars(taiwaneseData, thisDefintionItem, "");
					
					taiwaneseData = thisDefintionItem + "\n" + taiwaneseData;
					
					writeToFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseData);
					
					taiwaneseDictionaryEditorSearch();

				} // end if this is already the first definition
				
			} // end if there are search results
			
		} // end function taiwaneseMoveDefinitionToTop
		

		function taiwaneseMoveDefinitionUp()
		{
			//debugLog("taiwaneseMoveDefinitionUp");
			
			var definitionNumber = -1;
			
			if (useMediaViewer == true)
			{
				definitionNumber = document.getElementById('taiwaneseMediaViewerDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			}
			
			if (definitionNumber == -1)
			{
				definitionNumber = document.getElementById('taiwaneseDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			}
				
			document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (definitionNumber == 1)
				{
					return;
				} else {
					
					var thisDefinition = dictionaryResultsArray[definitionNumber];
					
					var higherDefinitionNumber = definitionNumber - 1;
					var higherDefinition = dictionaryResultsArray[higherDefinitionNumber];
					
					var taiwaneseDataArray = taiwaneseData.split("\n" + thisWordChinese + "	");
					
					// Swap the definitions in the array
					
					var higherDefintionItem = taiwaneseDataArray[higherDefinitionNumber];
					
					higherDefintionItem = textBetween(higherDefintionItem, "\n", "end");
					
					higherDefintionItem = thisDefinition + "\n" + higherDefintionItem;
					
					taiwaneseDataArray[higherDefinitionNumber] = higherDefintionItem;



					
					var thisDefintionItem = taiwaneseDataArray[definitionNumber];
										
					thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
					
					thisDefintionItem = higherDefinition + "\n" + thisDefintionItem;
					
					taiwaneseDataArray[definitionNumber] = thisDefintionItem;
					
					
					
					taiwaneseData = taiwaneseDataArray.join("\n" + thisWordChinese + "	");
					
					writeToFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseData);
					
					taiwaneseDictionaryEditorSearch();

				} // end if this is already the first definition
				
			} // end if there are search results
			
		} // end function taiwaneseMoveDefinitionUp

		function taiwaneseMoveDefinitionDown()
		{
			//debugLog("taiwaneseMoveDefinitionDown");
			
			var definitionNumber = -1;
			
			if (useMediaViewer == true)
			{
				definitionNumber = document.getElementById('taiwaneseMediaViewerDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			}
			
			if (definitionNumber == -1)
			{
				definitionNumber = document.getElementById('taiwaneseDefinitionDropdown').value;
				definitionNumber = definitionNumber * 1;
			}
			
			var thisWordChinese = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var lowerDefinitionNumber = definitionNumber + 1;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (numberResults < lowerDefinitionNumber)
				{
					return;
				} else {
					
					var thisDefinition = dictionaryResultsArray[definitionNumber];
					
					var lowerDefinition = dictionaryResultsArray[lowerDefinitionNumber];
					
					var taiwaneseDataArray = taiwaneseData.split("\n" + thisWordChinese + "	");
					
					// Swap the definitions in the array
					
					var lowerDefintionItem = taiwaneseDataArray[lowerDefinitionNumber];
					
					lowerDefintionItem = textBetween(lowerDefintionItem, "\n", "end");
					
					lowerDefintionItem = thisDefinition + "\n" + lowerDefintionItem;
					
					taiwaneseDataArray[lowerDefinitionNumber] = lowerDefintionItem;



					
					var thisDefintionItem = taiwaneseDataArray[definitionNumber];
										
					thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
					
					thisDefintionItem = lowerDefinition + "\n" + thisDefintionItem;
					
					taiwaneseDataArray[definitionNumber] = thisDefintionItem;
					
					
					
					taiwaneseData = taiwaneseDataArray.join("\n" + thisWordChinese + "	");
					
					writeToFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseData);
					
					taiwaneseDictionaryEditorSearch();

				} // end if this is already the first definition
				
			} // end if there are search results
			
		} // end function taiwaneseMoveDefinitionDown

		function taiwaneseDictionaryEditorAddButtonClicked()
		{
			//debugLog("taiwaneseDictionaryEditorAddButtonClicked");
			
			var thisWordChinese = "";
			var thisWordPoj = "";
			var thisWordTones = "";
			
			if (useMediaViewer == true)
			{
				thisWordChinese = document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value;
				thisWordPoj = document.getElementById("dictionaryEditorMediaViewerPojTextArea").value;
				thisWordTones = document.getElementById("dictionaryEditorMediaViewerTonesTextArea").value;
			}
			
			if (thisWordChinese == "")
			{
				useMediaViewer = false;
				
				thisWordChinese = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
				thisWordPoj = document.getElementById("taiwaneseDictionaryEditorPojTextArea").value;
				thisWordTones = document.getElementById("taiwaneseDictionaryEditorTonesTextArea").value;
			}
			
			var thisDefinition = "\n" + thisWordChinese + "	" + thisWordPoj + "	" + thisWordTones + "\n";
			
			var wordLength = stringLength(thisWordChinese);
		   
			switch (wordLength)
			{
				case 5: fiveWordsTaiwanese = "\n" + thisWordChinese + "\n" + fiveWordsTaiwanese; break;
				case 4: fourWordsTaiwanese = "\n" + thisWordChinese + "\n" + fourWordsTaiwanese; break;
				case 3: threeWordsTaiwanese = "\n" + thisWordChinese + "\n" + threeWordsTaiwanese; break;
				case 2: twoWordsTaiwanese = "\n" + thisWordChinese + "\n" + twoWordsTaiwanese; break;
				case 1: oneWordsTaiwanese = "\n" + thisWordChinese + "\n" + oneWordsTaiwanese;break;
				default: break;
			}
			
			// Append to top
			taiwaneseData = thisDefinition + taiwaneseData;
			
			writeToFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseData);
							
			taiwaneseDictionaryEditorSearch();
			
		} // end function taiwaneseDictionaryEditorAddButtonClicked

		function cantoneseDictionaryEditorSearch()
		{
			//debugLog("cantoneseDictionaryEditorSearch");
			
			var thisChineseString = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			
			thisChineseString = replaceChars(thisChineseString, "	", "");

			document.getElementById("dictionaryEditorChineseTextArea").value = thisChineseString;
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisChineseString);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (numberResults > 1)
				{
					var definitionDropdownInnerHtml = "";
					
					for (var currentResult = 1; currentResult < numberResults; currentResult++)
					{
						var thisResult = dictionaryResultsArray[currentResult];
						
						thisResult = textBetween(thisResult, "start", "	");
						
						definitionDropdownInnerHtml = definitionDropdownInnerHtml + "<option value=\"" + currentResult + "\">" + thisResult + "</option>";
						
					} // end for every other result
					
					document.getElementById("cantoneseDefinitionDropdown").innerHTML = definitionDropdownInnerHtml;
					
				} else {
					document.getElementById("cantoneseDefinitionDropdown").innerHTML = "";
				} // end if there is more than one result
				
				// First result is at index 1 because index 0 is the first part of the dictionary before the first search result
				var thisDictionaryLine = dictionaryResultsArray[1];
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				var lineLength = thisDictionaryLineArray.length;
				
				var thisYale = "";
				var thisTones = "";
				
				thisYale = thisDictionaryLineArray[0];
				
				if (lineLength >= 1)
				{
					thisTones = thisDictionaryLineArray[1];
				}
				
				document.getElementById("cantoneseDictionaryEditorYaleTextArea").value = thisYale;
				document.getElementById("cantoneseDictionaryEditorTonesTextArea").value = thisTones;
				
				
			} // end if there are search results
			
			
		} // end function cantoneseDictionaryEditorSearch

		function cantoneseDictionaryEditorDropdownChanged()
		{
			//debugLog("cantoneseDictionaryEditorDropdownChanged");
			
			var thisChineseString = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			
			thisChineseString = replaceChars(thisChineseString, "	", "");

			document.getElementById("cantoneseDictionaryEditorChineseTextArea").value = thisChineseString;
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisChineseString);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				var definitionNumber = document.getElementById('cantoneseDefinitionDropdown').value;
				
				// Show the user's requested definition number
				var thisDictionaryLine = dictionaryResultsArray[definitionNumber];
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				var lineLength = thisDictionaryLineArray.length;
				
				var thisYale = "";
				var thisTones = "";
				
				thisYale = thisDictionaryLineArray[0];
				
				if (lineLength >= 1)
				{
					thisTones = thisDictionaryLineArray[1];
				}
				
				document.getElementById("cantoneseDictionaryEditorYaleTextArea").value = thisYale;
				document.getElementById("cantoneseDictionaryEditorTonesTextArea").value = thisTones;
				
				
			} // end if there are search results
			
			
		} // end function cantoneseDictionaryEditorDropdownChanged
		
		function cantoneseMoveDefinitionUp()
		{
			//debugLog("cantoneseMoveDefinitionUp");
			
			var definitionNumber = document.getElementById('cantoneseDefinitionDropdown').value;
			definitionNumber = definitionNumber * 1;
				
			var thisWordChinese = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (definitionNumber == 1)
				{
					return;
				} else {
					
					var thisDefinition = dictionaryResultsArray[definitionNumber];
					
					var higherDefinitionNumber = definitionNumber - 1;
					var higherDefinition = dictionaryResultsArray[higherDefinitionNumber];
					
					var cantoneseDataArray = cantoneseData.split("\n" + thisWordChinese + "	");
					
					// Swap the definitions in the array
					
					var higherDefintionItem = cantoneseDataArray[higherDefinitionNumber];
					
					higherDefintionItem = textBetween(higherDefintionItem, "\n", "end");
					
					higherDefintionItem = thisDefinition + "\n" + higherDefintionItem;
					
					cantoneseDataArray[higherDefinitionNumber] = higherDefintionItem;



					
					var thisDefintionItem = cantoneseDataArray[definitionNumber];
										
					thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
					
					thisDefintionItem = higherDefinition + "\n" + thisDefintionItem;
					
					cantoneseDataArray[definitionNumber] = thisDefintionItem;
					
					
					
					cantoneseData = cantoneseDataArray.join("\n" + thisWordChinese + "	");
					
					writeToFile("cantoneseChineseWordsTones.txt", cantoneseData);
					
					cantoneseDictionaryEditorSearch();

				} // end if this is already the first definition
				
			} // end if there are search results
			
		} // end function cantoneseMoveDefinitionUp

		function cantoneseMoveDefinitionDown()
		{
			//debugLog("cantoneseMoveDefinitionDown");
			
			var definitionNumber = document.getElementById('cantoneseDefinitionDropdown').value;
			definitionNumber = definitionNumber * 1;
				
			var thisWordChinese = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			var lowerDefinitionNumber = definitionNumber + 1;
			
			if (numberResults == 0)
			{
				return;
			} else {
				
				if (numberResults < lowerDefinitionNumber)
				{
					return;
				} else {
					
					var thisDefinition = dictionaryResultsArray[definitionNumber];
					
					var lowerDefinition = dictionaryResultsArray[lowerDefinitionNumber];
					
					var cantoneseDataArray = cantoneseData.split("\n" + thisWordChinese + "	");
					
					// Swap the definitions in the array
					
					var lowerDefintionItem = cantoneseDataArray[lowerDefinitionNumber];
					
					lowerDefintionItem = textBetween(lowerDefintionItem, "\n", "end");
					
					lowerDefintionItem = thisDefinition + "\n" + lowerDefintionItem;
					
					cantoneseDataArray[lowerDefinitionNumber] = lowerDefintionItem;



					
					var thisDefintionItem = cantoneseDataArray[definitionNumber];
										
					thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
					
					thisDefintionItem = lowerDefinition + "\n" + thisDefintionItem;
					
					cantoneseDataArray[definitionNumber] = thisDefintionItem;
					
					
					
					cantoneseData = cantoneseDataArray.join("\n" + thisWordChinese + "	");
					
					writeToFile("cantoneseChineseWordsTones.txt", cantoneseData);
					
					cantoneseDictionaryEditorSearch();

				} // end if this is already the first definition
				
			} // end if there are search results
			
		} // end function cantoneseMoveDefinitionDown

		function cantoneseDictionaryEditorAddButtonClicked()
		{
			//debugLog("cantoneseDictionaryEditorAddButtonClicked");
			
			var thisWordChinese = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			var thisWordYale = document.getElementById("cantoneseDictionaryEditorYaleTextArea").value;
			var thisWordTones = document.getElementById("cantoneseDictionaryEditorTonesTextArea").value;
			
			var thisDefinition = "\n" + thisWordChinese + "	" + thisWordYale + "	" + thisWordTones + "\n";
			
			cantoneseData = cantoneseData + thisDefinition;
			
			writeToFile("cantoneseChineseWordsTones.txt", cantoneseData);
							
			cantoneseDictionaryEditorSearch();
			
		} // end function cantoneseDictionaryEditorAddButtonClicked


		function taiwaneseDictionaryEditorEditButtonClicked()
		{
			//debugLog("taiwaneseDictionaryEditorEditButtonClicked");
			
			var thisWordChinese = document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value;
			var thisWordPoj = document.getElementById("taiwaneseDictionaryEditorPojTextArea").value;
			var thisWordTones = document.getElementById("taiwaneseDictionaryEditorTonesTextArea").value;
			
			var thisDefinition = "\n" + thisWordChinese + "	" + thisWordPoj + "	" + thisWordTones + "\n";
			
			var dictionaryResultsArray = dictionarySearchTaiwanese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				taiwaneseDictionaryEditorAddButtonClicked();
			} else {
			
				// Edit the word
				
				var definitionNumber = document.getElementById('definitionDropdown').value;
				definitionNumber = definitionNumber * 1;
				
				var taiwaneseDataArray = taiwaneseData.split("\n" + thisWordChinese + "	");
				
				var thisDefintionItem = taiwaneseDataArray[definitionNumber];
									
				thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
				
				thisDefintionItem = thisDefinition + "\n" + thisDefintionItem;
				
				taiwaneseDataArray[definitionNumber] = thisDefintionItem;
				
				taiwaneseData = taiwaneseDataArray.join("\n" + thisWordChinese + "	");
				
			} // end if the word isn't already in the dictionary
			
			
			writeToFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseData);
							
			taiwaneseDictionaryEditorSearch();
			
		} // end function taiwaneseDictionaryEditorEditButtonClicked
		
		function cantoneseDictionaryEditorEditButtonClicked()
		{
			//debugLog("taiwaneseDictionaryEditorEditButtonClicked");
			
			var thisWordChinese = document.getElementById("cantoneseDictionaryEditorChineseTextArea").value;
			var thisWordYale = document.getElementById("cantoneseDictionaryEditorYaleTextArea").value;
			var thisWordTones = document.getElementById("cantoneseDictionaryEditorTonesTextArea").value;
			
			var thisDefinition = "\n" + thisWordChinese + "	" + thisWordYale + "	" + thisWordTones + "\n";
			
			var dictionaryResultsArray = dictionarySearchCantonese(thisWordChinese);
			
			var numberResults = dictionaryResultsArray.length;
			
			if (numberResults == 0)
			{
				cantoneseDictionaryEditorAddButtonClicked();
			} else {
			
				// Edit the word
				
				var definitionNumber = document.getElementById('definitionDropdown').value;
				definitionNumber = definitionNumber * 1;
				
				var cantoneseDataArray = cantoneseData.split("\n" + thisWordChinese + "	");
				
				var thisDefintionItem = cantoneseDataArray[definitionNumber];
									
				thisDefintionItem = textBetween(thisDefintionItem, "\n", "end");
				
				thisDefintionItem = thisDefinition + "\n" + thisDefintionItem;
				
				cantoneseDataArray[definitionNumber] = thisDefintionItem;
				
				cantoneseData = cantoneseDataArray.join("\n" + thisWordChinese + "	");
				
			} // end if the word isn't already in the dictionary
			
			
			writeToFile("cantoneseChineseWordsTones.txt", cantoneseData);
							
			cantoneseDictionaryEditorSearch();
			
		} // end function taiwaneseDictionaryEditorEditButtonClicked
		
		function dictionaryToWordLengths()
		{
			//debugLog("dictionaryToWordLengths");
		
			var combinedDictionaryDataLines = combinedDictionaryData.split("\n");
			
			var numberLines = combinedDictionaryDataLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = combinedDictionaryDataLines[currentLine];
			
				if (thisLine != "")
				{
					var thisChinese = textBetween(thisLine, "start", "	");
					
					var wordLength = stringLength(thisChinese);
					
					switch (wordLength)
					{
						case 5: fiveWords = fiveWords + thisChinese + "\n"; break;
						case 4: fourWords = fourWords + thisChinese + "\n"; break;
						case 3: threeWords = threeWords + thisChinese + "\n"; break;
						case 2: twoWords = twoWords + thisChinese + "\n"; break;
						case 1: oneWords = oneWords + thisChinese + "\n"; break;
						default: break;
					}
					
				} // end if the line is not blank
			} // end for every line in the dictionary
			

		} // end function dictionaryToWordLengths

		function taiwaneseToWordLengths()
		{
			//debugLog("taiwaneseToWordLengths");
		
			var taiwaneseDataLines = taiwaneseData.split("\n");
			
			var numberLines = taiwaneseDataLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = taiwaneseDataLines[currentLine];
			
				if (thisLine != "")
				{
					var thisChinese = textBetween(thisLine, "start", "	");
					
					var wordLength = stringLength(thisChinese);
					
					switch (wordLength)
					{
						case 5: fiveWordsTaiwanese = fiveWordsTaiwanese + thisChinese + "\n"; break;
						case 4: fourWordsTaiwanese = fourWordsTaiwanese + thisChinese + "\n"; break;
						case 3: threeWordsTaiwanese = threeWordsTaiwanese + thisChinese + "\n"; break;
						case 2: twoWordsTaiwanese = twoWordsTaiwanese + thisChinese + "\n"; break;
						case 1: oneWordsTaiwanese = oneWordsTaiwanese + thisChinese + "\n"; break;
						default: break;
					}
					
				} // end if the line is not blank
			} // end for every line in the dictionary
			

		} // end function taiwaneseToWordLengths

		function hakkaToWordLengths()
		{
			//debugLog("hakkaToWordLengths");
		
			var hakkaDataLines = hakkaData.split("\n");
			
			var numberLines = hakkaDataLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = hakkaDataLines[currentLine];
			
				if (thisLine != "")
				{
					var thisChinese = textBetween(thisLine, "start", "	");
					
					var wordLength = stringLength(thisChinese);
					
					switch (wordLength)
					{
						case 5: fiveWordsHakka = fiveWordsHakka + thisChinese + "\n"; break;
						case 4: fourWordsHakka = fourWordsHakka + thisChinese + "\n"; break;
						case 3: threeWordsHakka = threeWordsHakka + thisChinese + "\n"; break;
						case 2: twoWordsHakka = twoWordsHakka + thisChinese + "\n"; break;
						case 1: oneWordsHakka = oneWordsHakka + thisChinese + "\n"; break;
						default: break;
					}
					
				} // end if the line is not blank
			} // end for every line in the dictionary
			

		} // end function hakkaToWordLengths

		
		function dictionariesLoaded()
		{
			//debugLog("dictionariesLoaded");

			if ((combinedDictionaryData == "") || (combinedDictionaryData == undefined))
			{
				combinedDictionaryData = localStorage["dictionary"];
			}
						
			if ((combinedDictionaryData == "") || (combinedDictionaryData == undefined))
			{
			    document.getElementById("chineseTextArea").value = "Error loading dictionaries";
			    
			    return;
			}

			dictionaryToWordLengths();
			
			// If we have parameters
			if ((QueryString.command != "") && (QueryString.command != undefined))
			{
			    eval(QueryString.command);
			}

			// If we have a word list
			if ((QueryString.wordList != "") && (QueryString.wordList != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var wordList = QueryString.wordList;
				
				//debugLog(wordList);
				
				if (wordList == "tocfl")
				{
					loadCommonWords("wordLists/TOCFL/tocfl.txt");
				}
				
				if (wordList == "fireEx")
				{
					loadCommonWords("wordLists/fireExWords.txt");
				}
				
			}

			// If we have an English file
			if ((QueryString.englishFile != "") && (QueryString.englishFile != undefined))
			{
				//var englishUrl = encodeURI(QueryString.englishFile);
				var englishUrl = QueryString.englishFile;
			
			    loadEnglish(englishUrl);
			}

			// If we have a literal file
			if ((QueryString.literalFile != "") && (QueryString.literalFile != undefined))
			{
				var literalUrl = QueryString.literalFile;
			
			    loadLiteral(literalUrl);
			    
			    document.getElementById('litManCheckbox').checked = true;
			}

			// If we want to edit
			if ((QueryString.edit != "") && (QueryString.edit != undefined))
			{
				openDictionaryEditor();
			}

			// If we have a Taiwanese file
			if ((QueryString.taiwaneseFile != "") && (QueryString.taiwaneseFile != undefined))
			{
				//var taiwaneseUrl = encodeURI(QueryString.taiwaneseFile);
				var taiwaneseUrl = QueryString.taiwaneseFile;
				
			    document.getElementById('pinyinCheckbox').checked = false;
				document.getElementById('taiwaneseCheckbox').checked = true;
				
				loadTaiwaneseAndFile("TaiwaneseDictionaryTaiyuNumbers.txt", taiwaneseUrl);
				
				// If we want to edit
				if ((QueryString.edit != "") && (QueryString.edit != undefined))
				{
					openTaiwaneseDictionaryEditor();
				}
				
			    //loadTaiwaneseFile(taiwaneseUrl);
			}
			
			// If we have a Chinese file
			if ((QueryString.chineseFile != "") && (QueryString.chineseFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var chineseUrl = QueryString.chineseFile;

			    loadChinese(chineseUrl);
			    
			    var chineseFilename = QueryString.chineseFile;
			    while (contains(chineseFilename, "/") == true)
			    {
			    	chineseFilename = textBetween(chineseFilename, "/", "end")
			    }
			    
			    document.title = chineseFilename;
			}

			// If we have a bilingual file
			if ((QueryString.bilingualFile != "") && (QueryString.bilingualFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var bilingualUrl = QueryString.bilingualFile;

			    var bilingualFilename = QueryString.bilingualFile;
			    while (contains(bilingualFilename, "/") == true)
			    {
			    	bilingualFilename = textBetween(bilingualFilename, "/", "end")
			    }

			    loadBilingual(bilingualUrl);
			    
			    document.title = bilingualFilename;
			}

			// If we have an audio file
			if ((QueryString.audioFile != "") && (QueryString.audioFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var audioUrl = QueryString.audioFile;

			    loadAudioMediaViewer(audioUrl);
			    openMediaViewer();
			}

			// If we have an lrc file
			if ((QueryString.lrcFile != "") && (QueryString.lrcFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var lrcUrl = QueryString.lrcFile;

			    loadLrcMediaViewer(lrcUrl);
			    openMediaViewer();
			}

			// If we have an image file
			if ((QueryString.imageFile != "") && (QueryString.imageFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var imageUrl = QueryString.imageFile;
				
				document.getElementById("imagePath").innerText = imageUrl;
				
				listImageFolder(imageUrl);
				
			    loadImageMediaViewer(imageUrl);
			    openMediaViewer();
			} else {
				document.getElementById("imageControls").style.visibility = "hidden";
				document.getElementById("imageControls").style.width = "0px";
				//$("#mediaViewer").dialog( "option", "width", 620 );
			}
			
			// If we have Taiwanese text
			if ((QueryString.taiwaneseText != "") && (QueryString.taiwaneseText != undefined))
			{
				var thisText = QueryString.taiwaneseText;
				
				thisText = replaceChars(thisText, "§", "\n");
			
			    document.getElementById("chineseTextArea").value = thisText;
			    document.getElementById("englishTextArea").value = "";
			    
			    document.getElementById('pinyinCheckbox').checked = false;
				document.getElementById('taiwaneseCheckbox').checked = true;
				
				loadTaiwaneseAndTranslate("TaiwaneseDictionaryTaiyuNumbers.txt");
			}

			// If we need Oracle bones
			if ((QueryString.oracleBones != "") && (QueryString.oracleBones != undefined))
			{
				toggleCheckbox('oracleBonesCheckbox');
			}

			// If we have Chinese text
			if ((QueryString.text != "") && (QueryString.text != undefined))
			{
				var thisText = QueryString.text;
				
				thisText = replaceChars(thisText, "§", "\n");
			
			    document.getElementById("chineseTextArea").value = thisText;
			    document.getElementById("englishTextArea").value = "";
			    
			    wordSpaceButtonClicked();
			    
			    translateBilingualInterface();
			}
			
			// If we have simplified
			if ((QueryString.simplified != "") && (QueryString.simplified != undefined))
			{
			    document.getElementById("chineseTextArea").value = QueryString.simplified;
			    document.getElementById("englishTextArea").value = "";
			    
			    wordSpaceButtonClicked();
			    
			    translateInterface();
			}


		} // end function dictionariesLoaded
		
		function isPhpRunningResponseHandler(request)
		{
		  //debugLog("appendToFileResponseHandler");
		  if (request.readyState == 4)
		  {
			// The request is done
			if (request.status == 200)
			{
			  // All is well
			  
			  
			}
		  }

		  return;
		}
		  		
		function isPhpRunning()
		{
			//debugLog("isPhpRunning");
			
			var url = "whoami.php";

			var thisRequest = new XMLHttpRequest();
		    thisRequest.open("GET",url,true);
    		thisRequest.send();

    		thisRequest.onreadystatechange = function(){
    			if (thisRequest.readyState== 4 && thisRequest.status == 200)
    			{
					//debugLog(thisRequest.responseText);

    				if (contains(thisRequest.responseText, "php"))
    				{
    					document.getElementById("useGithubCheckbox").checked = true;
    				} else {
    					document.getElementById("useGithubCheckbox").checked = false;
    				}
                } else {
    				document.getElementById("useGithubCheckbox").checked = true;
                }
            }
		} // end function isPhpRunning
		
		function uploadButtonClicked()
		{
			//debugLog("uploadButtonClicked");
			
			var uploadedCount = localStorage["uploadedCount"];
			
			if (uploadedCount == undefined)
			{
				uploadedCount = 0;
			} else {
				uploadedCount = uploadedCount * 1;
			}
			
			var addWords = localStorage["addWords"];
			
			if (addWords == undefined)
			{
				addWords = "";
			}
			
			if (addWords != "")
			{
				appendToGithub("addWords.txt", addWords);
				
				uploadedCount = uploadedCount + addWords.split("\n").length - 1;

				localStorage["addWords"] = "";
			}

			var editWords = localStorage["editWords"];
			
			if (editWords == undefined)
			{
				editWords = "";
			}
			
			if (editWords != "")
			{
				appendToGithub("editWords.txt", editWords);

				uploadedCount = uploadedCount + editWords.split("\n").length - 1;
				
				localStorage["editWords"] = "";
			}

			var removeWords = localStorage["removeWords"];
			
			if (removeWords == undefined)
			{
				removeWords = "";
			}
			
			if (removeWords != "")
			{
				appendToGithub("removeWords.txt", removeWords);

				uploadedCount = uploadedCount + removeWords.split("\n").length - 1;

				localStorage["removeWords"] = "";
			}

			localStorage["uploadedCount"] = uploadedCount;
			
			dictionaryEditorEditCounts();
			
		} // end function uploadButtonClicked
		
		function helpButtonClicked()
		{
			//debugLog("helpButtonClicked");
			
			var thisUrl = "docs/index.html";
			window.open(thisUrl,'_blank');
			
		} // end function helpButtonClicked
		
		function simplifiedToTraditional(thisChinese)
		{
			//debugLog("simplifiedToTraditional");
			
			var traditionalChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = stringLength(thisChineseLine);
				var lastWasNotChinese = false;
				var traditionalChineseLine = "";
				
				var lineIsEnglish = true;
								
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisWord = "";
				
					var wordFound = false;
					
					for (var wordLength = 5; wordLength >= 2; wordLength--)
					{
				
						var lastCharacter = currentCharacter + wordLength;
						
						if (lastCharacter > numberCharacters)
						{
							lastCharacter = numberCharacters;
						}
						
						thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
						var thisCharacter = thisChineseLine[currentCharacter];

						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							//traditionalChineseLine = traditionalChineseLine + thisCharacter;
						
							//lastWasNotChinese = true;
							
							// Move the character along in the string
							//currentCharacter = currentCharacter + 1;
							
							wordFound == false;
							
						} else {

							//lastWasNotChinese = false;
							
							var inDictionary = contains(simplifiedData, "\n" + thisWord + "	");
							
							//if (contains(longWords, " " + thisWord) == true)
							if (inDictionary == true)
							{
								// Move the character along in the string
								currentCharacter = currentCharacter + wordLength - 1;
							
								wordFound = true;
						
								// Exit the loop cleanly
								wordLength = 0;
							} // end if the character is not Chinese
							
						} // if the word exists
					
					} // end for every word length
				
					// If the word is not found, just use the character
					if (wordFound == false)
					{
						var thisCharacter = thisChineseLine[currentCharacter];
					
						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							traditionalChineseLine = traditionalChineseLine + thisCharacter;
							
							lastWasNotChinese = true;
						
						} else {
						
							// Add a space if we're back to parsing Chinese
							if (lastWasNotChinese == true)
							{
								//traditionalChineseLine = traditionalChineseLine + " ";
								lastWasNotChinese = false;
							}
							
							if (contains(simplifiedData, "\n" + thisCharacter + "	"))
							{
								var traditionalCharacter = textBetween(simplifiedData, "\n" + thisCharacter + "	", "\n");
								traditionalCharacter = textBetween(traditionalCharacter, "start", " ");
								//traditionalChineseLine = traditionalChineseLine + traditionalCharacter + " ";
								traditionalChineseLine = traditionalChineseLine + traditionalCharacter;
							} else {
								//traditionalChineseLine = traditionalChineseLine + thisCharacter + " ";					
								traditionalChineseLine = traditionalChineseLine + thisCharacter;
							}
							

						} // end if this character is not Chinese
					
					} else {

						// Add a space if we're back to parsing Chinese
						if (lastWasNotChinese == true)
						{
							traditionalChineseLine = traditionalChineseLine + " ";
							lastWasNotChinese = false;
						}
						
						var traditionalWord = textBetween(simplifiedData, "\n" + thisWord + "	", "\n");
						traditionalWord = textBetween(traditionalWord, "start", " ");

						//traditionalChineseLine = traditionalChineseLine + traditionalWord + " ";
						traditionalChineseLine = traditionalChineseLine + traditionalWord;

					} // end if the word was not found
								
				
				} // end for every character
				
				traditionalChinese = traditionalChinese + traditionalChineseLine + "\n";

			} // end for every line
			
			return traditionalChinese;
			
		} // end function simplifiedToTraditional
		
		function simplifiedToTraditionalButtonClicked()
		{
			//debugLog("simplifiedToTraditionalButtonClicked");

			var thisChinese = document.getElementById("simplifiedInputTextArea").value;
			
			var traditionalChinese = simplifiedToTraditional(thisChinese);
			
			document.getElementById("chineseTextArea").value = traditionalChinese;
			
		} // end function simplifiedToTraditionalButtonClicked
		
		function spacedToSimplifiedButtonClicked()
		{
			//debugLog("spacedToSimplifiedButtonClicked");
			
			var spacedTraditional = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedWords = spacedTraditional.split(" ");
			
			var numberWords = spacedWords.length;
			
			var spacedSimplified = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedWords[currentWord];
				
				// Translate the word
				if (contains(traditionalData, "\n" + thisWord + "	", "\n"))
				{
					var simplifiedWord = textBetween(traditionalData, "\n" + thisWord + "	", "\n");
					simplifiedWord = textBetween(simplifiedWord, "start", " ");
					
					spacedSimplified = spacedSimplified + simplifiedWord + " ";
					
				} else {
					
					// Translate the characters
					
					var thisWordCharacters = stringToCharacterArray(thisWord);
					var numberCharacters = thisWordCharacters.length;
					
					var thisWordSimplified = "";
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacter = thisWordCharacters[currentCharacter];
						
						if (contains(traditionalData, "\n" + thisCharacter + "	", "\n"))
						{
							var simplifiedCharacter = textBetween(traditionalData, "\n" + thisCharacter + "	", "\n");
							simplifiedCharacter = textBetween(simplifiedCharacter, "start", " ");
							thisWordSimplified = thisWordSimplified + simplifiedCharacter;
						} else {
							thisWordSimplified = thisWordSimplified + thisCharacter;
						} // end if the character is in the dictionary
						
					} // end for every character
					
					
					spacedSimplified = spacedSimplified + thisWordSimplified + " ";
				
				} // end if the word is in the traditional phrases
				
				
			} // end for every word
			
			document.getElementById("simplifiedSpacedTextArea").value = spacedSimplified;
			
		} // end function spacedToSimplifiedButtonClicked

		function hongKongButtonClicked()
		{
			//debugLog("hongKongButtonClicked");
			
			var spacedChinese = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedChineseWordsArray = spacedChinese.split(" ");
			
			var numberWords = spacedChineseWordsArray.length;
			
			var hongKongeseChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedChineseWordsArray[currentWord];
			
				if (contains(hongKongData, "\n" + thisWord + "	"))
				{
					var thishongKongeseWord = textBetween(hongKongData, "\n" + thisWord + "	", "\n");
					thishongKongeseWord = textBetween(thishongKongeseWord, "start", " ");
					
					hongKongeseChinese = hongKongeseChinese + thishongKongeseWord + " ";
				} else {
					hongKongeseChinese = hongKongeseChinese + thisWord + " ";
				}
			} // end for every word
			
			document.getElementById("chineseSpacedTextArea").value = hongKongeseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			translateInterface();
			
		} // end function hongKongButtonClicked

		function taiwanButtonClicked()
		{
			//debugLog("taiwanButtonClicked");
			
			//debugLog(taiwanData);
			
			var chineseCharacters = document.getElementById("chineseTextArea").value;
			
			var chineseCharactersArray = stringToCharacterArray(chineseCharacters);
			
			var numberCharacters = chineseCharactersArray.length;
			
			var taiwaneseChinese = "";
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = chineseCharactersArray[currentCharacter];
			
				if (contains(taiwanData, "\n" + thisCharacter + "	"))
				{
					var thisTaiwaneseCharacter = textBetween(taiwanData, "\n" + thisCharacter + "	", "\n");
					thisTaiwaneseCharacter = textBetween(thisTaiwaneseCharacter, "start", " ");
					
					taiwaneseChinese = taiwaneseChinese + thisTaiwaneseCharacter;
				} else {
					taiwaneseChinese = taiwaneseChinese + thisCharacter;
				}
			} // end for every word
			
			document.getElementById("chineseTextArea").value = taiwaneseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			//translateInterface();
			
		} // end function taiwanButtonClicked

		function japanButtonClicked()
		{
			//debugLog("japanButtonClicked");
			
			var spacedChinese = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedChineseWordsArray = spacedChinese.split(" ");
			
			var numberWords = spacedChineseWordsArray.length;
			
			var japaneseChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedChineseWordsArray[currentWord];
			
				if (contains(japanData, "\n" + thisWord + "	"))
				{
					var thisjapaneseWord = textBetween(japanData, "\n" + thisWord + "	", "\n");
					thisjapaneseWord = textBetween(thisjapaneseWord, "start", " ");
					
					japaneseChinese = japaneseChinese + thisjapaneseWord + " ";
				} else {
					japaneseChinese = japaneseChinese + thisWord + " ";
				}
			} // end for every word
			
			document.getElementById("chineseSpacedTextArea").value = japaneseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			translateInterface();
			
		} // end function japanButtonClicked

		function hexToChineseButtonClicked()
		{
			//debugLog("hexToChineseButtonClicked");

			var thisInputPhrase = document.getElementById("simplifiedInputTextArea").value;
			
			var thisInputPhraseArray = thisInputPhrase.split(" ");
			
			if (thisInputPhraseArray == null)
			{
				return;
			}
			
			var numberWords = thisInputPhraseArray.length;
			
			var thisChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisInputPhraseArray[currentWord];
				
				var thisWordChinese = hexToCharacter(thisWord);
				
				thisChinese = thisChinese + thisWordChinese;
				
			} // end for every hex word
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
		} // end function hexToChineseButtonClicked

		function unitypeToChineseButtonClicked()
		{
			//debugLog("unitypeToChineseButtonClicked");

			var thisInputPhrase = document.getElementById("simplifiedInputTextArea").value;
			
			var thisInputPhraseArray = thisInputPhrase.split(" ");
			
			if (thisInputPhraseArray == null)
			{
				return;
			}
			
			var numberWords = thisInputPhraseArray.length;
			
			var thisChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisInputPhraseArray[currentWord];
				
				var thisWordChinese = unitypeToCharacter(thisWord);
				
				thisChinese = thisChinese + thisWordChinese;
				
			} // end for every hex word
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
		} // end function unitypeToChineseButtonClicked

		function useSimplified()
		{
			//debugLog("useSimplified");
			
			document.getElementById('simplifiedSpacedCheckbox').checked = true;
		} // end function useSimplified
		
		function cleanHtml(thisString)
		{
			//debugLog("cleanHtml(" + thisString + ")");
			
			var regex = /(<([^>]+)>)/ig;
			
			var cleanText = thisString.replace(regex, "");
			
			return cleanText;
			
		} // end function cleanHtml
		
		function listOffset(thisArray, thisString)
		{
			//debugLog("listOffset(" + thisArray.join("	") + "," + thisString + ")");
			
			thisString = " " + thisString + " ";
			
			var foundOffset = -1;
			
			var arrayLength = thisArray.length;
			
			for (var currentItem = 0; currentItem < arrayLength; currentItem++)
			{
				var thisItem = " " + thisArray[currentItem] + " ";
				
				if (contains(thisItem, thisString) == true)
				{
					foundOffset = currentItem;
					break;
				} // end
				
			} // end for every item in the array
			
			
			//debugLog(foundOffset);
			
			return foundOffset;
			
		} // end function listOffset

		function zeroPad(thisNumber, thisLength) 
		{
			var thisText = "" + thisNumber;
		
			var startLength = thisText.length;

			for (var currentLength = startLength; currentLength < thisLength; currentLength++)
			{
				thisText = "0" + thisText;
			}
			
			//debugLog(thisText);
			
			return thisText;
		} // end function zeroPad
		
		function numberToTime(thisEndTimeNumber)
		{
			//debugLog("numberToTime");

			thisEndTimeSeconds = Math.floor(thisEndTimeNumber);
			thisEndTimeMilliseconds = thisEndTimeNumber - thisEndTimeSeconds;
			
			thisEndTimeMilliseconds = Math.floor(thisEndTimeMilliseconds * 1000);
			
			thisEndTimeHours = 0;
			
			while (thisEndTimeSeconds > 3600)
			{
				thisEndTimeHours = thisEndTimeHours + 1;
				thisEndTimeSeconds = thisEndTimeSeconds - 3600;
			}
							
			thisEndTimeMinutes = Math.floor(thisEndTimeSeconds / 60);
			
			thisEndTimeSeconds = thisEndTimeSeconds - (thisEndTimeMinutes * 60);
			
			thisEndTimeHours = zeroPad(thisEndTimeHours, 2);
			thisEndTimeMinutes = zeroPad(thisEndTimeMinutes, 2);
			thisEndTimeSeconds = zeroPad(thisEndTimeSeconds, 2);
			thisEndTimeMilliseconds = zeroPad(thisEndTimeMilliseconds, 3);
			
			thisEndTime = thisEndTimeHours + ":" + thisEndTimeMinutes + ":" + thisEndTimeSeconds + "," + thisEndTimeMilliseconds;
			
			return thisEndTime;
		} // end function numberToTime
		
		function timeToNumber(thisTimeString)
		{
			//debugLog("timeToNumber " + thisTimeString);
		
			var thisTimeHours = textBetween(thisTimeString, "start", ":");
			var thisTimeMinutesSeconds = textBetween(thisTimeString, ":", ",");
			var thisTimeMinutes = textBetween(thisTimeMinutesSeconds, "start", ":");
			var thisTimeSeconds = textBetween(thisTimeMinutesSeconds, ":", "end");
			var thisTimeMilliseconds = textBetween(thisTimeString, ",", "end");
			
			var thisTimeHoursInteger = 0;
			if (thisTimeHours != "")
			{
				thisTimeHoursInteger = thisTimeHours * 1;
			}
			
			var thisTimeMinutesInteger = 0;
			if (thisTimeMinutes != "")
			{
				thisTimeMinutesInteger = thisTimeMinutes * 1;
			}
			
			var thisTimeSecondsInteger = 0;
			if (thisTimeSeconds != "")
			{
				thisTimeSecondsInteger = thisTimeSeconds * 1;
			}
			
			var thisTimeMillisecondsInteger = thisTimeMilliseconds;
			if (thisTimeMilliseconds != "")
			{
				thisTimeMillisecondsInteger = thisTimeMilliseconds * 1;
			}
			
			var thisTimeNumber = thisTimeHoursInteger * 3600 + thisTimeMinutesInteger * 60 + thisTimeSecondsInteger * 1 + thisTimeMillisecondsInteger / 1000;
			
			//debugLog(thisTimeString);
			//debugLog(thisTimeNumber);
			
			return thisTimeNumber;
			
		} // end function timeToNumber
		
		// subtitlesTwoButtonClicked - This was subtitlesButtonClicked when there were only two lines: Chinese & English. Lyrics show multiple, and that is hard.
		function subtitlesTwoButtonClicked()
		{
			//debugLog("subtitlesTwoButtonClicked");
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;
			document.getElementById('breakMissingWordsCheckbox').checked = true;
			document.getElementById('monospaceTextCheckbox').checked = false;
			
			var subtitlesText = document.getElementById("simplifiedInputTextArea").value;
			
			var subtitlesLines = subtitlesText.split("\n");
			
			var numberLines = subtitlesLines.length;
			
			// Combine subtitles into correctly alternating lines
			var numbersText = "";
			var timesText = "";
			var englishText = "";
			var chineseText = "";
			var thisSubtitleNumber = "";
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = subtitlesLines[currentLine];
				
				var lineLength = stringLength(thisLine);
				
				if (thisLine == "")
				{
					numbersText = numbersText + "\n";
					timesText = timesText + "\n";
					englishText = englishText + "\n";
					chineseText = chineseText + "\n";
					thisSubtitleNumber = "";
				} else {
					if ((isNumberString(thisLine) == true) && (thisSubtitleNumber == ""))
					{
						numbersText = numbersText + thisLine;
						thisSubtitleNumber = thisLine;
					} else {
						// If this line is a time
						if (contains(thisLine, " --> ") == true)
						{
							timesText = timesText + thisLine;
						} else {
							var cleanText = cleanHtml(thisLine);
							
							if (containsChineseString(cleanText) == true)
							{
								chineseText = chineseText + cleanText + " ";
							} else {
								// extra spaces in case we concatenate two lines
								englishText = englishText + cleanText + " ";
							}
						} // end if time
					} // end if number string
				} // end if blank line

			} // end for every line in the subtitles
			
			chineseText = replaceChars(chineseText, " \n", "\n");
			englishText = replaceChars(englishText, " \n", "\n");
			
			// Process the Chinese text
			
			chineseText = despace(chineseText);
			
			var despacedChineseText = chineseText;
			var despacedChineseTextArray = chineseText.split("\n");
			
			//chineseText = simplifiedToTraditional(chineseText);
			chineseText = wordSpace(chineseText);
			chineseText = replaceChars(chineseText, "\n ", "\n");
			
			// For every line in the numbers/times/chinese/english text
			
			var numbersTextArray = numbersText.split("\n");
			var timesTextArray = timesText.split("\n");
			var englishTextArray = englishText.split("\n");
			var chineseTextArray = chineseText.split("\n");
			
			
			
			numberLines = numbersTextArray.length;
			
			var subtitlesOutput = "";
			
			var chineseHtmlArray = [];
			
			var pinyinTextArray = [];
			var pinyinHtmlArray = [];
			
			var literalHtmlArray = [];
			var literalTextArray = [];
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var numbersTextLine = numbersTextArray[currentLine];
				var timesTextLine = timesTextArray[currentLine];
				var englishTextLine = englishTextArray[currentLine];				
				var chineseTextLine = chineseTextArray[currentLine];
				
				var translationOutput = translateText(chineseTextLine, englishTextLine);
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
								
				var translatedTextArray = translatedText.split("\n");
				var translatedTextChinese = translatedTextArray[0];
				var translatedTextPinyin = translatedTextArray[1];
				var translatedTextLiteral = translatedTextArray[2];
				var translatedTextEnglish = translatedTextArray[3];
				
				pinyinTextArray.push(translatedTextPinyin);
				
				/*
				translatedTextChinese = "<font size=\"17\">" + translatedTextChinese + "</font>";
				
				subtitlesOutput = subtitlesOutput + "\n" + numbersTextLine + "\n" + timesTextLine + "\n" + translatedTextChinese + "\n"  + translatedTextPinyin + "\n" + translatedTextLiteral + "\n" + translatedTextEnglish + "\n" + "\n";
				*/
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				var translatedHtmlArray = translatedHtml.split("</tr><tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];

				var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
				var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
				var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
				var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
				var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");

				chineseHtmlArray.push(translatedHtmlChinese);
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</div>", "</font>");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"englishInChinese\">", "<font color=#" + chineseColourOne + ">");
				
				while (contains(translatedHtmlChinese, "  ") == true)
				{
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "  ", " ");
				}

				translatedHtmlChinese = "<font size=\"20\">" + translatedHtmlChinese + "</font>";
				
				var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
				var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
				var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
				var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
				var pinyinColourFive = pinyinColourOne;

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<tr>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</tr>", "");

				pinyinHtmlArray.push(translatedHtmlPinyin);

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</div>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_6\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_7\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"englishInChinese\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "px\">", "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</span>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<b>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</b>", "");
				
				while (contains(translatedHtmlPinyin, "   ") == true)
				{
					translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "   ", "  ");
				}

				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "<tr>", "");
				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "</tr>", "");
				translatedHtmlLiteral = textBetween(translatedHtmlLiteral, "start", "<div class=\"english\">");

				while (contains(translatedHtmlLiteral, "   ") == true)
				{
					translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "   ", "  ");
				}
				// Change the font size
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"14\">", "<font size=\"10\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"15\">", "<font size=\"11\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"16\">", "<font size=\"12\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"17\">", "<font size=\"13\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"18\">", "<font size=\"14\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"19\">", "<font size=\"15\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"20\">", "<font size=\"16\">");
				
				literalHtmlArray.push(translatedHtmlLiteral);
				
				literalTextArray.push(translatedTextLiteral);
				
				translatedTextLiteral = "<font size=\"12\"><font color=#000000>" + translatedTextLiteral + "</font></font>";
				
				translatedTextEnglish = "<font size=\"12\"><font color=#000000>" + translatedTextEnglish + "</font></font>";
				
				var thisSubtitle = numbersTextLine + "\n" + timesTextLine + "\n" + translatedHtmlChinese + "\n"  + translatedHtmlPinyin + "\n" + translatedTextLiteral + "\n" + translatedTextEnglish;
				
				thisSubtitle = replaceChars(thisSubtitle, "	", "  ");
				
				while (contains(thisSubtitle, "   "))
				{
					thisSubtitle = replaceChars(thisSubtitle, "   ", "  ");
				}
				
				thisSubtitle = replaceChars(thisSubtitle, "\n ", "\n");
				
				subtitlesOutput = subtitlesOutput + thisSubtitle + "\n" + "\n";
				
			} // end for every line
			
			document.getElementById("chineseTextArea").value = chineseText;
			document.getElementById("englishTextArea").value = englishText;
			document.getElementById("simplifiedSpacedTextArea").value = subtitlesOutput;
			
			var vocabularyArray = getVocabulary(chineseText);
			
			var vocabularyHtml = vocabularyArray[0];
			var vocabularyText = vocabularyArray[1];
			
			var vocabularyExamplesHtml = "";
			var vocabularyExamplesText = "";
			
			// Add examples to vocabulary
			vocabularyHtml = replaceChars(vocabularyHtml, "<table>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "\n", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "<tr>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "</table>", "");
			
			var vocabularyHtmlArray = vocabularyHtml.split("</tr>");
			
			var vocabularyTextArray = vocabularyText.split("\n");
			var numberLines = vocabularyTextArray.length;
			
			var addLiteral = true;
			
			var vocabularyExamplesSubtitles = "";
			var currentWordDefinitionSubtitle = 1;
			var vocabularyCommands = "";
			var audioCommands = "";
			var currentWordDefinitionSubtitleStartTime = 0;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLineHtml = vocabularyHtmlArray[currentLine];
				var thisLineText = vocabularyTextArray[currentLine];
				
				var thisWord = textBetween(thisLineText, "	", "	");
				
				if (thisWord != "")
				{
					var thisLineHtmlArray = thisLineHtml.split("</td>");
					
					var thisLineHtmlChinese = thisLineHtmlArray[1];
					var thisLineHtmlPinyin = thisLineHtmlArray[2];
					var thisLineHtmlLiteral = thisLineHtmlArray[3];
					
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</div>", "</font>");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<td>", "");
					
					thisLineHtmlChinese = "<font size=\"80\">" + thisLineHtmlChinese + "</font>";
					
					var thisWordChinese = cleanHtml(thisLineHtmlChinese);
					thisWordChinese = replaceChars(thisWordChinese, " ", "");
					
					var thisWordPinyin = "";
					
					//if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == true)
					if (searchDictionary(thisWordChinese) == true)
					{
						var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
				
						var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
						var lineLength = thisDictionaryLineArray.length;
				
						var thisDefinition = "";
						var thisCharacterPinyin = "";
						var thisToneless = "";
						var thisTone = "";
				
						thisDefinition = thisDictionaryLineArray[0];

						if (lineLength >= 1)
						{
							thisCharacterPinyin = thisDictionaryLineArray[1];
						}
				
						if (lineLength >= 2)
						{
							thisToneless = thisDictionaryLineArray[2];
						}
				
						if (lineLength >= 3)
						{
							thisTone = thisDictionaryLineArray[3];
						}
						
						var thisPinyinArray = thisCharacterPinyin.split(" ");
						var thisTonelessArray = thisToneless.split(" ");
						var thisTonesArray = stringToCharacterArray(thisTone);
						
						var numberCharacters = stringLength(thisWordChinese);
						
						var thisAudioCommand = "";
						
						if (numberCharacters > 1)
						{
							thisAudioCommand = "cat ";
						}
						
						for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
						{
							var thisCharacterToneless = thisTonelessArray[currentCharacter];
							var thisCharacterTone = thisTonesArray[currentCharacter];
							
							if (thisCharacterToneless == "")
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							if (thisCharacterTone == undefined)
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							
							thisWordPinyin = thisWordPinyin + thisCharacterToneless + thisCharacterTone;

							if (numberCharacters > 1)
							{
								thisAudioCommand = thisAudioCommand + "\"PinyinAudio/" + thisCharacterToneless + thisCharacterTone + ".mp3\" ";
							}
							
						} // end for every character
						
						if (numberCharacters > 1)
						{							
							thisAudioCommand = thisAudioCommand + "> \"PinyinAudio/" + thisWordPinyin + ".mp3\"";
							
							audioCommands = audioCommands + thisAudioCommand + "\n";
						}

						
					} else {
					
						// Break the word into characters - not needed because all vocabulary words are in dictionary

					} // if the word is in the dictionary
					
					var wordSubtitleOffset = -1;
					
					var numberSubtitles = chineseTextArray.length;
					for (var currentSubtitle = 0; currentSubtitle < numberSubtitles; currentSubtitle++)
					{
						var thisWordSubtitleText = chineseTextArray[currentSubtitle];
						
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, " ", "");
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, "	", "");
						
						if (contains(thisWordSubtitleText,thisWord))
						{
							wordSubtitleOffset = currentSubtitle;
							break;
						}
					} // go through the subtitles again because list offset doesn't work
					
					//debugLog(wordSubtitleOffset+" "+thisWord);
					
					var thisWordTime = timesTextArray[wordSubtitleOffset];
					var thisWordSubtitleHtml = chineseHtmlArray[wordSubtitleOffset];
					var thisWordSubtitleText = chineseTextArray[wordSubtitleOffset];
					var thisWordExamplePinyinHtml = pinyinHtmlArray[wordSubtitleOffset];
					var thisWordExamplePinyinText = pinyinTextArray[wordSubtitleOffset];
					var thisWordExampleLiteralHtml = literalHtmlArray[wordSubtitleOffset];
					var thisWordExampleLiteralText = literalTextArray[wordSubtitleOffset];
					var thisWordExampleEnglish = englishTextArray[wordSubtitleOffset];
				
					thisWordTime = textBetween(thisWordTime, "start", " -->");
					thisWordTime = textBetween(thisWordTime, "start", ",");
				
					var thisLineExampleHtml = thisLineHtml + "<td>" + thisWordTime + "</td><td>" + "<table><tr><td>" + "<table><tr>" + thisWordSubtitleHtml + "</tr><tr>" + thisWordExamplePinyinHtml + "</tr>";
					
					if (addLiteral == true)
					{
						thisLineExampleHtml = thisLineExampleHtml + "<tr>" + thisWordExampleLiteralHtml + "</tr>";
					}
					
					thisLineExampleHtml = thisLineExampleHtml + "</table></td></tr><tr><td>" + thisWordExampleEnglish + "</td></tr></table>" + "</td>";
						
					var thisLineExampleText = thisLineText + "	" + thisWordTime + "	" + thisWordSubtitleText + "	" + thisWordExamplePinyinText + "	" + thisWordExampleLiteralText + "	" + thisWordExampleEnglish;
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						vocabularyExamplesHtml = vocabularyExamplesHtml + "<tr id=\"" + thisWordChinese + "\">" + thisLineExampleHtml + "</tr>" + "\n";
						vocabularyExamplesText = vocabularyExamplesText + thisLineExampleText + "\n";
					}
					
					var thisWordSubtitleStartTime = currentWordDefinitionSubtitleStartTime;
					var thisWordSubtitleEndTime = thisWordSubtitleStartTime + 4;
					
					var thisWordSubtitleStartTimeString = numberToTime(thisWordSubtitleStartTime);
					var thisWordSubtitleEndTimeString = numberToTime(thisWordSubtitleEndTime);
					
					var thisWordSubtitleTime = thisWordSubtitleStartTimeString + " --> " + thisWordSubtitleEndTimeString;
					
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</div>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "px\">", "\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</span>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<b>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</b>", "");

						// Change the font size
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"14\">", "<font size=\"36\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"15\">", "<font size=\"40\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"16\">", "<font size=\"44\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"17\">", "<font size=\"48\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"18\">", "<font size=\"52\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"19\">", "<font size=\"56\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"20\">", "<font size=\"60\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</font></font> <font", " </font></font><font");
						
						thisLineHtmlLiteral = textBetween(thisLineHtml, "<div class=\"literal\">", "</div>");
					
						thisLineHtmlLiteral = "<font size=\"50\"><font color=#000000>" + thisLineHtmlLiteral + "</font></font>";
					
						var thisWordDefinitionSubtitle = currentWordDefinitionSubtitle + "\n" + thisWordSubtitleTime + "\n" + thisLineHtmlChinese + "\n" + thisLineHtmlPinyin + "\n" + thisLineHtmlLiteral + "\n";
					
						vocabularyExamplesSubtitles = vocabularyExamplesSubtitles + thisWordDefinitionSubtitle + "\n";
						
						var thisWordSubtitleStartTimeSeconds = replaceChars(thisWordSubtitleStartTimeString, ",000");
						var thisWordSubtitleEndTimeSeconds = replaceChars(thisWordSubtitleEndTimeString, ",000");
						
						//var thisVocabularyCommand = "ffmpeg -ss " + thisWordSubtitleStartTimeSeconds + " -to " + thisWordSubtitleEndTimeSeconds + " -async 1 -threads 9 -preset ultrafast -strict -2 \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						var thisVocabularyCommand = "ffmpeg -i \"last4SecondsPad5.mp4\" -i \"Audio/" + thisWordPinyin + ".mp3\" -vf subtitles=\"WordSubtitles/" + thisWordChinese + ".srt:force_style='FontName=PingFangTC-Regular,Outline=0'\" -map 0:v -map 1:a -threads 9 -preset ultrafast \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						vocabularyCommands = vocabularyCommands + thisVocabularyCommand + "\n";
						
						currentWordDefinitionSubtitle = currentWordDefinitionSubtitle + 1;
						currentWordDefinitionSubtitleStartTime = thisWordSubtitleEndTime;
					}

				} // end if the word is not blank
			} // end for every line in the vocabulary
			
			vocabularyExamplesHtml = "<table>" + vocabularyExamplesHtml + "</table>";
			
			//debugLog(vocabularyExamplesHtml);
			
			vocabularyCommands = audioCommands + vocabularyCommands;
			
			document.getElementById("outputHtml").innerHTML = vocabularyExamplesHtml;
			document.getElementById("outputTextArea").value = vocabularyExamplesSubtitles;
			document.getElementById("chineseSpacedTextArea").value = vocabularyCommands;
			
		}  // end function subtitlesTwoButtonClicked
		
		// Handle movie or lyrics subtitles
		function subtitlesButtonClicked()
		{
			// Suitable font sizes for movie subtitles
			/*
			var chineseFontSize = 20;
			
			var pinyinFontSizeOne = 10;
			var pinyinFontSizeTwo = 11;
			var pinyinFontSizeThree = 12;
			var pinyinFontSizeFour = 13;
			var pinyinFontSizeFive = 14;
			var pinyinFontSizeSix = 15;
			var pinyinFontSizeSeven = 16;
			
			var literalFontSize = 12;
			var englishFontSize = 12;
			*/
			
			// Suitable font sizes for 1024x768 lyrics
			/*
			var chineseFontSize = 16;
			
			var pinyinFontSizeOne = 8;
			var pinyinFontSizeTwo = 8;
			var pinyinFontSizeThree = 9;
			var pinyinFontSizeFour = 9;
			var pinyinFontSizeFive = 10;
			var pinyinFontSizeSix = 10;
			var pinyinFontSizeSeven = 11;
			
			var literalFontSize = 9;
			var englishFontSize = 9;
			*/
			
			// Suitable font sizes for 1920x1080 lyrics
			var chineseFontSize = 18;
			
			var pinyinFontSizeOne = 10;
			var pinyinFontSizeTwo = 10;
			var pinyinFontSizeThree = 11;
			var pinyinFontSizeFour = 11;
			var pinyinFontSizeFive = 12;
			var pinyinFontSizeSix = 12;
			var pinyinFontSizeSeven = 13;
			
			var literalFontSize = 11;
			var englishFontSize = 11;


		
			//debugLog("subtitlesButtonClicked");
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;
			document.getElementById('breakMissingWordsCheckbox').checked = true;
			document.getElementById('monospaceTextCheckbox').checked = false;
			
			var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;
			
			var subtitlesText = document.getElementById("simplifiedInputTextArea").value;
			
			var subtitlesLines = subtitlesText.split("\n");
			
			var numberLines = subtitlesLines.length;
			
			// Combine subtitles into correctly alternating lines
			var numbersText = "";
			var timesText = "";
			var englishText = "";
			var chineseText = "";
			var thisSubtitleNumber = "";
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = subtitlesLines[currentLine];
				
				var lineLength = stringLength(thisLine);
				
				if (thisLine == "")
				{
					numbersText = numbersText + "\n";
					timesText = timesText + "\n";
					englishText = englishText + "\n";
					chineseText = chineseText + "\n";
					thisSubtitleNumber = "";
				} else {
					if ((isNumberString(thisLine) == true) && (thisSubtitleNumber == ""))
					{
						numbersText = numbersText + thisLine;
						thisSubtitleNumber = thisLine;
					} else {
						// If this line is a time
						if (contains(thisLine, " --> ") == true)
						{
							timesText = timesText + thisLine;
						} else {
							var cleanText = cleanHtml(thisLine);
							
							if (containsChineseString(cleanText) == true)
							{
								chineseText = chineseText + cleanText + "| ";
							} else {
								// extra spaces in case we concatenate two lines
								englishText = englishText + cleanText + "| ";
							}
						} // end if time
					} // end if number string
				} // end if blank line

			} // end for every line in the subtitles
			
			chineseText = replaceChars(chineseText, " \n", "\n");
			chineseText = replaceChars(chineseText, "|\n", "\n");
			englishText = replaceChars(englishText, " \n", "\n");
			englishText = replaceChars(englishText, "|\n", "\n");
			
			// Process the Chinese text
			
			chineseText = despace(chineseText);
			
			var despacedChineseText = chineseText;
			var despacedChineseTextArray = chineseText.split("\n");
			
			//chineseText = simplifiedToTraditional(chineseText);
			chineseText = wordSpace(chineseText);
			chineseText = replaceChars(chineseText, "\n ", "\n");
			
			// For every line in the numbers/times/chinese/english text
			
			var numbersTextArray = numbersText.split("\n");
			var timesTextArray = timesText.split("\n");
			var englishTextArray = englishText.split("\n");
			var chineseTextArray = chineseText.split("\n");
			
			
			
			numberLines = numbersTextArray.length;
			
			var subtitlesOutput = "";
			
			var chineseHtmlArray = [];
			
			var pinyinTextArray = [];
			var pinyinHtmlArray = [];
			
			var literalHtmlArray = [];
			var literalTextArray = [];
			
			var taiwaneseTextArray = [];
			var taiwaneseHtmlArray = [];
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var numbersTextLine = numbersTextArray[currentLine];
				var timesTextLine = timesTextArray[currentLine];
				var englishTextLine = englishTextArray[currentLine];				
				var chineseTextLine = chineseTextArray[currentLine];
				
				var translationOutput = translateText(chineseTextLine, englishTextLine);
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
								
				var translatedTextArray = translatedText.split("\n");
				var translatedTextChinese = translatedTextArray[0];
				var translatedTextPinyin = translatedTextArray[1];
				var translatedTextLiteral = translatedTextArray[2];
				var translatedTextEnglish = translatedTextArray[3];
				
				pinyinTextArray.push(translatedTextPinyin);
				
				/*
				translatedTextChinese = "<font size=\"17\">" + translatedTextChinese + "</font>";
				
				subtitlesOutput = subtitlesOutput + "\n" + numbersTextLine + "\n" + timesTextLine + "\n" + translatedTextChinese + "\n"  + translatedTextPinyin + "\n" + translatedTextLiteral + "\n" + translatedTextEnglish + "\n" + "\n";
				*/
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				/*
				var translatedHtmlArray = translatedHtml.split("</tr><tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];
				*/
				
				var translatedHtmlChinese = textBetween(translatedHtml, "<tr class=\"chineseLine\">", "</tr>");
				var translatedHtmlPinyin = textBetween(translatedHtml, "<tr class=\"pinyinLine\">", "</tr>");
				var translatedHtmlLiteral = textBetween(translatedHtml, "<tr class=\"literalLine\">", "</tr>");
				var translatedHtmlEnglish = textBetween(translatedHtml, "<div class=\"english\">", "</div>");
				
				if (addTaiwanese == true)
				{
					var translatedHtmlTaiwanese = textBetween(translatedHtml, "<tr class=\"taiwaneseLine\">", "</tr>");
				} // end if addTaiwanese

				var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
				var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
				var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
				var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
				var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");

				chineseHtmlArray.push(translatedHtmlChinese);
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</div>", "</font>");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"englishInChinese\">", "<font color=#" + chineseColourOne + ">");
				
				while (contains(translatedHtmlChinese, "  ") == true)
				{
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "  ", " ");
				}
				
				
				translatedHtmlChinese = "<font size=\"" + chineseFontSize + "\">" + translatedHtmlChinese + "</font>";
				
				var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
				var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
				var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
				var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
				var pinyinColourFive = pinyinColourOne;

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<tr>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</tr>", "");

				pinyinHtmlArray.push(translatedHtmlPinyin);

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</div>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_6\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_7\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"englishInChinese\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "px\">", "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</span>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<b>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</b>", "");
				
				while (contains(translatedHtmlPinyin, "   ") == true)
				{
					translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "   ", "  ");
				}

				// Change the font size
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"14\">", "<font size=\"" + pinyinFontSizeOne + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"15\">", "<font size=\"" + pinyinFontSizeTwo + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"16\">", "<font size=\"" + pinyinFontSizeThree + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"17\">", "<font size=\"" + pinyinFontSizeFour + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"18\">", "<font size=\"" + pinyinFontSizeFive + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"19\">", "<font size=\"" + pinyinFontSizeSix + "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"20\">", "<font size=\"" + pinyinFontSizeSeven + "\">");

				if (addTaiwanese == true)
				{

					var taiwaneseColourOne = document.getElementById("taiwaneseColourPickerOne").value;
					var taiwaneseColourTwo = document.getElementById("taiwaneseColourPickerTwo").value;
					var taiwaneseColourThree = document.getElementById("taiwaneseColourPickerThree").value;
					var taiwaneseColourFour = document.getElementById("taiwaneseColourPickerFour").value;
					var taiwaneseColourFive = document.getElementById("taiwaneseColourPickerFive").value;
					var taiwaneseColourSeven = document.getElementById("taiwaneseColourPickerSeven").value;
					var taiwaneseColourEight = document.getElementById("taiwaneseColourPickerEight").value;


					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<tr>", "");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "</tr>", "");

					taiwaneseHtmlArray.push(translatedHtmlTaiwanese);

					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<td>", " ");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "</td>", " ");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "</div>", "</font>");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_1\">", "<font color=#" + taiwaneseColourOne + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_2\">", "<font color=#" + taiwaneseColourTwo + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_3\">", "<font color=#" + taiwaneseColourThree + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_4\">", "<font color=#" + taiwaneseColourFour + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_5\">", "<font color=#" + taiwaneseColourFive + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_6\">", "<font color=#" + taiwaneseColourOne + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_7\">", "<font color=#" + taiwaneseColourSeven + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"taiwanese_8\">", "<font color=#" + taiwaneseColourEight + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<div class=\"englishInChinese\">", "<font color=#" + taiwaneseColourOne + ">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<span style=\"font-size:", "<font size=\"");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "px\">", "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "</span>", "</font>");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<b>", "");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "</b>", "");
				
					while (contains(translatedHtmlTaiwanese, "   ") == true)
					{
						translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "   ", "  ");
					}

					// Change the font size
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"14\">", "<font size=\"" + taiwaneseFontSizeOne + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"15\">", "<font size=\"" + taiwaneseFontSizeTwo + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"16\">", "<font size=\"" + taiwaneseFontSizeThree + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"17\">", "<font size=\"" + taiwaneseFontSizeFour + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"18\">", "<font size=\"" + taiwaneseFontSizeFive + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"19\">", "<font size=\"" + taiwaneseFontSizeSix + "\">");
					translatedHtmlTaiwanese = replaceChars(translatedHtmlTaiwanese, "<font size=\"20\">", "<font size=\"" + taiwaneseFontSizeSeven + "\">");


				} // end if addTaiwanese


				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "<tr>", "");
				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "</tr>", "");
				//translatedHtmlLiteral = textBetween(translatedHtmlLiteral, "start", "<div class=\"english\">");

				while (contains(translatedHtmlLiteral, "   ") == true)
				{
					translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "   ", "  ");
				}
				
				literalHtmlArray.push(translatedHtmlLiteral);
				
				literalTextArray.push(translatedTextLiteral);
				
				translatedTextLiteral = "<font size=\"" + literalFontSize + "\"><font color=#000000>" + translatedTextLiteral + "</font></font>";
				translatedTextLiteral = replaceChars(translatedTextLiteral, "|", "</font></font>|<font size=\"" + literalFontSize + "\"><font color=#000000>");
				
				translatedTextEnglish = "<font size=\"" + englishFontSize + "\"><font color=#000000>" + translatedTextEnglish + "</font></font>";
				translatedTextEnglish = replaceChars(translatedTextEnglish, "|", "</font></font>|<font size=\"" + englishFontSize + "\"><font color=#000000>");
				
				// Movie subtitles - position at bottom
				//var subtitlePosition = "";
				
				// 1024x768 - position in middle
				var subtitlePosition = " X1:200 X2:500 Y1:40 Y2:500";
				
				// 1920x1080 - position in middle
				var subtitlePosition = " X1:200 X2:500 Y1:0 Y2:500";
				
								
				var thisSubtitle = numbersTextLine + "\n" + timesTextLine + subtitlePosition + "\n";
				
				// Fix multi-line subtitles (Chinese-English-Chinese-English, common in lyrics)
				translatedHtmlChinese=replaceChars(translatedHtmlChinese,"<font color=#000000>|</font>","|");
				translatedHtmlPinyin=replaceChars(translatedHtmlPinyin,"<font color=#000000>|</font>","|");
				
				var translatedHtmlChineseLines = translatedHtmlChinese.split("|");
				var translatedHtmlPinyinLines = translatedHtmlPinyin.split("|");
				var translatedTextLiteralLines = translatedTextLiteral.split("|");
				var translatedTextEnglishLines = translatedTextEnglish.split("|");
				
				var numberSubtitleLines = translatedHtmlChineseLines.length;
				
				for (var currentSubtitleLine = 0; currentSubtitleLine < numberSubtitleLines; currentSubtitleLine++)
				{
					var thisSubtitleChineseLine = translatedHtmlChineseLines[currentSubtitleLine];
					var thisSubtitlePinyinLine = translatedHtmlPinyinLines[currentSubtitleLine];
					var thisSubtitleLiteralLine = translatedTextLiteralLines[currentSubtitleLine];
					var thisSubtitleEnglishLine = translatedTextEnglishLines[currentSubtitleLine];
					
					thisSubtitlePinyinLine = thisSubtitlePinyinLine.trim();
					
					thisSubtitle = thisSubtitle + thisSubtitleChineseLine + "\n"  + thisSubtitlePinyinLine + "\n" + thisSubtitleLiteralLine + "\n" + thisSubtitleEnglishLine + "\n";
					
				} // end for every subtitle line
								
				thisSubtitle = replaceChars(thisSubtitle, "	", "  ");
				
				while (contains(thisSubtitle, "   "))
				{
					thisSubtitle = replaceChars(thisSubtitle, "   ", "  ");
				}
				
				thisSubtitle = replaceChars(thisSubtitle, "\n ", "\n");
				
				subtitlesOutput = subtitlesOutput + thisSubtitle + "\n";
				
			} // end for every line
			
			document.getElementById("chineseTextArea").value = chineseText;
			document.getElementById("englishTextArea").value = englishText;
			document.getElementById("simplifiedSpacedTextArea").value = subtitlesOutput;
			
			var vocabularyArray = getVocabulary(chineseText);
			
			var vocabularyHtml = vocabularyArray[0];
			var vocabularyText = vocabularyArray[1];
			
			var vocabularyExamplesHtml = "";
			var vocabularyExamplesText = "";
			
			// Add examples to vocabulary
			vocabularyHtml = replaceChars(vocabularyHtml, "<table>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "\n", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "<tr>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "</table>", "");
			
			var vocabularyHtmlArray = vocabularyHtml.split("</tr>");
			
			var vocabularyTextArray = vocabularyText.split("\n");
			var numberLines = vocabularyTextArray.length;
			
			var addLiteral = true;
			
			var vocabularyExamplesSubtitles = "";
			var currentWordDefinitionSubtitle = 1;
			var vocabularyCommands = "";
			var audioCommands = "";
			var currentWordDefinitionSubtitleStartTime = 0;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLineHtml = vocabularyHtmlArray[currentLine];
				var thisLineText = vocabularyTextArray[currentLine];
				
				var thisWord = textBetween(thisLineText, "	", "	");
				
				if (thisWord != "")
				{
					var thisLineHtmlArray = thisLineHtml.split("</td>");
					
					var thisLineHtmlChinese = thisLineHtmlArray[1];
					var thisLineHtmlPinyin = thisLineHtmlArray[2];
					var thisLineHtmlLiteral = thisLineHtmlArray[3];
					
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</div>", "</font>");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<td>", "");
					
					thisLineHtmlChinese = "<font size=\"80\">" + thisLineHtmlChinese + "</font>";
					
					var thisWordChinese = cleanHtml(thisLineHtmlChinese);
					thisWordChinese = replaceChars(thisWordChinese, " ", "");
					
					var thisWordPinyin = "";
					
					//if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == true)
					if (searchDictionary(thisWordChinese) == true)
					{
						var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
				
						var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
						var lineLength = thisDictionaryLineArray.length;
				
						var thisDefinition = "";
						var thisCharacterPinyin = "";
						var thisToneless = "";
						var thisTone = "";
				
						thisDefinition = thisDictionaryLineArray[0];

						if (lineLength >= 1)
						{
							thisCharacterPinyin = thisDictionaryLineArray[1];
						}
				
						if (lineLength >= 2)
						{
							thisToneless = thisDictionaryLineArray[2];
						}
				
						if (lineLength >= 3)
						{
							thisTone = thisDictionaryLineArray[3];
						}
						
						var thisPinyinArray = thisCharacterPinyin.split(" ");
						var thisTonelessArray = thisToneless.split(" ");
						var thisTonesArray = stringToCharacterArray(thisTone);
						
						var numberCharacters = stringLength(thisWordChinese);
						
						var thisAudioCommand = "";
						
						if (numberCharacters > 1)
						{
							thisAudioCommand = "cat ";
						}
						
						for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
						{
							var thisCharacterToneless = thisTonelessArray[currentCharacter];
							var thisCharacterTone = thisTonesArray[currentCharacter];
							
							if (thisCharacterToneless == "")
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							if (thisCharacterTone == undefined)
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							
							thisWordPinyin = thisWordPinyin + thisCharacterToneless + thisCharacterTone;

							if (numberCharacters > 1)
							{
								thisAudioCommand = thisAudioCommand + "\"PinyinAudio/" + thisCharacterToneless + thisCharacterTone + ".mp3\" ";
							}
							
						} // end for every character
						
						if (numberCharacters > 1)
						{							
							thisAudioCommand = thisAudioCommand + "> \"PinyinAudio/" + thisWordPinyin + ".mp3\"";
							
							audioCommands = audioCommands + thisAudioCommand + "\n";
						}

						
					} else {
					
						// Break the word into characters - not needed because all vocabulary words are in dictionary

					} // if the word is in the dictionary
					
					var wordSubtitleOffset = -1;
					
					var numberSubtitles = chineseTextArray.length;
					for (var currentSubtitle = 0; currentSubtitle < numberSubtitles; currentSubtitle++)
					{
						var thisWordSubtitleText = chineseTextArray[currentSubtitle];
						
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, " ", "");
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, "	", "");
						
						if (contains(thisWordSubtitleText,thisWord))
						{
							wordSubtitleOffset = currentSubtitle;
							break;
						}
					} // go through the subtitles again because list offset doesn't work
					
					//debugLog(wordSubtitleOffset+" "+thisWord);
					
					var thisWordTime = timesTextArray[wordSubtitleOffset];
					var thisWordSubtitleHtml = chineseHtmlArray[wordSubtitleOffset];
					var thisWordSubtitleText = chineseTextArray[wordSubtitleOffset];
					var thisWordExamplePinyinHtml = pinyinHtmlArray[wordSubtitleOffset];
					var thisWordExamplePinyinText = pinyinTextArray[wordSubtitleOffset];
					var thisWordExampleLiteralHtml = literalHtmlArray[wordSubtitleOffset];
					var thisWordExampleLiteralText = literalTextArray[wordSubtitleOffset];
					var thisWordExampleEnglish = englishTextArray[wordSubtitleOffset];
				
					thisWordTime = textBetween(thisWordTime, "start", " -->");
					thisWordTime = textBetween(thisWordTime, "start", ",");
				
					var thisLineExampleHtml = thisLineHtml + "<td>" + thisWordTime + "</td><td>" + "<table><tr><td>" + "<table><tr>" + thisWordSubtitleHtml + "</tr><tr>" + thisWordExamplePinyinHtml + "</tr>";
					
					if (addLiteral == true)
					{
						thisLineExampleHtml = thisLineExampleHtml + "<tr>" + thisWordExampleLiteralHtml + "</tr>";
					}
					
					thisLineExampleHtml = thisLineExampleHtml + "</table></td></tr><tr><td>" + thisWordExampleEnglish + "</td></tr></table>" + "</td>";
						
					var thisLineExampleText = thisLineText + "	" + thisWordTime + "	" + thisWordSubtitleText + "	" + thisWordExamplePinyinText + "	" + thisWordExampleLiteralText + "	" + thisWordExampleEnglish;
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						vocabularyExamplesHtml = vocabularyExamplesHtml + "<tr id=\"" + thisWordChinese + "\">" + thisLineExampleHtml + "</tr>" + "\n";
						vocabularyExamplesText = vocabularyExamplesText + thisLineExampleText + "\n";
					}
					
					var thisWordSubtitleStartTime = currentWordDefinitionSubtitleStartTime;
					var thisWordSubtitleEndTime = thisWordSubtitleStartTime + 4;
					
					var thisWordSubtitleStartTimeString = numberToTime(thisWordSubtitleStartTime);
					var thisWordSubtitleEndTimeString = numberToTime(thisWordSubtitleEndTime);
					
					var thisWordSubtitleTime = thisWordSubtitleStartTimeString + " --> " + thisWordSubtitleEndTimeString;
					
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</div>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "px\">", "\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</span>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<b>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</b>", "");

						// Change the font size
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"14\">", "<font size=\"36\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"15\">", "<font size=\"40\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"16\">", "<font size=\"44\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"17\">", "<font size=\"48\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"18\">", "<font size=\"52\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"19\">", "<font size=\"56\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"20\">", "<font size=\"60\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</font></font> <font", " </font></font><font");
						
						thisLineHtmlLiteral = textBetween(thisLineHtml, "<div class=\"literal\">", "</div>");
					
						thisLineHtmlLiteral = "<font size=\"50\"><font color=#000000>" + thisLineHtmlLiteral + "</font></font>";
					
						var thisWordDefinitionSubtitle = currentWordDefinitionSubtitle + "\n" + thisWordSubtitleTime + "\n" + thisLineHtmlChinese + "\n" + thisLineHtmlPinyin + "\n" + thisLineHtmlLiteral + "\n";
					
						vocabularyExamplesSubtitles = vocabularyExamplesSubtitles + thisWordDefinitionSubtitle + "\n";
						
						var thisWordSubtitleStartTimeSeconds = replaceChars(thisWordSubtitleStartTimeString, ",000");
						var thisWordSubtitleEndTimeSeconds = replaceChars(thisWordSubtitleEndTimeString, ",000");
						
						//var thisVocabularyCommand = "ffmpeg -ss " + thisWordSubtitleStartTimeSeconds + " -to " + thisWordSubtitleEndTimeSeconds + " -async 1 -threads 9 -preset ultrafast -strict -2 \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						var thisVocabularyCommand = "ffmpeg -i \"last4SecondsPad5.mp4\" -i \"Audio/" + thisWordPinyin + ".mp3\" -vf subtitles=\"WordSubtitles/" + thisWordChinese + ".srt:force_style='FontName=PingFangTC-Regular,Outline=0'\" -map 0:v -map 1:a -threads 9 -preset ultrafast \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						vocabularyCommands = vocabularyCommands + thisVocabularyCommand + "\n";
						
						currentWordDefinitionSubtitle = currentWordDefinitionSubtitle + 1;
						currentWordDefinitionSubtitleStartTime = thisWordSubtitleEndTime;
					}

				} // end if the word is not blank
			} // end for every line in the vocabulary
			
			vocabularyExamplesHtml = "<table>" + vocabularyExamplesHtml + "</table>";
			
			//debugLog(vocabularyExamplesHtml);
			
			vocabularyCommands = audioCommands + vocabularyCommands;
			
			document.getElementById("outputHtml").innerHTML = vocabularyExamplesHtml;
			document.getElementById("outputTextArea").value = vocabularyExamplesSubtitles;
			document.getElementById("chineseSpacedTextArea").value = vocabularyCommands;
			
		}  // end function subtitlesButtonClicked
		
		function examplesButtonClicked()
		{
			//debugLog("examplesButtonClicked");
			
			var vocabularyExamplesHtml = "";
			
			var theseWords = "一半\n中部\n以外\n來賓\n分鐘\n剛好\n國家\n大清早\n就是說\n市區\n得了\n想不到\n懂得\n有些\n有意\n有趣\n正在\n測驗\n演唱\n經過\n至於\n話題\n車票\n道理";
			
			var theseChinese = "聽說 有 一批 大陸 偷渡客   偷渡 到一 半就 淹死 了 \n六年 前   剛剛 踏進 精誠 中學 國中 部 的時候 \n所以 外號 叫 「  勃起 」 \n沒 聽說 過來 賓 要 親新娘 \n十分 鐘 \n剛剛 好啦 \n大概 真的 很想 換 個國 家 打手槍 吧 \n一大 清早 就 這麼 \n也就 是說 我 有機 會 囉 \n就 直接 跳進 彰化市 區 了 啊 \n贏得 了 五 燈獎 的 冠軍 \n只是 還 想不到 書 名   不知道 怎麼 開頭 \n你們 這樣 很 壞 耶   一點 都 不懂 得 祝福 \n真實 人生 裡有 些事 永遠 也沒有 答案 \n很多 事 不用 做 就 知道 沒有 意義 啊 \n聽起來 很有 趣 耶 \n等到 真正 在 一起 了 \n馬上 把 隨堂測 驗 紙 拿出來 \n下個月 他們 要 來 開演 唱會 \n學期 已經 過了 三分之一 了 \n甚至 於 想 打 老師 的 \n幸好   我們 還有 共 通 的 話題 \n阿和 則 買 了 最近 一 班 的 火車 票 \n妳 真的 很 喜歡 學 大人 講道 理 耶 ";
			var theseTimes = "00:33:23,459 --> 00:33:27,500\n00:48:09,542 --> 00:48:15,333\n00:02:41,876 --> 00:02:45,584\n01:39:10,876 --> 01:39:12,583\n00:30:06,292 --> 00:30:08,334\n00:03:12,167 --> 00:03:15,042\n01:33:14,417 --> 01:33:17,833\n00:06:55,959 --> 00:06:57,209\n01:17:54,792 --> 01:17:56,917\n00:34:35,376 --> 00:34:38,458\n00:02:11,917 --> 00:02:14,709\n01:46:01,167 --> 01:46:04,917\n01:36:21,334 --> 01:36:25,126\n00:47:39,042 --> 00:47:43,001\n00:32:25,084 --> 00:32:29,000\n00:17:41,001 --> 00:17:42,625\n01:29:06,501 --> 01:29:08,958\n00:44:54,959 --> 00:44:58,208\n00:17:27,959 --> 00:17:29,750\n00:19:28,209 --> 00:19:30,500\n00:09:59,126 --> 00:10:01,500\n01:02:18,709 --> 01:02:22,876\n01:18:05,001 --> 01:18:09,042\n00:32:12,959 --> 00:32:16,541\n";
			
			var theseEnglish = "I heard some stowaways from China were drowned.\nSix years ago, when we first stepped in to Jing-Cheng high school\nthat's why we named him \"Boner\".\nBullshit!\n10 minutes.\nWhy not?\nPerhaps he wanted to masturbate in a different country.\nIt's early morning and everyone looks half asleep.\nOh yes, so I have a chance now?\nand jumped directly into Changhua city.\nfor five consecutive rounds.\nI just haven't come up a good name to start with.\nYou guys are mean. Can't you just show some love to the couple?\nyou never find a correct answer in life.\nYou know something is meaningless without trying it.\nSounds fun.\nWhen two people are together.\nTake out your paper right now.\nThey are coming next month.\nwe have gone through a third of this semester.\nOr even those who beat up teachers!\nLuckily, we had some common interests to talk about.\nA-Ho, on the other hand, bought a ticket for the next train.\nYou really like to pitch high notes like adults, don't you?\n";
			
			var theseWordsArray = theseWords.split("\n");
			var theseChineseArray = theseChinese.split("\n");
			var theseTimesArray = theseTimes.split("\n");
			var theseEnglishArray = theseEnglish.split("\n");
			
			var numberWords = theseWordsArray.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWordChinese = theseWordsArray[currentWord];
				
				var thisExampleChinese = theseChineseArray[currentWord];
				
				var thisWordTime = theseTimesArray[currentWord];
				
				thisWordTime = textBetween(thisWordTime, "start", ",");
				
				var thisWordExampleEnglish = theseEnglishArray[currentWord];
				
				
				var translationOutput = translateText(thisWordChinese, "");
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				// Not sure why there's an undefined line in here, but this fixes the symptoms
				//var undefinedLine = translatedHtmlArray[1];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");
				
				var thisFrequency = 1;
				
				var thisLineHtml = "<td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>";
				
				
				translationOutput = translateText(thisExampleChinese, "");
				
				translatedHtml = translationOutput[0];
				translatedText = translationOutput[1];
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var thisWordSubtitleHtml = translatedHtmlArray[0];
				var thisWordExamplePinyinHtml = translatedHtmlArray[1];
				var thisWordExampleLiteralHtml = translatedHtmlArray[2];
								
				var thisLineExampleHtml = thisLineHtml + "<td>" + thisWordTime + "</td><td>" + "<table><tr><td>" + "<table><tr>" + thisWordSubtitleHtml + "</tr><tr>" + thisWordExamplePinyinHtml + "</tr><tr>" + thisWordExampleLiteralHtml + "</tr>";
			   			   
				thisLineExampleHtml = thisLineExampleHtml + "</table></td></tr><tr><td>" + thisWordExampleEnglish + "</td></tr></table>" + "</td>";
							   
				vocabularyExamplesHtml = vocabularyExamplesHtml + "<tr id=\"" + thisWordChinese + "\">" + thisLineExampleHtml + "</tr>" + "\n";
				
			} // end for every word

			vocabularyExamplesHtml = "<table>" + vocabularyExamplesHtml + "</table>";

			document.getElementById("outputHtml").innerHTML = vocabularyExamplesHtml;
			
		} // end function examplesButtonClicked
		
		function countWords(inputText)
		{
			//debugLog("countWords");
		
  			// Split after verse numbers
  			/*
  			inputText = inputText.replace(/([0-9])([A-Za-z])/g, '$1 $2');
  			inputText = replaceChars(inputText, "(", " ( ");
  			inputText = replaceChars(inputText, ")", " ) ");
  			inputText = replaceChars(inputText, ".", " . ");
  			inputText = inputText.replace(/:/g, ' ');
  			inputText = inputText.replace(/,/g, ' , ');
  			inputText = inputText.replace(/  /g, ' ');
  			*/
  			
  			inputText = replaceChars(inputText, "\n", " ");
  			
  			var inputWords = inputText.split(" ");
  			
  			var numberWords = inputWords.length;
  			
  			var uniqueWords = [];
  			var uniqueWordsCounts = [];
  			
  			var onlyCommon = false;
  			
			if (commonWords != "")
			{
				onlyCommon = true;
			}
  			
  			
  			for (var currentWord = 0; currentWord < numberWords; currentWord++)
  			{
  				var thisWord = inputWords[currentWord];
  				
  				var addWord = true;
  				
  				if (onlyCommon == true)
  				{
  					if (contains(commonWords,thisWord) == false)
  					{
  						addWord = false;
  					}
  				}
  				
  				var thisWordIndex = uniqueWords.indexOf(thisWord);
  				
  				if (thisWordIndex != -1)
  				{
  					var thisCount = uniqueWordsCounts[thisWordIndex];
  					thisCount = thisCount + 1;
  					uniqueWordsCounts[thisWordIndex] = thisCount;
  					
  				} else {
  					uniqueWords.push(thisWord);
  					uniqueWordsCounts.push(1);
  				} // end if the word is unique
  				
  			} // end for every word
  			
  			var numberUniqueWords = uniqueWords.length;
  			
  			var wordsArray = [];
  			
  			for (var currentWord = 0; currentWord < numberUniqueWords; currentWord++)
  			{
  				var thisWord = uniqueWords[currentWord];
  				var thisWordCount = uniqueWordsCounts[currentWord];
  				
  				var outputLine = thisWordCount + " " + thisWord;
  				
  				if (thisWord != "")
  				{
  					wordsArray.push(outputLine);
  				}
  				
  			} // end for every unique word
  			
  			var wordsArraySorted = wordsArray.sort(
  			function(a,b)
				{
				    var c = parseInt(a,10);
				    var d = parseInt(b,10);
			    	return c-d;
				}
			);
			
			var outputArray = wordsArraySorted.reverse();
			
			var outputText = outputArray.join("\n");
			
			return outputText;
					
		} // end function countWords
		
		function getTocflVocabulary(chineseText)
		{
			//debugLog("getVocabulary");
			
			var commonWordsArray = commonWords.split("\n");
			
			var numberWords = commonWordsArray.length;
			
			var vocabularyHtml = "";
			var vocabularyText = "";

			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = commonWordsArray[currentWord];
				
				if (contains(chineseText, thisWord))
				{
					var wordCountArray = chineseText.split(thisWord);
					
					var thisFrequency = wordCountArray.length;
					
					var translationOutput = translateText(thisWord, "");
				
					var translatedHtml = translationOutput[0];
					var translatedText = translationOutput[1];
				
					var translatedTextArray = translatedText.split("\n");
					var translatedTextChinese = translatedTextArray[0];
					var translatedTextPinyin = translatedTextArray[1];
					var translatedTextLiteral = translatedTextArray[2];
					var translatedTextEnglish = translatedTextArray[3];
					
					var thisTextLine = thisFrequency + "	" + thisWord + "	" + translatedTextPinyin + "	" + translatedTextLiteral;
					
					if (contains(vocabularyText,thisTextLine) == false)
					{
						vocabularyText = vocabularyText + thisTextLine + "\n";
					}
					
					translatedHtml = replaceChars(translatedHtml, "<p>", "");
					translatedHtml = replaceChars(translatedHtml, "</p>", "");
					translatedHtml = replaceChars(translatedHtml, "<table>", "");
					translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
					translatedHtml = replaceChars(translatedHtml, "<tr>", "");
					var translatedHtmlArray = translatedHtml.split("</tr>");
					var translatedHtmlChinese = translatedHtmlArray[0];
					var translatedHtmlPinyin = translatedHtmlArray[1];
					var translatedHtmlLiteral = translatedHtmlArray[2];
					var translatedHtmlEnglish = translatedHtmlArray[3];
				
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");

					var thisHtmlLine = "<tr><td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>" + "</tr>";
					
					if (contains(vocabularyHtml,thisHtmlLine) == false)
					{
						vocabularyHtml = vocabularyHtml + thisHtmlLine + "\n";
					}
					
				} // end if the text contains the word
				
			} // end for every word in TOCFL
			
			vocabularyHtml = "<table>" + vocabularyHtml + "</table>";

			return [vocabularyHtml, vocabularyText];

		} // end function getTocflVocabulary
					
		function getVocabulary(chineseText)
		{
			//debugLog("getVocabulary");
			
			if (commonWords != "")
			{
				return getTocflVocabulary(chineseText);
			}
						
			var addPageBreaks = document.getElementById('pageBreaksCheckbox').checked;

			if (addPageBreaks == true)
			{
				var pageBreaksLine = pageBreaksTextArea.value;
			} // end if addPageBreaks

			var wordFrequencies = countWords(chineseText);
			
			var wordFrequenciesArray = wordFrequencies.split("\n");
			
			var numberUniqueWords = wordFrequenciesArray.length;
			
			var vocabularyHtml = "";
			var vocabularyText = "";
			
			for (var currentLine = 0; currentLine < numberUniqueWords; currentLine++)
			{
				var thisFrequencyWord = wordFrequenciesArray[currentLine];
			
				var thisFrequency = textBetween(thisFrequencyWord, "start", " ");
				var thisWord = textBetween(thisFrequencyWord, " ", "end");
								
				var translationOutput = translateText(thisWord, "");
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
				
				var translatedTextArray = translatedText.split("\n");
				var translatedTextChinese = translatedTextArray[0];
				var translatedTextPinyin = translatedTextArray[1];
				var translatedTextLiteral = translatedTextArray[2];
				var translatedTextEnglish = translatedTextArray[3];
				
				vocabularyText = vocabularyText + thisFrequency + "	" + thisWord + "	" + translatedTextPinyin + "	" + translatedTextLiteral + "\n";
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");

				vocabularyHtml = vocabularyHtml + "<tr><td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>" + "</tr>\n";
				
				if (addPageBreaks == true)
				{
					if ((currentLine % pageBreaksLine) == (pageBreaksLine - 1))
					{
						vocabularyHtml = vocabularyHtml + "</table><br></br>" + "<br></br><table>";
					}
				} // end if addPageBreaks
				
			} // end for every word
			
			vocabularyHtml = "<table>" + vocabularyHtml + "</table>";
			
			return [vocabularyHtml, vocabularyText];
		
		} // end function getVocabulary
		
		function vocabularyButtonClicked()
		{
			//debugLog("vocabularyButtonClicked");
			
			var chineseText = document.getElementById("chineseTextArea").value;
			
			var vocabularyArray = getVocabulary(chineseText);
			
			var vocabularyHtml = vocabularyArray[0];
			var vocabularyText = vocabularyArray[1];
			
			// Add examples to vocabulary
			
			document.getElementById("outputHtml").innerHTML = vocabularyHtml;
			document.getElementById("outputTextArea").value = vocabularyText;
			
		} // end function vocabularyButtonClicked
		
		function audioButtonClicked()
		{
			//debugLog("audioButtonClicked");

			var chineseText = document.getElementById("chineseTextArea").value;
			
			var theseLines = chineseText.split("\n");
			
			var numberLines = theseLines.length;
			
			var vocabularyExamplesSubtitles = "";
			var vocabularyCommands = "";
			var audioCommands = "";
			var missingWords = "";

			var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
			var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
			var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
			var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
			var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
			var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
			var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
			var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
			var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
			var pinyinColourFive = pinyinColourOne;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = theseLines[currentLine];
				
				var thisLineWords = thisLine.split(" ");
				
				var numberWords = thisLineWords.length;
				
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisWord = thisLineWords[currentWord];

					if (thisWord != "")
					{
						var translationOutput = translateText(thisWord, "");
				
						var translatedHtml = translationOutput[0];
						var translatedText = translationOutput[1];
						
						var thisLineHtmlArray = translatedHtml.split("</tr>");
					
						var thisLineHtmlChinese = thisLineHtmlArray[0];
						var thisLineHtmlPinyin = thisLineHtmlArray[1];
						var thisLineHtmlLiteral = thisLineHtmlArray[2];
					
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<table>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<tr>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<p>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</td>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</div>", "</font>");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<td>", "");
					
						thisLineHtmlChinese = "<font size=\"80\">" + thisLineHtmlChinese + "</font>";
					
						var thisWordChinese = cleanHtml(thisLineHtmlChinese);
						thisWordChinese = replaceChars(thisWordChinese, " ", "");
						
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</div>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<tr>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "px\">", "\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</span>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<b>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</b>", "");

						// Change the font size
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"14\">", "<font size=\"36\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"15\">", "<font size=\"40\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"16\">", "<font size=\"44\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"17\">", "<font size=\"48\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"18\">", "<font size=\"52\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"19\">", "<font size=\"56\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"20\">", "<font size=\"60\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</font></font> <font", " </font></font><font");
						
						thisLineHtmlLiteral = textBetween(translatedHtml, "<div class=\"literal\">", "</div>");
					
						thisLineHtmlLiteral = "<font size=\"50\"><font color=#000000>" + thisLineHtmlLiteral + "</font></font>";
						
						var thisWordPinyin = "";
				   
						//if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == true)
						if (searchDictionary(thisWordChinese) == true)
						{
							var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
			   
							var thisDictionaryLineArray = thisDictionaryLine.split("	");
			   
							var lineLength = thisDictionaryLineArray.length;
			   
							var thisDefinition = "";
							var thisCharacterPinyin = "";
							var thisToneless = "";
							var thisTone = "";
			   
							thisDefinition = thisDictionaryLineArray[0];

							if (lineLength >= 1)
							{
								thisCharacterPinyin = thisDictionaryLineArray[1];
							}
			   
							if (lineLength >= 2)
							{
								thisToneless = thisDictionaryLineArray[2];
							}
			   
							if (lineLength >= 3)
							{
								thisTone = thisDictionaryLineArray[3];
							}
					   
							var thisPinyinArray = thisCharacterPinyin.split(" ");
							var thisTonelessArray = thisToneless.split(" ");
							var thisTonesArray = stringToCharacterArray(thisTone);
					   
							var numberCharacters = stringLength(thisWordChinese);
					   
							var thisAudioCommand = "";
					   
							if (numberCharacters > 1)
							{
								thisAudioCommand = "cat ";
							}
					   	
							for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
							{
								var thisCharacterToneless = thisTonelessArray[currentCharacter];
								var thisCharacterTone = thisTonesArray[currentCharacter];
						   		
						   		/*
						   		if (thisCharacterToneless == undefined)
						   		{
									addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
						   		} else {
						   		
									if (thisCharacterToneless.length <  thisCharacterPinyin.length)
									{
										addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
									} else {

										if (thisCharacterTone == undefined)
										{
											addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
										}
									}
								}
								*/
						   
								thisWordPinyin = thisWordPinyin + thisCharacterToneless + thisCharacterTone;

								if (numberCharacters > 1)
								{
									thisAudioCommand = thisAudioCommand + "\"PinyinAudio/" + thisCharacterToneless + thisCharacterTone + ".mp3\" ";
								}
						   
							} // end for every character
					   
							if (numberCharacters > 1)
							{							
								thisAudioCommand = thisAudioCommand + "> \"PinyinAudio/" + thisWordPinyin + ".mp3\"";
						   
								audioCommands = audioCommands + thisAudioCommand + "\n";
							}

					   
						} else {
				   
							// Break the word into characters - is still needed because not all vocabulary words are in dictionary
							missingWords = missingWords + thisWordChinese + "\n";

						} // if the word is in the dictionary
						
						
						var thisWordDefinitionSubtitle = "0" + "\n" + "0:00:00,000" + "\n" + thisLineHtmlChinese + "\n" + thisLineHtmlPinyin + "\n" + thisLineHtmlLiteral + "\n";
					
						vocabularyExamplesSubtitles = vocabularyExamplesSubtitles + thisWordDefinitionSubtitle + "\n";
						
						var thisVocabularyCommand = "ffmpeg -i \"last4SecondsPad5.mp4\" -i \"Audio/" + thisWordPinyin + ".mp3\" -vf subtitles=\"WordSubtitles/" + thisWordChinese + ".srt:force_style='FontName=PingFangTC-Regular,Outline=0'\" -map 0:v -map 1:a -threads 9 -preset ultrafast \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						vocabularyCommands = vocabularyCommands + thisVocabularyCommand + "\n";
						
					} // end if this word is blank				
					
				} // end for every word in the line
				
			} // end for every line
			
			//writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			
			//vocabularyCommands = audioCommands + vocabularyCommands;
			
			showMissingWords(missingWords);
			
			document.getElementById("englishTextArea").value = audioCommands;
			document.getElementById("outputTextArea").value = vocabularyExamplesSubtitles;
			document.getElementById("chineseSpacedTextArea").value = vocabularyCommands;

		} // end function audioButtonClicked
		
		function loadRegionalButtonClicked()
		{
			//debugLog("loadRegionalButtonClicked");

			document.getElementById("simplifiedInputTitle").style.width = "auto";
			document.getElementById("simplifiedInputTitle").style.visibility = "visible";

			document.getElementById("simplifiedInputTextArea").style.width = "250px";
			document.getElementById("simplifiedInputTextArea").style.visibility = "visible";
			
			document.getElementById("simplifiedSpacedTitle").style.width = "auto";
			document.getElementById("simplifiedSpacedTitle").style.visibility = "visible";

			document.getElementById("simplifiedSpacedTextArea").style.width = "250px";
			document.getElementById("simplifiedSpacedTextArea").style.visibility = "visible";
			
			document.getElementById("chineseTextArea").style.width = "250px";
			document.getElementById("englishTextArea").style.width = "250px";
			document.getElementById("chineseSpacedTextArea").style.width = "250px";
			document.getElementById("outputTextArea").style.width = "250px";
			
			document.getElementById("simplifiedButtonsDiv").style.height = "auto";
			document.getElementById("simplifiedButtonsDiv").style.visibility = "visible";
			
			document.getElementById("simplifiedCheckboxSpan").style.visibility = "visible";
			
			loadSimplified("opencc/dictionary/STCharacters.txt");
			loadSimplified("opencc/dictionary/STPhrases.txt");
			loadTraditional("opencc/dictionary/TSCharacters.txt");
			loadTraditional("opencc/dictionary/TSPhrases.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesIT.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesName.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesOther.txt");
			loadTaiwan("opencc/dictionary/TWVariants.txt");
			loadTaiwan("opencc/dictionary/TWVariantsRevPhrases.txt");
			loadHongKong("opencc/dictionary/HKVariants.txt");
			loadHongKong("opencc/dictionary/HKVariantsPhrases.txt");
			loadHongKong("opencc/dictionary/HKVariantsRevPhrases.txt");
			loadJapan("opencc/dictionary/JPVariants.txt");
			
			loadTaiwanese("TaiwaneseDictionaryTaiyuNumbers.txt");
			loadCantonese("cantoneseChineseWordsTones.txt");
			loadHakka("Hakka/HakkaPFSTones.txt");
			loadHangul("hangulChineseKorean.txt");
			loadTang("tangChineseWords.txt");
			loadJapanese("japaneseOnChineseWords.txt");
			loadVietnamese("vietnameseChineseWords.txt");
			
			//document.getElementById("simplifiedInputTextArea").value = "中国电信设备制造商华为(Huawei)正在低迷的个人电脑(PC)市场寻求扩张，没有被PC销售下滑和较小参与者出局的现实吓倒。";
			
			//document.getElementById('chineseCheckbox').checked = false;
			//document.getElementById('simplifiedSpacedCheckbox').checked = true;
			
			var thisClass = "regional";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.visibility = "visible";
				thisElement.style.height = "auto";
				thisElement.style.width = "auto";
			} // end for every element
			
			
			document.getElementById("taiwaneseButton").style.width = "70px";
			document.getElementById("cantoneseButton").style.width = "70px";
			
			document.getElementById("wadeGilesButton").style.width = "70px";
			document.getElementById("vietnameseButton").style.width = "70px";

			document.getElementById("searchCantoneseButton").style.width = "70px";
			document.getElementById("searchTaiwaneseButton").style.width = "70px";
			
			document.getElementById("subtitlesButton").style.width = "70px";
			document.getElementById("vocabularyButton").style.width = "80px";
			
		} // end function loadRegionalButtonClicked
		
		function loadWordLists()
		{
			//debugLog("loadWordLists");
			
			var bibleWords = document.getElementById('commonCheckbox').checked;

			commonWords = "";

			var tocflZeroWords = document.getElementById('tocflZeroCheckbox').checked;
			var tocflOneWords = document.getElementById('tocflOneCheckbox').checked;
			var tocflTwoWords = document.getElementById('tocflTwoCheckbox').checked;
			var tocflThreeWords = document.getElementById('tocflThreeCheckbox').checked;
			var tocflFourWords = document.getElementById('tocflFourCheckbox').checked;
			var tocflFiveWords = document.getElementById('tocflFiveCheckbox').checked;
			var tocflSixWords = document.getElementById('tocflSixCheckbox').checked;
			var tocflAllWords = document.getElementById('tocflAllCheckbox').checked;
			
			var hskOneWords = document.getElementById('hskOneCheckbox').checked;
			var hskTwoWords = document.getElementById('hskTwoCheckbox').checked;
			var hskThreeWords = document.getElementById('hskThreeCheckbox').checked;
			var hskFourWords = document.getElementById('hskFourCheckbox').checked;
			var hskFiveWords = document.getElementById('hskFiveCheckbox').checked;
			var hskSixWords = document.getElementById('hskSixCheckbox').checked;
			var hskAllWords = document.getElementById('hskAllCheckbox').checked;
			
			var fireExWords = document.getElementById('fireExCheckbox').checked;
			
			if (bibleWords == true)
			{
				loadCommonWords("wordLists/bibleWords.txt");
			}

			if (tocflZeroWords == true)
			{
				loadCommonWords("wordLists/TOCFL/0.txt");
			}

			if (tocflOneWords == true)
			{
				loadCommonWords("wordLists/TOCFL/1.txt");
			}

			if (tocflTwoWords == true)
			{
				loadCommonWords("wordLists/TOCFL/2.txt");
			}

			if (tocflThreeWords == true)
			{
				loadCommonWords("wordLists/TOCFL/3.txt");
			}

			if (tocflFourWords == true)
			{
				loadCommonWords("wordLists/TOCFL/4.txt");
			}

			if (tocflFiveWords == true)
			{
				loadCommonWords("wordLists/TOCFL/5.txt");
			}

			if (tocflSixWords == true)
			{
				loadCommonWords("wordLists/TOCFL/6.txt");
			}

			if (tocflAllWords == true)
			{
				loadCommonWords("wordLists/TOCFL/tocfl.txt");
			}
			
			if (hskOneWords == true)
			{
				loadCommonWords("wordLists/HSK/1.txt");
			}

			if (hskTwoWords == true)
			{
				loadCommonWords("wordLists/HSK/2.txt");
			}

			if (hskThreeWords == true)
			{
				loadCommonWords("wordLists/HSK/3.txt");
			}

			if (hskFourWords == true)
			{
				loadCommonWords("wordLists/HSK/4.txt");
			}

			if (hskFiveWords == true)
			{
				loadCommonWords("wordLists/HSK/5.txt");
			}

			if (hskSixWords == true)
			{
				loadCommonWords("wordLists/HSK/6.txt");
			}

			if (hskAllWords == true)
			{
				loadCommonWords("wordLists/HSK/hsk.txt");
			}

			if (fireExWords == true)
			{
				loadCommonWords("wordLists/fireExWords.txt");
			}
			
		} // end function loadWordLists
		
		function findNewWords()
		{
			//debugLog("findNewWords");
			
			document.getElementById('breakMissingWordsCheckbox').checked = false;

			var checkText = document.getElementById("chineseSpacedTextArea").value;

			if (checkText == "")
			{
				wordSpaceButtonClicked();
				
				checkText = document.getElementById("chineseSpacedTextArea").value;
			} // end if we didn't already space
			
			checkText = replaceChars(checkText,"\n"," ");
		
			var checkTextArray = checkText.split(" ");
			
			var numberWords = checkTextArray.length;
			
			var newWords = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = checkTextArray[currentWord];
				
				//if (contains(combinedDictionaryData, thisWord) == false)
				if (searchDictionary(thisWord) == false)
				{
					if (isChineseString(thisWord) == true)
					{
						newWords = newWords + thisWord + "\n";
					}
				}
			
			} // end for every word
						
			showMissingWords(newWords);
			
		} // end function findNewWords
				
		function loadVideo(videoUrl)
		{
			//debugLog("loadVideo");

			document.getElementById("mp4_src").src = videoUrl;
			document.getElementById("myVideo").load();
			
		} // end function loadVideo

		function videoPlayPause()
		{
			//debugLog("videoPlayPause");
			
			var isPaused = document.getElementById("myVideo").paused;
			
			if (isPaused)
			{
				document.getElementById("myVideo").play();
			} else {
				document.getElementById("myVideo").pause();
			}
			
		} // end function videoPlayPause
		
		function videoMediaViewerPlayPause()
		{
			//debugLog("videoPlayPause");
			
			var isPaused = document.getElementById("mediaViewerVideo").paused;
			
			if (isPaused)
			{
				document.getElementById("mediaViewerVideo").play();
			} else {
				document.getElementById("mediaViewerVideo").pause();
				
				var audioPausePositions = document.getElementById("lrcTextArea").value;
				
				var pauseTime = getAudioTime("mediaViewerVideo");
				
				audioPausePositions = audioPausePositions + pauseTime + "\n";
				
				document.getElementById("lrcTextArea").value = audioPausePositions;
				
				var lrcArray = audioPausePositions.split("\n");
				var verseNumber = lrcArray.length - 1;
				document.getElementById("verseCountDiv").innerHTML = verseNumber;				
			}
		
		} // end function videoMediaViewerPlayPause
		
		function rewindPauseTimesButtonClicked()
		{
			var audioPausePositions = document.getElementById("lrcTextArea").value;
				
			var pauseTime = getAudioTime("mediaViewerVideo");
			
			var pauseTimeNumber = timeToNumberLrc(pauseTime);
			
			var theseTimes = audioPausePositions.split("\n");
			
			var numberTimes = theseTimes.length;
			
			var lastTimeNumber = 0;
			
			// For every time in the lrc file
			for (var currentTime = 0; currentTime < numberTimes; currentTime++)
			{
				var thisTime = theseTimes[currentTime];
				
				var thisTimeNumber = timeToNumberLrc(thisTime);
				
				if (thisTimeNumber > pauseTimeNumber)
				{
					break;
				} // if the time is after the current position
				
				lastTimeNumber = thisTimeNumber;
				
			} // end for every pause time
			
			document.getElementById("mediaViewerVideo").currentTime = lastTimeNumber;
		} // end function rewindPauseTimesButtonClicked

		function deleteLastPauseTimeButtonClicked()
		{
			var audioPausePositions = document.getElementById("lrcTextArea").value;
			
			var audioPausePositionsArray = audioPausePositions.split("\n");
			
			// Remove the trailing return and last item
			audioPausePositionsArray.pop();
			audioPausePositionsArray.pop();
			
			var newAudioPausePositions = audioPausePositionsArray.join("\n");
			newAudioPausePositions = newAudioPausePositions + "\n";
			
			document.getElementById("lrcTextArea").value = newAudioPausePositions;
			
			var lrcArray = newAudioPausePositions.split("\n");
			var verseNumber = lrcArray.length - 1;
			document.getElementById("verseCountDiv").innerHTML = verseNumber;				
			
			var lastPauseTime = audioPausePositionsArray.pop();
			
			var lastPauseTimeNumber = timeToNumberLrc(lastPauseTime);
			
			document.getElementById("mediaViewerVideo").currentTime = lastPauseTimeNumber;
			
		} // end function deleteLastPauseTimeButtonClicked

		function savePauseTimesButtonClicked()
		{
			var lrcFilename = QueryString.lrcFile;
			
			//lrcFilename = replaceChars(lrcFilename, "%20", " ");
			
			var audioPausePositions = document.getElementById("lrcTextArea").value;
			
			writeToFile(lrcFilename, audioPausePositions);
		} // end function savePauseTimesButtonClicked

		function nextPauseTimesButtonClicked()
		{
			var audioPausePositions = document.getElementById("lrcTextArea").value;
				
			var pauseTime = getAudioTime("mediaViewerVideo");
			
			var pauseTimeNumber = timeToNumberLrc(pauseTime);
			
			var theseTimes = audioPausePositions.split("\n");
			
			var numberTimes = theseTimes.length;
			
			// For every time in the lrc file
			for (var currentTime = 0; currentTime < numberTimes; currentTime++)
			{
				var thisTime = theseTimes[currentTime];
				
				var thisTimeNumber = timeToNumberLrc(thisTime);
				
				if (thisTimeNumber > pauseTimeNumber)
				{
					document.getElementById("mediaViewerVideo").currentTime = thisTimeNumber;
					
					break;
				} // if the time is after the current position
				
			} // end for every pause time
			
		} // end function nextPauseTimesButtonClicked
		

		function showSlide(slideNumber)
		{
			//debugLog("showSlide(" + slideNumber + ")");
			
			currentSlide = slideNumber;
			
			var slideId = "slide" + slideNumber;
			
			var slideHtml = document.getElementById(slideId).innerHTML;
			
			document.getElementById("thisSlideHtml").innerHTML = slideHtml;
			
			appendSubtitle();
			
			// Get the current time
			var thisTime = getVideoTime("myVideo");
			
			// Make a note of the start time and slide text
			lastSlideStartTime = thisTime;
			lastSlideText = slideTextArray[slideNumber];
			
		} // end function showSlide
		
		
		function timeToNumberLrc(thisTime)
		{
			var thisTimeMinutes = textBetween(thisTime, "[", ":");
			var thisTimeSeconds = textBetween(thisTime, ":", ".");
			var thisTimeMilliseconds = textBetween(thisTime, ".", "]");
			
			thisTimeMinutes = thisTimeMinutes * 60;
			thisTimeSeconds = thisTimeSeconds * 1;
			thisTimeMilliseconds = thisTimeMilliseconds / 1000;
			
			var thisTimeNumber = thisTimeMinutes + thisTimeSeconds + thisTimeMilliseconds;
			
			return thisTimeNumber;
			
		} // end function timeToNumberLrc
		
		
		function numberToTime(thisEndTimeNumber)
		{
			//debugLog("numberToTime");

			thisEndTimeSeconds = Math.floor(thisEndTimeNumber);
			thisEndTimeMilliseconds = thisEndTimeNumber - thisEndTimeSeconds;
			
			thisEndTimeMilliseconds = Math.floor(thisEndTimeMilliseconds * 1000);
			
			thisEndTimeHours = 0;
			
			while (thisEndTimeSeconds > 3600)
			{
				thisEndTimeHours = thisEndTimeHours + 1;
				thisEndTimeSeconds = thisEndTimeSeconds - 3600;
			}
							
			thisEndTimeMinutes = Math.floor(thisEndTimeSeconds / 60);
			
			thisEndTimeSeconds = thisEndTimeSeconds - (thisEndTimeMinutes * 60);
			
			thisEndTimeHours = zeroPad(thisEndTimeHours, 2);
			thisEndTimeMinutes = zeroPad(thisEndTimeMinutes, 2);
			thisEndTimeSeconds = zeroPad(thisEndTimeSeconds, 2);
			thisEndTimeMilliseconds = zeroPad(thisEndTimeMilliseconds, 3);
			
			thisEndTime = thisEndTimeHours + ":" + thisEndTimeMinutes + ":" + thisEndTimeSeconds + "," + thisEndTimeMilliseconds;
			
			return thisEndTime;
		} // end function numberToTime
		
		function numberToLrc(thisEndTimeNumber)
		{
			//debugLog("numberToLrc");

			thisEndTimeSeconds = Math.floor(thisEndTimeNumber);
			thisEndTimeMilliseconds = thisEndTimeNumber - thisEndTimeSeconds;
			
			thisEndTimeMilliseconds = Math.floor(thisEndTimeMilliseconds * 1000);
			
			thisEndTimeHours = 0;
			
			while (thisEndTimeSeconds > 3600)
			{
				thisEndTimeHours = thisEndTimeHours + 1;
				thisEndTimeSeconds = thisEndTimeSeconds - 3600;
			}
							
			thisEndTimeMinutes = Math.floor(thisEndTimeSeconds / 60);
			
			thisEndTimeSeconds = thisEndTimeSeconds - (thisEndTimeMinutes * 60);
			
			thisEndTimeHours = zeroPad(thisEndTimeHours, 2);
			thisEndTimeMinutes = zeroPad(thisEndTimeMinutes, 2);
			thisEndTimeSeconds = zeroPad(thisEndTimeSeconds, 2);
			thisEndTimeMilliseconds = zeroPad(thisEndTimeMilliseconds, 3);
			
			thisEndTime = "[" + thisEndTimeMinutes + ":" + thisEndTimeSeconds + "." + thisEndTimeMilliseconds + "]";
			
			return thisEndTime;
		} // end function numberToLrc

		function getAudioTime(videoElementName)
		{
			//debugLog("getVideoTime");
			var thisTime = document.getElementById(videoElementName).currentTime;
			thisTime = thisTime.toFixed(3);
			
			var thisTimeString = numberToLrc(thisTime);
			
			return thisTimeString;
			
		} // end function getAudioTime

		function getVideoTime(videoElementName)
		{
			//debugLog("getVideoTime");
			var thisTime = document.getElementById(videoElementName).currentTime;
			thisTime = thisTime.toFixed(3);
			
			var thisTimeString = numberToTime(thisTime);
			
			return thisTimeString;
			
		} // end function getVideoTime
		
		function appendSubtitle()
		{
			//debugLog("appendSubtitle");

			// Do append blank subtitles so we can use them for durations
			//if (lastSlideText == "")
			//{
			//	return;
			//}
			
			var thisTime = getVideoTime("myVideo");
			
			var lastSlideEndTime = thisTime;
			
			// Append the subtitle to the textarea
			var thisSubtitlesText = document.getElementById("thisSubtitlesTextArea").value;
			
			thisSubtitlesText = thisSubtitlesText + currentSlideSubtitle + "\n" + lastSlideStartTime + " --> " + lastSlideEndTime + "\n" + lastSlideText + "\n";
			
			document.getElementById("thisSubtitlesTextArea").value = thisSubtitlesText;
			
			document.getElementById("thisSubtitlesTextArea").scrollTop = document.getElementById("thisSubtitlesTextArea").scrollHeight;
			
			lastSlideText = "";
			
			currentSlideSubtitle = currentSlideSubtitle + 1;
			
		} // end function addSubtitle
		
		function previousButtonClicked()
		{
			//debugLog("previousButtonClicked");

			currentSlide = currentSlide - 1;
			showSlide(currentSlide);
		} // end function previousButtonClicked

		function blackButtonClicked()
		{
			//debugLog("blackButtonClicked");
		
			document.getElementById("thisSlideHtml").innerHTML = "";
			
			appendSubtitle();
			
		} // end function blackButtonClicked

		function nextButtonClicked()
		{
			//debugLog("nextButtonClicked");

			currentSlide = currentSlide + 1;
			showSlide(currentSlide);
		} // end function nextButtonClicked
		
		function durationsButtonClicked()
		{
			//debugLog("durationsButtonClicked");
		
			var thisSubtitlesText = document.getElementById("thisSubtitlesTextArea").value;
			
			var thisSubtitlesLines = thisSubtitlesText.split("\n");
			
			var numberLines = thisSubtitlesLines.length;
			
			var durationsText = "";
			var currentSubtitle = 1;
			
			var subtitleDuration = 0;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = thisSubtitlesLines[currentLine];
				
				if (contains(thisLine, " --> "))
				{
					var startTimeString = textBetween(thisLine, "start", " --> ");
					var endTimeString = textBetween(thisLine, " --> ", "end");
					
					var startTimeInteger = timeToNumber(startTimeString);
					var endTimeInteger = timeToNumber(endTimeString);
										
					subtitleDuration = endTimeInteger - startTimeInteger;

					subtitleDuration = Math.round(subtitleDuration * 100) / 100;
					
					durationsText = durationsText + "file '" + currentSubtitle + ".png'\nduration " + subtitleDuration + "\n";
					
					currentSubtitle = currentSubtitle + 1;
				} // end if the line is a subtitle time
				
			} // end for every line in the subtitles
			
			// Double the last subtitle because of a quirk in ffmpeg
			currentSubtitle = currentSubtitle - 1;
			durationsText = durationsText + "file '" + currentSubtitle + ".png'\nduration " + subtitleDuration + "\n";
			
			document.getElementById("thisSubtitlesTextArea").value = durationsText;
			
		} // end function durationsButtonClicked
		
		function mediaViewerButtonClicked()
		{
			openMediaViewer();
		} // end function mediaViewerButtonClicked
		
		function lyricsButtonClicked()
		{
			//debugLog("lyricsButtonClicked");

			var videoUrl = "Data/LyricsSrt/Contentment.mp3";
			
			loadVideo(videoUrl);
			
			document.getElementById("videoContainer").style.visibility = "visible";
			document.getElementById("videoContainer").style.height = "auto";
			
			var lyricsText = document.getElementById("chineseTextArea").value;
			
			var lyricsTextLines = lyricsText.split("\n");
			
			var numberLines = lyricsTextLines.length;
			
			var thisSlide = "";
			
			var slidesArray = [];
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = lyricsTextLines[currentLine];
				
				if (thisLine == "")
				{
					slidesArray.push(thisSlide);
					thisSlide = "";
				} else {
					thisSlide = thisSlide + thisLine + "\n";
				} // end if the line is blank
				
			} // end for every line of the lyrics
			
			var numberSlides = slidesArray.length;
			
			var outputHtml = "";
			var outputText = "";
			
			slideTextArray = [];
			
			for (var currentSlideNumber = 0; currentSlideNumber < numberSlides; currentSlideNumber++)
			{
				var thisSlide = slidesArray[currentSlideNumber];
				
				slideTextArray.push(thisSlide);
				
				var thisSlideSpaced = wordSpace(thisSlide);
				
				var translations = translateBilingual(thisSlideSpaced);
				
				var slideHtml=translations[0];
				var slideText=translations[1];
				
				slideHtml = replaceChars(slideHtml, "<br></br>", "");
				
				slideHtml = "<div id=\"slide" + currentSlideNumber + "\" onclick=\"showSlide(" + currentSlideNumber + ");\">" + slideHtml + "</div>";
								
				outputHtml = outputHtml + slideHtml + "<br></br>" + "\n";
				outputText = outputText + slideText + "\n";
				
			} // end for every slide

			document.getElementById("outputHtml").innerHTML = outputHtml;
			document.getElementById("outputTextArea").value = outputText;

			openSlideViewer();
			
		} // end function lyricsButtonClicked
		
		function slidesButtonClicked()
		{
			var originalHtml = document.getElementById("outputHtml").innerHTML;
			
			var outputHtml = replaceChars(originalHtml, "</table>", "</table>\n");
			
			var newLineHtml = "<p></p><table><tr><td><div></div></td></tr></table><p></p>\n";
			
			var newPageHtml = "";
			
			for (var currentLine = 0; currentLine < 10; currentLine++)
			{
				newPageHtml = newPageHtml + newLineHtml;
			} // make a new page of 10 new lines
			
			outputHtml = replaceChars(outputHtml, "<table>", "<table style=\"margin-left: 400px;\">");
			outputHtml = replaceChars(outputHtml, "<div class=\"english\"", "<div class=\"english\" style=\"margin-left: 400px;\"");
			outputHtml = replaceChars(outputHtml, "<br>", newPageHtml);
			
			// Start with enough space to cover the control buttons
			outputHtml = newPageHtml + newPageHtml + outputHtml;
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
		} // end function slidesButtonClicked
		
		function swapButtonClicked()
		{
			//debugLog("swapButtonClicked");
			
			var bilingualText = document.getElementById("chineseTextArea").value;
			
			var bilingualArray = bilingualText.split("\n");
			
			var numberLines = bilingualArray.length;
			
			var lastEnglishString = "";
			
			var swappedText = "";
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = bilingualArray[currentLine];
				
				if (thisLine == "")
				{
					if (lastEnglishString != "")
					{
						swappedText = swappedText + lastEnglishString + "\n";
						lastEnglishString = "";
					}
				
					swappedText = swappedText + thisLine + "\n";
				} else {
				
					var lineIsChinese = containsChineseString(thisLine);
				
					if (lineIsChinese == true)
					{
						swappedText = swappedText + thisLine + "\n";
						
						if (lastEnglishString != "")
						{
							swappedText = swappedText + lastEnglishString + "\n";
						}
						
						lastEnglishString = "";
					
					} else {
						if (lastEnglishString != "")
						{
							swappedText = swappedText + lastEnglishString + "\n";
							lastEnglishString = "";
						}
					
						lastEnglishString = thisLine;
					
					} // end if the line is chinese
					
				} // end if the line is not blank
				
			} // end for every line
			
			document.getElementById("chineseTextArea").value = swappedText;
			
			translateButtonClicked();

		} // end function swapButtonClicked
		
		function splitButtonClicked()
		{
			var bilingualText = document.getElementById("chineseTextArea").value;
			
			var bilingualArray = bilingualText.split("\n");
			
			var numberLines = bilingualArray.length;
			
			var lastEnglishString = "";
			
			var chineseText = "";
			var englishText = "";
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = bilingualArray[currentLine];
				
				if (thisLine == "")
				{
					chineseText = chineseText + thisLine + "\n";
				
					englishText = englishText + thisLine + "\n";
				} else {
				
					var lineIsChinese = containsChineseString(thisLine);
				
					if (lineIsChinese == true)
					{
						chineseText = chineseText + thisLine + "\n";
						
					} else {
					
						englishText = englishText + thisLine + "\n";
					
					} // end if the line is chinese
					
				} // end if the line is not blank
				
			} // end for every line
			
			document.getElementById("chineseTextArea").value = chineseText;
			document.getElementById("englishTextArea").value = englishText;
			
			translateButtonClicked();
		} // end function splitButtonClicked
		
		function lineBreaksButtonClicked()
		{
			var chineseTextAreaWidth = document.getElementById("chineseTextArea").style.width;
			
			var chineseText = document.getElementById("chineseTextArea").value;
			var spacedText = wordSpace(chineseText);
			document.getElementById("chineseSpacedTextArea").value = spacedText;
			
			var chineseLines = chineseText.split("\n");
			
			var outputLines = "";
			var numberLines = chineseLines.length;
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = chineseLines[currentLine];
				
				var lineBrokenLine = lineBreakText(thisLine, chineseTextAreaWidth);
				
				outputLines = outputLines + lineBrokenLine + "\n";
			} // end for every line of input text
			
			document.getElementById("outputTextArea").value = outputLines;
			document.getElementById("htmlTable").innerHTML = "<table><tr><td>" + outputLines.split("\n").join("</td></tr><tr><td>") + "</td></tr></table>" + "<table><tr><td><div id=\"outputHtml\"></div></td></tr></table>";

		} // end function lineBreaksButtonClicked
		
		function lineBreakText(chineseText, chineseTextAreaWidth)
		{
			if (chineseText == "")
			{
				return "";
			}
			
			document.getElementById("htmlTable").innerHTML = "<p class=\"lineWrappingArea\" style=\"width:" + chineseTextAreaWidth + "\">" + chineseText + "</p><table><tr><td><div id=\"outputHtml\"></div></td></tr></table>";
			var wrappedLines = extractLinesFromTextNode( document.querySelector( ".lineWrappingArea" ).firstChild );

			var numberLines = wrappedLines.length;
			if (numberLines > 1)
			{
				var firstLine = wrappedLines[0];
				var secondLine = wrappedLines[1];
				
				var breaksWord = checkLineBreak(firstLine, secondLine);
				
				if (breaksWord == true)
				{
					while (breaksWord == true)
					{
						// Move the newline one character to the left and re-check
						var firstLineArray = firstLine.split("");
						var firstLineLastCharacter = firstLineArray.pop();
						var secondLine = firstLineLastCharacter + secondLine;
						firstLine = firstLineArray.join("");
						
						// If we moved all the way back, fail out to the original newline
						if (firstLine == "")
						{
							breaksWord = false;
							firstLine = wrappedLines[0];
							secondLine = wrappedLines[1];
						} else {
							breaksWord = checkLineBreak(firstLine, secondLine);
						}
					}

					wrappedLines[0] = firstLine;
					wrappedLines[1] = secondLine;
					
					var notFirstLine = "";
					for (var currentLine = 1; currentLine < numberLines; currentLine++)
					{
						notFirstLine = notFirstLine + wrappedLines[currentLine];
					}
					
					return firstLine + "\n" + lineBreakText(notFirstLine, chineseTextAreaWidth);
					
				} else {

					var notFirstLine = "";
					for (var currentLine = 1; currentLine < numberLines; currentLine++)
					{
						notFirstLine = notFirstLine + wrappedLines[currentLine];
					}

					return firstLine + "\n" + lineBreakText(notFirstLine, chineseTextAreaWidth);
				}
			} else {
				return chineseText;
			}
			
		} // end function lineBreakText

		function checkLineBreak(firstLine, secondLine)
		{
			var combinedLine = firstLine + secondLine;
			var spacedCombinedLine = wordSpace(combinedLine);
			spacedCombinedLine = replaceChars(spacedCombinedLine, "\n", "");

			var spacedFirstLine = wordSpace(firstLine);
			spacedFirstLine = replaceChars(spacedFirstLine, "\n", "");
			var spacedSecondLine = wordSpace(secondLine);
			spacedSecondLine = replaceChars(spacedSecondLine, "\n", "");
			
			var combinedSpacedLine = spacedFirstLine + spacedSecondLine;

			var firstLineLastCharacter = firstLine.charAt(firstLine.length - 1);
			if (isChinese(firstLineLastCharacter) == false)
			{
				combinedSpacedLine = spacedFirstLine + " " + spacedSecondLine;
			}
			
			if (combinedSpacedLine !== spacedCombinedLine)
			{
				return true;
			} else {
				return false;
			}
		} // end function checkLineBreak

		/**
		* I extract the visually rendered lines of text from the given textNode as it
		* exists in the document at this very moment. Meaning, it returns the lines of
		* text as seen by the user.
		*/
		function extractLinesFromTextNode( textNode ) {

			// BECAUSE SAFARI: None of the "modern" browsers seem to care about the actual
			// layout of the underlying markup. However, Safari seems to create range
			// rectangles based on the physical structure of the markup (even when it
			// makes no difference in the rendering of the text). As such, let's rewrite
			// the text content of the node to REMOVE SUPERFLUOS WHITE-SPACE. This will
			// allow Safari's .getClientRects() to work like the other modern browsers.
			textNode.textContent = collapseWhiteSpace( textNode.textContent );

			// A Range represents a fragment of the document which contains nodes and
			// parts of text nodes. One thing that's really cool about a Range is that we
			// can access the bounding boxes that contain the contents of the Range. By
			// incrementally adding characters - from our text node - into the range, and
			// then looking at the Range's client rectangles, we can determine which
			// characters belong in which rendered line.
			var textContent = textNode.textContent;
			var range = document.createRange();
			var lines = [];
			var lineCharacters = [];

			// Iterate over every character in the text node.
			for ( var i = 0 ; i < textContent.length ; i++ ) {

				// Set the range to span from the beginning of the text node up to and
				// including the current character (offset).
				range.setStart( textNode, 0 );
				range.setEnd( textNode, ( i + 1 ) );

				// At this point, the Range's client rectangles will include a rectangle
				// for each visually-rendered line of text. Which means, the last
				// character in our Range (the current character in our for-loop) will be
				// the last character in the last line of text (in our Range). As such, we
				// can use the current rectangle count to determine the line of text.
				var lineIndex = ( range.getClientRects().length - 1 );

				// If this is the first character in this line, create a new buffer for
				// this line.
				if ( ! lines[ lineIndex ] ) {

					lines.push( lineCharacters = [] );

				}

				// Add this character to the currently pending line of text.
				lineCharacters.push( textContent.charAt( i ) );

			}

			// At this point, we have an array (lines) of arrays (characters). Let's
			// collapse the character buffers down into a single text value.
			lines = lines.map(
				function operator( characters ) {

					return( collapseWhiteSpace( characters.join( "" ) ) );

				}
			);

			return( lines );

		}


		/**
		* I normalize the white-space in the given value such that the amount of white-
		* space matches the rendered white-space (browsers collapse strings of white-space
		* down to single space character, visually, and this is just updating the text to
		* match that behavior).
		*/
		function collapseWhiteSpace( value ) {

			return( value.trim().replace( /\s+/g, " " ) );

		}



		/**
		* I create a true array from the given array-like data. Array.from() if you are on
		* modern browsers.
		*/
		function arrayFrom( arrayLike ) {

			return( Array.prototype.slice.call( arrayLike ) );

		}


		
		function englishButtonClicked()
		{
			var chineseText = document.getElementById("chineseTextArea").value;
			chineseText = replaceChars(chineseText, "\n", "§");
			
			var englishText = document.getElementById("englishTextArea").value;
			englishText = replaceChars(englishText, "\n", "§");
			
			window.open("english.html?text=" + englishText + "&chineseText=" + chineseText, '_blank');
			
		} // end function englishButtonClicked
		
		function shuffle(array) 
		{
			//debugLog("shuffle");

			var newPosition;
			var currentItem;
			var thisItem;
			
			for (currentItem = array.length; currentItem; currentItem--) 
			{
				newPosition = Math.floor(Math.random() * currentItem);
				thisItem = array[currentItem - 1];
				array[currentItem - 1] = array[newPosition];
				array[newPosition] = thisItem;
			}
			
			return array;
		} // end function function shuffle
		
		
		function shuffleButtonClicked()
		{
			//debugLog("shuffleButtonClicked");
			
			var chineseText = document.getElementById("chineseTextArea").value;
			
			var spacedText = document.getElementById("chineseSpacedTextArea").value;
			
			if (spacedText == "")
			{
				spacedText = wordSpace(chineseText);
			}
			
			spacedText = replaceChars(spacedText, "  ", " ");
			
			var outputText = "";
			
			var spacedLines = spacedText.split("\n");
			var numberLines = spacedLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = spacedLines[currentLine];
			
				var spacedArray = thisLine.split(" ");
			
				spacedArray = shuffle(spacedArray);
			
				var shuffledLine = spacedArray.join(" ");
				
				outputText = outputText + shuffledLine + "\n";
			} // end for every line
			
			document.getElementById("chineseTextArea").value = outputText;
			
			translateButtonClicked();
							
		} // end function shuffleButtonClicked
		
		function dictionaryButtonClicked()
		{
			// debugLog("dictionaryButtonClicked");
			
			var chineseText = document.getElementById("chineseTextArea").value;
			
			var chineseArray = chineseText.split("\n");
			
			var numberWords = chineseArray.length;
			
			var outputHtml = "<table><tr>";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = chineseArray[currentWord];
				
				var translationOutput = translateText(thisWord, "");
		
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
				
				var translatedHtmlChinese = textBetween(translatedHtml, "<tr class=\"chineseLine\">", "</tr>");
				var translatedHtmlPinyin = textBetween(translatedHtml, "<tr class=\"pinyinLine\">", "</tr>");
				var translatedHtmlLiteral = textBetween(translatedHtml, "<tr class=\"literalLine\">", "</tr>");
				var translatedHtmlEnglish = textBetween(translatedHtml, "<div class=\"english\">", "</div>");
				
				outputHtml = outputHtml + "<td>" + translatedHtmlLiteral + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td>";
				
				if (((currentWord + 1) % 3) == 0)
				{
					outputHtml = outputHtml + "</tr><tr>";
				} else {
					outputHtml = outputHtml + "<td>|</td>";
				}
				
			} // end for every word 
			
			outputHtml = outputHtml + "</tr></table>";
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			
		} // end function dictionaryButtonClicked
		
		/*
		* alignLiteralButtonClicked - add punctuation to literal text to make it fit
		*/
		function alignLiteralButtonClicked()
		{
			//debugLog("alignLiteralButtonClicked");
			
			var alignedText = "";
			
			var literalText = document.getElementById("simplifiedInputTextArea").value;
			
			literalText = replaceChars(literalText, " in ", "-in ");
			literalText = replaceChars(literalText, " In ", " In-");
			literalText = replaceChars(literalText, "chiah ê", "chiah-ê");
			literalText = replaceChars(literalText, "Iû-thài lâng", "Iû-thài-lâng");
			literalText = replaceChars(literalText, "khì kàu", "khì-kàu");
			literalText = replaceChars(literalText, "tōe-hng koaⁿ", "tōe-hng-koaⁿ");
			literalText = replaceChars(literalText, "lâng ê", "lâng-ê");
			literalText = replaceChars(literalText, "ê lâng", "ê-lâng");
			literalText = replaceChars(literalText, "chèng lâng", "chèng-lâng");
			literalText = replaceChars(literalText, "chhut-gōa lâng", "chhut-gōa-lâng");
			literalText = replaceChars(literalText, "chi̍t chō", "chi̍t-chō");
			literalText = replaceChars(literalText, "bān mi̍h", "bān-mi̍h");
			literalText = replaceChars(literalText, "chi̍t ê", "chi̍t-ê");
			literalText = replaceChars(literalText, "lâi tit-tio̍h", "lâi-tit-tio̍h");
			literalText = replaceChars(literalText, "kì-jiân sī", "kì-jiân-sī");
			literalText = replaceChars(literalText, "lia̍h chòe", "lia̍h-chòe");
			literalText = replaceChars(literalText, "bô khêng-khàm", "bô-khêng-khàm");
			literalText = replaceChars(literalText, "chi̍t ji̍t", "chi̍t-ji̍t");
			literalText = replaceChars(literalText, "chèng lâng", "chèng-lâng");
			literalText = replaceChars(literalText, "miâ kiò", "miâ-kiò");
			literalText = replaceChars(literalText, "nn̄g lâng", "nn̄g-lâng");
			literalText = replaceChars(literalText, "lâi kóng", "lâi-kóng");
			literalText = replaceChars(literalText, "kì-jiân sī", "kì-jiân-sī");
			literalText = replaceChars(literalText, "ū só͘", "ū-só͘");
			literalText = replaceChars(literalText, "thang sìn", "thang-sìn");
			literalText = replaceChars(literalText, "pa̍t lâng", "pa̍t-lâng");
			literalText = replaceChars(literalText, "thiⁿ tōe", "thiⁿ-tōe");
			literalText = replaceChars(literalText, "Hiah ê", "Hiah-ê");
			literalText = replaceChars(literalText, "siū sóe-lé", "siū-sóe-lé");
			literalText = replaceChars(literalText, "hōaⁿ chhiú", "hōaⁿ-chhiú");
			literalText = replaceChars(literalText, "saⁿ ge̍h ji̍t", "saⁿ-ge̍h-ji̍t");
			literalText = replaceChars(literalText, "tng chèng-lâng-ê", "tng-chèng-lâng-ê");
			literalText = replaceChars(literalText, "ê-lâng", "ê lâng");
			literalText = replaceChars(literalText, "ū lâng", "ū-lâng");
			literalText = replaceChars(literalText, ", -in", ", ");
			literalText = replaceChars(literalText, "bē bat", "bē-bat");
			literalText = replaceChars(literalText, "chit ê", "chit-ê");
			literalText = replaceChars(literalText, "ū ê", "ū-ê");
			literalText = replaceChars(literalText, "chhit ê", "chhit-ê");
			literalText = replaceChars(literalText, "-lâng-ê ", "-lâng ê ");
			literalText = replaceChars(literalText, "só͘ kiâⁿ", "só͘-kiâⁿ");
			literalText = replaceChars(literalText, "Chiah ê", "Chiah-ê");
			literalText = replaceChars(literalText, "Tng sî", "Tng-sî");
			literalText = replaceChars(literalText, "Hiah-ê lâng", "Hiah-ê-lâng");
			literalText = replaceChars(literalText, "hiah ê", "hiah-ê");
			literalText = replaceChars(literalText, "gō͘ bān", "gō͘-bān");
			literalText = replaceChars(literalText, "kóng , ", "kóng ,  ");
			literalText = replaceChars(literalText, "tâng kiâⁿ", "tâng-kiâⁿ");
			literalText = replaceChars(literalText, "sim siūⁿ", "sim-siūⁿ");
			literalText = replaceChars(literalText, "kúi ê", "kúi-ê");
			literalText = replaceChars(literalText, "chi̍t lâng", "chi̍t-lâng");
			literalText = replaceChars(literalText, "bô lūn", "bô-lūn");
			literalText = replaceChars(literalText, "tōa pòaⁿ", "tōa-pòaⁿ");
			literalText = replaceChars(literalText, "Ū lâng", "Ū-lâng");
			literalText = replaceChars(literalText, "chhut chèng-lâng", "chhut-chèng-lâng");
			literalText = replaceChars(literalText, "sòaⁿ hōe", "sòaⁿ-hōe");
			literalText = replaceChars(literalText, "Chèng lâng", "Chèng-lâng");
			literalText = replaceChars(literalText, "lán ê", "lán-ê");
			literalText = replaceChars(literalText, "hōe lâi", "hōe-lâi");
			literalText = replaceChars(literalText, "só͘ thoân", "só͘-thoân");
			literalText = replaceChars(literalText, "iô chhiú", "iô-chhiú");
			literalText = replaceChars(literalText, "chi̍t sî", "chi̍t-sî");
			literalText = replaceChars(literalText, "Sèng Sîn", "Sèng-Sîn");
			literalText = replaceChars(literalText, "gō͘ ji̍t", "gō͘-ji̍t");
			literalText = replaceChars(literalText, "chhit ji̍t", "chhit-ji̍t");
			literalText = replaceChars(literalText, "saⁿ chàn lâu", "saⁿ-chàn-lâu");
			literalText = replaceChars(literalText, "Chhit ji̍t", "Chhit-ji̍t");
			literalText = replaceChars(literalText, "chiūⁿ chûn", "chiūⁿ-chûn");
			literalText = replaceChars(literalText, "tiàm tī", "tiàm-tī");
			literalText = replaceChars(literalText, "chhiáⁿ kàu-hōe", "chhiáⁿ-kàu-hōe");
			literalText = replaceChars(literalText, "góa ê", "góa-ê");
			literalText = replaceChars(literalText, "ta̍k ê", "ta̍k-ê");
			literalText = replaceChars(literalText, "khòaⁿ chòe", "khòaⁿ-chòe");
			literalText = replaceChars(literalText, "Siōng-tè ê kok", "Siōng-tè-ê-kok");
			literalText = replaceChars(literalText, "kìⁿ góa-ê", "kìⁿ-góa-ê");
			literalText = replaceChars(literalText, "lī-khui liáu-āu", "lī-khui-liáu-āu");
			literalText = replaceChars(literalText, "saⁿ nî", "saⁿ-nî");
			literalText = replaceChars(literalText, "tē it", "tē-it");
			literalText = replaceChars(literalText, "hoān sū", "hoān-sū");
			literalText = replaceChars(literalText, "bô ēng", "bô-ēng");
			literalText = replaceChars(literalText, "tē jī", "tē-jī");
			literalText = replaceChars(literalText, "hoān sū", "hoān-sū");
			literalText = replaceChars(literalText, "lâi sìn", "lâi-sìn");
			literalText = replaceChars(literalText, "lī-khui liáu-āu", "lī-khui-liáu-āu");
			literalText = replaceChars(literalText, "chi̍t chiah", "chi̍t-chiah");
			literalText = replaceChars(literalText, "chiūⁿ soaⁿ", "chiūⁿ-soaⁿ");
			literalText = replaceChars(literalText, "sià chāi", "sià-chāi");
			literalText = replaceChars(literalText, "chi̍t chiah", "chi̍t-chiah");
			literalText = replaceChars(literalText, "chiūⁿ chûn", "chiūⁿ-chûn");
			literalText = replaceChars(literalText, "tiong chi̍t-ê", "tiong-chi̍t-ê");
			literalText = replaceChars(literalText, "sì ê", "sì-ê");
			literalText = replaceChars(literalText, "thoân hok-im", "thoân-hok-im");
			literalText = replaceChars(literalText, "siū khó͘-khǹg", "siū-khó͘-khǹg");
			literalText = replaceChars(literalText, "ji̍p khì", "ji̍p-khì");
			literalText = replaceChars(literalText, "chi̍t hāng", "chi̍t-hāng");
			literalText = replaceChars(literalText, "chòe kang", "chòe-kang");
			literalText = replaceChars(literalText, "m̄ nā", "m̄-nā");
			literalText = replaceChars(literalText, "gōa-pang lâng", "gōa-pang-lâng");
			literalText = replaceChars(literalText, "hiah-ê lâng", "hiah-ê-lâng");
			literalText = replaceChars(literalText, "lâi ê", "lâi-ê");
			literalText = replaceChars(literalText, "tē jī", "tē-jī");
			literalText = replaceChars(literalText, "hē chhiú", "hē-chhiú");
			literalText = replaceChars(literalText, "Í-sek-lia̍t lâng", "Í-sek-lia̍t-lâng");
			literalText = replaceChars(literalText, "thoân kàu", "thoân-kàu");
			literalText = replaceChars(literalText, "thì thâu-mn̂g", "thì-thâu-mn̂g");
			literalText = replaceChars(literalText, "sìn Chú", "sìn-Chú");
			literalText = replaceChars(literalText, "nn̄g tiâu", "nn̄g-tiâu");
			literalText = replaceChars(literalText, "chi̍t-kù-ōe", "chi̍t kù ōe");
			literalText = replaceChars(literalText, "Ai-ki̍p lâng", "Ai-ki̍p-lâng");
			literalText = replaceChars(literalText, "Góa sī", "Góa-sī");
			literalText = replaceChars(literalText, "lí ê", "lí-ê");
			literalText = replaceChars(literalText, "góa ê", "góa-ê");
			literalText = replaceChars(literalText, "iā tùi", "iā-tùi");
			literalText = replaceChars(literalText, "tio̍h kiâⁿ", "tio̍h-kiâⁿ");
			literalText = replaceChars(literalText, "hē goān", "hē-goān");
			literalText = replaceChars(literalText, "hit ê", "hit-ê");
			literalText = replaceChars(literalText, "thang mah", "thang-mah");
			literalText = replaceChars(literalText, "in- ", "in ");
			literalText = replaceChars(literalText, " -in", " in");
			literalText = replaceChars(literalText, "(", "( ");
			literalText = replaceChars(literalText, ")", " )");
			literalText = replaceChars(literalText, "?", " ?");
			literalText = replaceChars(literalText, ":", " :");
			//var generatedWordsExtraSpace = "「()。";
			var generatedWordsExtraSpace = "：「()。 ";
			
			var outputText = document.getElementById("outputTextArea").value;
			
			var taiwaneseText = "";
			
			var outputTextArray = outputText.split("\n");
			
			var numberLines = outputTextArray.length;
			
			for (var currentLine = 2; currentLine < numberLines; currentLine = currentLine + 6)
			{
				var thisLine = outputTextArray[currentLine];
				
				taiwaneseText = taiwaneseText + thisLine + "\n";
			} // end for every line
		
			//document.getElementById("outputTextArea").value = taiwaneseText;
		
			var literalTextArray = literalText.split("\n");
			var taiwaneseTextArray = taiwaneseText.split("\n");
			
			numberLines = literalTextArray.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLiteralLine = literalTextArray[currentLine];
				var thisGeneratedLine = taiwaneseTextArray[currentLine];
				
				var thisLiteralLineNoDashes = replaceChars(thisLiteralLine, "-", "");
				
				var thisLiteralLineArray = thisLiteralLine.split(" ");
				
				var thisGeneratedLineArray = thisGeneratedLine.split("	");
				
				var thisAlignedLiteralLine = "";
				
				var numberLiteralWords = thisLiteralLineArray.length;
				var numberGeneratedWords = thisGeneratedLineArray.length;
				
				//debugLog(numberLiteralWords + "	" + thisLiteralLine + "\n" + numberGeneratedWords + "	" + thisGeneratedLine);
				
				var currentLiteralWord = 0;
				
				for (var currentWord = 0; currentWord < numberGeneratedWords; currentWord++)
				{
					if (currentLiteralWord > numberLiteralWords)
					{
						currentWord = numberGeneratedWords;
						break;
					}

					var thisGeneratedWord = thisGeneratedLineArray[currentWord];
					
					/*
					if (thisGeneratedWord != "")
					{
						if (contains(generatedWordsExtraSpace,thisGeneratedWord))
						{
							thisAlignedLiteralLine = thisAlignedLiteralLine + " ";
						}
					}
					*/
					
					thisGeneratedWord = replaceChars(thisGeneratedWord, " ", "");
					
					// If the generated word is in the LitMan input, make sure it lines up
					if (contains(thisLiteralLineNoDashes,thisGeneratedWord) == true)
					{
						for (var incrementWord = currentLiteralWord; incrementWord < numberLiteralWords; incrementWord++)
						{
							currentLiteralWord = currentLiteralWord + 1;
							
							var thisLiteralWord = thisLiteralLineArray[incrementWord];
														
							thisAlignedLiteralLine = thisAlignedLiteralLine + thisLiteralWord + " ";

							thisLiteralWord = replaceChars(thisLiteralWord, "-", "");
							
							if (incrementWord > numberLiteralWords)
							{
								currentWord = numberGeneratedWords;
							}
							
							if (contains(thisGeneratedWord, thisLiteralWord))
							{
								//currentLiteralWord = incrementWord + 1;
								break;
							}
						} // for every word until we reach a match
						
					} else {
						var thisLiteralWord = thisLiteralLineArray[currentLiteralWord];
						
						if (thisLiteralWord == undefined)
						{
							currentWord = numberGeneratedWords;
							break;
						}

						thisAlignedLiteralLine = thisAlignedLiteralLine + thisLiteralWord + " ";
						
						currentLiteralWord = currentLiteralWord + 1;
						
					} // end if the generated word is in the LitMan input
					
					
					
				} // end for every generated word
				
				alignedText = alignedText + thisAlignedLiteralLine + "\n";
				
			} // end for every line
		
			document.getElementById("simplifiedInputTextArea").value = alignedText;
			
			translateButtonClicked();
		
		} // end function alignLiteralButtonClicked
		
		function searchLyrics(searchText)
		{
			var resultsHtml = "";
		
			var lyricsData = localStorage["phrase"];
		
			var songsArray = lyricsData.split("\n");
		
			var lyricsDataDespacedDeradicalised = replaceChars(lyricsData, " ", "");
			lyricsDataDespacedDeradicalised = deradicalize(lyricsDataDespacedDeradicalised);
			lyricsDataDespacedDeradicalised = dehomonym(lyricsDataDespacedDeradicalised);
		
			var songsDespacedDeradicalisedArray = lyricsDataDespacedDeradicalised.split("\n");
		
			var numberSongs = songsArray.length - 1;
		
			var searchInEnglish = isEnglishString(searchText);
		
			for (var currentSong = 0; currentSong < numberSongs; currentSong++)
			{
				var thisSongText = songsArray[currentSong];
			
				var thisSongTextDespacedDeradicalised = songsDespacedDeradicalisedArray[currentSong];
			
				var thisSongHtml = replaceChars(thisSongText, "§", "<br></br>");
				var thisSongTitle = textBetween(thisSongHtml, "start", "	");
				thisSongHtml = textBetween(thisSongHtml, "	", "end");
				
				thisSongTitle = "<a href=\"../index.html?chineseFile=Data/" + thisSongTitle + "\" target=_blank>" + thisSongTitle + "</a><br></br>";

				//thisSongTitle = replaceChars(thisSongTitle, ".txt", ".html") 
				//var thisSongHtml = "<a href=\"Cache/" + thisSongTitle + "\" target=_blank>" + thisSongTitle + "</a><br></br>";
				thisSongHtml = thisSongTitle + thisSongHtml;

				if (contains(thisSongText, searchText) == true)
				{
				
					resultsHtml = resultsHtml + thisSongHtml;
				} else {
				
					if (searchInEnglish == true) 
					{
						var searchTextLowercase = searchText.toLowerCase();
						var thisSongHtmlLowercase = thisSongHtml.toLowerCase();
	
						if (contains(thisSongHtmlLowercase, searchTextLowercase) == true)
						{
							resultsHtml = resultsHtml + thisSongHtml;
						}
					} else {
						var searchTextDespace = replaceChars(searchText, " ", "");
						searchTextDespace = dehomonym(searchTextDespace);
	
						if (contains(thisSongTextDespacedDeradicalised, searchTextDespace) == true)
						{
							resultsHtml = resultsHtml + thisSongHtml;
						} // end if despaced & deradicalised contains
					
					} // end if search in english
			
				} // if the song (or the name) contains the search string
			
			} // end for every song
		
			document.getElementById("resultsHtml").innerHTML = resultsHtml;
		
		} // end function searchLyrics
		
		
		function memorySearchButtonClicked()
		{
			//debugLog("memorySearchButtonClicked");
			
			var searchText = prompt("Search memory");
			
			searchText = deradicalize(searchText);
			searchText = dehomonym(searchText);
			
			searchLyrics(searchText);
			
			//document.getElementById("chineseTextArea").value = songText;
			
		} // end function memorySearchButtonClicked
		
		function advancedButtonClicked()
		{
			//debugLog("advancedButtonClicked");
			
			loadBopomofo("zhuyin.txt");
			loadIds("ids.txt");
			
			document.getElementById("translateButton").innerText = "Deradicalize, Space, and Translate";
			document.getElementById("translateButton").style.width = "193px";
			document.getElementById("defaultTranslateButton").style.width = "200px";
			document.getElementById("thisPhraseTable").style.height = "auto";
			document.getElementById("thisPhraseTable").style.width = "auto";

			document.getElementById("advancedRows").style.height = "auto";

			document.getElementById("chineseSpacedTitle").style.width = "auto";
			document.getElementById("chineseSpacedTextArea").style.width = "auto";
			
			var thisClass = "advanced";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.visibility = "visible";
			} // end for every element
						
		} // end function advancedButtonClicked
		
		function keyPressed()
		{
			//debugLog("keyPressed");

    		var key = window.event.keyCode;
    		
				// If the user has pressed return
				if (key === 13) 
				{
					var defaultButtons = document.getElementsByClassName("DefaultButtonOuter");
					
					if (defaultButtons == null)
					{
						return;
					}
					
					for (var currentButton = 0; currentButton < defaultButtons.length; currentButton++)
					{
						var thisDefaultButton = defaultButtons[currentButton];
						
						var thisButton = thisDefaultButton.firstElementChild;
						
						thisButton.click();
					} // end for every default button
					
				} // end if this key is return
				
		} // end function keyPressed
		
		function moveCursorToElement(newTargetElementId)
		{
			//debugLog("moveCursorToElement(" + newTargetElementId + ")");

			var newPosition = $("#" + newTargetElementId).position();
			var newPositionTop = newPosition.top;
			var newPositionLeft = newPosition.left;
			var newPositionBottom = newPosition.bottom;

			//$("#cursor").parent().css({position: 'relative'});
			$("#cursor").css({top: newPositionTop, left: newPositionLeft, position:'absolute'});
			
			cursorTargetElementId = newTargetElementId;
						
			if (contains(newTargetElementId, "chinese") == true)
			{
				var thisWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = thisWord;
				} else {
					document.getElementById("dictionaryEditorChineseTextArea").value = thisWord;
				}
				
				//dictionaryEditorSearch();

				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					if (useMediaViewer == true)
					{
						document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = thisWord;
					} else {
						document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value = thisWord;
					}
					
					//taiwaneseDictionaryEditorSearch();
				}

			} // end if the cursor word is chinese
			
			
			if (contains(newTargetElementId, "pinyin") == true)
			{
				var thisWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerPinyinTextArea").value = thisWord;
				} else {
					document.getElementById("dictionaryEditorPinyinTextArea").value = thisWord;
				}
				
			} // end if the cursor word is pinyin

			if (contains(newTargetElementId, "literal") == true)
			{
				var thisWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerEnglishTextArea").value = thisWord;
				} else {
					document.getElementById("dictionaryEditorEnglishTextArea").value = thisWord;
				}
				
			} // end if the cursor word is pinyin


			if (contains(newTargetElementId, "litMan") == true)
			{
				var thisWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
			
				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					thisWord = replaceChars(thisWord, "-", " ");
					
					if (useMediaViewer == true)
					{
						document.getElementById("dictionaryEditorMediaViewerPojTextArea").value = thisWord;
					} else {
						document.getElementById("taiwaneseDictionaryEditorPojTextArea").value = thisWord;
					}
					
					//taiwaneseDictionaryEditorSearch();
				}
			} // end if the cursor word is litMan

			
		} // end function moveCursorToElement
		
		function cursorLeft()
		{
			//debugLog("cursorLeft");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			var elementExists = false;
			var newTargetElementId = cursorTargetElementId;
			
			// Move left in the word
			var newData = currentData;
			var newLine = currentLine;
			var newWord = currentWord;
			var newCharacter = currentCharacter - 1;
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists
			
			// If there aren't earlier characters in the word, go to the previous word

			// Move to the previous word
			var newData = currentData;
			var newLine = currentLine;
			var newWord = currentWord - 1;
			var newCharacter = 0;
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId + "	" + elementExists);
			
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists

			// If there aren't later words in the line, go to the previous line
			
			// Move to the previous line
			var newData = currentData;
			var newLine = currentLine - 1;
			var newWord = 0;
			var newCharacter = 0;
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId + "	" + elementExists);
			
			
			while (elementExists != null)
			{
				newWord = newWord + 1;
				newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
				elementExists = document.getElementById(newTargetElementId);
			} // end if new target element exists
			
			newWord = newWord - 1;
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			while (elementExists != null)
			{
				newCharacter = newCharacter + 1;
				var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
				elementExists = document.getElementById(newTargetElementId);
			} // end if new target element exists
			
			newCharacter = newCharacter - 1;
			
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists

		} // end function cursorLeft

		function cursorUp()
		{
			//debugLog("cursorUp");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			var elementExists = false;
			var newTargetElementId = cursorTargetElementId;
			
			var outputHtml = document.getElementById("outputHtml").innerHTML;
			
			// Move to the next line
			var newData = currentData;
			var newLine = currentLine;
			
			if (currentData == "chinese")
			{
				newData = "english";
				newLine = newLine - 1;
			}

			if (currentData == "litMan")
			{
				newData = "chinese";
			}

			if (currentData == "pinyin")
			{
				newData = "chinese";
				
				if (contains(outputHtml, "litMan") == true)
				{
					newData = "litMan";
				}
			}

			if (currentData == "poj")
			{
				newData = "litMan";
			}
			
			if (currentData == "literal")
			{
				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					newData = "poj";
				}
			}

			if (currentData == "english")
			{
				newData = "literal";
			}
			
			var newWord = currentWord;
			var newCharacter = currentCharacter;
			
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId);
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			}
			
			newCharacter = "0";
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);

			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			}

			newWord = "0";
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);

			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			}
			
		} // end function cursorUp

		function cursorRight()
		{
			//debugLog("cursorRight");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			var elementExists = false;
			var newTargetElementId = cursorTargetElementId;
			
			// Move right in the word
			var newData = currentData;
			var newLine = currentLine;
			var newWord = currentWord;
			var newCharacter = currentCharacter + 1;
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists
			
			// If there aren't later characters in the word, go to the next word
			
			// Move to the next word
			var newData = currentData;
			var newLine = currentLine;
			var newWord = currentWord + 1;
			var newCharacter = 0;
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId + "	" + elementExists);
			
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists

			// If there aren't later words in the line, go to the next line
			
			// Move to the next line
			var newData = currentData;
			var newLine = currentLine + 1;
			var newWord = 0;
			var newCharacter = 0;
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId + "	" + elementExists);
			
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists

			
		} // end function cursorRight

		function cursorDown()
		{
			//debugLog("cursorDown");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			var elementExists = false;
			var newTargetElementId = cursorTargetElementId;
			
			var outputHtml = document.getElementById("outputHtml").innerHTML;
			
			// Move to the next line
			var newData = currentData;
			var newLine = currentLine;
			
			if (currentData == "chinese")
			{
				newData = "pinyin";
				
				if (contains(outputHtml, "litMan") == true)
				{
					newData = "litMan";
				}
			}

			if (currentData == "litMan")
			{
				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					newData = "poj";
				}
			}

			if (currentData == "pinyin")
			{
				newData = "literal";
			}

			if (currentData == "poj")
			{
				newData = "literal";
			}

			if (currentData == "literal")
			{
				newData = "english";
			}

			if (currentData == "english")
			{
				newData = "chinese";
				newLine = newLine + 1;
			}
			
			//debugLog(currentData + " -> " + newData);
			
			var newWord = currentWord;
			var newCharacter = currentCharacter;
			
			var newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);
			
			//debugLog(newTargetElementId);
			
			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			} // end if new target element exists
			
			newCharacter = "0";
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);

			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			}

			newWord = "0";
			newTargetElementId = newData + "Line" + newLine + "Word" + newWord + "Character" + newCharacter;
			elementExists = document.getElementById(newTargetElementId);

			if (elementExists != null)
			{
				moveCursorToElement(newTargetElementId);
				return;
			}
			
		} // end function cursorDown
		
		function deleteKeyDown()
		{
			//debugLog("deleteKeyDown");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			if (currentData == "litMan")
			{
				var litManText = document.getElementById('simplifiedInputTextArea').value;
				var litManArray = litManText.split("\n");
				
				var litManLine = litManArray[currentLine];
				
				var litManLineWords = litManLine.split(" ");
				var numberLitManLineWords = litManLineWords.length;
				
				var newLitManLine = "";
				
				for (var currentLitManLineWord = 0; currentLitManLineWord < numberLitManLineWords; currentLitManLineWord++)
				{
					var thisLitManLineWord = litManLineWords[currentLitManLineWord];
					
					newLitManLine = newLitManLine + thisLitManLineWord;
					
					if (currentLitManLineWord != (currentWord - 1))
					{
						newLitManLine = newLitManLine + " ";
					} else {
						newLitManLine = newLitManLine + "-";
					} // end if this word is not the word we're deleting in front of
					
				} // end for every word on the line
				
				litManArray[currentLine] = newLitManLine;
				litManText = litManArray.join("\n");
				
				litManText = replaceChars(litManText, "- ", " ");
				litManText = replaceChars(litManText, " -", " ");
				
				document.getElementById('simplifiedInputTextArea').value = litManText;
				
				//var newLitManHtml = "<tr id=\"litManLine" + currentLine + "\" class=\"litManLine\">";
				var newLitManHtml = litManLineToHtml(newLitManLine, currentLine);
				//litManHtml = litManHtml + "</tr>";
				
				document.getElementById("litManLine" + currentLine).innerHTML = newLitManHtml;
				
			} // end if we should delete from litMan

			if (currentData == "chinese")
			{
				var rightWord = document.getElementById(cursorTargetElementId).parentElement.innerText;

				cursorLeft();
				
				var leftWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
				
				var newWord = leftWord + rightWord;
				
				if (useMediaViewer == true)
				{
					document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = newWord;
				} else {
					document.getElementById("dictionaryEditorChineseTextArea").value = newWord;
				}
				
				dictionaryEditorCharsButtonClicked();

				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					if (useMediaViewer == true)
					{
						document.getElementById("dictionaryEditorMediaViewerChineseTextArea").value = newWord;
					} else {
						document.getElementById("taiwaneseDictionaryEditorChineseTextArea").value = newWord;
					}
					taiwaneseCharsToPoj();
				}
			} // end if we should delete from chinese
		
		} // end function deleteKeyDown

		function spaceKeyDown()
		{
			//debugLog("spaceKeyDown");
			
			var currentData = textBetween(cursorTargetElementId, "start", "Line");
			var currentLine = textBetween(cursorTargetElementId, "Line", "Word") * 1;
			var currentWord = textBetween(cursorTargetElementId, "Word", "Character") * 1;
			var currentCharacter = textBetween(cursorTargetElementId, "Character", "end") * 1;
			
			if (currentData == "litMan")
			{
				var litManText = document.getElementById('simplifiedInputTextArea').value;
				var litManArray = litManText.split("\n");
				
				var litManLine = litManArray[currentLine];
				
				var litManLineWords = litManLine.split(" ");
				var numberLitManLineWords = litManLineWords.length;
				
				var newLitManLine = "";
				
				for (var currentLitManLineWord = 0; currentLitManLineWord < numberLitManLineWords; currentLitManLineWord++)
				{
					var thisLitManLineWord = litManLineWords[currentLitManLineWord];
					
					newLitManLine = newLitManLine + thisLitManLineWord;
					
					if (currentLitManLineWord != (currentWord - 1))
					{
						newLitManLine = newLitManLine + " ";
					} else {
						newLitManLine = newLitManLine + "  ";
					} // end if this word is not the word we're adding a space in front of
					
				} // end for every word on the line
				
				litManArray[currentLine] = newLitManLine;
				litManText = litManArray.join("\n");
				document.getElementById('simplifiedInputTextArea').value = litManText;
				
				//var newLitManHtml = "<tr id=\"litManLine" + currentLine + "\" class=\"litManLine\">";
				var newLitManHtml = litManLineToHtml(newLitManLine, currentLine);
				//litManHtml = litManHtml + "</tr>";
				
				document.getElementById("litManLine" + currentLine).innerHTML = newLitManHtml;
			} // end if we should add a space to litMan

			if (currentData == "chinese")
			{
				var thisWord = document.getElementById(cursorTargetElementId).parentElement.innerText;
				
				dictionaryEditorRemoveTextArea.value = thisWord;

				var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;

				if (addTaiwanese == true)
				{
					taiwaneseDictionaryEditorRemoveTextArea.value = thisWord;
				}
			} // end if we should add a space to chinese

		
		} // end function spaceKeyDown


		function cursorKeyDown()
		{
			//debugLog("cursorKeyDown");
			
    		var key = window.event.keyCode;
    		    		
			// If the user has pressed the left arrow
			if (key === 37) 
			{
				cursorLeft();
			} // end if this key is the left arrow

			// If the user has pressed the up arrow
			if (key === 38) 
			{
				cursorUp();
			} // end if this key is the up arrow

			// If the user has pressed the right arrow
			if (key === 39) 
			{
				cursorRight();
			} // end if this key is the right arrow
			
			// If the user has pressed the up arrow
			if (key === 40) 
			{
				cursorDown();
			} // end if this key is the down arrow

			// If the user has pressed the delete key
			if (key === 8) 
			{
				deleteKeyDown();
			} // end if this key is the delete key

			// If the user has pressed the spacebar
			if (key === 32) 
			{
				spaceKeyDown();
			} // end if this key is the space


		} // end function cursorKeyDown

		function keyDown()
		{
			//debugLog("keyPressed");

    		var key = window.event.keyCode;
    		    		
			// If the user has pressed the left arrow
			if (key === 37) 
			{
				previousButtonClicked();
			} // end if this key is the left arrow

			// If the user has pressed the b key
			if (key === 66) 
			{
				blackButtonClicked();
			} // end if this key is the b key


			// If the user has pressed the right arrow
			if (key === 39) 
			{
				nextButtonClicked();
			} // end if this key is the right arrow

		} // end function keyDown

		
		// Don't reload dictionaries unless the user presses the button. 
		/*
		combinedDictionaryData = localStorage["dictionary"];
		
		if (combinedDictionaryData == "")
		{
			loadDictionaries();
		}
		*/
		
		loadDictionaries();
		
		//loadDictionary("cedictPlusAndtsu8Dictionary.txt");
		//loadDictionary("PinyinDefinitionsTonesSorted.txt");
		//loadDictionary("cedictPlusAndtsu8PinyinDefinitionsTones.txt");
		//loadDictionary("combinedPinyinDefinitionsTones.txt");
		
		//loadLongWords("cedictPlusAndtsu8AndBibleWords2-5.txt");
		loadRadicals("radicals.txt");
  
		document.getElementById("pinyinKeyboard").style.visibility = "hidden";
		//document.getElementById("radicalKeyboard").style.visibility = "hidden";

		loadComposition("cjk-decomp-0.4.0.txt");
		loadGenealogies("Genealogies.txt");

		loadSimplifiedList("SimplifiedCharacters.txt");

		loadToken();
		
		loadToneNumbersMarks("ToneNumbersMarks.txt");
		
		isPhpRunning();
  		
  </script>
  
  <!-- jQuery scripts -->
  <script>
  
    var dictionaryEditorDialog;
  
  	function openMediaViewer()
  	{
  		//debuglog("openSlideViewer");
  		
		useMediaViewer = true;

		document.getElementById("mediaViewer").style.visibility = "visible";

		dictionaryEditorEditCounts();
  		
		var thisDialog = $( "#mediaViewer" ).dialog(
			{
				width: 1880,
				maxWidth: 3000,
				height: 350,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'left bottom',
				    of: $('#htmlTable')
				},
			    dialogClass: 'mediaViewer',
			    create: function (event) {
		            $(event.target).parent().css({ 'position': 'fixed', "left": 50, "top": 150 });
          		}
			    
			}
		); 
  	} // end function openMediaViewer

  	function openSlideViewer()
  	{
  		//debuglog("openSlideViewer");
  		
		document.getElementById("slideViewer").style.visibility = "visible";

		dictionaryEditorEditCounts();
  		
		var thisDialog = $( "#slideViewer" ).dialog(
			{
				width: 800,
				maxWidth: 1200,
				height: 500,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#lyricsButton')
				},
			    dialogClass: 'slideViewer',
			    
			    open: function() {
			    
    				$('body').keydown(function(e) 
    				{
    					keyDown();
    				});
           		}
			    
			}
		); 
		
		
  	} // end function openSlideViewer
  	
  	function showCursorButtonClicked()
  	{
  		//debuglog("showCursorButtonClicked");
		
		useCursor = !useCursor;
		
		var cursorId = "cursor";
		var cursorIdJQuery = "#" + cursorId;
		
		var cursorDiv = document.createElement('div');
		cursorDiv.id = cursorId;
		cursorDiv.className = 'event ui-draggable';
		document.getElementById('outputHtml').appendChild(cursorDiv);
		
		document.getElementById(cursorId).innerHTML = "|";
		
		cursorTargetElementId = "chineseLine0Word0Character0";
		
		var startPosition = $("#" + cursorTargetElementId).position();
		var startPositionTop = startPosition.top;
		var startPositionLeft = startPosition.left;
		var startPositionBottom = startPosition.bottom;
		
		//var startPositionHeight = startPositionBottom - startPositionTop;
		//startPositionTop = startPositionBottom - (startPositionHeight / 2);
		startPositionTop = startPositionTop - 37;
		startPositionLeft = startPositionLeft - 6;
		
		$(cursorIdJQuery).css({ 'background-color':'#FFFFFF', 'width':'3px', 'height': '20px', 'font-size': '20px', 'position': 'fixed', "left": startPositionLeft, "top": startPositionTop });
		//$(newEventIdJQuery).draggable({ snap: ".fifteenMinutes" }).trigger( 'mouseup' );
		//$(cursorIdJQuery).draggable({ snap: ".fifteenMinutes" , stop: function() { dragStopped(this.id);} });

		//$(cursorIdJQuery).resizable( {'handles': 'n, s', 'grid': '18'});
		
		//$(cursorIdJQuery).position.top = startPositionTop;
		//$(cursorIdJQuery).position.left = startPositionLeft;
		
		
			
		$('body').keydown(function(e) 
		{
			if (!$(e.target).is("textarea"))
			{
				cursorKeyDown();
			}
		});
		
		// Disable default arrow keys actions
		cursorEventListener = function(e) {
			// space, delete, and arrow keys
			if ( ([32, 37, 38, 39, 40, 8].indexOf(e.keyCode) > -1) && !$(e.target).is("textarea") )
			{
				e.preventDefault();
			}
		};
		
		
		window.addEventListener("keydown", cursorEventListener, false);
		
		// Move the cursor to the line clicked
		
		var thisClass = "litManWord";

		var theseElements = document.getElementsByClassName(thisClass);
   
		var numberElements = theseElements.length;
	   
		//debugLog(thisClass + " has " + numberElements);
	   
		if (numberElements > 0)
		{
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
			   
				if (thisElement != undefined)
				{
					//debugLog(thisElement.id);
					var targetId = thisElement.id.toString();
					//debugLog(targetId);
					//thisElement.setAttribute("onclick", moveCursorToElement(targetId));
					thisElement.setAttribute("onclick", "moveCursorToElement(\"" + targetId + "\")");
					
    				//$("#" + thisElement.id).attr('onclick', '').click("alert(\"hello\")");
					
					//window.addEventListener("onclick", cursorEventListener, false);
				} // end if the element is not undefined
			} // end for every element
		} // end if there are elements

	 	
  		/*
		document.getElementById("cursor").style.visibility = "visible";
  		
		var thisDialog = $( "#cursor" ).dialog(
			{
				width: 10,
				maxWidth: 10,
				height: 20,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#lyricsButton')
				},
			    dialogClass: 'cursor',
			    
			    open: function() {
			    
           		}
			    
			}
		); 
		*/
  		
  	} // end function showCursorButtonClicked

	function litManSizeButtonClicked()
	{
		var el = document.querySelectorAll(".litManWord");
		for ( var i = 0; i < el.length; i ++ ) {
			el[i].style.fontSize = "32px";
		}
	} // end function litManSizeButtonClicked

  	function openTaiwaneseDictionaryEditor()
  	{
  		//debuglog("openTaiwaneseDictionaryEditor");
  		
		document.getElementById("taiwaneseDictionaryEditor").style.visibility = "visible";

		dictionaryEditorEditCounts();
  		
		var thisDialog = $( "#taiwaneseDictionaryEditor" ).dialog(
			{
				width: 450,
				maxWidth: 768,
				height: 400,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#editButton')
				},
			    dialogClass: 'dialogWithDropShadow',
			    create: function (event) {
		            $(event.target).parent().css({ 'position': 'fixed', "left": 50, "top": 150 });
          		}
			}
		); 

		//dictionaryEditorDiv.dialog('open');
				
  	} // end function openTaiwaneseDictionaryEditor

  	function openCantoneseDictionaryEditor()
  	{
  		//debuglog("openCantoneseDictionaryEditor");
  		
		document.getElementById("cantoneseDictionaryEditor").style.visibility = "visible";

		dictionaryEditorEditCounts();
  		
		var thisDialog = $( "#cantoneseDictionaryEditor" ).dialog(
			{
				width: 450,
				maxWidth: 768,
				height: 400,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#editButton')
				},
			    dialogClass: 'dialogWithDropShadow',
			    create: function (event) {
		            $(event.target).parent().css({ 'position': 'fixed', "left": 50, "top": 150 });
          		}
			}
		); 

		//dictionaryEditorDiv.dialog('open');
				
  	} // end function openCantoneseDictionaryEditor

  	
  	function openDictionaryEditor()
  	{
  		//debuglog("openDictionaryEditor");
  		
		document.getElementById("dictionaryEditor").style.visibility = "visible";

	  	var useGithub = document.getElementById("useGithubCheckbox").checked;
	  	
	  	if (useGithub == false)
	  	{
	  		document.getElementById("dictionaryEditorGoogleTransPyButton").style.visibility = "visible";
	  	}

		dictionaryEditorEditCounts();
  		
		dictionaryEditorDialog = $( "#dictionaryEditor" ).dialog(
			{
				width: 450,
				maxWidth: 768,
				height: 400,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#editButton')
				},
			    dialogClass: 'dialogWithDropShadow',
			    create: function (event) {
		            $(event.target).parent().css({ 'position': 'fixed', "left": 50, "top": 150 });
          		}
			}
		); 

		//dictionaryEditorDiv.dialog('open');
				
  	} // end function openDictionaryEditor
  	
  	//openDictionaryEditor();

		
  	
  </script>
  
</html>
