<!--
	Pingtype
	Peter Burkimsher 2017-01-16 to 2017-06-13
	
	A literal translator for Chinese to English. 
	
	+ Translate HTML
	+ Translate text
	+ Translate bilingual
	+ Word spacing
	+ Deradicalize
	+ Word search
	+ Append to file
	+ Pinyin typing, word suggestion
  	+ Rounded rectangle buttons
  	+ Decomposing numbers not just characters
	+ Matrix
	+ Save word errors
	+ Upload and read from image
	+ Hide pinyin, literal, change opacity
	+ Common characters in bold
	+ Syllables, charts. Red for mismatch. 
	+ Google translate words, input
	+ Bopomofo, with dot above
	+ Character to TurtleSheet
	+ Change tone colours
	+ Frequency sort
	+ Character spacing
	+ Break missing words
	+ Keep unspaced, spaced Chinese on lines like English
	+ Choice of dictionaries, including Unihan and zh-wiktionary and en-wiktionary
	+ Dictionary in localStorage (only up to a maximum length though)
    + Floating dictionary update panel using jQuery, with date added
	+ Type bopomofo, convert to pinyin to add word
	+ Tone numbers to tone marks
	+ Pinyin suggestion, easy to edit tone
	+ Classifiers to dictionary
	+ Auto-load text from url through API
	+ Historical phrase reader
	+ Filename save to server, auto-detect if PHP is running to save locally
	+ Upload dictionary changes to server, unsynced changes tracker
	+ Bopomofo keyboard in character search
	+ HubText direct file editor on GitHub
	+ GUI in Chinese
	+ Load chinese, english from url.
	+ Simplified
	+ Regional variants
	+ Hex, Unitype input, bulk input, and output
	+ Pinyin tone numbers, sized
	+ Large Seal script, Small Seal Script, Oracle bones with fonts
	+ Word Frequency side script
	+ Findnewwords from text area side script
	+ Taiwanese, Cantonese with font size, colours for tones. 
	+ Tang, Vietnamese, Japanese, Hangul output
	+ CNLT, Vicky's blog
	+ Monospaced font
	+ Print to PDF, page breaks
	+ Coloured subtitles
	+ Subtitles vocabulary with examples
	+ Word lists (TOCFL, HSK)
	+ hash out words not in tocfl
	+ Pingfang, Jhenghei fonts
	+ TOCFL8000, Bible book short names, Country names, road names, city names to dictionary
	
	
	To do:
	- dictionary problems where there are too many tones because of extra spaces
	- remove extra dot in 爺爺, 奶奶, 舅舅, 妹妹, 弟弟, 姐姐, 叔叔, 寶寶
	- 5th tone from https://pedia.cloud.edu.tw/Home/List?search=也不錯
	- bopomofo of yinhang not yinxing
	- audio in headings
	- font selection menu in interface
	- png frames of clips to html file of words
	- space after quote in translate bilingual
	- left indent
	- find syllables in data sources
	- vocabulary test website, ask user to click/type words they know
	- tocfl pinyin comparison
	- reviewing the hanzi in typing area
	- lrc lyrics files to srt
	- subtitles plain, just spaced chinese and english
	- proper page breaks using css https://www.w3schools.com/cssref/pr_print_pageba.asp
	- Other languages (e.g. English, French, Slovak) with custom dictionary
	- khop button like subtitles to make summary of new words in video to textarea, lyrics to html area
	- zh-wikipedia to text files
	- Wade-giles, english, korean, japanese, vietnamese, cantonese, taiwanese first choice bulk input in simplified text box
	- pinyin sizes, disable tone numbers for wade-giles
	- Save files into folder
	- check upload, allow retry if failed.
	- options of different sounds for one word (hang, xing) to mouseover
	- Puns
	- chords above text
	- Four chords to four tones
	- number of songs in khop to get all syllables
	- khop videos
	- Random Bible verse website
	- cunp manual fixing
	- pos speech tagging, could use to change grammar later
	- number of radicals to get all characters
	- server-side for automatic facebook chinese made larger and spaced
	
	Marketing:
	- Talk to richard.sears.tn@gmail.com http://www.chineseetymology.org/CharacterEtymology.aspx?submitButton1=Etymology&characterInput=於
	- report errors to let's learn chinese textbook
	- don't forget to re-enable appcache before release
	- Release on Hacker News
	- Promote to Chinese Universities database's professors
	- Talk to zh-wikipedia editors about using spacing
	- Huáng Yù Chún 黃鈺淳 is TEDx NCYU in Chiayi
	- Talk to Dr Donald Sturgeon from CText http://ctext.org/faq#copyright
	- http://socialmandarin.com
	- http://www.davidpetersson.com/practice-your-chinese-writing-skills-chinese-writer-on-iphone-or-ipad/
	
	Documentation:
	- Chinese words that are shorter than english (mosquito, air conditioning)
	- Tones joke 來刀叉可以嗎？ 來到茶可以嗎？ https://mattandre.ws/2012/08/the-importance-of-tones-in-mandarin-chinese/
	- Docs in Chinese
	- how to use f-stop to change names to pinyin
	- Simplified characters documentation, that Carbo Kuo (ByVoid) is just as rude as Unihan maintainer
	- Unitype, hex codes documentation
	- Word frequency side script documentation
	- Documentation Vicky's blog https://vickytravelday.wordpress.com
	- monospaced text alignment when using simsun font
	- Taiwan law
	- find words in data sources

	Long-term development:
	- o for a thousand tounges to sing in different languages
	- be thou my vision in different languages
	- Superscript/subscript for tones, after unicode adds subscript "g" (or use 9) http://stackoverflow.com/questions/17908593/how-to-find-the-unicode-of-the-subscript-alphabet
	- Hakka https://en.wikipedia.org/wiki/Hakka_Bible:_Today%27s_Taiwan_Hakka_Version https://en.wikipedia.org/wiki/Pha̍k-fa-sṳ
	- Ningbo dialect romanised by Hudson Taylor https://find.bible/bibles/WUURNT/
	- one ok rock, ellegarden bilingual songs to learn japanese
	- Mobile theme
	- Remove hard-coded Github access token
	- Gwoyeu Romatzyh
	- cedict as itunes
	- cursor
	- Word segmentation from http://ckipsvr.iis.sinica.edu.tw
	- Server-side translation with REST API
	- Upload new dictionary edits to https://translate.google.com/community#zh-TW/en
	- WebASM multi-threading to translate each line separately, faster
	- Lazy load leaflet when image uploaded	
	- Seal script, after unicode adds it
	- Glagolitic script https://en.wikipedia.org/wiki/Glagolitic_script
	- Japanese/French http://jibiki.fr
	- greek and hebrew
	
	Data sources:
	- indievox lyrics https://raw.githubusercontent.com/indievox-inc/iNDIEVOX-Dataset/master/dataset/lyrics.dataset
	- Sermons from http://www.kc7schurch.org.tw/index.php?Pgc=Sermon&SermonPgNo=1
	- https://github.com/umbrae/reddit-top-2.5-million/blob/master/data/languagelearning.csv
	- Taiwanese dramas http://sugoideas.com/
	- Paragliding manual
	- Chinese audio Bible
	- Taiwanese films
	- Double subtitles from https://secure.assrt.net especially DTS-WiKi and http://www.zimuzimu.com
	- CUNP
	- taiwanese songs - living water church, fire ex
	- japanese songs
	- hillsong global project
	- 4 spiritual laws
	- Famous manga (Naruto, OnePiece)
	- Space all of zh-wikipedia (about 11 days runtime)
	- Only common words in Pingtype dictionary
	- Dictionary of phrases from OpenCC
	- KHOP audio
	- Joshuaband lyrics
	- Weather
	- Daily Bible
	- News http://www.taipeitimes.com/News/lang/archives/2017/04/16/2003668787 - load live, because people must be allowed to edit
	- Kaohsiung Q&A (back to 2014) https://www.facebook.com/groups/KaohsiungQA/
	- Movie subtitles
	- LINE chats, Facebook, PTT
	- Taiwanese immigration test
	- Phrases from Wendy
	- Manga from https://mangahelpers.com/m/haikyuu/translations/
	- Lyrics from http://www.5nd.com/gecilrc/69656.htm and https://www.lrcsite.com
	- Movies from http://dl.funsaber.net/animation/ and http://fs.evonetbd.com/index.php?dir=Movies%2F&search=2000&search_mode=f and http://dl2.mihanpix.com/Film/
	- Manuals from https://www.manualslib.com
	
	Type in:
	- Texts from dog
	- Reddit group to request photo transcription
	- Wendy instagram
	
	Other languages:
	- Hakka Bible: http://www.bible.is/HAKTHV/Matt/1
	- FML in French http://www.viedemerde.fr and Spanish http://www.vida-hp.com
	- simple english words in other languages

	Decompose started 2016-12-05, merged with translate on 2017-04-05
	Recursively breaks a Chinese character into its parts
	
	Decomposition data from https://cjkdecomp.codeplex.com
	Simplified converstion data from https://github.com/BYVoid/OpenCC/tree/master/data/dictionary
	Taiwanese dictionary from MKDictionary http://www.taiwanesedictionary.org
	TOCFL from http://www.sc-top.org.tw/english/download.php
	HSK from https://github.com/Lemmih/lesschobo
	
	Hit counter at https://github.com/pingtype/pingtype.github.io/graphs/traffic
	
-->

<!DOCTYPE html>
<html manifest="pingtype.appcache">
  <head>
  	<title>Pingtype</title>
  	  	
	<meta charset="utf-8" />
    <style>

@font-face {
    font-family: "Charcoal CY";
    src: url("fonts/Charcoal.ttf") format("truetype");
}

@font-face {
    font-family: "Virtue";
    src: url("fonts/virtue.ttf") format("truetype");
}

@font-face {
    font-family: "SimSun";
    src: url("fonts/SimSun.ttf") format("truetype");
}

@font-face {
    font-family: "Jhenghei";
    src: url("fonts/MicrosoftJhengHeiRegular.ttf") format("truetype");
}

@font-face {
    font-family: "PingfangLocal";
    src: local("PingFang-TC-Regular");
}

@font-face {
    font-family: "Pingfang";
    src: url("fonts/PingFang1.ttf") format("truetype");
}

      body {
        font-family: Tahoma, Geneva, sans-serif;
      }
      
      table td {
      white-space: nowrap;
      }
		
	a:hover, a:visited, a:link, a:active
	{
		color:#000000;
	    text-decoration: none;
	}
		
      .chinese_1 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#000000;
		font-size: 30px;
		display:inline;
      }

      .chinese_2 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .chinese_3 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .chinese_4 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

      .chinese_5 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }

      .chinese_6 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }

      .chinese_7 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }
      
      .chinese_8 {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
font-size: 30px;
display:inline;
      }


      .pinyin_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .pinyin_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
display:inline;
      }

      .pinyin_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
display:inline;
      }

      .pinyin_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
display:inline;
      }

      .pinyin_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .taiwanese_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#787878;
		display:inline;
      }

      .taiwanese_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
display:inline;
      }

      .taiwanese_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#0000FF;
display:inline;
      }

      .taiwanese_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#505050;
display:inline;
      }

      .taiwanese_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#F82423;
display:inline;
      }

      .taiwanese_7 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }
      
      .taiwanese_8 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#929292;
display:inline;
      }

      .cantonese_1 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#929292;
		display:inline;
      }

      .cantonese_2 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#FF8080;
display:inline;
      }

      .cantonese_3 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#787878;
font-size: 30px;
display:inline;
      }

      .cantonese_4 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#0000FF;
display:inline;
      }

      .cantonese_5 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#F82423;
display:inline;
      }

      .cantonese_6 {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .hangul {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:#000000;
		font-size: 26px;
		display:inline;
      }

      .tang {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .japanese {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .vietnamese {
        font-family: "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .englishInChinese {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .literal {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }

      .english {
        font-family: "Pingfang", "Jhenghei", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#000000;
display:inline;
      }


		.DefaultButtonOuter
		{
			border: 2px solid black ;
			border-radius: 8px;
			width: 96px;
			height: 26px;
			text-align: center;
			
			/*background-color: #99999a;*/
			background: #99999a; /* For browsers that do not support gradients */
			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */
			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */
			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */
			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */
		}

		.ButtonInner
		{
			border: 1px solid black ;
			border-radius: 5px;
			background-color: #dcdbde;
			width: 88px;
			height: 18px;
			text-align: center;
			margin: 3px;
			
		    line-height: 18px;
	        font-family: "Charcoal CY", "Virtue", Geneva, sans-serif;
			font-size: 11px;
			color: #000000;
		}
		
		.ButtonInner:active
		{
		    background:#666666;
		    color: #ffffff;
		}

		.key
		{
			border: 1px solid black ;
			border-radius: 5px;
			background-color: #dcdbde;
			width: 18px;
			height: 18px;
			text-align: center;
			margin: 3px;
			
		    line-height: 18px;
	        font-family: Geneva, sans-serif;
			font-size: 11px;
			color: #000000;
		}


			#matrix {
				background: black;
				float: center;
			}

			#matrix td {
			    padding: 7px;
    			margin: 0px;
    			float: center;
				background: black;
				font: 54px arial;
				
				height: 80px;
			}

			#matrix tr {
				height: 80px;
			}


			#matrix p {
			    opacity: 0;
			    margin-top: -25px;
			    text-align: center;

				height: 80px;

			    -webkit-transition: margin-top 2s ease-in;
			    -moz-transition: margin-top 2s ease-in;
			    -o-transition: margin-top 2s ease-in;
			    -ms-transition: margin-top 2s ease-in;
			    transition: margin-top 2s ease-in;
			}
			
			#matrix p.load {
			    opacity: 1;
			    margin-top: 25px;
			}

     .dialogWithDropShadow
     {
         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);
         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); 
     }

@font-face {
    font-family: "SmallSealScript";
    src: url("fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf") format("truetype");
}

      .smallSealScript_1 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .smallSealScript_2 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .smallSealScript_3 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .smallSealScript_4 {
        font-family: "SmallSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }

@font-face {
    font-family: "LargeSealScript";
    src: url("fonts/JDFZHUANF.ttf") format("truetype");
}

      .largeSealScript_1 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .largeSealScript_2 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .largeSealScript_3 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .largeSealScript_4 {
        font-family: "LargeSealScript", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }


@font-face {
    font-family: "OracleBones";
    src: url("fonts/bnujgw.ttf") format("truetype");
}

      .oracleBones_1 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
        color:black;
		font-size: 30px;
		display:inline;
      }

      .oracleBones_2 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#f82423;
font-size: 30px;
display:inline;
      }

      .oracleBones_3 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#189c19;
font-size: 30px;
display:inline;
      }

      .oracleBones_4 {
        font-family: "OracleBones", "Heiti TC Light", Tahoma, Geneva, sans-serif;
color:#178FD1;
font-size: 30px;
display:inline;
      }


    </style>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="apple-touch-icon-precomposed" href="images/pingtypeLogo256.png" />
	<link rel="stylesheet" href="leaflet/leaflet.css" />
	<link rel="stylesheet" href="jquery-ui.css"/>

  </head>
<!--  <body onkeypress="keyPressed();"> -->
  <body>

  	<div style="font-family: 'Lucida Sans', Geneva, sans-serif; font-size: 16px;">
		翻譯 軟體 <b>Pingtype Parallel Translator</b>
  	</div>
	
	<table id="inputTable">
		<tr>
			<td>
  				<div id="simplifiedInputTitle" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Simplified input 简化字 輸入
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Chinese input 中文 輸入
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					English input 英文 輸入
  				</div>
			</td>
			<td>
  				<div id="chineseSpacedTitle" class="advanced" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Chinese spaced 中文 空間
  				</div>
			</td>
			<td>
  				<div id="simplifiedSpacedTitle" style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;visibility:hidden;width:0px">
  					Simplified spaced 简化字 空間
  				</div>
			</td>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Text output 文本 輸出
  				</div>
			</td>
		</tr>
		<tr>
			<td>
  				<textarea id="simplifiedInputTextArea" style="visibility:hidden;width:0px" rows="10" cols="50" onkeyup="useSimplified();"></textarea>
  			</td>
			<td>
				<textarea id="chineseTextArea" rows="7" cols="50" style="font-size: 16px;"></textarea>
  			</td>
  			<td>
  				<textarea id="englishTextArea" rows="10" cols="50" ></textarea>
  			</td>
  			<td>
  				<textarea id="chineseSpacedTextArea" class="advanced" style="visibility:hidden;width:0px" rows="10" cols="50" ></textarea>
  			</td>
			<td>
  				<textarea id="simplifiedSpacedTextArea" style="visibility:hidden;width:0px" rows="10" cols="50" ></textarea>
  			</td>
  			<td>
  				<textarea id="outputTextArea" rows="10" cols="50" style="font-family: 'SimSun', Geneva, sans-serif;"></textarea>
  			</td>
  		</tr>
  		
  	</table>
  	
  	<table id="translateButtonsTable" >
  		
  		<tr>
  			<!--
  			<td style="width:100px;height:10px;background-color:#BBBBBB;text-align:center;" onclick="translateHtml();">
  				Translate HTML
  			</td>
  			<td style="width:100px;height:10px;background-color:#BBBBBB;text-align:center;" onclick="translateInterface();">
  				Translate Text
  			</td>
  			-->
			<td>
				<div id="defaultTranslateButton" class="DefaultButtonOuter">
					<div id="translateButton" class="ButtonInner" onclick="translateButtonClicked();">
		  				Translate 翻譯
					</div>
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="clearButtonClicked();" style="width:70px">
					Clear 擦除
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="clearLocalStorage();" style="width:30px">
					MC
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="memoryPlus();" style="width:30px">
					M+
				</div>
			</td>
			<td>
				<div class="ButtonInner" onclick="loadFromLocalStorage();" style="width:30px">
					MR
				</div>
			</td>
			<td>
				<div id="editButton" class="ButtonInner" onclick="openDictionaryEditor();" style="width:60px">
	  				Edit 編輯
				</div>
			</td>
			<td>
				<div id="advancedButton" class="ButtonInner" onclick="advancedButtonClicked();">
	  				Advanced 高級
				</div>
			</td>
			<td>
				<div id="helpButton" class="ButtonInner" onclick="helpButtonClicked();" style="width:20px">
	  				?
				</div>
			</td>
			<td>
				<div id="loadRegionalButton" class="ButtonInner advanced" onclick="loadRegionalButtonClicked();" style="visibility:hidden;">
	  				Regional 區域
				</div>
			</td>
			<td>
				<div id="matrixButton" class="ButtonInner advanced" onclick="matrixButtonClicked();" style="visibility:hidden">
					Matrix 黑客
				</div>
			</td>
			<td>
				<div id="googleTranslatePhraseButton" class="ButtonInner advanced" onclick="googleTranslatePhraseButtonClicked();" style="visibility:hidden;width:100px">
	  				Google Translate
				</div>
			</td>
			<td>
				<div id="printButton" class="ButtonInner advanced" onclick="printButtonClicked();" style="visibility:hidden;width:60px">
	  				Print 印表
				</div>
			</td>
			<td>
				<div id="onlyTranslateButton" class="ButtonInner advanced" onclick="translateInterface();" style="visibility:hidden">
	  				Translate 翻譯
				</div>
			</td>
		</tr>
	</table>
	
	<div id="advancedRows" style="visibility:hidden;height:0px;">
	
		<table id="spaceButtonsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Spacing 空間
					</div>
				</td>
				<td>
					<div id="deradicalizeButton" class="ButtonInner advanced" onclick="deradicalizeButtonClicked();" style="visibility:hidden">
						Deradicalize
					</div>
				</td>
				<td>
					<div id="spaceButton" class="ButtonInner advanced" onclick="wordSpaceButtonClicked();" style="visibility:hidden">
						Words 話
					</div>
				</td>
				<td>
					<div id="characterSpaceButton" class="ButtonInner advanced" onclick="characterSpace();" style="visibility:hidden">
						Characters 汉字
					</div>
				</td>
				<td>
					<div id="despaceButton" class="ButtonInner advanced" onclick="despaceButtonClicked();" style="visibility:hidden">
						Despace 繼續
					</div>
				</td>
				<td>
					<input type="checkbox" id="monospaceTextCheckbox" checked="true"><span onclick="toggleCheckbox('monospaceTextCheckbox');">Monospace text</span>
				</td>
				<td>
					<span onclick="toggleCheckbox('breakMissingWordsCheckbox');">
					<table>
						<tr>
							<td>
								<input type="checkbox" id="breakMissingWordsCheckbox" checked="true">
							</td>
							<td style="width:132px;white-space:normal">
									Break missing words 打破 遺漏 的 單詞
							</td>
						</tr>
						<tr>
							<td>
							</td>
							<td>
					 			
							</td>
						</tr>
					</table>
					</span>
				</td>
				<td>
					<textarea id="pageBreaksTextArea" rows="1" cols="3" >10</textarea>
				</td>
				<td>
					<input type="checkbox" id="pageBreaksCheckbox"><span onclick="toggleCheckbox('pageBreaksCheckbox');">Page Breaks</span>
				</td>
				<td>
					<div id="subtitlesButton" class="ButtonInner advanced" onclick="subtitlesButtonClicked();" style="width:65px;visibility:hidden">
						Subtitles
					</div>
				</td>
				<td>
					<div id="examplesButton" class="ButtonInner advanced" onclick="examplesButtonClicked();" style="width:65px;visibility:hidden">
						Examples
					</div>
				</td>
				<td>
					<div id="vocabularyButton" class="ButtonInner advanced" onclick="vocabularyButtonClicked();" style="visibility:hidden">
						Vocabulary
					</div>
				</td>
				<td>
					<div id="audioButton" class="ButtonInner advanced" onclick="audioButtonClicked();" style="width:55px;visibility:hidden">
						Audio
					</div>
				</td>
			</tr>
		</table>
	
		<div id="simplifiedButtonsDiv" style="visibility:hidden;height:0px;">
			<table id="simplifiedButtonsTable" style="font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
				<tr>
					<td>
						<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
							Regional 區域
						</div>
					</td>
					<td>
						<div id="simplifiedToTraditionalButton" class="ButtonInner" onclick="simplifiedToTraditionalButtonClicked();" style="width:150px">
							Simplified To Traditional
						</div>
					</td>
					<td>
						<div id="spacedToSimplifiedButton" class="ButtonInner" onclick="spacedToSimplifiedButtonClicked();" style="width:120px">
							Spaced to Simplified
						</div>
					</td>
					<td>
						<div id="hongKongButton" class="ButtonInner" onclick="hongKongButtonClicked();" style="width:70px">
							Hong Kong
						</div>
					</td>
					<td>
						<div id="taiwanButton" class="ButtonInner" onclick="taiwanButtonClicked();" style="width:50px">
							Taiwan
						</div>
					</td>
					<td>
						<div id="japanButton" class="ButtonInner" onclick="japanButtonClicked();" style="width:50px">
							Japan
						</div>
					</td>
					<td>
						<div id="hexToChineseButton" class="ButtonInner" onclick="hexToChineseButtonClicked();" style="width:30px">
							Hex
						</div>
					</td>
					<td>
						<div id="unitypeToChineseButton" class="ButtonInner" onclick="unitypeToChineseButtonClicked();" style="width:50px">
							Unitype
						</div>
					</td>
					<td>
						<input type="checkbox" id="oracleBonesCheckbox" ><span onclick="toggleCheckbox('oracleBonesCheckbox');">Oracle Bones 甲骨文</span>
					</td>
					<td>
						<input type="checkbox" id="largeSealScriptCheckbox" ><span onclick="toggleCheckbox('largeSealScriptCheckbox');">Large Seal Script 大篆</span>
					</td>
					<td>
						<input type="checkbox" id="smallSealScriptCheckbox" ><span onclick="toggleCheckbox('smallSealScriptCheckbox');">Small Seal Script 小篆</span>
					</td>
					<td>
						<input type="checkbox" id="tangCheckbox" ><span onclick="toggleCheckbox('tangCheckbox');">Tang 唐朝</span>
					</td>
					<td>
						<input type="checkbox" id="japaneseCheckbox" ><span onclick="toggleCheckbox('japaneseCheckbox');">Japanese 音読み</span>
					</td>
					<td>
						<input type="checkbox" id="vietnameseCheckbox" ><span onclick="toggleCheckbox('vietnameseCheckbox');">Vietnamese 越南语</span>
					</td>
					<td>
						<input type="checkbox" id="hangulCheckbox" ><span onclick="toggleCheckbox('hangulCheckbox');">Hangul 한글</span>
					</td>
					<td>
						<input type="checkbox" id="cantoneseCheckbox" ><span onclick="toggleCheckbox('cantoneseCheckbox');">Cantonese 粵語</span>
					</td>
					<td>
						<input type="checkbox" id="taiwaneseCheckbox" ><span onclick="toggleCheckbox('taiwaneseCheckbox');">Taiwanese 台語</span>
					</td>
				</tr>
			</table>
		</div>
	
		<table id="dictionariesTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Dictionaries 字典
					</div>
				</td>
				<td>
					<input type="checkbox" id="cnltDictionaryCheckbox" ><span onclick="toggleCheckbox('cnltDictionaryCheckbox');">CNLT</span>
				</td>
				<td>
					<input type="checkbox" id="cunpDictionaryCheckbox" ><span onclick="toggleCheckbox('cunpDictionaryCheckbox');">CUNP</span>
				</td>
				<td>
					<input type="checkbox" id="unihanDictionaryCheckbox" ><span onclick="toggleCheckbox('unihanDictionaryCheckbox');">Unihan</span>
				</td>
				<td>
					<input type="checkbox" id="cedictDictionaryCheckbox" ><span onclick="toggleCheckbox('cedictDictionaryCheckbox');">CEDICT</span>
				</td>
				<td>
					<input type="checkbox" id="zhWiktionaryDictionaryCheckbox" ><span onclick="toggleCheckbox('zhWiktionaryDictionaryCheckbox');">zh-wiktionary</span>
				</td>
				<td>
					<input type="checkbox" id="enWiktionaryDictionaryCheckbox" ><span onclick="toggleCheckbox('enWiktionaryDictionaryCheckbox');">en-wiktionary</span>
				</td>
				<td>
					<input type="checkbox" id="pingtypeDictionaryCheckbox" checked="true" ><span onclick="toggleCheckbox('pingtypeDictionaryCheckbox');">Pingtype</span>
				</td>
				<td>
					<div id="addWordsButton" class="ButtonInner advanced" onclick="addWordsButtonClicked();" style="visibility:hidden;width:100px">
						Add Words
					</div>
				</td>
				<td>
					<div id="findNewWordsButton" class="ButtonInner advanced" onclick="findNewWords();" style="visibility:hidden;width:100px">
						Find new words
					</div>
				</td>
				<td>
					<div id="loadDictionariesButton" class="ButtonInner advanced" onclick="loadDictionaries();" style="visibility:hidden;width:150px">
						Load Dictionaries 下載 字典
					</div>
				</td>
			</tr>
		</table>

		<table id="wordListsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Word Lists
					</div>
				</td>
				<td>
					<input type="checkbox" id="reviewingTheHanziCheckbox" ><span onclick="toggleReviewingTheHanzi('reviewingTheHanziCheckbox');">Reviewing The Hanzi</span>
				</td>
				<td>
					<input type="checkbox" id="hashOutCheckbox" ><span onclick="toggleReviewingTheHanzi('hashOutCheckbox');">Hash out</span>
				</td>
				<td>
					<input type="checkbox" id="commonCheckbox" ><span onclick="toggleCheckbox('commonCheckbox');">Bible</span>
				</td>
				<td>
					TOCFL
				</td>
				<td>
					<input type="checkbox" id="tocflZeroCheckbox" ><span onclick="toggleCheckbox('tocflZeroCheckbox');">0</span>
				</td>
				<td>
					<input type="checkbox" id="tocflOneCheckbox" ><span onclick="toggleCheckbox('tocflOneCheckbox');">1</span>
				</td>
				<td>
					<input type="checkbox" id="tocflTwoCheckbox" ><span onclick="toggleCheckbox('tocflTwoCheckbox');">2</span>
				</td>
				<td>
					<input type="checkbox" id="tocflThreeCheckbox" ><span onclick="toggleCheckbox('tocflThreeCheckbox');">3</span>
				</td>
				<td>
					<input type="checkbox" id="tocflFourCheckbox" ><span onclick="toggleCheckbox('tocflFourCheckbox');">4</span>
				</td>
				<td>
					<input type="checkbox" id="tocflFiveCheckbox" ><span onclick="toggleCheckbox('tocflFiveCheckbox');">5</span>
				</td>
				<td>
					<input type="checkbox" id="tocflSixCheckbox" ><span onclick="toggleCheckbox('tocflSixCheckbox');">6</span>
				</td>
				<td>
					<input type="checkbox" id="tocflAllCheckbox" ><span onclick="toggleCheckbox('tocflAllCheckbox');">TOCFL</span>
				</td>
				<td>
					HSK
				</td>
				<td>
					<input type="checkbox" id="hskOneCheckbox" ><span onclick="toggleCheckbox('hskOneCheckbox');">1</span>
				</td>
				<td>
					<input type="checkbox" id="hskTwoCheckbox" ><span onclick="toggleCheckbox('hskTwoCheckbox');">2</span>
				</td>
				<td>
					<input type="checkbox" id="hskThreeCheckbox" ><span onclick="toggleCheckbox('hskThreeCheckbox');">3</span>
				</td>
				<td>
					<input type="checkbox" id="hskFourCheckbox" ><span onclick="toggleCheckbox('hskFourCheckbox');">4</span>
				</td>
				<td>
					<input type="checkbox" id="hskFiveCheckbox" ><span onclick="toggleCheckbox('hskFiveCheckbox');">5</span>
				</td>
				<td>
					<input type="checkbox" id="hskSixCheckbox" ><span onclick="toggleCheckbox('hskSixCheckbox');">6</span>
				</td>
				<td>
					<input type="checkbox" id="hskAllCheckbox" ><span onclick="toggleCheckbox('hskAllCheckbox');">HSK</span>
				</td>
				<td>
					<div id="loadWordListsButton" class="ButtonInner advanced" onclick="loadWordLists();" style="visibility:hidden;width:100px">
						Load Word Lists
					</div>
				</td>
				<td>
					<div id="wordListPercent"></div>
				</td>
			</tr>
		</table>

		<table id="annotationsTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Annotations 註釋
					</div>
				</td>
				<td>
					<input type="checkbox" id="chinesePlainCheckbox" ><span onclick="toggleCheckbox('chinesePlainCheckbox');">Chinese Plain 純</span>
					<input type="checkbox" id="chineseSpacedCheckbox" ><span onclick="toggleCheckbox('chineseSpacedCheckbox');">Chinese Spaced 空間</span>
					<input type="checkbox" id="chineseCheckbox" checked="true" ><span onclick="toggleCheckbox('chineseCheckbox');">Chinese 中文</span>
					<input type="range" id="pinyinOpacity" value="100" onclick="setPinyinOpacity();">
					<input type="checkbox" id="pinyinCheckbox" checked="true" ><span onclick="toggleCheckbox('pinyinCheckbox');">Pinyin 拼音</span>
					<input type="checkbox" id="toneNumbersCheckbox" ><span onclick="toggleCheckbox('toneNumbersCheckbox');">#</span>
					<input type="checkbox" id="sizeCheckbox" checked="true" ><span onclick="toggleCheckbox('sizeCheckbox');">Size</span>
					<input type="range" id="literalOpacity" value="100" onclick="setLiteralOpacity();">
					<input type="checkbox" id="literalCheckbox" checked="true" ><span onclick="toggleCheckbox('literalCheckbox');">Literal 字面</span>
					<input type="range" id="englishOpacity" value="100" onclick="setEnglishOpacity();">
					<input type="checkbox" id="englishCheckbox" checked="true" ><span onclick="toggleCheckbox('englishCheckbox');">English 英文</span>
					<input type="checkbox" id="hexCheckbox" ><span onclick="toggleCheckbox('hexCheckbox');">Hex</span>
					<input type="checkbox" id="unitypeCheckbox" ><span onclick="toggleCheckbox('unitypeCheckbox');">Unitype</span>
					<input type="checkbox" id="syllablesCheckbox" ><span onclick="toggleCheckbox('syllablesCheckbox');">Radicals 部首</span>
					<input type="checkbox" id="wadeGilesCheckbox" ><span onclick="toggleCheckbox('wadeGilesCheckbox');">Wade-Giles</span>
					<input type="checkbox" id="bopomofoCheckbox" ><span onclick="toggleCheckbox('bopomofoCheckbox');">ㄅㄆㄇㄈ</span>
					<span id="simplifiedCheckboxSpan" style="visibility:hidden;" onclick="toggleCheckbox('simplifiedSpacedCheckbox');"><input type="checkbox" id="simplifiedSpacedCheckbox" >Simplified 简化字</span>
				</td>
			</tr>
		</table>
	
	
		<table id="toneColoursTable" class="advanced" style="visibility:hidden;height:0px;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Colours 顏色
					</div>
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerOne" value="000000" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerTwo" value="f82423" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerThree" value="189c19" onchange="updateColours();">
				</td>
				<td>
					<input class="jscolor" id="chineseColourPickerFour" value="178FD1" onchange="updateColours();">
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerFive" value="000000" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerSix" value="F82423" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div class="regional" style="visibility:hidden;width:0px">
						<input class="jscolor" id="chineseColourPickerSeven" value="929292" onchange="updateColours();">
					</div>
				</td>
				<td>
					<div id="blackButton" class="ButtonInner advanced" onclick="blackColours();" style="visibility:hidden;width:50px">
						Black
					</div>
				</td>
				<td>
					<div id="greyButton" class="ButtonInner advanced" onclick="greyColours();" style="visibility:hidden;width:40px">
						Grey
					</div>
				</td>
				<td>
					<div id="peterButton" class="ButtonInner advanced" onclick="peterColours();" style="visibility:hidden;width:60px">
						Pingtype
					</div>
				</td>
				<td>
					<div id="plecoButton" class="ButtonInner advanced" onclick="plecoColours();" style="visibility:hidden;width:50px">
						Pleco
					</div>
				</td>
				<td>
					<div id="nathanButton" class="ButtonInner advanced" onclick="nathanColours();" style="visibility:hidden;width:50px">
						Nathan
					</div>
				</td>
				<td>
					<div id="mdbgButton" class="ButtonInner advanced" onclick="mdbgColours();" style="visibility:hidden;width:40px">
						MDBG
					</div>
				</td>
				<td>
					<div id="hanpingButton" class="ButtonInner advanced" onclick="hanpingColours();" style="visibility:hidden;width:60px">
						Hanping
					</div>
				</td>
				<td>
					<div id="taiwaneseButton" class="ButtonInner regional" onclick="taiwaneseColours();" style="visibility:hidden">
						Taiwanese
					</div>
				</td>
				<td>
					<div id="cantoneseButton" class="ButtonInner regional" onclick="cantoneseColours();" style="visibility:hidden">
						Cantonese
					</div>
				</td>
			</tr>
		</table>
		
		<div id="toneColoursRegionalDiv" class="regional" style="visibility:hidden;height:0px;">
			<table id="toneColoursRegionalTable" style="font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
				<tr>
					<td>
						Pinyin
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerOne" value="000000" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerTwo" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerThree" value="189c19" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="pinyinColourPickerFour" value="178FD1" onchange="updateColours();">
					</td>
				</tr>
				<tr>
					<td>
						Taiwanese
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerOne" value="787878" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerTwo" value="178FD1" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerThree" value="0000ff" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerFour" value="505050" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerFive" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerSeven" value="000000" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="taiwaneseColourPickerEight" value="929292" onchange="updateColours();">
					</td>
				</tr>
				<tr>
					<td>
						Cantonese
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerOne" value="929292" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerTwo" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerThree" value="787878" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerFour" value="0000ff" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerFive" value="f82423" onchange="updateColours();">
					</td>
					<td>
						<input class="jscolor" id="cantoneseColourPickerSix" value="000000" onchange="updateColours();">
					</td>
				</tr>
			</table>
		</div>
		
		<table id="filenameTable" class="advanced" style="visibility:hidden;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;">
			<tr>
				<td>
					<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
						Filename 文件名
					</div>
				</td>
				<td>
					<textarea id="filenameTextArea" rows="1" cols="50" >filename.txt</textarea>
				</td>
				<td>
					<input type="checkbox" id="useGithubCheckbox" ><span onclick="toggleCheckbox('useGithubCheckbox');">Use Github</span>
				</td>
				<td>
					<div class="ButtonInner" onclick="saveHtml();">
						Save HTML 保存
					</div>
				</td>
				<td>
					<div class="ButtonInner" onclick="saveText();">
						Save Text 保存
					</div>
				</td>
			</tr>
		</table>
	
	
		<table id="missingWordsTable" class="advanced" style="visibility:hidden;font-family: 'Lucida Sans', 'Verdana', Geneva, sans-serif; font-size: 12px;"></table>
	
	</div>
	
	<table id="htmlTable">
		<tr>
			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					HTML output 彩色 輸出
  				</div>
			</td>
		</tr>
  		<tr>
  			<td>
  				<div id="outputHtml"></div>
  			</td>
  		</td>
	</table>
	
	<table id="textTable">
  		<tr>
  		</tr>
  	</table>

	<table id="matrix"></table>

	
	<table id="imageTable">
  		<tr>
  			<td>
  				<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  					Image 照片
  				</div>
  			</td>
  		</tr>
  		<tr>
  			<td>
  				<input type="file" id="imageLoader" name="imageLoader"/>
  			</td>
  		</tr>
	</table>

	<div id="drawing" style="width: 0px; height: 0px;"></div>

	<table id="decomposeTable" style="font-size: 32px;">

		

		<tr>
			<td>
				<div id="thisPhraseTable" class="advanced" style="visibility:hidden;height:0px;width:0px">
					<table>
						<tr>
  							<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  								Phrase 短語
  							</div>
						</tr>
						<tr>
							<td>	
								<textarea id="thisPhrase" name="thisPhrase" rows="3" cols="30" style="font-size: 16px;"></textarea>
							</td>
						</tr>
					</table>
				</div>
    		</td>
    	</tr>

		<tr>
			<td>
				<table>
					<tr>
						<td>
							<div id="leftCharacter"></div>
						</td>
						<td>
							<div id="rightCharacter"></div>
						</td>
					</tr>
				</table>
			</td>
    	</tr>
    	
    	<tr>
    		<td>
    			<div id="reviewArea" style="width:100px;font-family: sans-serif; font-size: 10px;"></div>
    		</td>
    	</tr>


		<tr>
			<table>
				<tr>
					<td>
						<div id="pinyinKeyboard" style="width:0px;height:0px;">
							<table>
								<tr>
									<td><div class="key" onclick="typeCharacter('q')">q</div></td>
									<td><div class="key" onclick="typeCharacter('w')">w</div></td>
									<td><div class="key" onclick="typeCharacter('e')">e</div></td>
									<td><div class="key" onclick="typeCharacter('r')">r</div></td>
									<td><div class="key" onclick="typeCharacter('t')">t</div></td>
									<td><div class="key" onclick="typeCharacter('y')">y</div></td>
									<td><div class="key" onclick="typeCharacter('u')">u</div></td>
									<td><div class="key" onclick="typeCharacter('i')">i</div></td>
									<td><div class="key" onclick="typeCharacter('o')">o</div></td>
									<td><div class="key" onclick="typeCharacter('p')">p</div></td>
								</tr>
							</table>
							<table style="margin-left:10px">
								<tr>
									<td><div class="key" onclick="typeCharacter('a')">a</div></td>
									<td><div class="key" onclick="typeCharacter('s')">s</div></td>
									<td><div class="key" onclick="typeCharacter('d')">d</div></td>
									<td><div class="key" onclick="typeCharacter('f')">f</div></td>
									<td><div class="key" onclick="typeCharacter('g')">g</div></td>
									<td><div class="key" onclick="typeCharacter('h')">h</div></td>
									<td><div class="key" onclick="typeCharacter('j')">j</div></td>
									<td><div class="key" onclick="typeCharacter('k')">k</div></td>
									<td><div class="key" onclick="typeCharacter('l')">l</div></td>
								</tr>
							</table>
							<table style="margin-left:20px">
								<tr>
									<td><div class="key" onclick="typeCharacter('z')">z</div></td>
									<td><div class="key" onclick="typeCharacter('x')">x</div></td>
									<td><div class="key" onclick="typeCharacter('c')">c</div></td>
									<td><div class="key" onclick="typeCharacter('v')">v</div></td>
									<td><div class="key" onclick="typeCharacter('b')">b</div></td>
									<td><div class="key" onclick="typeCharacter('n')">n</div></td>
									<td><div class="key" onclick="typeCharacter('m')">m</div></td>
									<td><div class="key" onclick="typeCharacter('delete')">⌫</div></td>
									<td><div class="key" onclick="searchCharacter()">⏎</div></td>
								</tr>
							</table>
							<table style="margin-left:90px">
								<tr>
									<td><div class="key" style="width:100px;align:center" onclick="typeCharacter(' ')">space</div></td>
								</tr>
							</table>
						 </div>
					</td>
					
					
					<td>
						<div id="radicalKeyboard" style="width:0px;height:0px;visibility:hidden">
							<table>
						  <tr>
							   <td><div onclick="typeCharacter('一')">一</div></td>
							   <td><div onclick="typeCharacter('乙')">乙</div></td>
							   <td><div onclick="typeCharacter('丁')">丁</div></td>
							   <td><div onclick="typeCharacter('七')">七</div></td>
							   <td><div onclick="typeCharacter('乂')">乂</div></td>
							   <td><div onclick="typeCharacter('乜')">乜</div></td>
							   <td><div onclick="typeCharacter('九')">九</div></td>
							   <td><div onclick="typeCharacter('了')">了</div></td>
							   <td><div onclick="typeCharacter('二')">二</div></td>
							   <td><div onclick="typeCharacter('人')">人</div></td>
							   <td><div onclick="typeCharacter('八')">八</div></td>
							   <td><div onclick="typeCharacter('刀')">刀</div></td>
							   <td><div onclick="typeCharacter('刁')">刁</div></td>
							   <td><div onclick="typeCharacter('力')">力</div></td>
							   <td><div onclick="typeCharacter('匕')">匕</div></td>
							   <td><div onclick="typeCharacter('十')">十</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('又')">又</div></td>
							   <td><div onclick="typeCharacter('上')">上</div></td>
							   <td><div onclick="typeCharacter('下')">下</div></td>
							   <td><div onclick="typeCharacter('久')">久</div></td>
							   <td><div onclick="typeCharacter('乞')">乞</div></td>
							   <td><div onclick="typeCharacter('也')">也</div></td>
							   <td><div onclick="typeCharacter('兀')">兀</div></td>
							   <td><div onclick="typeCharacter('凢')">凢</div></td>
							   <td><div onclick="typeCharacter('勺')">勺</div></td>
							   <td><div onclick="typeCharacter('及')">及</div></td>
							   <td><div onclick="typeCharacter('口')">口</div></td>
							   <td><div onclick="typeCharacter('女')">女</div></td>
							   <td><div onclick="typeCharacter('子')">子</div></td>
							   <td><div onclick="typeCharacter('孓')">孓</div></td>
							   <td><div onclick="typeCharacter('山')">山</div></td>
							   <td><div onclick="typeCharacter('川')">川</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('工')">工</div></td>
							   <td><div onclick="typeCharacter('己')">己</div></td>
							   <td><div onclick="typeCharacter('巳')">巳</div></td>
							   <td><div onclick="typeCharacter('巾')">巾</div></td>
							   <td><div onclick="typeCharacter('幺')">幺</div></td>
							   <td><div onclick="typeCharacter('弋')">弋</div></td>
							   <td><div onclick="typeCharacter('弓')">弓</div></td>
							   <td><div onclick="typeCharacter('彳')">彳</div></td>
							   <td><div onclick="typeCharacter('不')">不</div></td>
							   <td><div onclick="typeCharacter('丏')">丏</div></td>
							   <td><div onclick="typeCharacter('丹')">丹</div></td>
							   <td><div onclick="typeCharacter('予')">予</div></td>
							   <td><div onclick="typeCharacter('互')">互</div></td>
							   <td><div onclick="typeCharacter('亢')">亢</div></td>
							   <td><div onclick="typeCharacter('仉')">仉</div></td>
							   <td><div onclick="typeCharacter('仍')">仍</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('允')">允</div></td>
							   <td><div onclick="typeCharacter('勾')">勾</div></td>
							   <td><div onclick="typeCharacter('勿')">勿</div></td>
							   <td><div onclick="typeCharacter('匀')">匀</div></td>
							   <td><div onclick="typeCharacter('匹')">匹</div></td>
							   <td><div onclick="typeCharacter('升')">升</div></td>
							   <td><div onclick="typeCharacter('卞')">卞</div></td>
							   <td><div onclick="typeCharacter('卬')">卬</div></td>
							   <td><div onclick="typeCharacter('尹')">尹</div></td>
							   <td><div onclick="typeCharacter('尺')">尺</div></td>
							   <td><div onclick="typeCharacter('巴')">巴</div></td>
							   <td><div onclick="typeCharacter('廿')">廿</div></td>
							   <td><div onclick="typeCharacter('心')">心</div></td>
							   <td><div onclick="typeCharacter('戈')">戈</div></td>
							   <td><div onclick="typeCharacter('户')">户</div></td>
							   <td><div onclick="typeCharacter('方')">方</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('止')">止</div></td>
							   <td><div onclick="typeCharacter('氏')">氏</div></td>
							   <td><div onclick="typeCharacter('水')">水</div></td>
							   <td><div onclick="typeCharacter('火')">火</div></td>
							   <td><div onclick="typeCharacter('爪')">爪</div></td>
							   <td><div onclick="typeCharacter('片')">片</div></td>
							   <td><div onclick="typeCharacter('牙')">牙</div></td>
							   <td><div onclick="typeCharacter('瓦')">瓦</div></td>
							   <td><div onclick="typeCharacter('𠙶')">𠙶</div></td>
							   <td><div onclick="typeCharacter('仫')">仫</div></td>
							   <td><div onclick="typeCharacter('冊')">冊</div></td>
							   <td><div onclick="typeCharacter('凸')">凸</div></td>
							   <td><div onclick="typeCharacter('凹')">凹</div></td>
							   <td><div onclick="typeCharacter('匄')">匄</div></td>
							   <td><div onclick="typeCharacter('印')">印</div></td>
							   <td><div onclick="typeCharacter('囙')">囙</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('四')">四</div></td>
							   <td><div onclick="typeCharacter('宂')">宂</div></td>
							   <td><div onclick="typeCharacter('廵')">廵</div></td>
							   <td><div onclick="typeCharacter('弁')">弁</div></td>
							   <td><div onclick="typeCharacter('斥')">斥</div></td>
							   <td><div onclick="typeCharacter('母')">母</div></td>
							   <td><div onclick="typeCharacter('氕')">氕</div></td>
							   <td><div onclick="typeCharacter('永')">永</div></td>
							   <td><div onclick="typeCharacter('氾')">氾</div></td>
							   <td><div onclick="typeCharacter('犯')">犯</div></td>
							   <td><div onclick="typeCharacter('瓜')">瓜</div></td>
							   <td><div onclick="typeCharacter('皿')">皿</div></td>
							   <td><div onclick="typeCharacter('矛')">矛</div></td>
							   <td><div onclick="typeCharacter('艿')">艿</div></td>
							   <td><div onclick="typeCharacter('邙')">邙</div></td>
							   <td><div onclick="typeCharacter('㠯')">㠯</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('乒')">乒</div></td>
							   <td><div onclick="typeCharacter('乓')">乓</div></td>
							   <td><div onclick="typeCharacter('争')">争</div></td>
							   <td><div onclick="typeCharacter('亙')">亙</div></td>
							   <td><div onclick="typeCharacter('兆')">兆</div></td>
							   <td><div onclick="typeCharacter('刑')">刑</div></td>
							   <td><div onclick="typeCharacter('匠')">匠</div></td>
							   <td><div onclick="typeCharacter('危')">危</div></td>
							   <td><div onclick="typeCharacter('回')">回</div></td>
							   <td><div onclick="typeCharacter('州')">州</div></td>
							   <td><div onclick="typeCharacter('曳')">曳</div></td>
							   <td><div onclick="typeCharacter('氖')">氖</div></td>
							   <td><div onclick="typeCharacter('氘')">氘</div></td>
							   <td><div onclick="typeCharacter('汎')">汎</div></td>
							   <td><div onclick="typeCharacter('竹')">竹</div></td>
							   <td><div onclick="typeCharacter('羽')">羽</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('而')">而</div></td>
							   <td><div onclick="typeCharacter('臣')">臣</div></td>
							   <td><div onclick="typeCharacter('舟')">舟</div></td>
							   <td><div onclick="typeCharacter('艸')">艸</div></td>
							   <td><div onclick="typeCharacter('芃')">芃</div></td>
							   <td><div onclick="typeCharacter('芒')">芒</div></td>
							   <td><div onclick="typeCharacter('衣')">衣</div></td>
							   <td><div onclick="typeCharacter('邢')">邢</div></td>
							   <td><div onclick="typeCharacter('阨')">阨</div></td>
							   <td><div onclick="typeCharacter('卵')">卵</div></td>
							   <td><div onclick="typeCharacter('形')">形</div></td>
							   <td><div onclick="typeCharacter('戼')">戼</div></td>
							   <td><div onclick="typeCharacter('汧')">汧</div></td>
							   <td><div onclick="typeCharacter('汽')">汽</div></td>
							   <td><div onclick="typeCharacter('沂')">沂</div></td>
							   <td><div onclick="typeCharacter('沉')">沉</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('芹')">芹</div></td>
							   <td><div onclick="typeCharacter('苉')">苉</div></td>
							   <td><div onclick="typeCharacter('苊')">苊</div></td>
							   <td><div onclick="typeCharacter('苣')">苣</div></td>
							   <td><div onclick="typeCharacter('近')">近</div></td>
							   <td><div onclick="typeCharacter('邱')">邱</div></td>
							   <td><div onclick="typeCharacter('兔')">兔</div></td>
							   <td><div onclick="typeCharacter('所')">所</div></td>
							   <td><div onclick="typeCharacter('泖')">泖</div></td>
							   <td><div onclick="typeCharacter('茆')">茆</div></td>
							   <td><div onclick="typeCharacter('洄')">洄</div></td>
							   <td><div onclick="typeCharacter('派')">派</div></td>
							   <td><div onclick="typeCharacter('茫')">茫</div></td>
							   <td><div onclick="typeCharacter('茴')">茴</div></td>
							   <td><div onclick="typeCharacter('迴')">迴</div></td>
							   <td><div onclick="typeCharacter('飛')">飛</div></td>
						   </tr>
						   <tr>
							   <td><div onclick="typeCharacter('展')">展</div></td>
							   <td><div onclick="typeCharacter('流')">流</div></td>
							   <td><div onclick="typeCharacter('烏')">烏</div></td>
							   <td><div onclick="typeCharacter('芻')">芻</div></td>
							   <td><div onclick="typeCharacter('偽')">偽</div></td>
							   <td><div onclick="typeCharacter('康')">康</div></td>
							   <td><div onclick="typeCharacter('涵')">涵</div></td>
							   <td><div onclick="typeCharacter('痐')">痐</div></td>
							   <td><div onclick="typeCharacter('菡')">菡</div></td>
							   <td><div onclick="typeCharacter('逮')">逮</div></td>
							   <td><div onclick="typeCharacter('鳥')">鳥</div></td>
							   <td><div onclick="typeCharacter('無')">無</div></td>
							   <td><div onclick="typeCharacter('虜')">虜</div></td>
							   <td><div onclick="typeCharacter('𦵏')">𦵏</div></td>
							 </tr>
					  </table>
						 </div>
    				</td>
    				
    				<td>
    					<div id="decomposeBopomofoKeyboard" style="width:0px;height:0px;visibility:hidden">
							<table>
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄅ')">ㄅ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄉ')">ㄉ</div></td>
									<td><div class="key" onclick="typeCharacter('ˇ')">ˇ</div></td>
									<td><div class="key" onclick="typeCharacter('ˋ')">ˋ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄓ')">ㄓ</div></td>
									<td><div class="key" onclick="typeCharacter('ˊ')">ˊ</div></td>
									<td><div class="key" onclick="typeCharacter('˙')">˙</div></td>
									<td><div class="key" onclick="typeCharacter('ㄚ')">ㄚ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄞ')">ㄞ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄢ')">ㄢ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄦ')">ㄦ</div></td>
								</tr>
							</table>
							<table style="margin-left:10px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄆ')">ㄆ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄊ')">ㄊ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄍ')">ㄍ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄐ')">ㄐ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄔ')">ㄔ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄗ')">ㄗ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄧ')">ㄧ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄛ')">ㄛ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄟ')">ㄟ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄣ')">ㄣ</div></td>
								</tr>
							</table>
							<table style="margin-left:20px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄇ')">ㄇ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄋ')">ㄋ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄎ')">ㄎ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄑ')">ㄑ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄕ')">ㄕ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄘ')">ㄘ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄨ')">ㄨ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄜ')">ㄜ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄠ')">ㄠ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄤ')">ㄤ</div></td>
								</tr>
							</table>
							<table style="margin-left:30px">
								<tr>
									<td><div class="key" onclick="typeCharacter('ㄈ')">ㄈ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄌ')">ㄌ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄏ')">ㄏ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄒ')">ㄒ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄖ')">ㄖ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄙ')">ㄙ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄩ')">ㄩ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄝ')">ㄝ</div></td>
									<td><div class="key" onclick="typeBopomofo('ㄡ')">ㄡ</div></td>
									<td><div class="key" onclick="typeCharacter('ㄥ')">ㄥ</div></td>
								</tr>
							</table>
							<table style="margin-left:90px">
								<tr>
									<td><div class="key" style="width:100px;align:center" onclick="typeCharacter(' ')">space</div></td>
									<td><div class="key" onclick="typeCharacter('delete')">⌫</div></td>
									<td><div class="key" onclick="searchCharacter()">⏎</div></td>
								</tr>
							</table>
    					</div>
    				</td>
				</tr>
			</table>
    	</tr>


		<tr>
			<td>
				<table>
					<tr>
						<td>	
							<textarea id="startCharacter" name="startCharacter" rows="2" cols="5" style="font-size: 32px;">隹</textarea>
						</td>
						
						<td>
							
							<table>
							
								<tr>
									<td>
									  	<div class="ButtonInner" onclick="togglePinyinKeyboard();">
									  	<!-- ⌨ -->
	  										Keyboard 鍵盤
										</div>
									</td>
									<td>
										<div id="drawGenealogyButton" class="ButtonInner advanced" onclick="drawGenealogyButtonClicked();" style="visibility:hidden">
										Genealogy 家譜
										</div>
									</td>
									<td>
										<div id="hexButton" class="ButtonInner regional" onclick="searchHexButtonClicked();" style="visibility:hidden">
											Hex
										</div>
									</td>
									<td>
										<div id="hangulButton" class="ButtonInner regional" onclick="searchHangulButtonClicked();" style="visibility:hidden">
											Hangul
										</div>
									</td>
									<td>
										<div id="searchTaiwaneseButton" class="ButtonInner regional" onclick="searchTaiwaneseButtonClicked();" style="visibility:hidden">
											Taiwanese
										</div>
									</td>
								</tr>
								<tr>
									<td>
									  	<div class="DefaultButtonOuter">
					  						<div class="ButtonInner" onclick="searchCharacter();">
	  											Search 找
											</div>
										</div>
									</td>
									<td>
										<div id="decomposeBopomofoButton" class="ButtonInner advanced" onclick="toggleDecomposeBopomofoKeyboard();" style="visibility:hidden;">
										ㄅㄆㄇㄈ
										</div>
									</td>
									<td>
										<div id="unitypeButton" class="ButtonInner regional" onclick="searchUnitypeButtonClicked();" style="visibility:hidden">
											Unitype
										</div>
									</td>
									<td>
										<div id="japaneseButton" class="ButtonInner regional" onclick="searchJapaneseButtonClicked();" style="visibility:hidden">
											Japanese
										</div>
									</td>
									<td>
										<div id="searchCantoneseButton" class="ButtonInner regional" onclick="searchCantoneseButtonClicked();" style="visibility:hidden">
											Cantonese
										</div>
									</td>
								</tr>
								
								<tr>
									<td>
								  		<div class="ButtonInner" onclick="insertButtonClicked();">
	  										Insert 插
										</div>
									</td>
									<td>
									  	<div id="radicalButton" class="ButtonInner advanced" onclick="toggleRadicalKeyboard();"  style="visibility:hidden">
	  										Radicals 部首
										</div>
									</td>
									<td>
										<div id="wadeGilesButton" class="ButtonInner regional" onclick="searchWadeGilesButtonClicked();" style="visibility:hidden">
											Wade-Giles
										</div>
									</td>
									<td>
										<div id="vietnameseButton" class="ButtonInner regional" onclick="searchVietnameseButtonClicked();" style="visibility:hidden">
											Vietnamese
										</div>
									</td>
								</tr>
								
							
							</table>
							
							
						</td>
						
					</tr>
				</table>
    		</td>
    	</tr>
    	
		<tr>
			<td>
				<table>
					<tr>
						<td>
							<div id="charCode"></div>
						</td>
						<td>
							<div id="pinyin"></div>
						</td>
						<td>
							<div id="definition"></div>
						</td>
					</tr>
				</table>
			</td>
    	</tr>
    	
		<tr>
			<td>
				<div id="childCharacters">
				
				</div>
			</td>
		</tr>

		<tr>
			<td>
				<div id="characterWords">
				
				</div>
			</td>
		</tr>

    </table>

	<div id="debugDiv" class="advanced" style="visibility:hidden">
		<p style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">Debug 調試</p>
  		<textarea id="debugTextArea" rows="10" cols="50" ></textarea>
	</div>
	
	<!-- Dictionary editor dialog -->
	<div id="dictionaryEditor" title="Dictionary Editor" style="visibility:hidden">

	    <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		    Upload
	    </div>
	    
	    <table style="width:100%">
	    	<tr>
	    		<td>
	    			<div id="addedLabel">0 added</div>
	    		</td>
	    		<td>
	    			<div id="editedLabel">0 edited</div>
	    		</td>
	    		<td>
	    			<div id="deletedLabel">0 deleted</div>
	    		</td>
	    		<td>
	    			<div id="uploadedLabel">0 uploaded</div>
	    		</td>
	    		<td>
	    			<div id="uploadButtonTable" onclick="uploadButtonClicked();">
		    			<table>
		    				<tr>
	    						<td>
	    							<img src="sync.png"</img>
	    						</td>
	    						<td>
	    							Upload
	    						</td>
		    				</tr>
		    			</table>
		    		</div>
	    		</td>
	    	</tr>
	    </table>
		
	   <div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
		   Add/Edit
	   </div>


	   <div id="bopomofoKeyboard" style="width:100px;height:5px;visibility:hidden">
		   <table>
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄅ')">ㄅ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄉ')">ㄉ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˇ')">ˇ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˋ')">ˋ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄓ')">ㄓ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ˊ')">ˊ</div></td>
				   <td><div class="key" onclick="typeBopomofo('˙')">˙</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄚ')">ㄚ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄞ')">ㄞ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄢ')">ㄢ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄦ')">ㄦ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:10px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄆ')">ㄆ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄊ')">ㄊ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄍ')">ㄍ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄐ')">ㄐ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄔ')">ㄔ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄗ')">ㄗ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄧ')">ㄧ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄛ')">ㄛ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄟ')">ㄟ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄣ')">ㄣ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:20px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄇ')">ㄇ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄋ')">ㄋ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄎ')">ㄎ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄑ')">ㄑ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄕ')">ㄕ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄘ')">ㄘ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄨ')">ㄨ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄜ')">ㄜ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄠ')">ㄠ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄤ')">ㄤ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:30px">
			   <tr>
				   <td><div class="key" onclick="typeBopomofo('ㄈ')">ㄈ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄌ')">ㄌ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄏ')">ㄏ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄒ')">ㄒ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄖ')">ㄖ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄙ')">ㄙ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄩ')">ㄩ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄝ')">ㄝ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄡ')">ㄡ</div></td>
				   <td><div class="key" onclick="typeBopomofo('ㄥ')">ㄥ</div></td>
			   </tr>
		   </table>
		   <table style="margin-left:90px">
			   <tr>
				   <td><div class="key" style="width:100px;align:center" onclick="typeBopomofo(' ')">space</div></td>
				   <td><div class="key" onclick="typeBopomofo('delete')">⌫</div></td>
				   <td><div class="key" onclick="bopomofoToPinyin()">⏎</div></td>
			   </tr>
		   </table>
		</div>
	
		<table>
			<tr>
				<td>
					Chinese
				</td>
				<td>
					<textarea id="dictionaryEditorChineseTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="dictionaryEditorCharsButton" class="ButtonInner" onclick="dictionaryEditorCharsButtonClicked();" style="width:100px">
									Chars to Pinyin
								</div>
							</td>
							<td>
								<div id="dictionaryEditorSearchKey" class="key" onclick="dictionaryEditorSearch()">🔍</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<table>
						<tr>
							<td>
								Pinyin
							</td>
						</tr>
						<tr>
							<td>
								(e.g. píng xíng)
							</td>
						</tr>
					</table>
				</td>
				<td>
					<textarea id="dictionaryEditorPinyinTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<table>
						<tr>
							<td>
								<div id="dictionaryEditorBopomofoButton" class="ButtonInner" onclick="dictionaryEditorBopomofoButtonClicked();" style="width:60px">
									ㄅㄆㄇㄈ
								</div>
							</td>
							<td>
								<div id="dictionaryEditorBopomofoButton" class="ButtonInner" onclick="toneNumbersToToneMarks();" style="width:70px">
									# to marks
								</div>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					English
				</td>
				<td>
					<textarea id="dictionaryEditorEnglishTextArea" rows="2" cols="19" style="background-color: #ffffff;resize: none;"></textarea>
				</td>
				<td>
					<div id="dictionaryEditorGoogleTranslateButton" class="ButtonInner" onclick="dictionaryEditorGoogleTranslateButtonClicked();" style="width:120px">
						Google Translate
					</div>
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="dictionaryEditorAddButton" class="ButtonInner" onclick="dictionaryEditorAddButtonClicked();">
							Add
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<table>
			<tr>
				<td>
			  		<div style="font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;">
  						Remove
			  		</div>
		  		</td>
		  	</tr>
			<tr>
				<td>
					<textarea id="dictionaryEditorRemoveTextArea" rows="1" cols="7" style="background-color: #ffffff;resize: none;overflow:hidden;font-size: 30px;"></textarea>
				</td>
				<td>
					<div class="DefaultButtonOuter" style="margin-left:10px">
						<div id="dictionaryEditorRemoveButton" class="ButtonInner" onclick="dictionaryEditorRemoveButtonClicked();">
							Remove
						</div>
					</div>
				</td>
			</tr>
		</table>
		
		<div style="margin-left:120px">
			<div id="defaultTranslateButton" class="DefaultButtonOuter">
				<div id="retranslateButton" class="ButtonInner" onclick="translateButtonClicked();">
					Retranslate
				</div>
			</div>
		</div>
		
	</div>
	
  </body>
  
  <!-- External scripts -->
  <script src="leaflet/leaflet.js"></script>
  <script src="jscolor.js"></script>
  <script src="jquery-3.2.1.min.js"></script>
  <script src="jquery-ui.js"></script>

  <!-- Native scripts -->
  <script>
		var token = "";
		var githubUsername = "pingtype";
		var githubRepo = "pingtype.github.io";

  
		var combinedDictionaryData = "";
		var longWords;
		var radicals;
		var toneNumbersMarks;

		var chineseText = "";
		var englishText = "";

		var compositionData;
		var genealogiesData;
		var dictionaryData;
		var pinyinDefinitionData;
		var longWords;
		var commonWords = "";
		var bopomofoData;
		var reviewingTheHanziData = "\n";
		
		var taiwaneseData = "";
		var cantoneseData = "";
		var hangulData = "";
		var tangData = "";
		var japaneseData = "";
		var vietnameseData = "";
		
		var simplifiedData = "";
		var traditionalData = "";
		var taiwanData = "";
		var hongKongData = "";
		var japanData = "";
				
		var ancestors = "";
		var highestLevel = 0;
		var genealogy = "";
		var children = "";
		
		var lastDictionary = false;
		
		// No idea where this magic number comes from. It's used for truncating the dictionary to fit in localStorage. 
		// Found by checking for errors in Safari. 
		var localStorageLength = 863185;


		var Base64 = {
		// private property
		_keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",

		// public method for encoding
		encode : function (input) {
			var output = "";
			var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
			var i = 0;

			input = Base64._utf8_encode(input);

			while (i < input.length) {

				chr1 = input.charCodeAt(i++);
				chr2 = input.charCodeAt(i++);
				chr3 = input.charCodeAt(i++);

				enc1 = chr1 >> 2;
				enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
				enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
				enc4 = chr3 & 63;

				if (isNaN(chr2)) {
					enc3 = enc4 = 64;
				} else if (isNaN(chr3)) {
					enc4 = 64;
				}

				output = output +
				Base64._keyStr.charAt(enc1) + Base64._keyStr.charAt(enc2) +
				Base64._keyStr.charAt(enc3) + Base64._keyStr.charAt(enc4);

			}

			return output;
		},

		// public method for decoding
		decode : function (input) {
			var output = "";
			var chr1, chr2, chr3;
			var enc1, enc2, enc3, enc4;
			var i = 0;

			input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

			while (i < input.length) {

				enc1 = Base64._keyStr.indexOf(input.charAt(i++));
				enc2 = Base64._keyStr.indexOf(input.charAt(i++));
				enc3 = Base64._keyStr.indexOf(input.charAt(i++));
				enc4 = Base64._keyStr.indexOf(input.charAt(i++));

				chr1 = (enc1 << 2) | (enc2 >> 4);
				chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
				chr3 = ((enc3 & 3) << 6) | enc4;

				output = output + String.fromCharCode(chr1);

				if (enc3 != 64) {
					output = output + String.fromCharCode(chr2);
				}
				if (enc4 != 64) {
					output = output + String.fromCharCode(chr3);
				}

			}

			output = Base64._utf8_decode(output);

			return output;

		},

		// private method for UTF-8 encoding
		_utf8_encode : function (string) {
			string = string.replace(/\r\n/g,"\n");
			var utftext = "";

			for (var n = 0; n < string.length; n++) {

				var c = string.charCodeAt(n);

				if (c < 128) {
					utftext += String.fromCharCode(c);
				}
				else if((c > 127) && (c < 2048)) {
					utftext += String.fromCharCode((c >> 6) | 192);
					utftext += String.fromCharCode((c & 63) | 128);
				}
				else {
					utftext += String.fromCharCode((c >> 12) | 224);
					utftext += String.fromCharCode(((c >> 6) & 63) | 128);
					utftext += String.fromCharCode((c & 63) | 128);
				}

			}

			return utftext;
		},

		// private method for UTF-8 decoding
		_utf8_decode : function (utftext) {
			var string = "";
			var i = 0;
			var c = c1 = c2 = 0;

			while ( i < utftext.length ) {

				c = utftext.charCodeAt(i);

				if (c < 128) {
					string += String.fromCharCode(c);
					i++;
				}
				else if((c > 191) && (c < 224)) {
					c2 = utftext.charCodeAt(i+1);
					string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
					i += 2;
				}
				else {
					c2 = utftext.charCodeAt(i+1);
					c3 = utftext.charCodeAt(i+2);
					string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
					i += 3;
				}

			}
			return string;
		}
		} // end Base64

		var QueryString = function () 
		{
			// This function is anonymous, is executed immediately and 
			// the return value is assigned to QueryString!
			var query_string = {};
			var query = window.location.search.substring(1);
			var vars = query.split("&");
			for (var i=0;i<vars.length;i++) {
			  var pair = vars[i].split("=");
				  // If first entry with this name
			  if (typeof query_string[pair[0]] === "undefined") {
				query_string[pair[0]] = decodeURIComponent(pair[1]);
				  // If second entry with this name
			  } else if (typeof query_string[pair[0]] === "string") {
				var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
				query_string[pair[0]] = arr;
				  // If third or later entry with this name
			  } else {
				query_string[pair[0]].push(decodeURIComponent(pair[1]));
			  }
			} 
			return query_string;
		}();


		/* Image upload */
		
		var imageLoader = document.getElementById('imageLoader');

		imageLoader.addEventListener('change', uploadImage, false);

		function uploadImage(event)
		{
			//debugLog("uploadImage");

			var reader = new FileReader();
			
			reader.onload = function(event)
			{
				var img = new Image();
				
				img.onload = function()
				{
					//canvas.width = img.width;
					//canvas.height = img.height;
					//ctx.drawImage(img,0,0);
					
					var width = img.width;
					var height = img.height;
					
					var southWest = drawing.unproject([0, height], 3);
					var northEast = drawing.unproject([width, 0], 3);
					
					var bounds = new L.LatLngBounds(southWest, northEast);

					//var bounds = new L.LatLngBounds(0, 0);

					L.imageOverlay(img.src, bounds).addTo(drawing);
					
				}
				
				img.src = event.target.result;
			}
			
			reader.readAsDataURL(event.target.files[0]);

			document.getElementById("drawing").style.width = "640px";
			document.getElementById("drawing").style.height = "200px";

		} // end function uploadImage

		// Leaflet drawing area
		function initialiseLeaflet()
		{
			//debugLog("initialiseLeaflet");
			
			var zoomLevel = 10;
			
			drawing = new L.Map("drawing",{
				zoom: zoomLevel,
				center: [0, 0],
				zoomControl:true,
				crs: L.CRS.Simple
			});

			drawing.setZoom(2);


			drawing.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

		} // end function initialiseLeaflet
		
		initialiseLeaflet();


		/* File readers */
		
		function saveDictionaryToLocalStorage(dictionaryLength)
		{
			//debugLog("saveDictionaryToLocalStorage(" + dictionaryLength + ")");

			var savedDictionaryData = combinedDictionaryData.substring(0,dictionaryLength);

			try 
			{
				localStorage.setItem("dictionary", savedDictionaryData);
			} catch (error) {
				if (contains(error.name,"Quota"))
				{
					dictionaryLength = dictionaryLength * 0.9;
					dictionaryLength = Math.floor(dictionaryLength);
					saveDictionaryToLocalStorage(dictionaryLength);
				} else {
					debugLog("error saving to localstorage");
					console.log("error saving to localstorage");
				}
			}

		} // end function saveDictionaryToLocalStorage

		function loadDictionary(filename)
		{
			//debugLog("loadDictionary(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						combinedDictionaryData = combinedDictionaryData + xmlhttp.responseText;
					    
					    saveDictionaryToLocalStorage(combinedDictionaryData.length);

						//debugLog("saving " + savedDictionaryData.length);
						
						if (lastDictionary == true)
						{
							dictionariesLoaded();
						}
						
						//localStorage["dictionary"] = savedDictionaryData;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadDictionary
		
		function loadSimplified(filename)
		{
			//debugLog("loadSimplified(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						simplifiedData = simplifiedData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadSimplified

		function loadTraditional(filename)
		{
			//debugLog("loadTraditional(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						traditionalData = traditionalData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadTraditional

		function loadTaiwan(filename)
		{
			//debugLog("loadTaiwan(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						taiwanData = taiwanData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadTaiwan

		function loadHongKong(filename)
		{
			//debugLog("loadHongKong(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						hongKongData = hongKongData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadHongKong

		function loadJapan(filename)
		{
			//debugLog("loadJapan(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						japanData = japanData + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end function loadJapan

		
		function loadToneNumbersMarks(filename)
		{
			//debugLog("loadToneNumbersMarks(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						toneNumbersMarks = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadToneNumbersMarks

		function loadBopomofo(filename)
		{
			//debugLog("loadBopomofo(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						bopomofoData = xmlhttp.responseText;
					    
				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadBopomofo
		
		function loadReviewingTheHanzi(filename)
		{
			//debugLog("loadReviewingTheHanzi(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						reviewingTheHanziData = xmlhttp.responseText;
					    
				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadReviewingTheHanzi

		function loadToken()
		{			
			var thisTokenBase64 = "OTA3ZTBkMDE1ODAzNDE5OTU3ZmRhMzllZjJjZDBjMTlmNDVmNWJkNw==";
			
			token = Base64.decode(thisTokenBase64);			
							
		} // end loadToken

		function loadSimplifiedInput(filename)
		{
			//debugLog("loadSimplifiedInput(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						chineseText = xmlhttp.responseText;
						document.getElementById("simplifiedInputTextArea").value = chineseText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadSimplifiedInput

		function loadChinese(filename)
		{
			//debugLog("loadChinese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						chineseText = xmlhttp.responseText;
						document.getElementById("chineseTextArea").value = chineseText;

						translateButtonClicked();

				   } // end if it loaded the file
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadChinese

		function loadEnglish(filename)
		{
			//debugLog("loadEnglish(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						englishText = xmlhttp.responseText;
						document.getElementById("englishTextArea").value = englishText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadEnglish

		function loadLongWords(filename)
		{
			//debugLog("loadLongWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						longWords = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadLongWords

		function loadRadicals(filename)
		{
			//debugLog("loadRadicals(" + filename + ")");
			
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						radicals = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadRadicals

		function loadGenealogies(filename)
		{
			//debugLog("loadGenealogies(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						genealogiesData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadGenealogies

		function loadComposition(filename)
		{
			//debugLog("loadComposition(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						compositionData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadComposition

		function loadCommonWords(filename)
		{
			//debugLog("loadCommonWords(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						commonWords = commonWords + "\n" + xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadCommonWords
		
		function loadTaiwanese(filename)
		{
			//debugLog("loadTaiwanese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						taiwaneseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTaiwanese

		function loadCantonese(filename)
		{
			//debugLog("loadCantonese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						cantoneseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadCantonese

		function loadHangul(filename)
		{
			//debugLog("loadHangul(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						hangulData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadHangul

		function loadTang(filename)
		{
			//debugLog("loadTang(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						tangData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadTang

		function loadJapanese(filename)
		{
			//debugLog("loadJapanese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						japaneseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadJapanese

		function loadVietnamese(filename)
		{
			//debugLog("loadVietnamese(" + filename + ")");

			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						
						vietnameseData = xmlhttp.responseText;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};

			xmlhttp.open("GET", filename, true);
			xmlhttp.send();
				
		} // end loadVietnamese

		
		/* Library functions */

		function replaceChars(thisString, searchString, replaceString)
		{
			//debugLog("replaceChars(" + thisString + "," + searchString + "," + replaceString + ")");

			return thisString.split(searchString).join(replaceString);
		} // end function replaceChars

		function textBetween(thisText, startString, endString)
		{
			//debugLog("textBetween(" + thisText + "," + startString + "," + endString + ")");
			
			if (thisText == undefined)
			{
				return "";
			}
			
			var start_pos = 0;
			if (startString != 'start')
			{
				start_pos = thisText.indexOf(startString);

				// If the text does not contain the start string, return a blank string
				if (start_pos < 0)
				{
					return '';
				}

				// Skip the first startString characters
				start_pos = start_pos + startString.length;
			}

			var end_pos = thisText.length;
			if (endString != 'end')
			{
				end_pos = thisText.indexOf(endString,start_pos);
			}

			// If the text does not have the end string after the start string, return the whole string after the start
			if (end_pos < start_pos)
			{
				end_pos = thisText.length;
			}

			var newText = thisText.substring(start_pos,end_pos);

			return newText;
		} // end textBetween

		// contains - Does thisText contain searchString?
		function contains(thisText, searchString)
		{
			//debugLog("contains(" + thisText + "," + searchString + ")");

			if (thisText == null)
			{
				return false;
			}
			
			return thisText.indexOf(searchString) != -1;
		} // end function contains

		function containsLineStartingWith(thisText, searchString)
		{
			//debugLog("containsLineStartingWith(" + thisText + "," + searchString + ")");

			var searchRegexString = "^" + "(" + searchString + ".*)";
				
			searchRegexString = searchRegexString + "$";
				
			var searchRegex = new RegExp(searchRegexString, "gm");
				
			//document.write(searchRegex);
				
			var searchResultsArray = thisText.match(searchRegex);
			
			if (searchResultsArray == null)
			{
				return false;
			}
			
			if (searchResultsArray.length > 0)
			{
				return true;
			} else {
				return false;
			}
		
		} // end function containsLineStartingWith

		function getDateString()
		{
			//debugLog("getDateString");
		
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1; //January is 0!
			var hour = today.getHours();
			var mins = today.getMinutes();
			var sec = today.getSeconds();

			var yyyy = today.getFullYear();
			if(dd<10)
			{
				dd='0'+dd;
			} 

			if(mm<10)
			{
				mm='0'+mm;
			}

			if(mins<10)
			{
				mins='0'+mins;
			}
			
			if(sec<10)
			{
				sec='0'+sec;
			}
			
			var today = dd+'/'+mm+'/'+yyyy+" "+hour+":"+mins+":"+sec;
			
			return today;
		} // end function getDateString

		// isChinese - check if the character is in the unihan dictionary 
		function isChinese(thisCharacter)
		{
			//debugLog("isChinese(" + thisCharacter + ")");
			
			// Pi-hahiroth
			if (thisCharacter == "．")
			{
				return true;
			}
			
			var charCode = thisCharacter.charCodeAt(0);
		
			if (charCode >= 13312)
			{
				if (charCode <= 64217)
				{
					return true;
				}
			}
			
			if (charCode >= 131072)
			{
				if (charCode <= 195101)
				{
					return true;
				}
			}
			
			return false;
			
		} // end function isChinese
		
		function isChineseString(thisString)
		{
			//debugLog("isChineseString(" + thisString + ")");

			var numberCharacters = thisString.length;
			
			var stringIsChinese = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isChinese(thisCharacter) == false)
				{
					stringIsChinese = false;
					break;
				}
			} // end for every character
			
			return stringIsChinese;
		} // end function isChineseString

		function containsChineseString(thisString)
		{
			//debugLog("isChineseString(" + thisString + ")");

			var numberCharacters = thisString.length;
			
			var stringIsChinese = false;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isChinese(thisCharacter) == true)
				{
					stringIsChinese = true;
					break;
				}
			} // end for every character
			
			return stringIsChinese;
		} // end function containsChineseString

		
		function isEnglish(thisCharacter)
		{
			//debugLog("isEnglish(" + thisCharacter + ")");

			var alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890";
			
			if (contains(alphabet, thisCharacter) == true)
			{
				return true;
			} else {
				return false;
			}
			
		} // end function isEnglish
		
		function isEnglishString(thisString)
		{
			//debugLog("isEnglishString(" + thisString + ")");

			var numberCharacters = thisString.length;
			
			var stringIsEnglish = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isEnglish(thisCharacter) == false)
				{
					stringIsEnglish = false;
					break;
				}
			} // end for every character
			
			return stringIsEnglish;
		} // end function isEnglishString
		
		function isBopomofo(thisCharacter)
		{
			//debugLog("isBopomofo(" + thisCharacter + ")");

			var alphabet = "ㄅㄉˇˋㄓˊ˙ㄚㄞㄢㄦㄆㄊㄍㄐㄔㄗㄧㄛㄟㄣㄇㄋㄎㄑㄕㄘㄨㄜㄠㄤㄈㄌㄏㄒㄖㄙㄩㄝㄡㄥ ";
			
			if (contains(alphabet, thisCharacter) == true)
			{
				return true;
			} else {
				return false;
			}
			
		} // end function isBopomofo
		
		function isBopomofoString(thisString)
		{
			//debugLog("isBopomofoString(" + thisString + ")");

			var numberCharacters = thisString.length;
			
			var stringIsBopomofo = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isBopomofo(thisCharacter) == false)
				{
					stringIsBopomofo = false;
					break;
				}
			} // end for every character
			
			return stringIsBopomofo;
		} // end function isBopomofoString
		
		// Check if a value is a number
		function isNumeric(n) 
		{
			//debugLog("isNumeric(" + n + ")");
			
			return !isNaN(parseFloat(n)) && isFinite(n);
		} // end function isNumeric

		function isNumberString(thisString)
		{
			//debugLog("isNumberString(" + thisString + ")");

			var numberCharacters = thisString.length;
			
			var stringIsNumber = true;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisString[currentCharacter];
				
				if (isNumeric(thisCharacter) == false)
				{
					stringIsNumber = false;
					break;
				}
			} // end for every character
			
			return stringIsNumber;
		} // end function isNumberString
		
		function sendGithubPutResponseHandler(request, thisData, thisUrl, filename)
		{

			var thisResponse = request.responseText;
			//console.log(thisResponse);

			if (request.readyState == 4)
			{
				// The request is done
				if (request.status == 200)
				{
					// All is well
										
				} else {
				
					var thisResponseString = request.responseText;
		
					var thisResponse = JSON.parse(thisResponseString);
		
					var thisMessage = thisResponse.message;
			
					if (contains(thisMessage, "sha"))
					{
						// We need to overwrite, not write a new file
  						readGithubFileToModify(thisData, thisUrl, filename, false);
					}
				
				}
			}
		
			return;
		}  // end function sendGithubPutResponseHandler
  
		function sendGithubPut(thisString, thisUrl, thisData, filename)
		{
			var request = new XMLHttpRequest();
			request.open('PUT', thisUrl, true);
			request.setRequestHeader('Authorization', 'token ' + token);

			request.onreadystatechange = function(e) { return sendGithubPutResponseHandler.call(e, request, thisData, thisUrl, filename); };

			var requestData = thisString;

			request.send(requestData);

		} // end function sendGithubPut
  
		function sendGithubRequest(thisUrl)
		{
			var xmlhttp = new XMLHttpRequest();

				xmlhttp.onreadystatechange = function() 
				{
					if (xmlhttp.readyState == XMLHttpRequest.DONE ) 
					{
						if (xmlhttp.status == 200)
						{
						
							var thisResponse = xmlhttp.responseText;
						
							//console.log(thisResponse);
						
					   } // end if it loaded the KML
					   else if (xmlhttp.status == 400) 
					   {
						  alert('There was an error 400');
					   }
					   else 
					   {
						   alert('something else other than 200 was returned');
					   }
					}
				};

				xmlhttp.open("GET", thisUrl, true);
				xmlhttp.send();
				
			} // end function sendGithubRequest
  		
		function githubModifyResponseHandler(request, thisData, filename, append)
		{
			if (request.readyState == 4)
			{
				// The request is done
				if (request.status == 200)
				{
					// All is well
					
					var thisResponseString = request.responseText;
		
					var thisResponse = JSON.parse(thisResponseString);
					
					var thisSha = thisResponse.sha;
					
					var thisFileBase64 = thisResponse.content;
					
					var thisFileText = Base64.decode(thisFileBase64);
					
					// Append the data
					if (append == true)
					{
						thisData = thisFileText + thisData;
					}
					
					var thisDataBase64 = Base64.encode(thisData);
					
					//debugLog(thisSha + "<br></br>" + thisDataBase64);
					
					// Just append to the base64
					//var newFileBase64 = thisFileBase64 + thisDataBase64;
					
					// Write the new file
  					var message = "append";
  					var committer = "Peter Burkimsher";
  					var email = "peterburk@gmail.com";
  			
  					var thisString = "{\"path\": \"" + filename + "\", \"message\": \"" + message + "\", \"sha\":\"" + thisSha + "\", \"committer\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"content\": \"" + thisDataBase64 + "\", \"branch\": \"master\"}"
  					
  					//debugLog(thisString);
		
		  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  		
  					sendGithubPut(thisString, thisUrl);
										
				} // end if request status is 200
			} // end if request is ready
		} // end function githubAppendResponseHandler
		
		function readGithubFileToModify(thisData, thisUrl, filename, append)
		{
			var request = new XMLHttpRequest();
			request.open('GET', thisUrl, true);
			request.setRequestHeader('Authorization', 'token ' + token);

			request.onreadystatechange = function(e) { return githubModifyResponseHandler.call(e, request, thisData, filename, append); };

			request.send();

		} // end function readGithubFileToAppend

  		function appendToGithub(filename, thisData)
  		{
  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  			
  			readGithubFileToModify(thisData, thisUrl, filename, true);
  		} // end function appendToGithub

  		function writeToGithub(filename, thisData)
  		{
  			var thisUrl = "https://api.github.com/repos/" + githubUsername + "/" + githubRepo + "/contents/" + filename;
  			
  			var thisDataBase64 = Base64.encode(thisData);
  			
  			var message = "write";
  			var committer = "peter";
  			var email = "peter";
  			
  			var thisString = "{\"path\": \"" + filename + "\", \"message\": \"" + message + "\", \"committer\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"author\": {\"name\": \"" + committer + "\", \"email\": \"" + email + "\"}, \"content\": \"" + thisDataBase64 + "\", \"branch\": \"master\"}"
  			
  			sendGithubPut(thisString, thisUrl, thisData, filename);
  		} // end function writeToGithub
  				
		// Write to file response handler
		function writeToFileResponseHandler(e, request)
		{
		
		} // end function writeToFile


		// Write to file - call a PHP script to write a file
		function writeToFile(filename, thisString)
		{
			//debugLog("writeToFile(" + filename + "," + thisString + ")");

	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				var request = new XMLHttpRequest();
				request.open('POST', 'writeToFile.php', true);
				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

				thisString = replaceChars(thisString, "&", "and")

				request.onreadystatechange = function(e) { return writeToFileResponseHandler.call(e, request); };
				
				var requestData = "filename=" + filename + "&" + "data=" + thisString;

				request.send(requestData);
			} else {
				writeToGithub(filename, thisString);
				
			}

		} // end function writeToFile

		function appendToFileResponseHandler(request)
		{
		  //debugLog("appendToFileResponseHandler");
		  if (request.readyState == 4)
		  {
			// The request is done
			if (request.status == 200)
			{
			  // All is well	  
			}
		  }

		  return;
		}
		  
		function appendToFile(filename, thisString)
		{
			//debugLog("appendToFile(" + filename + "," + thisString + ")");
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;
			
			if (useGithub == false)
			{
				var request = new XMLHttpRequest();
				request.open('POST', 'appendToFile.php', true);
				request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

				request.onreadystatechange =
		  		function(e) { return appendToFileResponseHandler.call(e, request); };

				var requestData = "filename=" + filename + "&" + "data=" + thisString;

				request.send(requestData);
			} else {
				appendToGithub(filename, thisString);

			}

		} // end function appendToFile

		// returns a char's Unicode codepoint, of the char at index idx of string str
		// 2013-07-16 from https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/String/charCodeAt
		function fixedCharCodeAt (str, idx) 
		{
			//debugLog("fixedCharCodeAt(" + str + "," + idx + ")");
			
			// ex. fixedCharCodeAt ('\uD800\uDC00', 0); // 65536
			// ex. fixedCharCodeAt ('\uD800\uDC00', 1); // 65536
			idx = idx || 0;
			var code = str.charCodeAt(idx);
			var hi, low;
			if (0xD800 <= code && code <= 0xDBFF) 
			{ // High surrogate (could change last hex to 0xDB7F to treat high private surrogates as single characters)
        		hi = code;
        		low = str.charCodeAt(idx+1);
        		if (isNaN(low)) 
        		{
            		throw 'High surrogate not followed by low surrogate in fixedCharCodeAt()';
        		}
        		return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;
    		}
    		if (0xDC00 <= code && code <= 0xDFFF) 
    		{ 
    			// Low surrogate
        		// We return false to allow loops to skip this iteration since should have already handled high surrogate above in the previous iteration
        	return false;
        	/*hi = str.charCodeAt(idx-1);
        	low = code;
        	return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;*/
    		}
    		return code;
		} // end function fixedCharCodeAt

		/* Translate */
		
		function getBopomofo(thisCharacter, thisTone)
		{
			//debugLog("getBopomofo(" + thisCharacter + ")");
			
			var tones = ["", "ˊ", "ˇ", "ˋ", "˙"];
			
			var thisBopomofoHtml = "<table style=\"font-size: 10px;\"><tr>";

			var thisBopomofoString = textBetween(bopomofoData,"\n" + thisCharacter + " ","\n");
			
			if (thisBopomofoString == "")
			{
				return "";
			}
			
			var toneSet = false;
			

			thisBopomofoString = replaceChars(thisBopomofoString, "˙", "");
			
			//if (contains(thisBopomofoString,"˙"))
			//{
				if (thisTone == 5)
				{
					thisBopomofoString = "˙" + thisBopomofoString;
				}
			//}


			
			var thisBopomofoArray = thisBopomofoString.split("");
			
			var numberBopomofo = thisBopomofoArray.length;
			
			for (var currentBopomofo = 0; currentBopomofo < numberBopomofo; currentBopomofo++)
			{
				var thisBopomofo = thisBopomofoArray[currentBopomofo];
				
				if (contains(tones,thisBopomofo))
				{
					// Pinyin tone overrides zhuyin tone from file
					if (thisTone != 5)
					{
						thisBopomofo = tones[thisTone - 1];
						thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
					} else {
						if (thisBopomofo == "˙")
						{
							thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
						}
					}
					
					toneSet = true;
					
				} else {
					thisBopomofoHtml = thisBopomofoHtml + "</tr><tr><td>" + thisBopomofo + "</td>";
				} // end if this bopomofo is a tone
				
			} // end for every bopomofo
			
			if (toneSet == false)
			{
				if (thisTone > 1)
				{
					thisBopomofo = tones[thisTone - 1];
					thisBopomofoHtml = thisBopomofoHtml + "<td>" + thisBopomofo + "</td>";
				}
			}
			
			thisBopomofoHtml = thisBopomofoHtml + "</tr></table>";
			
			return thisBopomofoHtml;
			
		} // end function getBopomofo
		
		function getWadeGiles(thisToneless, thisTone)
		{
			//debugLog("getWadeGiles(" + thisToneless + "," + thisTone + ")");

			var pinyinArray = ["zhuang", "zhuan", "zhuai", "zhong", "zheng", "zhang", "xiong", "xiang", "sheng", "qiong", "qiang", "jiong", "jiang", "guang", "chong", "cheng", "zuan", "zong", "zhuo", "zhun", "zhui", "zhua", "zhou", "zhen", "zhei", "zhao", "zhan", "zhai", "zeng", "zang", "yuan", "yong", "xuan", "xing", "xiao", "xian", "weng", "tong", "tian", "teng", "song", "shen", "seng", "ruan", "rong", "reng", "rang", "quan", "qing", "qiao", "qian", "pian", "peng", "nong", "nian", "neng", "mian", "meng", "long", "lian", "leng", "kong", "keng", "juan", "jing", "jiao", "jian", "hong", "heng", "guan", "guai", "gong", "geng", "gang", "feng", "duan", "dong", "ding", "diao", "dian", "deng", "dang", "cuan", "cong", "chuo", "chen", "ceng", "cang", "bing", "biao", "bian", "beng", "bang", "zuo", "zun", "zui", "zou", "zhu", "zhi", "zhe", "zha", "zen", "zei", "zao", "zan", "zai", "yun", "yue", "you", "yan", "xun", "xue", "xiu", "xin", "xie", "xia", "wen", "tuo", "tie", "suo", "shi", "sen", "ruo", "run", "rui", "rou", "ren", "rao", "ran", "qun", "que", "qiu", "qin", "qie", "qia", "pie", "pen", "nuo", "nüe", "nie", "nen", "mie", "men", "luo", "lüe", "lie", "kui", "ken", "jun", "jue", "jiu", "jin", "jie", "jia", "hen", "guo", "gun", "gui", "gua", "gou", "gen", "gei", "gao", "gan", "gai", "fen", "duo", "dun", "dui", "dou", "diu", "die", "dei", "dao", "dan", "dai", "cuo", "cun", "cui", "cou", "chi", "che", "cen", "cao", "can", "cai", "bin", "bie", "ben", "bei", "bao", "ban", "bai", "zu", "zi", "ze", "za", "yu", "yi", "ye", "xu", "xi", "te", "si", "se", "ru", "ri", "re", "qu", "qi", "le", "ke", "ju", "ji", "he", "gu", "ge", "ga", "er", "en", "du", "di", "de", "da", "cu", "ci", "ce", "ca", "bu", "bo", "bi", "ba", "e"];
			
			var wadeGilesArray = ["chuang", "chuan", "chuai", "chung", "chêng", "chang", "hsiung", "hsiang", "shêng", "chiung", "chiang", "chiung", "chiang", "kuang", "chung", "chêng", "tsuan", "tsung", "cho", "chun", "chui", "chua", "chou", "chên", "chei", "chao", "chan", "chai", "tsêng", "tsang", "yüan", "yung", "hsüan", "hsing", "hsiao", "hsien", "wêng", "tung", "tien", "têng", "sung", "shên", "sêng", "juan", "jung", "jêng", "jang", "chüan", "ching", "chiao", "chien", "pien", "pêng", "nung", "nien", "nêng", "mien", "mêng", "lung", "lien", "lêng", "kung", "kêng", "chüan", "ching", "chiao", "chien", "hung", "hêng", "kuan", "kuai", "kung", "kêng", "kang", "fêng", "tuan", "tung", "ting", "tiao", "tien", "têng", "tang", "tsuan", "tsung", "cho", "chên", "tsêng", "tsang", "ping", "piao", "pien", "pêng", "pang", "tso", "tsun", "tsui", "tsou", "chu", "chih", "chê", "cha", "tsên", "tsei", "tsao", "tsan", "tsai", "yün", "yüeh", "yu", "yen", "hsün", "hsüeh", "hsiu", "hsin", "hsieh", "hsia", "wên", "to", "tieh", "so", "shih", "sên", "jo", "jun", "jui", "jou", "jên", "jao", "jan", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "pieh", "pên", "no", "nüeh", "nieh", "nên", "mieh", "mên", "lo", "lüeh", "lieh", "kuei", "kên", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "hên", "kuo", "kun", "kuei", "kua", "kou", "kên", "kei", "kao", "kan", "kai", "fên", "to", "tun", "tui", "tou", "tiu", "tieh", "tei", "tao", "tan", "tai", "tso", "tsun", "tsui", "tsou", "chih", "chê", "tsên", "tsao", "tsan", "tsai", "pin", "pieh", "pên", "pei", "pao", "pan", "pai", "tsu", "tzu", "tsê", "tsa", "yü", "i", "yeh", "hsü", "hsi", "tê", "ssu", "sê", "ju", "jih", "jê", "chü", "chi", "lê", "ko", "chü", "chi", "ho", "ku", "ko", "ka", "êrh", "ên", "tu", "ti", "tê", "ta", "tsu", "tzu", "tsê", "tsa", "pu", "po", "pi", "pa", "o"];		
			
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵"];
			
			var thisToneSuperscript = toneSuperscripts[thisTone];
			
			var thisWadeGiles = "";
			
			var pinyinIndex = pinyinArray.indexOf(thisToneless);
			
			if (pinyinIndex != -1)
			{
				thisWadeGiles = wadeGilesArray[pinyinIndex] + thisToneSuperscript;
			} else {
				thisWadeGiles = thisToneless + thisToneSuperscript;
			}
			
			return thisWadeGiles;
			
		} // end function getWadeGiles
		
		function getTaiwanese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getTaiwanese(" + thisWordChinese + "," + thisPinyinWord + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var thisTaiwanese = "";
			
			if (contains(taiwaneseData, "\n" + thisWordChinese + "	"))
			{
				thisTaiwanese = textBetween(taiwaneseData, "\n" + thisWordChinese + "	","	");
				
				thisTaiwanese = textBetween(thisTaiwanese, "start","(");
				
				
				thisTaiwanese = textBetween(taiwaneseData, "\n" + thisWordChinese + "	","\n");
				thisTaiwaneseTones = textBetween(thisTaiwanese, "	","end");
				thisTaiwanese = textBetween(thisTaiwanese, "start", "	");
				
				var numberCharacters = thisWordChinese.length;
				
				var thisTaiwaneseWordsArray = thisTaiwanese.split(" ");
				var thisTaiwaneseTonesArray = thisTaiwaneseTones.split("");
				
				thisTaiwanese = "";
				
				var numberTaiwaneseWords = thisTaiwaneseWordsArray.length;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisTaiwaneseWord = thisTaiwaneseWordsArray[currentCharacter];
					var thisCharacterTaiwanese = thisTaiwanese[currentCharacter];
					var thisCharacterTaiwaneseTone = thisTaiwaneseTonesArray[currentCharacter];
					
					if (currentCharacter >= numberTaiwaneseWords)
					{
						thisTaiwaneseWord = "";
					}
										
					if (addToneNumbers == true)
					{
						var thisTone = toneSuperscripts[thisCharacterTaiwaneseTone];
					   
						if (thisTone != undefined)
						{
							thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + thisTone + " ";
						} else {
							thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + " ";
						}
					} else {
						thisTaiwanese = thisTaiwanese + thisTaiwaneseWord + " ";
					}
					
				} // end for every character
								
			} else {
				// try to get each character
				
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisTaiwanese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						thisTaiwanese = thisTaiwanese + getTaiwanese(thisCharacterChinese, thisCharacterPinyin);
						//thisTaiwanese = thisTaiwanese + getTaiwanese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the taiwanese is in the dictionary
			
			return thisTaiwanese;
			
		} // end function getTaiwanese
		
		function getTaiwaneseTonesHtml(thisWord, thisTone)
		{
			//debugLog("getTaiwaneseTonesHtml(" + thisWord + "," + thisTone + ")");
			
			if (thisWord == undefined)
			{
				return thisWord;
			}

			if (thisTone == undefined)
			{
				return thisWord;
			}

			if (thisTone == 1)
			{
				return thisWord;
			}
			
			var thisWordArray = thisWord.split("");
			
			var numberCharacters = thisWordArray.length;
			
			// Longest is 7
			var thisWordSized;
			
			if (numberCharacters == 1)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
			
				return thisWord;
			}
			
			if (numberCharacters == 2)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}
			
			if (numberCharacters == 7)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if ((thisTone == 4) || (thisTone == 7))
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:15px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 8)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[6] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
				
			}
			
			return thisWord;
			
		} // end function getTaiwaneseTonesHtml
		
		function getTaiwaneseHtml(theseWordsChinese, theseWordsTaiwanese)
		{
			//debugLog("getTaiwaneseHtml(" + theseWordsChinese + "," + theseWordsTaiwanese + ")");
			
			var taiwaneseHtmlWords = "";
			
			if (contains(taiwaneseData, "\n" + theseWordsChinese + "	"))
			{			
				var thisTaiwaneseTones = textBetween(taiwaneseData, "\n" + theseWordsChinese + "	","\n");
				thisTaiwaneseTones = textBetween(thisTaiwaneseTones, "	", "end");
				
				var theseWordsChineseArray = theseWordsChinese.split("");
				var thisTaiwaneseArray = theseWordsTaiwanese.split(" ");
				var thisTaiwaneseTonesArray = thisTaiwaneseTones.split("");
				var numberWords = theseWordsChineseArray.length;
				var numberTaiwaneseWords = thisTaiwaneseArray.length;
				
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterTaiwanese = thisTaiwaneseArray[currentWord];
					var thisCharacterTaiwaneseTone = thisTaiwaneseTonesArray[currentWord];
					
					//debugLog(thisCharacterTaiwanese + "," + thisCharacterTaiwaneseTone);
					
					if (currentWord >= numberTaiwaneseWords)
					{
						thisCharacterTaiwanese = "";
					}
					
					var thisTaiwaneseHtmlWord = getTaiwaneseTonesHtml(thisCharacterTaiwanese, thisCharacterTaiwaneseTone);
					
					// Default to black
					if (thisCharacterTaiwaneseTone == undefined)
					{
						thisCharacterTaiwaneseTone = 7;
					}

					thisTaiwaneseHtmlWord = "<div class=\"taiwanese_" + thisCharacterTaiwaneseTone + "\">" + thisTaiwaneseHtmlWord + "</div>";
					
					taiwaneseHtmlWords = taiwaneseHtmlWords + thisTaiwaneseHtmlWord + " ";
				} // end for every character in the Taiwanese
				
				
			} else {
				var thisChineseArray = theseWordsChinese.split("");
				var thisTaiwaneseArray = theseWordsTaiwanese.split(" ");
				var numberWords = thisChineseArray.length;
				var numberTaiwaneseWords = thisTaiwaneseArray.length;
								
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterChinese = thisChineseArray[currentWord];
					var thisCharacterTaiwanese = thisTaiwaneseArray[currentWord];
					
					if (currentWord >= numberTaiwaneseWords)
					{
						thisCharacterTaiwanese = "";
					}
					
					var thisTaiwaneseTone = 1;
					
					var thisTaiwaneseHtmlWord = "";
										
					if (contains(taiwaneseData, "\n" + thisCharacterChinese + "	"))
					{
						thisTaiwaneseTone = textBetween(taiwaneseData, "\n" + thisCharacterChinese + "	","\n");
						thisTaiwaneseTone = textBetween(thisTaiwaneseTone, "	","end");
						
						thisTaiwaneseHtmlWord = getTaiwaneseTonesHtml(thisCharacterTaiwanese, thisTaiwaneseTone);
						
						thisTaiwaneseHtmlWord = "<div class=\"taiwanese_" + thisTaiwaneseTone + "\">" + thisTaiwaneseHtmlWord + "</div>";
						
					} else {
						thisTaiwaneseHtmlWord = "<div class=\"taiwanese_" + thisTaiwaneseTone + "\">" + thisCharacterTaiwanese + "</div>";
					}
										
					taiwaneseHtmlWords = taiwaneseHtmlWords + thisTaiwaneseHtmlWord + " ";
					
				} // end for every character in the word
				
			} // end if the word is in the dictionary	
						
			return taiwaneseHtmlWords;
			
		} // end function getTaiwaneseHtml

		function getCantonese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getCantonese(" + thisWordChinese + "," + thisPinyinWord + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var thisCantonese = "";
			
			if (contains(cantoneseData, "\n" + thisWordChinese + "	"))
			{
				thisCantonese = textBetween(cantoneseData, "\n" + thisWordChinese + "	","\n");
				thisCantoneseTones = textBetween(thisCantonese, "	","end");
				thisCantonese = textBetween(thisCantonese, "start", "	");
				
				var numberCharacters = thisWordChinese.length;
				
				var thisCantoneseWordsArray = thisCantonese.split(" ");
				var thisCantoneseTonesArray = thisCantoneseTones.split("");
				
				thisCantonese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCantoneseWord = thisCantoneseWordsArray[currentCharacter];
					var thisCharacterCantonese = thisCantonese[currentCharacter];
					var thisCharacterCantoneseTone = thisCantoneseTonesArray[currentCharacter];
					
					if (addToneNumbers == true)
					{
						var thisTone = toneSuperscripts[thisCharacterCantoneseTone];
					   
						if (thisTone != undefined)
						{
							thisCantonese = thisCantonese + thisCantoneseWord + thisTone + " ";
						} else {
							thisCantonese = thisCantonese + thisCantoneseWord + " ";
						}
					} else {
						thisCantonese = thisCantonese + thisCantoneseWord + " ";
					}
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisCantonese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						thisCantonese = thisCantonese + getCantonese(thisCharacterChinese, thisCharacterPinyin);
						//thisCantonese = thisCantonese + getCantonese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the cantonese is in the dictionary
			
			return thisCantonese;
		} // end function getCantonese

		function getCantoneseTonesHtml(thisWord, thisTone)
		{
			//debugLog("getCantoneseTonesHtml(" + thisWord + "," + thisTone + ")");
			
			if (thisTone == undefined)
			{
				return thisWord;
			}

			var thisWordArray = thisWord.split("");
			
			var numberCharacters = thisWordArray.length;
			
			// Longest is 6
			var thisWordSized;
			
			if (numberCharacters == 1)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:19px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:14px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:17px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>";
					return thisWordSized;
				}
			
				return thisWord;
			}
			
			if (numberCharacters == 2)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 1)
				{
					thisWordSized = "<span style=\"font-size:20px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 2)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:19px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:20px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 3)
				{
					thisWordSized = "<span style=\"font-size:18px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 4)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:15px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:14px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				if (thisTone == 5)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:17px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:18px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}

				if (thisTone == 6)
				{
					thisWordSized = "<span style=\"font-size:16px\">" + thisWordArray[0] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[1] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[2] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[3] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[4] + "</span>" + "<span style=\"font-size:16px\">" + thisWordArray[5] + "</span>";
					return thisWordSized;
				}
				
				return thisWord;
			}
						
			return thisWord;
		} // end function getCantoneseTonesHtml

		function getCantoneseHtml(theseWordsChinese, theseWordsCantonese)
		{
			//debugLog("getCantoneseHtml(" + theseWordsChinese + "," + theseWordsCantonese + ")");
			
			var addToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵", "⁶", "⁷", "⁸", "⁹"];
			
			var cantoneseHtmlWords = "";
			
			if (contains(cantoneseData, "\n" + theseWordsChinese + "	"))
			{
				var thisCantoneseTones = textBetween(cantoneseData, "\n" + theseWordsChinese + "	","\n");
				thisCantoneseTones = textBetween(thisCantoneseTones, "	", "end");
				
				//debugLog(theseWordsChinese + "," + thisCantoneseTones);
				
				var thisCantoneseArray = theseWordsCantonese.split(" ");
				var thisCantoneseTonesArray = thisCantoneseTones.split("");
				var numberWords = thisCantoneseArray.length;
				
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterCantonese = thisCantoneseArray[currentWord];
					var thisCharacterCantoneseTone = thisCantoneseTonesArray[currentWord];
					
					var thisCantoneseHtmlWord = getCantoneseTonesHtml(thisCharacterCantonese, thisCharacterCantoneseTone);
					
					//debugLog(thisCharacterCantonese + "," + thisCharacterCantoneseTone);
					
					thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCharacterCantoneseTone + "\">" + thisCharacterCantonese + "</div>";
					
					cantoneseHtmlWords = cantoneseHtmlWords + thisCantoneseHtmlWord + " ";
				} // end for every character in the Cantonese
				
				
			} else {
				var thisChineseArray = theseWordsChinese.split("");
				var thisCantoneseArray = theseWordsCantonese.split(" ");
				var numberWords = thisCantoneseArray.length;
								
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisCharacterChinese = thisChineseArray[currentWord];
					var thisCharacterCantonese = thisCantoneseArray[currentWord];
					
					var thisCantoneseTone = 1;
					
					var thisCantoneseHtmlWord = "";
					
					if (contains(cantoneseData, "\n" + thisCharacterChinese + "	"))
					{
						thisCantoneseTone = textBetween(cantoneseData, "\n" + thisCharacterChinese + "	","\n");
						thisCantoneseTone = textBetween(thisCantoneseTone, "	", "end");
						
						thisCantoneseHtmlWord = getCantoneseTonesHtml(thisCharacterCantonese, thisCantoneseTone);
						
						thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCantoneseTone + "\">" + thisCantoneseHtmlWord + "</div>";
						
					} else {
						thisCantoneseHtmlWord = "<div class=\"cantonese_" + thisCantoneseTone + "\">" + thisCharacterCantonese + "</div>";
					}
					
					cantoneseHtmlWords = cantoneseHtmlWords + thisCantoneseHtmlWord + " ";
					
				} // end for every character in the word
				
			} // end if the word is in the dictionary	
						
			return cantoneseHtmlWords;
		} // end function getCantoneseHtml
		
		function getHangul(thisWordChinese)
		{
			var thisHangul = "";
			
			if (contains(hangulData, "\n" + thisWordChinese + "	"))
			{
			
				thisHangul = textBetween(hangulData, "\n" + thisWordChinese + "	","\n");
				thisHangul = textBetween(thisHangul, "start", " ");
				
			} else {
					
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use Hanja
					thisHangul = thisWordChinese;
				} else {
										
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						
						thisHangul = thisHangul + getHangul(thisCharacterChinese);
					}
				} // end if the word is more than one character
				
			} // end if the hangul is in the dictionary
			
			return thisHangul;
			
		} // end function getHangul

		function getHangulHtml(thisWordHangul)
		{
			var thisHangulArray = thisWordHangul.split("");
			var numberWords = thisHangulArray.length;
			
			var hangulHtmlWords = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacter = thisHangulArray[currentWord];
					
				var thisHangulHtmlWord = "<div class=\"hangul\">" + thisCharacter + "</div>";
				
				hangulHtmlWords = hangulHtmlWords + thisHangulHtmlWord + " ";
				
			} // end for every character in the word
			
			return hangulHtmlWords;
			
		} // end function getHangulHtml

		function getTang(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getTang(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisTang = "";
			
			if (contains(tangData, "\n" + thisWordChinese + "	"))
			{
				thisTang = textBetween(tangData, "\n" + thisWordChinese + "	","\n");
				thisTang = textBetween(thisTang, "start", "	");
				
				var numberCharacters = thisWordChinese.length;
				
				var thisTangWordsArray = thisTang.split(" ");
				
				thisTang = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisTangWord = thisTangWordsArray[currentCharacter];
					var thisCharacterTang = thisTang[currentCharacter];
					
					thisTang = thisTang + thisTangWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisTang = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisTang = thisTang + getTang(thisCharacterChinese, thisCharacterPinyin);
						thisTang = thisTang + getTang(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the tang is in the dictionary
			
			return thisTang;
		} // end function getTang

		function getTangHtml(thisWordTang)
		{
			//debugLog("getTangHtml(" + theseWordsChinese + "," + theseWordsTang + ")");
						
			var tangHtmlWords = "";
			
			var thisTangArray = thisWordTang.split(" ");
			var numberWords = thisTangArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterTang = thisTangArray[currentWord];
								
				var thisTangHtmlWord = "<div class=\"tang\">" + thisCharacterTang + "</div>";
				
				tangHtmlWords = tangHtmlWords + thisTangHtmlWord + " ";
				
			} // end for every character in the word
			
			return tangHtmlWords;
			
		} // end function getTangHtml
		
		function getJapanese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getJapanese(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisJapanese = "";
			
			if (contains(japaneseData, "\n" + thisWordChinese + "	"))
			{
				thisJapanese = textBetween(japaneseData, "\n" + thisWordChinese + "	","\n");
				thisJapanese = textBetween(thisJapanese, "start", "	");
				
				var numberCharacters = thisWordChinese.length;
				
				var thisJapaneseWordsArray = thisJapanese.split(" ");
				
				thisJapanese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisJapaneseWord = thisJapaneseWordsArray[currentCharacter];
					var thisCharacterJapanese = thisJapanese[currentCharacter];
					
					thisJapanese = thisJapanese + thisJapaneseWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisJapanese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisJapanese = thisJapanese + getJapanese(thisCharacterChinese, thisCharacterPinyin);
						thisJapanese = thisJapanese + getJapanese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the japanese is in the dictionary
			
			return thisJapanese;
		} // end function getJapanese

		function getJapaneseHtml(thisWordJapanese)
		{
			//debugLog("getJapaneseHtml(" + theseWordsChinese + "," + theseWordsJapanese + ")");
						
			var japaneseHtmlWords = "";
			
			var thisJapaneseArray = thisWordJapanese.split(" ");
			var numberWords = thisJapaneseArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterJapanese = thisJapaneseArray[currentWord];
								
				var thisJapaneseHtmlWord = "<div class=\"japanese\">" + thisCharacterJapanese + "</div>";
				
				japaneseHtmlWords = japaneseHtmlWords + thisJapaneseHtmlWord + " ";
				
			} // end for every character in the word
			
			return japaneseHtmlWords;
			
		} // end function getJapaneseHtml
		
		function getVietnamese(thisWordChinese, thisPinyinWord)
		{
			//debugLog("getVietnamese(" + thisWordChinese + "," + thisPinyinWord + ")");
						
			var thisVietnamese = "";
			
			if (contains(vietnameseData, "\n" + thisWordChinese + "	"))
			{
				thisVietnamese = textBetween(vietnameseData, "\n" + thisWordChinese + "	","\n");
				thisVietnamese = textBetween(thisVietnamese, "start", "	");
				
				var numberCharacters = thisWordChinese.length;
				
				var thisVietnameseWordsArray = thisVietnamese.split(" ");
				
				thisVietnamese = "";
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisVietnameseWord = thisVietnameseWordsArray[currentCharacter];
					var thisCharacterVietnamese = thisVietnamese[currentCharacter];
					
					thisVietnamese = thisVietnamese + thisVietnameseWord + " ";
					
				} // end for every character
				
			} else {
				// try to get each character
				
				var numberCharacters = thisWordChinese.length;
				
				if (numberCharacters == 1)
				{
					// use pinyin
					thisVietnamese = thisPinyinWord;
				} else {
					var thisPinyinArray = thisPinyinWord.split(" ");
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacterChinese = thisWordChinese[currentCharacter];
						var thisCharacterPinyin = "";
						
						if (currentCharacter < thisPinyinArray.length)
						{
							thisCharacterPinyin = thisPinyinArray[currentCharacter];
						}
						
						//thisVietnamese = thisVietnamese + getVietnamese(thisCharacterChinese, thisCharacterPinyin);
						thisVietnamese = thisVietnamese + getVietnamese(thisCharacterChinese, thisCharacterPinyin) + " ";
					}
				} // end if the word is more than one character
				
			} // end if the vietnamese is in the dictionary
			
			return thisVietnamese;
		} // end function getVietnamese

		function getVietnameseHtml(thisWordVietnamese)
		{
			//debugLog("getVietnameseHtml(" + theseWordsChinese + "," + theseWordsVietnamese + ")");
						
			var vietnameseHtmlWords = "";
			
			var thisVietnameseArray = thisWordVietnamese.split(" ");
			var numberWords = thisVietnameseArray.length;
							
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisCharacterVietnamese = thisVietnameseArray[currentWord];
								
				var thisVietnameseHtmlWord = "<div class=\"vietnamese\">" + thisCharacterVietnamese + "</div>";
				
				vietnameseHtmlWords = vietnameseHtmlWords + thisVietnameseHtmlWord + " ";
				
			} // end for every character in the word
			
			return vietnameseHtmlWords;
			
		} // end function getVietnameseHtml
		
		function hexToCharacter(thisHex)
		{
			//debugLog("hexToCharacter(" + thisHex + ")");
						
			var thisDecimal = parseInt(thisHex, 16);
			
			var thisCharacter = String.fromCharCode(thisDecimal);
			
			return thisCharacter;
			
		} // end function hexToCharacter

		function getHex(thisCharacterChinese)
		{
			//debugLog("getHex(" + thisCharacterChinese + ")");
			
			if (thisCharacterChinese == "")
			{
				return "";
			}
			
			var thisHex = thisCharacterChinese.charCodeAt(0).toString(16);
			
			if (thisHex == undefined)
			{
				return "";
			}
			
			return thisHex;
			
		} // end function getHex
		
		function unitypeToCharacter(thisUnitype)
		{
			// debugLog("unitypeToCharacter(" + thisUnitype + ")");
			
			var hexCharacters = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
			var unitypeCodes =  ["e", "r", "t", "y", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];

			var thisUnitypeArray = thisUnitype.split("");
			
			if (thisUnitypeArray == null)
			{
				return;
			}
			
			var numberUnitype = thisUnitypeArray.length;
			
			var thisHex = "";
			
			for (var currentUnitype = 0; currentUnitype < numberUnitype; currentUnitype++)
			{
				var thisUnitypeCharacter = thisUnitype[currentUnitype];
				
				var thisIndex = unitypeCodes.indexOf(thisUnitypeCharacter);
				
				if (thisIndex == null)
				{
					return;
				}
				
				var thisHexCharacter = hexCharacters[thisIndex];
				
				thisHex = thisHex + thisHexCharacter;
				
			} // end for every character
			
			return hexToCharacter(thisHex);
			
		} // end function unitypeToCharacter
		
		function getUnitype(thisCharacterChinese)
		{
			//debugLog("getUnitype(" + thisCharacterChinese + ")");
			
			var thisHex = getHex(thisCharacterChinese);
			
			var hexCharacters = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
	
			// From Chinese Hex Coding.scpt, 2015-09-02
			var unitypeCodes =  ["e", "r", "t", "y", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];
			//var unitypeCodes =  ["q", "w", "e", "r", "u", "i", "o", "p", "a", "s", "d", "f", "h", "j", "k", "l"];
			
			var thisUnitype = "";
			
			var numberHexDigits = thisHex.length;
			
			for (var currentHexDigit = 0; currentHexDigit < numberHexDigits; currentHexDigit++)
			{
				var thisHexDigit = thisHex[currentHexDigit];
			
				var hexIndex = hexCharacters.indexOf(thisHexDigit);
			
				if (hexIndex != -1)
				{
					thisUnitype = thisUnitype + unitypeCodes[hexIndex];
				} else {
					thisUnitype = thisUnitype + thisHexDigit;
				}
			}
			
			return thisUnitype;
			
		} // end function getUnitype
		
		function getPinyinSized(thisPinyin, thisTone)
		{
			//debugLog("getPinyinSized(" + thisPinyin + "," + thisTone + ")");
			
			if (thisTone == 1)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}

			if (thisTone == 5)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}
			
			var thisPinyinArray = thisPinyin.split("");
			
			var numberCharacters = thisPinyinArray.length;
			
			// Longest is 6
			
			if (numberCharacters == 1)
			{
				return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
			}
			
			var thisPinyinSized;
			
			if (numberCharacters == 2)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[1] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					return "<span style=\"font-size:16px\">" + thisPinyin + "</span>";
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 3)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 4)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[3] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 5)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[4] + "</span>";
					return thisPinyinSized;
				}
			}

			if (numberCharacters == 6)
			{
				if (thisTone == 2)
				{
					thisPinyinSized = "<span style=\"font-size:14px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 3)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:18px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}

				if (thisTone == 4)
				{
					thisPinyinSized = "<span style=\"font-size:18px\">" + thisPinyin[0] + "</span>" + "<span style=\"font-size:17px\">" + thisPinyin[1] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[2] + "</span>" + "<span style=\"font-size:16px\">" + thisPinyin[3] + "</span>" + "<span style=\"font-size:15px\">" + thisPinyin[4] + "</span>" + "<span style=\"font-size:14px\">" + thisPinyin[5] + "</span>";
					return thisPinyinSized;
				}
			}

			
			return thisPinyin;
			
		} // end function getPinyinSized
		
		function getSyllable(thisCharacter, thisToneless)
		{
			//debugLog("getSyllable(" + thisCharacter + "," + thisToneless + ")");

			var syllables = ["木", "厂", "大", "令", "女", "卯", "非", "帀", "𢀳", "𠫔", "甘", "分", "𦚏", "己", "亼", "𡗜", "禸", "古", "舛", "尞", "畾", "方", "⺙", "俞", "𠱠", "粦", "留", "七", "韋", "付", "冡", "民", "氏", "殳", "交", "主", "皇", "曼", "旲", "业", "柬", "包", "加", "刁", "五", "釆", "弗", "尼", "凶", "者", "户", "巴", "央", "唐", "同", "來", "扁", "龹", "票", "求", "此", "录", "巨", "夗", "夆", "半", "畢", "東", "必", "它", "孚", "夫", "賏", "英", "糹", "沓", "尃", "宛", "孛", "侯", "于", "䜌", "廷", "刃", "兼", "亘", "胡", "朱", "是", "早", "少", "夬", "卜", "冋", "余", "介", "文", "卉", "不"];
			
			var syllablesPinyin = ["li", "li", "yi", "ling", "lou", "liu", "fei", "ling", "lang", "zhi", "qi", "fen", "long", "long", "yu", "liao", "li", "gu hu", "lin", "liao", "lei", "fang", "ao", "yu", "ling", "lin", "liu", "lu hu", "wei", "fu", "meng", "min", "di", "yi", "jiao", "zhu", "huang", "man", "mo", "pu", "lan", "bao pao", "jia", "deng", "wu", "fan", "fu fei", "ni", "li", "zhu", "bian", "ba", "ying yang", "tang", "tong", "lai", "bian pian", "juan quan", "piao biao", "qiu", "zi ci", "lu", "ju qu", "wan yuan", "feng", "juan quan", "bi", "dong", "bi mi", "tuo", "fu", "fu", "ying", "ying", "luan luo", "ta", "bo", "wan", "bo", "hou", "yu", "luan", "ting", "ren", "lian", "xuan", "hu", "zhu", "ti", "zhang", "sha", "jue", "pi", "qiao jiao", "tu", "jie", "wen", "fen", "pi pei"];
			
			var characterAncestors = textBetween(genealogiesData,"\n" + thisCharacter + " ","\n");
			
			var characterAncestorsArray = characterAncestors.split(",");
			
			var numberAncestors = characterAncestorsArray.length;
			
			for (var currentAncestor = 0; currentAncestor < numberAncestors; currentAncestor++)
			{
				var thisAncestor = characterAncestorsArray[currentAncestor];
				
				var syllableIndex = syllables.indexOf(thisAncestor);
				
				if (syllableIndex != -1)
				{
					var syllablePinyin = syllablesPinyin[syllableIndex];
					
					if (contains(syllablePinyin,thisToneless) == true)
					{
						var thisSyllable = "<a href=\"Charts/" + thisAncestor + ".html\" target=_blank>" + thisAncestor + "</a>";
						return thisSyllable;
					} else {
					
						var thisSyllable = "<a href=\"Charts/" + thisAncestor + ".html\" target=_blank><font style=\"color:red\">" + thisAncestor + "</font></a>";
						return thisSyllable;
						//return "";
					}
					
				}
			} // end for every ancestor
			
			return "";
		} // end function getSyllable
		
		function pad(thisText, startLength, thisLength) 
		{
			//debugLog("pad(" + thisText + "," + startLength + "," + thisLength + ")");

			for (var currentLength = startLength; currentLength < thisLength; currentLength++)
			{
				thisText = thisText + " ";
			}
			
			//debugLog(thisText);
			
			return thisText;
		} // end function pad
		
		// translateText - translate Chinese to English
		function translateText(inputText, englishText)
		{		
			//debugLog("translateText(" + inputText + "," + englishText + ")");
			
			var outputText = "";			
			var outputHtml = "";			
			
			var inputArray = inputText.split("\n");
			var englishArray = englishText.split("\n");
			
			var numberLines = inputArray.length;
			var numberEnglishLines = englishArray.length;
			
			var addChinesePlain = document.getElementById('chinesePlainCheckbox').checked;
			var addChineseSpaced = document.getElementById('chineseSpacedCheckbox').checked;
			var addChinese = document.getElementById('chineseCheckbox').checked;
			var addPinyin = document.getElementById('pinyinCheckbox').checked;
			var pinyinToneNumbers = document.getElementById('toneNumbersCheckbox').checked;
			var pinyinSize = document.getElementById('sizeCheckbox').checked;
			var addLiteral = document.getElementById('literalCheckbox').checked;
			var addEnglish = document.getElementById('englishCheckbox').checked;
			var addHex = document.getElementById('hexCheckbox').checked;
			var addUnitype = document.getElementById('unitypeCheckbox').checked;
			var addSyllables = document.getElementById('syllablesCheckbox').checked;
			var addLargeSealScript = document.getElementById('largeSealScriptCheckbox').checked;
			var addSmallSealScript = document.getElementById('smallSealScriptCheckbox').checked;
			var addOracleBones = document.getElementById('oracleBonesCheckbox').checked;
			var addBopomofo = document.getElementById('bopomofoCheckbox').checked;
			var addWadeGiles = document.getElementById('wadeGilesCheckbox').checked;
			var addSimplified = document.getElementById('simplifiedSpacedCheckbox').checked;
			var addTaiwanese = document.getElementById('taiwaneseCheckbox').checked;
			var addCantonese = document.getElementById('cantoneseCheckbox').checked;
			var monospaceText = document.getElementById('monospaceTextCheckbox').checked;
			var addHangul = document.getElementById('hangulCheckbox').checked;
			var addVietnamese = document.getElementById('vietnameseCheckbox').checked;
			var addJapanese = document.getElementById('japaneseCheckbox').checked;
			var addTang = document.getElementById('tangCheckbox').checked;
			var addPageBreaks = document.getElementById('pageBreaksCheckbox').checked;
			var hashOut = document.getElementById('hashOutCheckbox').checked;
			
			var addCommon = false;
			
			if (commonWords != "")
			{
				addCommon = true;
			}
			
			var missingWords = "";
			
			if (englishText == "")
			{
				addEnglish = false;
			}
			
			if (addSimplified == true)
			{
				var simplifiedText = document.getElementById('simplifiedSpacedTextArea').value;
			
				var simplifiedArray = simplifiedText.split("\n");
			} // end if addSimplified
			
			if (addPageBreaks == true)
			{
				var pageBreaksLine = pageBreaksTextArea.value;
			} // end if addPageBreaks
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = inputArray[currentLine];
				var englishLine = englishArray[currentLine];
				
				if (currentLine >= numberEnglishLines)
				{
					if (thisLine == "")
					{
						englishLine = "";
					} else {
						// Could show "undefined" to warn the user, but that might be more confusing. 
						englishLine = "";
					}
				}
				
				if (addSimplified == true)
				{
					var simplifiedLine = simplifiedArray[currentLine];
				} // end if addSimplified
				
				var chinesePlainLine = "";
				
				if (addChinesePlain == true)
				{
					chinesePlainLine = thisLine;
					chinesePlainLine = replaceChars(thisLine, " ", "");
				} // end if addChinesePlain

				var chineseSpacedLine = "";
				
				if (addChineseSpaced == true)
				{
					chineseSpacedLine = thisLine;
				} // end if addChineseSpaced
				
				var chineseHtml = "";
				var pinyinHtml = "";			
				var syllablesHtml = "";
				var translatedHtml = "";

				var chineseText = "";
				var pinyinText = "";			
				var translatedText = "";
				
				var simplifiedHtml = "";
				var simplifiedText = "";
				
				var wadeGilesHtml = "";
				var wadeGilesText = "";
				
				var hexHtml = "";
				var hexText = "";
				
				var unitypeHtml = "";
				var unitypeText = "";
				
				var smallSealScriptHtml = "";
				var largeSealScriptHtml = "";
				var oracleBonesHtml = "";
				
				var taiwaneseHtml = "";
				var taiwaneseText = "";
				
				var cantoneseHtml = "";
				var cantoneseText = "";
				
				var hangulHtml = "";
				var hangulText = "";

				var tangHtml = "";
				var tangText = "";

				var japaneseHtml = "";
				var japaneseText = "";

				var vietnameseHtml = "";
				var vietnameseText = "";
				

				//var thisLineWords = spacedLine.split(" ");
				
				var thisLineWords = thisLine.split(" ");
				
				if (addSimplified == true)
				{
					var thisSimplifiedWords = simplifiedLine.split(" ");
				} // end if addSimplified
				
				var numberLineWords = thisLineWords.length;
				for (var currentLineWord = 0; currentLineWord < numberLineWords; currentLineWord++)
				{
			
					var thisWord = thisLineWords[currentLineWord];
					
					var chineseHtmlWord = "";
					var pinyinHtmlWord = "";
					var syllablesHtmlWord = "";
					
					var chineseTextWord = "";
					var pinyinTextWord = "";
					var translatedTextWord = "";
					var chineseLength = 0;
					
					if (addBopomofo == true)
					{
						chineseHtmlWord = "<table><tr>";
					}
					
					if (addSimplified == true)
					{
						var simplifiedHtmlWord = "";
						var thisSimplifiedWord = thisSimplifiedWords[currentLineWord];
					} // end if addSimplified

					if (addSmallSealScript == true)
					{
						var smallSealScriptHtmlWord = "";
					} // end if addSmallSealScript

					if (addLargeSealScript == true)
					{
						var largeSealScriptHtmlWord = "";
					} // end if addLargeSealScript

					if (addOracleBones == true)
					{
						var oracleBonesHtmlWord = "";
					} // end if addOracleBones

					if (addWadeGiles == true)
					{
						var wadeGilesHtmlWord = "";
					} // end if addWadeGiles

					if (addTaiwanese == true)
					{
						var taiwaneseHtmlWord = "";
					} // end if addTaiwanese
					
					if (addCantonese == true)
					{
						var cantoneseHtmlWord = "";
					} // end if addCantonese

					if (addHangul == true)
					{
						var hangulHtmlWord = "";
					} // end if addHangul

					if (addTang == true)
					{
						var tangHtmlWord = "";
					} // end if addTang

					if (addJapanese == true)
					{
						var japaneseHtmlWord = "";
					} // end if addJapanese

					if (addVietnamese == true)
					{
						var vietnameseHtmlWord = "";
					} // end if addVietnamese

					
					if (addHex == true)
					{
						var hexHtmlWord = "";
					} // end if addHex

					if (addUnitype == true)
					{
						var unitypeHtmlWord = "";
					} // end if addUnitype
					
					if (contains(combinedDictionaryData, "\n" + thisWord + "	") == true)
					{
						var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWord + "	", "\n");
						
						var thisDictionaryLineArray = thisDictionaryLine.split("	");
						
						var lineLength = thisDictionaryLineArray.length;
						
						var thisDefinition = "";
						var thisPinyin = "";
						var thisToneless = "";
						var thisTone = "";
						
						thisDefinition = thisDictionaryLineArray[0];

						if (lineLength >= 1)
						{
							thisPinyin = thisDictionaryLineArray[1];
						}
						
						if (lineLength >= 2)
						{
							thisToneless = thisDictionaryLineArray[2];
						}
						
						if (lineLength >= 3)
						{
							thisTone = thisDictionaryLineArray[3];
							
							if (thisTone == undefined)
							{
								thisTone = "";
							}
						}
						
						//var thisPinyin = textBetween(thisCharacterLine, "start", "	");
						//var thisDefinitionTone = textBetween(thisCharacterLine, "	", "end");
						//var thisDefinition = textBetween(thisDefinitionTone, "start", "	");
						//var thisTone = textBetween(thisDefinitionTone, "	", "end");
						
						var thisWordLength = thisWord.length;
						
						var thisPinyinArray = [];
						
						if (contains(thisPinyin," ") == true)
						{
							thisPinyinArray = thisPinyin.split(" ");
						} else {
							thisPinyinArray = [thisPinyin];
						}
						
						var thisPinyinLength = thisPinyinArray.length;
						var thisToneLength = thisTone.length;
						
						if ((addSyllables == true) || (addWadeGiles == true))
						{
							var thisTonelessArray = thisToneless.split(" ");
							var thisTonelessLength = thisTonelessArray.length;
						} // only use toneless when showing syllables
						
						var pinyinWord = "";
											
						for (var currentWordCharacter = 0; currentWordCharacter < thisWordLength; currentWordCharacter++)
						{
							var thisCharacterChinese = thisWord[currentWordCharacter];
							
							var thisCharacterPinyin = "";
							
							if (currentWordCharacter < thisPinyinLength)
							{
								thisCharacterPinyin = thisPinyinArray[currentWordCharacter];
								
								if (pinyinToneNumbers == true)
								{
									thisCharacterPinyin = toneMarksToNumbers(thisCharacterPinyin);
								} // if we should convert to to numbers
								
							} // if there is a pinyin word
							
							if ((addSyllables == true) || (addWadeGiles == true))
							{
								var thisCharacterToneless = "";
							
								if (currentWordCharacter < thisTonelessLength)
								{
									thisCharacterToneless = thisTonelessArray[currentWordCharacter];
								}
							} // end if addSyllables then get toneless
							
							
							var thisCharacterTone = 1;
							
							if (currentWordCharacter < thisToneLength)
							{
								thisCharacterTone = thisTone[currentWordCharacter];
								
								if (thisCharacterTone < 1)
								{
									thisCharacterTone = 1;
								}
							} // end set the tone
							
							var chineseCharacterHtml = "<div class=\"chinese_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
							
							if (hashOut == true)
							{
								if (contains(commonWords,thisCharacterChinese) == false)
								{
									chineseCharacterHtml = "<div class=\"chinese_" + thisCharacterTone + "\">" + "#</div>";
								}
							}
							
							if (addSimplified == true)
							{
								var thisCharacterSimplified = thisSimplifiedWord[currentWordCharacter];
								var simplifiedCharacterHtml = "<div class=\"chinese_" + thisCharacterTone + "\">" + thisCharacterSimplified + "</div>";
								
								simplifiedHtmlWord = simplifiedHtmlWord + simplifiedCharacterHtml;
							}
							
							if (addSmallSealScript == true)
							{
								var smallSealScriptCharacterHtml = "<div class=\"smallSealScript_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								smallSealScriptHtmlWord = smallSealScriptHtmlWord + smallSealScriptCharacterHtml;
							} // end if addSmallSealScript

							if (addLargeSealScript == true)
							{
								var largeSealScriptCharacterHtml = "<div class=\"largeSealScript_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								largeSealScriptHtmlWord = largeSealScriptHtmlWord + largeSealScriptCharacterHtml;
							} // end if addLargeSealScript


							if (addOracleBones == true)
							{
								var oracleBonesCharacterHtml = "<div class=\"oracleBones_" + thisCharacterTone + "\">" + thisCharacterChinese + "</div>";
								
								oracleBonesHtmlWord = oracleBonesHtmlWord + oracleBonesCharacterHtml;
							} // end if addOracleBones

														
							if (addBopomofo == true)
							{
								var thisBopomofo = getBopomofo(thisCharacterChinese, thisCharacterTone);
								
								chineseHtmlWord = chineseHtmlWord + "<td>" + "<table><tr><td>" + chineseCharacterHtml + "</td><td>" + thisBopomofo + "</td></tr></table>" + "</td>";
								
							} else {
								
								chineseHtmlWord = chineseHtmlWord + chineseCharacterHtml;
								
							} // end if addBopomofo
							
							if (pinyinSize == true)
							{
								var pinyinSized = getPinyinSized(thisCharacterPinyin, thisCharacterTone);
								pinyinHtmlWord = pinyinHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + pinyinSized + "</div> ";
								
							} else {
								pinyinHtmlWord = pinyinHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisCharacterPinyin + "</div> ";
							}
														
							if (addWadeGiles == true)
							{
								var thisWadeGiles = getWadeGiles(thisCharacterToneless, thisCharacterTone);
								
								wadeGilesHtmlWord = wadeGilesHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisWadeGiles + "</div> ";
								
								wadeGilesText = wadeGilesText + thisWadeGiles + " ";
							} // end if addWadeGiles

							if (addHex == true)
							{
								var thisHex = getHex(thisCharacterChinese);
								
								hexHtmlWord = hexHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisHex + "</div> ";
								
								hexText = hexText + thisHex + " ";
							} // end if addHex

							if (addUnitype == true)
							{
								var thisUnitype = getUnitype(thisCharacterChinese);
								
								unitypeHtmlWord = unitypeHtmlWord + "<div class=\"pinyin_" + thisCharacterTone + "\">" + thisUnitype + "</div> ";
								
								unitypeText = unitypeText + thisUnitype + " ";
							} // end if addUnitype

							
							if (addSyllables == true)
							{
								var thisCharacterSyllable = getSyllable(thisCharacterChinese, thisCharacterToneless);
								
								syllablesHtmlWord = syllablesHtmlWord + thisCharacterSyllable;
							} // end if addSyllables
							
							chineseTextWord = chineseTextWord + thisCharacterChinese;
							pinyinWord = pinyinWord + thisCharacterPinyin + " ";
							
						} // end for every character in the word
						
						if (addTaiwanese == true)
						{
							var thisTaiwaneseWord = getTaiwanese(thisWord, pinyinWord);
							
							var thisTaiwaneseWordArray = [];
							
							if (thisTaiwaneseWord != "")
							{
								thisTaiwaneseWordArray = thisTaiwaneseWord.split(" ");
							}
							
							taiwaneseHtmlWord = getTaiwaneseHtml(thisWord, thisTaiwaneseWord);
							
							taiwaneseText = taiwaneseText + thisTaiwaneseWord + " ";
						} // end if addTaiwanese
						
						if (addCantonese == true)
						{
							var thisCantoneseWord = getCantonese(thisWord, pinyinWord);
							
							var thisCantoneseWordArray = [];
							
							if (thisCantoneseWord != "")
							{
								thisCantoneseWordArray = thisCantoneseWord.split(" ");
							}
							
							cantoneseHtmlWord = getCantoneseHtml(thisWord, thisCantoneseWord);
							
							cantoneseText = cantoneseText + thisCantoneseWord + " ";
						} // end if addCantonese
						
						if (addHangul == true)
						{
							var thisHangulWord = getHangul(thisWord);
							
							var thisHangulWordArray = [];
							
							if (thisHangulWord != "")
							{
								thisHangulWordArray = thisHangulWord.split(" ");
							}
							
							hangulHtmlWord = getHangulHtml(thisHangulWord);
							
							hangulText = hangulText + thisHangulWord + " ";
							
						} // end if addHangul

						if (addTang == true)
						{
							var thisTangWord = getTang(thisWord, pinyinWord);
							
							var thisTangWordArray = [];
							
							if (thisTangWord != "")
							{
								thisTangWordArray = thisTangWord.split(" ");
							}
							
							tangHtmlWord = getTangHtml(thisTangWord);
							
							tangText = tangText + thisTangWord + " ";
							
						} // end if addTang

						if (addJapanese == true)
						{
							var thisJapaneseWord = getJapanese(thisWord, pinyinWord);
							
							var thisJapaneseWordArray = [];
							
							if (thisJapaneseWord != "")
							{
								thisJapaneseWordArray = thisJapaneseWord.split(" ");
							}
							
							japaneseHtmlWord = getJapaneseHtml(thisJapaneseWord);
							
							japaneseText = japaneseText + thisJapaneseWord + " ";
							
						} // end if addJapanese

						if (addVietnamese == true)
						{
							var thisVietnameseWord = getVietnamese(thisWord, pinyinWord);
							
							var thisVietnameseWordArray = [];
							
							if (thisVietnameseWord != "")
							{
								thisVietnameseWordArray = thisVietnameseWord.split(" ");
							}
							
							vietnameseHtmlWord = getVietnameseHtml(thisVietnameseWord);
							
							vietnameseText = vietnameseText + thisVietnameseWord + " ";
							
						} // end if addVietnamese
						
						
						translatedHtml = translatedHtml + " " + "<div class=\"literal\">" + thisDefinition + "</div>";
						
						chineseLength = chineseTextWord.length * 2;
						
						//pinyinText = pinyinText + pinyinWord + " ";
						//pinyinText = pinyinText + pinyinWord;
						pinyinTextWord = pinyinWord;
						
						//translatedText = translatedText + thisDefinition + " ";
						translatedTextWord = thisDefinition;

						//alert(thisTone);
						if (addBopomofo == true)
						{
							chineseHtmlWord = chineseHtmlWord + "</tr></table>";
						}
												
						chineseHtml = chineseHtml + chineseHtmlWord;
						
						if (addSmallSealScript == true)
						{
							smallSealScriptHtml = smallSealScriptHtml + smallSealScriptHtmlWord;
						} // end if addSmallSealScript

						if (addLargeSealScript == true)
						{
							largeSealScriptHtml = largeSealScriptHtml + largeSealScriptHtmlWord;
						} // end if addLargeSealScript

						if (addOracleBones == true)
						{
							oracleBonesHtml = oracleBonesHtml + oracleBonesHtmlWord;
						} // end if addOracleBones
						
						if (addCommon == true)
						{
							if (thisWord != "")
							{							
								if (contains(commonWords,thisWord) == true)
								{
									pinyinHtmlWord = "<b>" + pinyinHtmlWord + "</b>";
								}
							} // end if the word is not blank
						} // end if addCommon
					} else {
						
						// If the word is not blank
						if (thisWord != "")
						{
					
							if (isChineseString(thisWord) == true)
							{
								appendToFile("missingWords.txt", thisWord);
								missingWords = missingWords + thisWord + "\n";
							}
							
							chineseHtml = chineseHtml + "<div class=\"englishInChinese\">" + thisWord + "</div>";
							pinyinHtmlWord = pinyinHtmlWord + "<div class=\"englishInChinese\">" + thisWord + "</div>";
							translatedHtml = translatedHtml + thisWord;

							chineseTextWord = thisWord;
							pinyinTextWord = thisWord;
							translatedTextWord = thisWord;
							
							chineseLength = thisWord.length;
							
							if (addSimplified == true)
							{
								simplifiedHtmlWord = thisSimplifiedWord;
							} // end if addSimplified
							
							if (addWadeGiles == true)
							{
								wadeGilesHtmlWord = wadeGilesHtmlWord + thisWord;
							} // end if addWadeGiles
							
							if (addTaiwanese == true)
							{
								taiwaneseHtmlWord = taiwaneseHtmlWord + thisWord;
							} // end if addTaiwanese
							
							if (addCantonese == true)
							{
								cantoneseHtmlWord = cantoneseHtmlWord + thisWord;
							} // end if addCantonese

							if (addHangul == true)
							{
								hangulHtmlWord = hangulHtmlWord + thisWord;
							} // end if addHangul

							if (addTang == true)
							{
								tangHtmlWord = tangHtmlWord + thisWord;
							} // end if addTang

							if (addJapanese == true)
							{
								japaneseHtmlWord = japaneseHtmlWord + thisWord;
							} // end if addJapanese

							if (addVietnamese == true)
							{
								vietnameseHtmlWord = vietnameseHtmlWord + thisWord;
							} // end if addVietnamese

							
							if (addHex == true)
							{
								var thisWordHex = getHex(thisWord);
								hexHtmlWord = hexHtmlWord + thisWordHex;
								hexText = hexText + thisWordHex + " ";
							} // end if addHex

							if (addUnitype == true)
							{
								var thisWordUnitype = getUnitype(thisWord);
								unitypeHtmlWord = unitypeHtmlWord + thisWordUnitype;
								unitypeText = unitypeText + thisWordUnitype + " ";
							} // end if addHex

							if (addSmallSealScript == true)
							{
								smallSealScriptHtml = smallSealScriptHtml + thisWord;
							} // end if addSmallSealScript

							if (addLargeSealScript == true)
							{
								largeSealScriptHtml = largeSealScriptHtml + thisWord;
							} // end if addLargeSealScript

							if (addOracleBones == true)
							{
								oracleBonesHtml = oracleBonesHtml + thisWord;
							} // end if addOracleBones

						} // end if the word is not blank

					} // end if the dictionary contains the word already
					
					
					// There is a space between each word
					chineseHtml = chineseHtml + "</td><td>";
					pinyinHtml = pinyinHtml + pinyinHtmlWord + "</td><td>";						
					translatedHtml = translatedHtml + "</td><td>";						
					
					if (addSyllables == true)
					{
						syllablesHtml = syllablesHtml + syllablesHtmlWord + "</td><td>";						
					}
					
					if (addSimplified == true)
					{
						simplifiedHtml = simplifiedHtml + simplifiedHtmlWord+ "</td><td>";
					} // end if addSimplified
					
					if (addWadeGiles == true)
					{
						wadeGilesHtml = wadeGilesHtml + wadeGilesHtmlWord+ "</td><td>";
						wadeGilesText = wadeGilesText + "  ";
					} // end if addWadeGiles

					if (addTaiwanese == true)
					{
						taiwaneseHtml = taiwaneseHtml + taiwaneseHtmlWord+ "</td><td>";
						taiwaneseText = taiwaneseText + "  ";
					} // end if addTaiwanese
					
					if (addCantonese == true)
					{
						cantoneseHtml = cantoneseHtml + cantoneseHtmlWord+ "</td><td>";
						cantoneseText = cantoneseText + "  ";
					} // end if addCantonese

					if (addHangul == true)
					{
						hangulHtml = hangulHtml + hangulHtmlWord+ "</td><td>";
						hangulText = hangulText + "  ";
					} // end if addHangul

					if (addTang == true)
					{
						tangHtml = tangHtml + tangHtmlWord+ "</td><td>";
						tangText = tangText + "  ";
					} // end if addTang

					if (addJapanese == true)
					{
						japaneseHtml = japaneseHtml + japaneseHtmlWord+ "</td><td>";
						japaneseText = japaneseText + "  ";
					} // end if addJapanese

					if (addVietnamese == true)
					{
						vietnameseHtml = vietnameseHtml + vietnameseHtmlWord+ "</td><td>";
						vietnameseText = vietnameseText + "  ";
					} // end if addVietnamese
					
					if (addHex == true)
					{
						hexHtml = hexHtml + hexHtmlWord+ "</td><td>";
					} // end if addHex

					if (addUnitype == true)
					{
						unitypeHtml = unitypeHtml + unitypeHtmlWord+ "</td><td>";
					} // end if addUnitype

					if (addSmallSealScript == true)
					{
						smallSealScriptHtml = smallSealScriptHtml + "</td><td>";
					} // end if addSmallSealScript

					if (addLargeSealScript == true)
					{
						largeSealScriptHtml = largeSealScriptHtml + "</td><td>";
					} // end if addLargeSealScript

					if (addOracleBones == true)
					{
						oracleBonesHtml = oracleBonesHtml + "</td><td>";
					} // end if addOracleBones
					
					//pinyinTextWord = pinyinTextWord + " ";
					//translatedTextWord = translatedTextWord + " ";
					
					if (monospaceText == true)
					{
						//var chineseLength = chineseTextWord.length * 2;
						//var chineseLength = chineseTextWord.length;
						var pinyinLength = pinyinTextWord.length;
						var translatedLength = translatedTextWord.length;
						
						//debugLog("thisWord" + thisWord);
						
						//var chineseUnspaced = replaceChars(chineseTextWord, " ", "");
						//var chineseUnspacedLength = chineseUnspaced.length;
						//var chineseSpacesLength = chineseLength - chineseUnspacedLength;
						// Because of Unicode weirdness, Chinese characters take up 2x monospaced size
						//chineseUnspacedLength = chineseUnspacedLength * 2;
						//chineseLength = chineseUnspacedLength + chineseSpacesLength;
						
						
						var longestLength = chineseLength;

						if (pinyinLength > longestLength)
						{
							longestLength = pinyinLength;
						}

						if (translatedLength > longestLength)
						{
							longestLength = translatedLength;
						}
						
						longestLength = longestLength + 1;
						
						chineseTextWord = pad(chineseTextWord, chineseLength, longestLength);
						pinyinTextWord = pad(pinyinTextWord, pinyinLength, longestLength);
						translatedTextWord = pad(translatedTextWord, translatedLength, longestLength);
						
						chineseText = chineseText + chineseTextWord;
						pinyinText = pinyinText + pinyinTextWord;
						translatedText = translatedText + translatedTextWord;

					} else {
						chineseText = chineseText + chineseTextWord + " ";
						pinyinText = pinyinText + pinyinTextWord + "	";
						translatedText = translatedText + translatedTextWord + "	";
					}

					
				} // end for every word
				
				
				/* Lines to text */
				
				if (addChinesePlain == true)
				{
					outputText = outputText + chinesePlainLine + "\n";
				}

				if (addChineseSpaced == true)
				{
					outputText = outputText + chineseSpacedLine + "\n";
				}

				if (addSimplified == true)
				{
					outputText = outputText + simplifiedLine + "\n";
				} // end if addSimplified

				if (addHangul == true)
				{
					outputText = outputText + hangulText + "\n";
				} // end if addHangul
				
				if (addChinese == true)
				{
					outputText = outputText + chineseText + "\n";
				}
				
				if (addPinyin == true)
				{
					outputText = outputText + pinyinText + "\n";
				}
				
				if (addTaiwanese == true)
				{
					outputText = outputText + taiwaneseText + "\n";
				} // end if addTaiwanese
				
				if (addCantonese == true)
				{
					outputText = outputText + cantoneseText + "\n";
				} // end if addCantonese
				
				if (addTang == true)
				{
					outputText = outputText + tangText + "\n";
				} // end if addTang

				if (addJapanese == true)
				{
					outputText = outputText + japaneseText + "\n";
				} // end if addJapanese

				if (addVietnamese == true)
				{
					outputText = outputText + vietnameseText + "\n";
				} // end if addVietnamese
				
				if (addWadeGiles == true)
				{
					outputText = outputText + wadeGilesText + "\n";
				} // end if addWadeGiles
				
				if (addHex == true)
				{
					outputText = outputText + hexText + "\n";
				} // end if addHex

				if (addUnitype == true)
				{
					outputText = outputText + unitypeText + "\n";
				} // end if adUnitype

				
				if (addLiteral == true)
				{
					outputText = outputText + translatedText + "\n";
				}
				
				if (addEnglish == true)
				{
					outputText = outputText + englishLine + "\n";
				}
				
				outputText = outputText + "\n";
				
				
				/* Lines to HTML */
				
				outputHtml = outputHtml + "<p>";
				
				if (addChinesePlain == true)
				{
					outputHtml = outputHtml + "<div class=\"chinesePlain\">" + chinesePlainLine + "</div>";
				}

				if (addChineseSpaced == true)
				{
					outputHtml = outputHtml + "<div class=\"chineseSpaced\">" + chineseSpacedLine + "</div>";
				}
				
				outputHtml = outputHtml + "<table>";
				
				if (addOracleBones == true)
				{
					outputHtml = outputHtml + "<tr><td>" + oracleBonesHtml + "</td></tr>";
				} // end if addOracleBones
				
				if (addLargeSealScript == true)
				{
					outputHtml = outputHtml + "<tr><td>" + largeSealScriptHtml + "</td></tr>";
				} // end if addLargeSealScript

				if (addSmallSealScript == true)
				{
					outputHtml = outputHtml + "<tr><td>" + smallSealScriptHtml + "</td></tr>";
				} // end if addSealScript

				if (addChinese == true)
				{
					outputHtml = outputHtml + "<tr><td>" + chineseHtml + "</td></tr>";
				}

				if (addSimplified == true)
				{
					outputHtml = outputHtml + "<tr><td>" + simplifiedHtml + "</td></tr>";
				} // end if addSimplified

				if (addHangul ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + hangulHtml + "</td></tr>";
				}
				
				if (addSyllables == true)
				{
					outputHtml = outputHtml + "<tr><td>" + syllablesHtml + "</td></tr>";
				} // end if addSyllables
								
				if (addPinyin == true)
				{
					outputHtml = outputHtml + "<tr><td>" + pinyinHtml + "</td></tr>";
				}

				if (addWadeGiles == true)
				{
					outputHtml = outputHtml + "<tr><td>" + wadeGilesHtml + "</td></tr>";
				} // end if addWadeGiles

				if (addTaiwanese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + taiwaneseHtml + "</td></tr>";
				}
				
				if (addCantonese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + cantoneseHtml + "</td></tr>";
				}

				if (addTang ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + tangHtml + "</td></tr>";
				}

				if (addJapanese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + japaneseHtml + "</td></tr>";
				}

				if (addVietnamese ==  true)
				{
					outputHtml = outputHtml + "<tr><td>" + vietnameseHtml + "</td></tr>";
				}

				if (addHex == true)
				{
					outputHtml = outputHtml + "<tr><td>" + hexHtml + "</td></tr>";
				} // end if addHex

				if (addUnitype == true)
				{
					outputHtml = outputHtml + "<tr><td>" + unitypeHtml + "</td></tr>";
				} // end if addUnitype
				
				if (addLiteral == true)
				{
					outputHtml = outputHtml + "<tr><td>" + translatedHtml + "</td></tr>";
				} // end if addLiteral

				outputHtml = outputHtml + "</table>";

				if (addEnglish == true)
				{
					outputHtml = outputHtml + "<div class=\"english\">" + englishLine + "</div>";
				} // end if addEnglish
				
				outputHtml = outputHtml + "</p>";
				
				if (addPageBreaks == true)
				{
					if ((currentLine % pageBreaksLine) == (pageBreaksLine - 1))
					{
						outputHtml = outputHtml + "<br></br>" + "<br></br>";
					}
				} // end if addPageBreaks
				
			} // end for every line
			
			showMissingWords(missingWords);
			
			return [outputHtml, outputText];
			
		} // end function translateText

		// translateInterface - Read values from the GUI, set them, and do a translation
		function translateInterface()
		{
			//debugLog("translateInterface");
		
			var inputText = document.getElementById("chineseSpacedTextArea").value;
			
			if (inputText == "")
			{
				inputText = document.getElementById("chineseTextArea").value;
			}
			
			var englishText = document.getElementById("englishTextArea").value;
						
			var translationOutput = translateText(inputText, englishText);
			
			outputHtml = translationOutput[0];
			outputText = translationOutput[1];			
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			document.getElementById("outputTextArea").value = outputText;
			
			if (commonWords != "")
			{
				//var addCommon = true;
				
				commonStatistics();
				
			} // end if we should count common words
			
		} // end function translateInterface

		function translateHtml()
		{
			//debugLog("translateHtml");

			translateInterface();
			
			document.getElementById("inputTable").hidden = true;
			document.getElementById("textTable").hidden = true;
		} // end function translateHtml
				
		function deradicalize(thisText)
		{
			//debugLog("deradicalize(" + thisText + ")");

			var radicalLines = radicals.split("\n");
			var numberLines = radicalLines.length;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine = currentLine + 1)
			{
				var thisLine = radicalLines[currentLine];
				
				var thisLineArray = thisLine.split(" ");
				
				var thisRadical = thisLineArray[0];
				var thisIdeograph = thisLineArray[1];
				
				//thisText = thisText.replace(/thisRadical/g, thisIdeograph);
				//thisText = thisText.split(thisRadical).join(thisIdeograph);
				thisText = replaceChars(thisText, thisRadical, thisIdeograph)

			} // end for every radical
			
			return thisText;
			
		} // end function deradicalize
		
		function deradicalizeButtonClicked()
		{
			//debugLog("deradicalizeButtonClicked");

			var thisText = document.getElementById("chineseTextArea").value;
			
			var deradicalisedChinese = deradicalize(thisText);
			
			document.getElementById("chineseTextArea").value = deradicalisedChinese;
			document.getElementById("outputTextArea").value = deradicalisedChinese;
			
		} // end function deradicalizeButtonClicked
		
		function translateBilingual()
		{
			//debugLog("translateBilingual");
			
			var inputText = document.getElementById("chineseSpacedTextArea").value;
			
			if (inputText == "")
			{
				inputText = document.getElementById("chineseTextArea").value;
			}
			
			var inputLines = inputText.split("\n");
			
			var numberLines = inputLines.length;
			
			var outputHtml = "";
			var outputText = "";
			
			var lastEnglishLine = "";

			for (var currentLine = 0; currentLine < numberLines; currentLine = currentLine + 1)
			{
				var thisLine = inputLines[currentLine];
				
				var thisLineCharacters = thisLine.split("");
				var numberCharacters = thisLineCharacters.length;
				
				var lineHasChinese = false;
				
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCharacter = thisLineCharacters[currentCharacter];
					
					if (isChinese(thisCharacter))
					{
						lineHasChinese = true;
						
						// Exit the loop
						currentCharacter = numberCharacters;
					} // end if the character is Chinese
				} // end for every character on the line
				
				if (lineHasChinese == true)
				{
					var translationOutput = translateText(thisLine, lastEnglishLine);
					
					outputHtml = outputHtml + "\n" + translationOutput[0];
					outputText = outputText + "\n" + translationOutput[1];			
					
					lastEnglishLine = "";
					
				} else {
					
					if (thisLine == "")
					{
						outputHtml = outputHtml + "\n" + "<br></br><br></br>";
						outputText = outputText + "\n\n";
					}
					
					if (lastEnglishLine == "")
					{
						lastEnglishLine = thisLine;
					} else {
						outputHtml = outputHtml + "\n" + "<p>" + lastEnglishLine + "</p>";
						outputText = outputText + "\n" + lastEnglishLine;
						
						lastEnglishLine = thisLine;
					}
				} // end if the line has a Chinese character
				
			} // end for every line
			
			outputText = replaceChars(outputText, "\n\n", "\n");
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			document.getElementById("outputTextArea").value = outputText;
			
		} // end function translateBilingual 

		function clearInterface()
		{
			//debugLog("clearInterface");

			document.getElementById("chineseTextArea").value = "";
			document.getElementById("chineseSpacedTextArea").value = "";
			document.getElementById("englishTextArea").value = "";
			document.getElementById("outputHtml").innerHTML = "";
			document.getElementById("outputTextArea").value = "";
			document.getElementById("filenameTextArea").value = "";
		} // end function clearInterface
	
		function interfaceLoaded()
		{
			//debugLog("interfaceLoaded");

			var chineseText = document.getElementById("chineseTextArea").value;
			//var englishText = document.getElementById("englishTextArea").value;
			var filenameText = document.getElementById("filenameTextArea").value;
			
			if (chineseText == "")
			{
				return false;
			}

			//if (englishText == "")
			//{
			//	return false;
			//}

			if (filenameText == "")
			{
				return false;
			}			
			
			return true;
			
		} // end function clearInterface
	
		function translateCnlt()
		{
			//debugLog("translateCnlt");

			var translationOutput = translateText(chineseText, nltText);
			
			outputHtml = translationOutput[0];
			outputText = translationOutput[1];			
			
			document.getElementById("outputHtml").innerHTML = outputHtml;
			
			return outputHtml;
			
		} // end function translateFiles

		function getOutputHtml()
		{
			//debugLog("getOutputHtml");

			return document.getElementById("outputHtml").innerHTML;
		} // end function getOutputHtml
		
		function setFilename(thisFilename)
		{
			//debugLog("setFilename(" + thisFilename + ")");

			document.getElementById("filenameTextArea").value = thisFilename;
		} // end function setFilename
		
		function saveHtml()
		{
			//debugLog("saveHtml");

			var filename = document.getElementById("filenameTextArea").value;
			var thisString = document.getElementById("outputHtml").innerHTML;
			
			var htmlHeaders = "<!DOCTYPE html>\n<html>\n  <head>\n	<meta charset=\"utf-8\" />\n        <style>\n\n@font-face {\n    font-family: \"Charcoal CY\";\n    src: url(\"fonts/Charcoal.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Virtue\";\n    src: url(\"fonts/virtue.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"SimSun\";\n    src: url(\"fonts/SimSun.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Jhenghei\";\n    src: url(\"fonts/MicrosoftJhengHeiRegular.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"PingfangLocal\";\n    src: local(\"PingFang-TC-Regular\");\n}\n\n@font-face {\n    font-family: \"Pingfang\";\n    src: url(\"fonts/PingFang1.ttf\") format(\"truetype\");\n}\n\n      body {\n        font-family: Tahoma, Geneva, sans-serif;\n      }\n      \n      table td {\n      white-space: nowrap;\n      }\n		\n	a:hover, a:visited, a:link, a:active\n	{\n		color:#000000;\n	    text-decoration: none;\n	}\n		\n      .chinese_1 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .chinese_2 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_3 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_4 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_5 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_6 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_7 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n      \n      .chinese_8 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n      .pinyin_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .pinyin_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\ndisplay:inline;\n      }\n\n      .pinyin_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\ndisplay:inline;\n      }\n\n      .pinyin_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .pinyin_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .taiwanese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#787878;\n		display:inline;\n      }\n\n      .taiwanese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .taiwanese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .taiwanese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#505050;\ndisplay:inline;\n      }\n\n      .taiwanese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .taiwanese_7 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n      \n      .taiwanese_8 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#929292;\ndisplay:inline;\n      }\n\n      .cantonese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#929292;\n		display:inline;\n      }\n\n      .cantonese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#FF8080;\ndisplay:inline;\n      }\n\n      .cantonese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#787878;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .cantonese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .cantonese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .cantonese_6 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .hangul {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 26px;\n		display:inline;\n      }\n\n      .tang {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .japanese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .vietnamese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .englishInChinese {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .literal {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .english {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n\n		.DefaultButtonOuter\n		{\n			border: 2px solid black ;\n			border-radius: 8px;\n			width: 96px;\n			height: 26px;\n			text-align: center;\n			\n			/*background-color: #99999a;*/\n			background: #99999a; /* For browsers that do not support gradients */\n			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */\n			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */\n			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */\n			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */\n		}\n\n		.ButtonInner\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 88px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: \"Charcoal CY\", \"Virtue\", Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n		\n		.ButtonInner:active\n		{\n		    background:#666666;\n		    color: #ffffff;\n		}\n\n		.key\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 18px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n\n\n			#matrix {\n				background: black;\n				float: center;\n			}\n\n			#matrix td {\n			    padding: 7px;\n    			margin: 0px;\n    			float: center;\n				background: black;\n				font: 54px arial;\n				\n				height: 80px;\n			}\n\n			#matrix tr {\n				height: 80px;\n			}\n\n\n			#matrix p {\n			    opacity: 0;\n			    margin-top: -25px;\n			    text-align: center;\n\n				height: 80px;\n\n			    -webkit-transition: margin-top 2s ease-in;\n			    -moz-transition: margin-top 2s ease-in;\n			    -o-transition: margin-top 2s ease-in;\n			    -ms-transition: margin-top 2s ease-in;\n			    transition: margin-top 2s ease-in;\n			}\n			\n			#matrix p.load {\n			    opacity: 1;\n			    margin-top: 25px;\n			}\n\n     .dialogWithDropShadow\n     {\n         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);\n         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); \n     }\n\n@font-face {\n    font-family: \"SmallSealScript\";\n    src: url(\"fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf\") format(\"truetype\");\n}\n\n      .smallSealScript_1 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .smallSealScript_2 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_3 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_4 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n@font-face {\n    font-family: \"LargeSealScript\";\n    src: url(\"fonts/JDFZHUANF.ttf\") format(\"truetype\");\n}\n\n      .largeSealScript_1 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .largeSealScript_2 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_3 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_4 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n@font-face {\n    font-family: \"OracleBones\";\n    src: url(\"fonts/bnujgw.ttf\") format(\"truetype\");\n}\n\n      .oracleBones_1 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .oracleBones_2 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_3 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_4 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n    </style>\n\n  </head>\n  <body>\n	";
			
			var htmlFooters = "\n  </body>\n</html>\n";
			
			var thisHtml = htmlHeaders + thisString + htmlFooters;
			
			writeToFile(filename, thisHtml);
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == true)
			{
				var thisUrl = "https://github.com/peterburk/pingxing/blob/master/" + filename;
				window.open(thisUrl,'_blank');
			}
		} // end function saveHtml
		
		function saveText()
		{
			//debugLog("saveText");

			var filename = document.getElementById("filenameTextArea").value;
			var thisString = document.getElementById("outputTextArea").value;
			
			writeToFile(filename, thisString);

	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == true)
			{
				var thisUrl = "https://github.com/peterburk/pingxing/blob/master/" + filename;
				window.open(thisUrl,'_blank');
			}

		} // end function saveText
		
		// To do: wordSpaceAdditive not working
		function wordSpaceAdditive(thisChinese)
		{
			//debugLog("wordSpace(" + thisChinese + ")");
			
			var breakMissingWords = document.getElementById('breakMissingWordsCheckbox').checked;
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var spacedChineseLine = "";
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				/*
				if (numberCharacters >= 1)
				{
					
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				*/
				
				// Skip all-English lines
				//if (lineIsEnglish == true)
				//{
				//	spacedChinese = spacedChinese + thisChineseLine + "\n";
				//} else {
				
				var lastCharacter = 0;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisWord = "";
				
					var wordFound = false;
					
					for (var wordLength = 2; wordLength <= 5; wordLength++)
					{
				
						lastCharacter = currentCharacter + wordLength;
						
						if (lastCharacter > numberCharacters)
						{
							lastCharacter = numberCharacters;
						}
						
						thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
						var thisCharacter = thisChineseLine[currentCharacter];

						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							//spacedChineseLine = spacedChineseLine + thisCharacter;
						
							//lastWasNotChinese = true;
							
							// Move the character along in the string
							//currentCharacter = currentCharacter + 1;
							
							wordFound == false;
							
							currentCharacter = currentCharacter - 1;

							// Exit the loop cleanly
							wordLength = 10;
							
						} else {

							//lastWasNotChinese = false;
							
							var inDictionary = false;
							
							if (breakMissingWords == false)
							{
								inDictionary = contains(combinedDictionaryData, thisWord + "	");
							} else {
								inDictionary = contains(combinedDictionaryData, "\n" + thisWord + "	");
							}
							
							//if (contains(longWords, " " + thisWord) == true)
							if (inDictionary == true)
							{
								// Move the character along in the string
								currentCharacter = currentCharacter + wordLength - 1;
							
								wordFound = true;
						
								// Exit the loop cleanly
								//wordLength = 10;
							} else {
								
								lastCharacter = lastCharacter - 1;

								// Exit the loop cleanly
								wordLength = 10;

							} // end if the character is not Chinese
							
						} // if the word exists
					
					} // end for every word length
										
					thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
					
					spacedChineseLine = spacedChineseLine + thisWord + " ";
								
				
				} // end for every character
				
				spacedChinese = spacedChinese + spacedChineseLine + "\n";
				//} // end if the line is English
				
			} // end for every line
			
			
			var spacedLine = "";
		   
			var numberLineCharacters = spacedChinese.length;
		   
			// Add spaces for punctuation
			for (var currentLineCharacter = 0; currentLineCharacter < numberLineCharacters; currentLineCharacter++)
			{
				var thisLineCharacter = spacedChinese[currentLineCharacter];
			   
				if (isChinese(thisLineCharacter) == true)
				{
					spacedLine = spacedLine + thisLineCharacter;
				} else {
					if (isEnglish(thisLineCharacter) == true)
					{
						spacedLine = spacedLine + thisLineCharacter;
					} else {
						spacedLine = spacedLine + thisLineCharacter + " ";
					}
				}
			   
			} // end add spaces after every non-Chinese character
			
			return spacedLine;
			
		} // end function wordSpaceAdditive
		
		function wordSpace(thisChinese)
		{
			//debugLog("wordSpace(" + thisChinese + ")");
			
			var breakMissingWords = document.getElementById('breakMissingWordsCheckbox').checked;
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var spacedChineseLine = "";
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				/*
				if (numberCharacters >= 1)
				{
					
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				*/
				
				// Skip all-English lines
				//if (lineIsEnglish == true)
				//{
				//	spacedChinese = spacedChinese + thisChineseLine + "\n";
				//} else {
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisWord = "";
				
					var wordFound = false;
					
					for (var wordLength = 5; wordLength >= 2; wordLength--)
					{
				
						var lastCharacter = currentCharacter + wordLength;
						
						if (lastCharacter > numberCharacters)
						{
							lastCharacter = numberCharacters;
						}
						
						thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
						var thisCharacter = thisChineseLine[currentCharacter];

						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							//spacedChineseLine = spacedChineseLine + thisCharacter;
						
							//lastWasNotChinese = true;
							
							// Move the character along in the string
							//currentCharacter = currentCharacter + 1;
							
							wordFound == false;
							
						} else {

							//lastWasNotChinese = false;
							
							var inDictionary = false;
							
							if (breakMissingWords == false)
							{
								inDictionary = contains(combinedDictionaryData, thisWord + "	");
							} else {
								inDictionary = contains(combinedDictionaryData, "\n" + thisWord + "	");
							}
							
							//if (contains(longWords, " " + thisWord) == true)
							if (inDictionary == true)
							{
								// Move the character along in the string
								currentCharacter = currentCharacter + wordLength - 1;
							
								wordFound = true;
						
								// Exit the loop cleanly
								wordLength = 0;
							} // end if the character is not Chinese
							
						} // if the word exists
					
					} // end for every word length
				
					// If the word is not found, just use the character
					if (wordFound == false)
					{
						var thisCharacter = thisChineseLine[currentCharacter];
					
						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							spacedChineseLine = spacedChineseLine + thisCharacter;
						
							lastWasNotChinese = true;
						
						} else {
						
							// Add a space if we're back to parsing Chinese
							if (lastWasNotChinese == true)
							{
								spacedChineseLine = spacedChineseLine + " ";
								lastWasNotChinese = false;
							}
						
							spacedChineseLine = spacedChineseLine + thisCharacter + " ";					

						} // end if this character is not Chinese
					
					} else {

						// Add a space if we're back to parsing Chinese
						if (lastWasNotChinese == true)
						{
							spacedChineseLine = spacedChineseLine + " ";
							lastWasNotChinese = false;
						}

						spacedChineseLine = spacedChineseLine + thisWord + " ";

					} // end if the word was not found
								
				
				} // end for every character
				
				spacedChinese = spacedChinese + spacedChineseLine + "\n";
				//} // end if the line is English
				
			} // end for every line
			
			
			var spacedLine = "";
		   
			var numberLineCharacters = spacedChinese.length;
		   
			// Add spaces for punctuation
			for (var currentLineCharacter = 0; currentLineCharacter < numberLineCharacters; currentLineCharacter++)
			{
				var thisLineCharacter = spacedChinese[currentLineCharacter];
			   
				if (isChinese(thisLineCharacter) == true)
				{
					spacedLine = spacedLine + thisLineCharacter;
				} else {
					if (isEnglish(thisLineCharacter) == true)
					{
						spacedLine = spacedLine + thisLineCharacter;
					} else {
						spacedLine = spacedLine + thisLineCharacter + " ";
					}
				}
			   
			} // end add spaces after every non-Chinese character
			
			return spacedLine;
			
		} // end function wordSpace
		
		function wordSpaceButtonClicked()
		{
			//debugLog("wordSpaceButtonClicked()");

			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedLine = wordSpace(thisChinese);
			
			document.getElementById("chineseSpacedTextArea").value = spacedLine;
			//document.getElementById("outputTextArea").value = spacedChinese;
			
		} // end function wordSpace
		
		function characterSpace()
		{
			//debugLog("characterSpace()");
			
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedChinese = "";
			
			var thisChineseCharacters = thisChinese.split("");
			
			var numberCharacters = thisChineseCharacters.length;

			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisChineseCharacters[currentCharacter];
				
				spacedChinese = spacedChinese + thisCharacter + " ";
			} // end for every character
			
			document.getElementById("chineseSpacedTextArea").value = spacedChinese;
		} // end function characterSpace
		
		function despace(thisChinese)
		{
			//debugLog("despace(" + thisChinese + ")");
			
			var spacedChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisCharacter = thisChineseLine[currentCharacter];
					
					if (isChinese(thisCharacter) == true)
					{
						spacedChinese = spacedChinese + thisCharacter;
						lastWasNotChinese = false;
					} else {
					
						if (lastWasNotChinese == false)
						{
							if (thisCharacter != " ")
							{
								spacedChinese = spacedChinese + thisCharacter;
							}
						} else {
							spacedChinese = spacedChinese + thisCharacter;
						}
						
						lastWasNotChinese = true;
					}
				} // end for every character
				
				spacedChinese = spacedChinese + "\n";
				
				
				/*
				var spacedChineseLine = "";
				
				
				var lineIsEnglish = true;
				
				// Skip non-Chinese character
				if (numberCharacters >= 1)
				{
					for (var currentCharacter = 0; currentCharacter <= numberCharacters; currentCharacter++)
					{	
						
						if (currentCharacter >= numberCharacters)
						{
							break;
						}
									
						var thisCharacter = thisChineseLine[currentCharacter];
						
						if (isChinese(thisCharacter) == true)
						{
							lineIsEnglish = false;
							break;
						}
					} // end for every non-Chinese character
				} // end if there is more than one character on the line
				
				
				// Skip all-English lines
				if (lineIsEnglish == true)
				{
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				} else {
					
					thisChineseLine = replaceChars(thisChineseLine," ", "");
					spacedChinese = spacedChinese + thisChineseLine + "\n";
				
				} // end if line is english
				*/
								
			} // end for every line
			
			return spacedChinese;
			
		} // end function despace
		
		function despaceButtonClicked()
		{
			//debugLog("despaceButtonClicked");

			var thisChinese = document.getElementById("chineseTextArea").value;
			
			var spacedChinese = despace(thisChinese);
			
			document.getElementById("chineseTextArea").value = spacedChinese;
			document.getElementById("outputTextArea").value = spacedChinese;
			
		} // end function despace
		
		function showMissingWords(theseWords)
		{
			//debugLog("showMissingWords(" + theseWords + ")");

			var missingWordsHtml = "";

			var headers = "<tr><td><div style=\"font-family: 'Charcoal CY', 'Virtue', Geneva, sans-serif; font-size: 14px;\">Missing words</div></td><td><textarea id=\"missingWordsTextArea\" rows=\"5\" cols=\"50\" >";
		
			var footers = "</textarea></td></tr>";
			
			var missingWordsArray = theseWords.split("\n");
			
			var missingWordsString = "";
			
			var numberWords = missingWordsArray.length;
			
			if (numberWords <= 1)
			{
				return;
			}
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = missingWordsArray[currentWord];
				
				if (contains(missingWordsString,thisWord) == false)
				{
					missingWordsString = missingWordsString + thisWord + "\n";
				}
			} // end for every word
			
			missingWordsHtml = headers + missingWordsString + footers;
		
			var missingWordsTable = document.getElementById("missingWordsTable");
			missingWordsTable.innerHTML = missingWordsHtml;
		
		} // end function showMissingWords
		
		
		/* Decompose */
		
		function searchHexButtonClicked()
		{
			//debugLog("searchHexButtonClicked");
	
			var inputHex = document.getElementById("startCharacter").value;
			
			var inputCharacter = hexToCharacter(inputHex);
			
			document.getElementById("startCharacter").value = inputCharacter;
			
		} // end function searchHexButtonClicked

		function searchUnitypeButtonClicked()
		{
			//debugLog("searchUnitypeButtonClicked");

			var inputUnitype = document.getElementById("startCharacter").value;
			
			var inputCharacter = unitypeToCharacter(inputUnitype);
			
			document.getElementById("startCharacter").value = inputCharacter;

		} // end function searchUnitypeButtonClicked

		function searchWadeGilesButtonClicked()
		{
			//debugLog("searchWadeGilesButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var pinyinArray = ["zhuang", "zhuan", "zhuai", "zhong", "zheng", "zhang", "xiong", "xiang", "sheng", "qiong", "qiang", "jiong", "jiang", "guang", "chong", "cheng", "zuan", "zong", "zhuo", "zhun", "zhui", "zhua", "zhou", "zhen", "zhei", "zhao", "zhan", "zhai", "zeng", "zang", "yuan", "yong", "xuan", "xing", "xiao", "xian", "weng", "tong", "tian", "teng", "song", "shen", "seng", "ruan", "rong", "reng", "rang", "quan", "qing", "qiao", "qian", "pian", "peng", "nong", "nian", "neng", "mian", "meng", "long", "lian", "leng", "kong", "keng", "juan", "jing", "jiao", "jian", "hong", "heng", "guan", "guai", "gong", "geng", "gang", "feng", "duan", "dong", "ding", "diao", "dian", "deng", "dang", "cuan", "cong", "chuo", "chen", "ceng", "cang", "bing", "biao", "bian", "beng", "bang", "zuo", "zun", "zui", "zou", "zhu", "zhi", "zhe", "zha", "zen", "zei", "zao", "zan", "zai", "yun", "yue", "you", "yan", "xun", "xue", "xiu", "xin", "xie", "xia", "wen", "tuo", "tie", "suo", "shi", "sen", "ruo", "run", "rui", "rou", "ren", "rao", "ran", "qun", "que", "qiu", "qin", "qie", "qia", "pie", "pen", "nuo", "nüe", "nie", "nen", "mie", "men", "luo", "lüe", "lie", "kui", "ken", "jun", "jue", "jiu", "jin", "jie", "jia", "hen", "guo", "gun", "gui", "gua", "gou", "gen", "gei", "gao", "gan", "gai", "fen", "duo", "dun", "dui", "dou", "diu", "die", "dei", "dao", "dan", "dai", "cuo", "cun", "cui", "cou", "chi", "che", "cen", "cao", "can", "cai", "bin", "bie", "ben", "bei", "bao", "ban", "bai", "zu", "zi", "ze", "za", "yu", "yi", "ye", "xu", "xi", "te", "si", "se", "ru", "ri", "re", "qu", "qi", "le", "ke", "ju", "ji", "he", "gu", "ge", "ga", "er", "en", "du", "di", "de", "da", "cu", "ci", "ce", "ca", "bu", "bo", "bi", "ba", "e"];
	
			var wadeGilesArray = ["chuang", "chuan", "chuai", "chung", "chêng", "chang", "hsiung", "hsiang", "shêng", "chiung", "chiang", "chiung", "chiang", "kuang", "chung", "chêng", "tsuan", "tsung", "cho", "chun", "chui", "chua", "chou", "chên", "chei", "chao", "chan", "chai", "tsêng", "tsang", "yüan", "yung", "hsüan", "hsing", "hsiao", "hsien", "wêng", "tung", "tien", "têng", "sung", "shên", "sêng", "juan", "jung", "jêng", "jang", "chüan", "ching", "chiao", "chien", "pien", "pêng", "nung", "nien", "nêng", "mien", "mêng", "lung", "lien", "lêng", "kung", "kêng", "chüan", "ching", "chiao", "chien", "hung", "hêng", "kuan", "kuai", "kung", "kêng", "kang", "fêng", "tuan", "tung", "ting", "tiao", "tien", "têng", "tang", "tsuan", "tsung", "cho", "chên", "tsêng", "tsang", "ping", "piao", "pien", "pêng", "pang", "tso", "tsun", "tsui", "tsou", "chu", "chih", "chê", "cha", "tsên", "tsei", "tsao", "tsan", "tsai", "yün", "yüeh", "yu", "yen", "hsün", "hsüeh", "hsiu", "hsin", "hsieh", "hsia", "wên", "to", "tieh", "so", "shih", "sên", "jo", "jun", "jui", "jou", "jên", "jao", "jan", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "pieh", "pên", "no", "nüeh", "nieh", "nên", "mieh", "mên", "lo", "lüeh", "lieh", "kuei", "kên", "chün", "chüeh", "chiu", "chin", "chieh", "chia", "hên", "kuo", "kun", "kuei", "kua", "kou", "kên", "kei", "kao", "kan", "kai", "fên", "to", "tun", "tui", "tou", "tiu", "tieh", "tei", "tao", "tan", "tai", "tso", "tsun", "tsui", "tsou", "chih", "chê", "tsên", "tsao", "tsan", "tsai", "pin", "pieh", "pên", "pei", "pao", "pan", "pai", "tsu", "tzu", "tsê", "tsa", "yü", "i", "yeh", "hsü", "hsi", "tê", "ssu", "sê", "ju", "jih", "jê", "chü", "chi", "lê", "ko", "chü", "chi", "ho", "ku", "ko", "ka", "êrh", "ên", "tu", "ti", "tê", "ta", "tsu", "tzu", "tsê", "tsa", "pu", "po", "pi", "pa", "o"];
			
			var thisIndex = wadeGilesArray.indexOf(inputWord);
			
			if (thisIndex >= 0)
			{
				var thisPinyin = pinyinArray[thisIndex];
				
				dictionaryCharacter(thisPinyin);
				
			} // if the word is in the wade-giles array

		} // end function searchWadeGilesButtonClicked



		function searchHangulButtonClicked()
		{
			//debugLog("searchHangulButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = hangulData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchHangulButtonClicked

		function searchJapaneseButtonClicked()
		{
			//debugLog("searchJapaneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = japaneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchJapaneseButtonClicked

		function searchVietnameseButtonClicked()
		{
			//debugLog("searchVietnameseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = vietnameseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchVietnameseButtonClicked

		function searchCantoneseButtonClicked()
		{
			//debugLog("searchCantoneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = cantoneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchCantoneseButtonClicked

		function searchTaiwaneseButtonClicked()
		{
			//debugLog("searchTaiwaneseButtonClicked");

			var inputWord = document.getElementById("startCharacter").value;

			var searchRegexString = "^(.*" + "	" + inputWord + ".*)$";

			var searchRegex = new RegExp(searchRegexString, "gm");

			var characterWordsArray = taiwaneseData.match(searchRegex);
	   
			if (characterWordsArray == null)
			{
				characterWords = "<table></table>";
				var wordsTable = document.getElementById("characterWords");
				wordsTable.innerHTML = characterWords;
				return;
			}
	   
			var characterWords = "<tr>";

			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];

				var thisItemLines = thisItem.split(/\r?\n/);

				var lastLine = thisItemLines[thisItemLines.length - 1];

				var thisWord = textBetween(lastLine, "start", "	");

   
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";

				numberWords = numberWords + 1;

				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
			} // end for every search result

			characterWords = "<table>" + characterWords + "</table>";
	
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

		} // end function searchTaiwaneseButtonClicked

		function dictionaryCharacter(thisCharacter)
		{
			//debugLog("dictionaryCharacter(" + thisCharacter + ")");

			if (contains(combinedDictionaryData, thisCharacter) == true)
			{
				var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisCharacter + "	", "\n");
				
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
				var lineLength = thisDictionaryLineArray.length;
				
				var thisDefinition = "";
				var thisCharacterPinyin = "";
				var thisToneless = "";
				var thisTone = "";
				
				thisDefinition = thisDictionaryLineArray[0];

				if (lineLength >= 1)
				{
					thisCharacterPinyin = thisDictionaryLineArray[1];
				}
				
				if (lineLength >= 2)
				{
					thisToneless = thisDictionaryLineArray[2];
				}
				
				if (lineLength >= 3)
				{
					thisTone = thisDictionaryLineArray[3];
				}

			
				document.getElementById("pinyin").innerHTML = thisCharacterPinyin;
				document.getElementById("definition").innerHTML = thisDefinition;
				
				
				// If this is an English word
				if (isChineseString(thisCharacter) == false)
				{
					var searchRegexString = "^(.*" + "	" + thisCharacter + "	" + ".*)$";
		   
					var searchRegex = new RegExp(searchRegexString, "gm");
		   
					var characterWordsArray = combinedDictionaryData.match(searchRegex);
					   
					var characterWords = "<tr>";
		   
					var numberWords = 0;

					for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
					{
						var thisItem = characterWordsArray[currentItem];
		   
						var thisItemLines = thisItem.split(/\r?\n/);
		   
						var lastLine = thisItemLines[thisItemLines.length - 1];
		   
						var thisWord = textBetween(lastLine, "start", "	");
			   
				   
						var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

						characterWords = characterWords + "<td>" + thisWordHtml + "</td>";
		   
						numberWords = numberWords + 1;
		   
						if ((numberWords % 3) == 0)
						{
							characterWords = characterWords + "</tr><tr class='children'>";
						}
			   		} // end if the word is english
			   
				} // end for every word containing the character
			
			characterWords = "<table>" + characterWords + "</table>";
			
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;
				
				return;
			} // end if the dictionary contains the character already
			
			if (thisCharacter.length > 1)
			{
				return;
			}
			
			var codePointDecimal = fixedCharCodeAt(thisCharacter, 0);
			
			var hexCode = codePointDecimal.toString(16).toUpperCase();
			
			document.getElementById("charCode").innerHTML = hexCode;

			var dictionaryUrl = "dictionary.php?charCode=" + hexCode;
		
			var xmlhttp = new XMLHttpRequest();

			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == XMLHttpRequest.DONE ) {
				   if (xmlhttp.status == 200) 
				   {
						var thisChinese = xmlhttp.responseText;
					    
						var thisPinyin = textBetween(thisChinese, "kMandarin=\"", "\"");
						var thisDefinition = textBetween(thisChinese, "kDefinition=\"", "\"");
						
						document.getElementById("pinyin").innerHTML = thisPinyin;
						document.getElementById("definition").innerHTML = thisDefinition;
					    
				   } // end if it loaded the KML
				   else if (xmlhttp.status == 400) {
					  alert('There was an error 400');
				   }
				   else {
					   alert('something else other than 200 was returned');
				   }
				}
			};
			
			xmlhttp.open("GET", dictionaryUrl, true);
			xmlhttp.send();
		} // end function dictionaryCharacter
		
		function searchBopomofo(thisWord)
		{
			//debugLog("searchBopomofo(" + thisWord + ")");
			
			if (contains(bopomofoData, thisWord) == true)
			{
				var searchRegexString = "^";
				searchRegexString = searchRegexString + "(.* " + thisWord + ".*)";
				searchRegexString = searchRegexString + "$";
				var searchRegex = new RegExp(searchRegexString, "gm");
				
				var childCharacterArray = bopomofoData.match(searchRegex);
				
				console.log(childCharacterArray);
				
				var numberChildren = 0;
				
				childCharacters = "";
				
				// If no children were found, skip the rest
				if (childCharacterArray == null)
				{
					return;
				}
				
				var childrenArrayLength = childCharacterArray.length;
								
				for (var currentItem = 0; currentItem < childrenArrayLength; currentItem++)
				{
					var thisItem = childCharacterArray[currentItem];
				
					var thisItemLines = thisItem.split(/\r?\n/);
				
					var lastLine = thisItemLines[thisItemLines.length - 1];
				
					var thisChild = textBetween(lastLine, "start", " ");
					
					thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChild + "</div>";

					childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		   
					numberChildren = numberChildren + 1;
		   
					if ((numberChildren % 3) == 0)
					{
						childCharacters = childCharacters + "</tr><tr class='children'>";
					}
					
				} // end for every child
				
				childCharacters = "<table>" + childCharacters + "</table>";
			
				var childTable = document.getElementById("childCharacters");
				childTable.innerHTML = childCharacters;
			} // end if the bopomofo data contains the word
			
		} // end function searchBopomofo
		
		function searchManyCharacters(inputCharacters)
		{
				//debugLog("searchManyCharacters(" + inputCharacters + ")");
				
				// If the word is in the dictionary, find the definition and pinyin
				dictionaryCharacter(inputCharacters);
				
				// If the characters are bopomofo, search the zhuyintable instead
				if (isBopomofoString(inputCharacters) == true)
				{
					return searchBopomofo(inputCharacters);
				} // end if thisString is bopomofo
				
				var numberInput = inputCharacters.length;
				
				var startCharacter = inputCharacters[0];
				
				var childCharacterArray = genealogiesData.split(startCharacter + ",");

				//var childCharacterArray = genealogiesData.match(/^(.*木,.*回,.*)$/gm);
				
				// 木回
				
				var searchRegexString = "^";
				
				for (var currentInput = 0; currentInput < numberInput; currentInput++)
				{
					var thisInput = inputCharacters[currentInput];
					
					searchRegexString = searchRegexString + "(.*" + thisInput + ",.*)";
				}
				
				searchRegexString = searchRegexString + "$";
				
				var searchRegex = new RegExp(searchRegexString, "gm");
				
				//document.write(searchRegex);
				
				var childCharacterArray = genealogiesData.match(searchRegex);
				//var childCharacterArray = genealogiesData.match(/^(.*木,.*)(.*回,.*)$/gm);
								
				var numberChildren = 0;
				
				childCharacters = "";
				
				// If no children were found, skip the rest
				if (childCharacterArray == null)
				{
					return;
				}
				
				var childrenArrayLength = childCharacterArray.length;
				
				for (var currentItem = 0; currentItem < childrenArrayLength; currentItem++)
				{
					var thisItem = childCharacterArray[currentItem];
				
					var thisItemLines = thisItem.split(/\r?\n/);
				
					var lastLine = thisItemLines[thisItemLines.length - 1];
				
					var thisChild = textBetween(lastLine, "start", " ");
					
					
					var childGenealogy = textBetween(genealogiesData, thisChild + " ", "\n");
				
					// algorithm problem: must search whole genealogy not only filter direct children.
				
					var keepChild = true;
				
					for (var currentInput = 1; currentInput < numberInput; currentInput++)
					{
						var thisInput = inputCharacters[currentInput];
					
						if (contains(childGenealogy, thisInput) == false)
						{
							keepChild = false;
						}
						
					} // end for every other input character
					
					if (keepChild == true)
					{
				
						 var thisChildTag = thisChild;
					
						 if (isNumeric(thisChild) == true)
						 {
				
							 childComposition = textBetween(compositionData, thisChild + ":", ")");
							 //childComposition = textBetween(compositionData, thisChild + " ", "\n");
					
							 childLeft = textBetween(thisComposition, "(", ",");
							 childRight = textBetween(thisComposition, ",", "end");

							 //childLeft = textBetween(thisComposition, " ", ",");
							 //childRight = textBetween(thisComposition, ",", ",");
				
							 thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
						 }
		
						 thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

						 childCharacters = childCharacters + "<td>" + thisChild + "</td>";
				
						 numberChildren = numberChildren + 1;
				
						 if ((numberChildren % 3) == 0)
						 {
							 childCharacters = childCharacters + "</tr><tr class='children'>";
						 }
					}
					
					
				} // end for every descendant of the first character

			childCharacters = "<table>" + childCharacters + "</table>";
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = childCharacters;
			

		} // end function searchManyCharacters
				
		function searchCharacter()
		{			
			//debugLog("searchCharacter");

			var inputCharacters = document.getElementById("startCharacter").value;
						
			var numberInput = inputCharacters.length;
			
			if (numberInput == 0)
			{
				return;
			}
			
			if (isNumberString(inputCharacters) == true)
			{
				numberInput = 1;
			}

			if (numberInput > 1)
			{
				return searchManyCharacters(inputCharacters);
			} // end if there are more than one character
			
			//startCharacter = inputCharacters[0];
			startCharacter = inputCharacters;
			
			
			// The iPhone can't cope with loading the dictionary into RAM
			//var thisChinese = textBetween(dictionaryData, "<char cp=\"" + hexCode, "/>");
			
			//alert(startCharacter);
			
			thisComposition = textBetween(compositionData, startCharacter + ":", ")");
			
			//thisComposition = textBetween(compositionData, startCharacter + " ", "end");
			
			//thisLeft = textBetween(thisComposition, "start", ",");
			//thisRight = textBetween(thisComposition, ",", ",");
			
			thisLeft = textBetween(thisComposition, "(", ",");
			thisRight = textBetween(thisComposition, ",", "end");
			
			
			thisLeft = "<div onclick='clickCharacter(\"" + thisLeft + "\")'>" + thisLeft + "</div>";
			thisRight = "<div onclick='clickCharacter(\"" + thisRight + "\")'>" + thisRight + "</div>";
			
			document.getElementById("leftCharacter").innerHTML = thisLeft;
			document.getElementById("rightCharacter").innerHTML = thisRight;
			
			//alert(thisComposition);
			
			var childCharacters = "";
			
			var numberChildren = 0;
			
			var childCharacterLeftArray = compositionData.split(startCharacter + ",");  

			for (var currentItem = 0; currentItem < childCharacterLeftArray.length; currentItem++)
			{
				var thisItem = childCharacterLeftArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
								
				var thisChildTag = thisChild;
		  
				if (isNumeric(thisChild) == true)
				{
		  
					childComposition = textBetween(compositionData, thisChild + ":", ")");
					//childComposition = textBetween(compositionData, thisChild + " ", "\n");
			  
					childLeft = textBetween(thisComposition, "(", ",");
					childRight = textBetween(thisComposition, ",", "end");

					//childLeft = textBetween(thisComposition, " ", ",");
					//childRight = textBetween(thisComposition, ",", ",");
		  
					thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
				}
  
				thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

				childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		  
				numberChildren = numberChildren + 1;
		  
				if ((numberChildren % 3) == 0)
				{
					childCharacters = childCharacters + "</tr><tr class='children'>";
				}
				
			} // end for every child character where startCharacter is on the left
						
			childCharacters = childCharacters + "</tr><tr>";
			
			var childCharacterRightArray = compositionData.split("," + startCharacter);  

			for (var currentItem = 0; currentItem < childCharacterRightArray.length; currentItem++)
			{
				var thisItem = childCharacterRightArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
				
				var thisChildTag = thisChild;
		   
				if (isNumeric(thisChild) == true)
				{
		   
					childComposition = textBetween(compositionData, thisChild + ":", ")");
					//childComposition = textBetween(compositionData, thisChild + " ", "\n");

					childLeft = textBetween(thisComposition, "(", ",");
					childRight = textBetween(thisComposition, ",", "end");
			   
					//childLeft = textBetween(thisComposition, " ", ",");
					//childRight = textBetween(thisComposition, ",", ",");
		   
		   
					thisChildTag = thisChild + "<br>(" + childLeft + "," + childRight + ")";
				}
   
				thisChild = "<div onclick='clickCharacter(\"" + thisChild + "\")'>" + thisChildTag + "</div>";

				childCharacters = childCharacters + "<td>" + thisChild + "</td>";
		   
				numberChildren = numberChildren + 1;
		   
				if ((numberChildren % 3) == 0)
				{
					childCharacters = childCharacters + "</tr><tr class='children'>";
				}
				
			} // end for every child character where startCharacter is on the left
			
			childCharacters = "<table>" + childCharacters + "</table>";
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = childCharacters;

			//$('#characterTable tr:last').after("<tr id='children'>" + childCharacters + "</tr>");
			
			dictionaryCharacter(startCharacter);
			
			
			
			// Words
			var searchRegexString = "^(.*" + startCharacter + ".*)$";
			
			var searchRegex = new RegExp(searchRegexString, "gm");
			
			var characterWordsArray = combinedDictionaryData.match(searchRegex);
						
			var characterWords = "<tr>";
			
			var numberWords = 0;

			for (var currentItem = 0; currentItem < characterWordsArray.length; currentItem++)
			{
				var thisItem = characterWordsArray[currentItem];
			
				var thisItemLines = thisItem.split(/\r?\n/);
			
				var lastLine = thisItemLines[thisItemLines.length - 1];
			
				var thisWord = textBetween(lastLine, "start", "	");
				
					
				var thisWordHtml = "<div onclick='clickCharacter(\"" + thisWord + "\")'>" + thisWord + "</div>";

				characterWords = characterWords + "<td>" + thisWordHtml + "</td>";
			
				numberWords = numberWords + 1;
			
				if ((numberWords % 3) == 0)
				{
					characterWords = characterWords + "</tr><tr class='children'>";
				}
				
				
			} // end for every word containing the character
			
			characterWords = "<table>" + characterWords + "</table>";
			
			var wordsTable = document.getElementById("characterWords");
			wordsTable.innerHTML = characterWords;

			var addReviewingTheHanzi = document.getElementById('reviewingTheHanziCheckbox').checked;
			
			if (addReviewingTheHanzi == true)
			{
				if (contains(reviewingTheHanziData, "\n" + startCharacter + "	"))
				{
					var thisReview = textBetween(reviewingTheHanziData, "\n" + startCharacter + "	", "\n");
					
					document.getElementById("reviewArea").innerHTML = thisReview;
					
				} // if reviewing the hanzi has the character
			} // if we should add reviewing the hanzi
			
		} // end function searchCharacter

		function typeCharacter(thisCharacter)
		{
			//debugLog("typeCharacter(" + thisCharacter + ")");

			var inputCharacters = document.getElementById("startCharacter").value;

			if (thisCharacter == "delete")
			{
				var inputLength = inputCharacters.length;
				
				if (inputLength == 1)
				{
					inputCharacters = "";
				} else {
					inputCharacters = inputCharacters.substring(0, inputLength - 1);
				}
			} else {
				inputCharacters = inputCharacters + thisCharacter;
			}
								
			document.getElementById("startCharacter").value = inputCharacters;
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = "";
			
			if (inputCharacters != "")
			{
				//searchCharacter();
			}
			
		} // end function typeCharacter

		function clickCharacter(thisCharacter)
		{
			//debugLog("clickCharacter(" + thisCharacter + ")");

			document.getElementById("startCharacter").value = thisCharacter;
			
			var childTable = document.getElementById("childCharacters");
			childTable.innerHTML = "";
			
			searchCharacter();
			
		} // end function clickCharacter
		
		function getGenealogy()
		{
			//debugLog("getGenealogy");

			//genealogy = genealogy.replace(/,\s*$/, "");

			return genealogy;
		} // end getAncestors		
		
		function getAncestors()
		{
			//debugLog("getAncestors");
			//ancestors = ancestors.replace(/,\s*$/, "");

			return ancestors;
		} // end getAncestors
		
		function findAncestors(thisCharacter, maxLevel, thisLevel)
		{
			//debugLog("findAncestors(" + thisCharacter + "," + maxLevel + "," + thisLevel + ")");

			var thisParents = getParents(thisCharacter, thisLevel);
			var thisLeft = thisParents[0];
			var thisRight = thisParents[1];
			
			if (thisLevel < maxLevel)
			{
				findAncestors(thisLeft, maxLevel, thisLevel + 1);
				findAncestors(thisRight, maxLevel, thisLevel + 1);
			} // if there are still more levels of recursion to continue

		} // end function findAncestors
		
		function getParents(thisCharacter, thisLevel)
		{
			//debugLog("getParents(" + thisCharacter + "," + thisLevel + ")");

			var thisParents = new Array();
			var numberParents = 0;
			
			thisComposition = textBetween(compositionData, thisCharacter + ":", ")");

			thisLeft = textBetween(thisComposition, "(", ",");
			thisRight = textBetween(thisComposition, ",", "end");
			
			if (thisLeft != "")
			{
				thisParents.push(thisLeft);
				numberParents = numberParents + 1;
				
				//if (isCharacter(thisLeft) == true)
				//{
					if (contains(genealogy, thisLeft) == false)
					{
						genealogy = genealogy + thisLeft + ",";
						
					} // end if the genealogy does not already contain thisLeft
				//} // end if thisLeft is a character
				
			} // end left
			
			if (thisRight != "")
			{
				thisParents.push(thisRight);
				numberParents = numberParents + 1;
				
				//if (isCharacter(thisRight) == true)
				//{
					if (contains(genealogy, thisRight) == false)
					{
						genealogy = genealogy + thisRight + ",";
						
					} // end if the genealogy does not already contain thisLeft
				//} // end if thisLeft is a character
				
			} // end right
			
			if (thisLeft == "")
			{
				if (thisRight == "")
				{
					if (thisCharacter != undefined)
					{
						if (contains(ancestors, thisCharacter) == false)
						{
							ancestors = ancestors + thisCharacter + ",";
							
							if (highestLevel < thisLevel)
							{
								highestLevel = thisLevel;
							} // end set the highest level
						} // end add to ancestors
					} // end if this character is undefined
					
				} // end if it has no right
			} // end if it has no left
			
			
			return thisParents;
			
		} // end function getParents
		
		function findChildren(thisCharacter)
		{
			//debugLog("findChildren(" + thisCharacter + ")");

			var numberLeft = 0;
			var numberRight = 0;
			
			var leftChildren = new Array();
			var rightChildren = new Array();
			var allChildren = new Array();
			
			var childCharacterLeftArray = compositionData.split(thisCharacter + ",");  

			for (var currentItem = 0; currentItem < childCharacterLeftArray.length; currentItem++)
			{
				var thisItem = childCharacterLeftArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
				
				leftChildren.push(thisChild);
				allChildren.push(thisChild);
								
				numberLeft = numberLeft + 1;
				
			} // end for every child character where startCharacter is on the left
			
			numberLeft = numberLeft - 1;
			

			var childCharacterRightArray = compositionData.split("," + thisCharacter);  

			for (var currentItem = 0; currentItem < childCharacterRightArray.length; currentItem++)
			{
				var thisItem = childCharacterRightArray[currentItem];
				
				var thisItemLines = thisItem.split(/\r?\n/);
				
				var lastLine = thisItemLines[thisItemLines.length - 1];
				
				var thisChild = textBetween(lastLine, "start", ":");
								
				rightChildren.push(thisChild);
				allChildren.push(thisChild);
				
			} // end for every child character where startCharacter is on the left

			numberRight = numberRight - 1;
			
			return allChildren;
			
		} // end function findChildren

		function fourHundredGenealogy()
		{
			//debugLog("fourHundredGenealogy");

			var theseCharacters = ["愛", "吧", "爸", "罷", "把", "八", "巴", "白", "佰", "半", "板", "搬", "幫", "抱", "包", "杯", "盃", "本", "比", "筆", "便", "病", "丙", "不", "布", "步", "才", "菜", "彩", "採", "草", "操", "茶", "常", "唱", "場", "晨", "池", "吃", "蟲", "出", "船", "穿", "窗", "吹", "春", "次", "從", "答", "大", "打", "當", "倒", "到", "稻", "的", "得", "等", "燈", "弟", "第", "低", "店", "掉", "碟", "蝶", "丁", "動", "洞", "冬", "東", "讀", "肚", "短", "對", "堆", "多", "兒", "二", "耳", "法", "房", "方", "粉", "分", "蜂", "服", "該", "糕", "個", "各", "哥", "歌", "給", "根", "共", "公", "功", "工", "狗", "故", "掛", "瓜", "光", "果", "哈", "孩", "害", "汗", "好", "和", "河", "禾", "喝", "很", "紅", "候", "後", "蝴", "忽", "畫", "話", "花", "換", "回", "會", "火", "級", "記", "己", "幾", "假", "甲", "加", "家", "件", "見", "叫", "教", "腳", "角", "交", "潔", "結", "姐", "接", "街", "今", "巾", "淨", "睛", "就", "九", "句", "看", "客", "課", "可", "肯", "空", "口", "哭", "塊", "快", "拉", "來", "老", "了", "樂", "冷", "力", "禮", "裏", "臉", "涼", "亮", "兩", "林", "留", "六", "綠", "落", "嗎", "媽", "慢", "滿", "忙", "毛", "帽", "貓", "沒", "妹", "每", "們", "蜜", "米", "棉", "名", "明", "木", "母", "拿", "男", "呢", "能", "泥", "你", "年", "牛", "女", "爬", "怕", "排", "拍", "旁", "朋", "匹", "片", "婆", "破", "氣", "七", "期", "前", "強", "橋", "親", "情", "晴", "請", "清", "球", "秋", "去", "全", "熱", "人", "認", "日", "容", "肉", "入", "三", "掃", "色", "扇", "山", "上", "少", "燒", "甚", "深", "勝", "升", "生", "聲", "十", "實", "時", "石", "事", "室", "是", "師", "手", "熟", "數", "樹", "耍", "刷", "誰", "睡", "水", "說", "四", "司", "算", "歲", "他", "她", "太", "談", "糖", "桃", "甜", "田", "條", "停", "聽", "同", "痛", "兔", "娃", "外", "完", "玩", "晚", "碗", "位", "尾", "問", "溫", "我", "物", "五", "午", "屋", "習", "細", "喜", "洗", "西", "下", "夏", "現", "先", "像", "向", "想", "校", "笑", "小", "寫", "些", "信", "心", "新", "行", "姓", "興", "星", "學", "呀", "牙", "燕", "眼", "羊", "樣", "搖", "要", "咬", "葉", "也", "冶", "易", "乙", "以", "已", "椅", "一", "衣", "應", "用", "油", "游", "又", "右", "友", "有", "元", "園", "圓", "月", "約", "再", "在", "早", "澡", "站", "張", "找", "爪", "著", "真", "正", "只", "指", "紙", "枝", "知", "種", "中", "竹", "住", "煮", "豬", "捉", "桌", "子", "字", "自", "仔", "姊", "走", "最", "昨", "作", "做", "坐", "左"];
			
			var numberCharacters = theseCharacters.length;
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = theseCharacters[currentCharacter];
								
				getAncestors(thisCharacter, 10, 1);
			} // end for every character
			
			ancestors = ancestors + highestLevel;
			
			document.write(ancestors);
			
			return ancestors;
			
		} // end function fourHundredGenealogy

		function findGenealogy(thisCharacter)
		{
			//debugLog("findGenealogy(" + thisCharacter + ")");

			//var thisCharacter = "愛";
			//var thisCharacter = "高";
			
			ancestors = "";
			genealogy = "";
			
			findAncestors(thisCharacter, 10, 1);
			var thisAncestors = getAncestors();
			
			//var thisChildren = findChildren(thisCharacter);
			
			var thisGenealogy = getGenealogy();
			
			return thisGenealogy;
			
		} // end function findGenealogy

		function firstWord(thisString)
		{
			//debugLog("firstWord(" + thisString + ")");

			thisString = thisString.replace(/;/g, ',');
			thisString = thisString.replace(/ /g, ',');			
			
			var thisWord = textBetween(thisString, "start", ",");
			
			return thisWord;
		} // end function firstWord

		function insertButtonClicked()
		{
			//debugLog("insertButtonClicked");

			var thisCharacter = document.getElementById("startCharacter").value;
			var thisPinyin = document.getElementById("pinyin").innerHTML;
			var thisEnglish = firstWord(document.getElementById("definition").innerHTML);
			
			var thisPhrase = document.getElementById("thisPhrase").value;
			
			var thisPhraseLines = thisPhrase.split("\n");
			
			thisPhraseLines[0] = thisPhraseLines[0] + thisCharacter;
			
			if (thisPhraseLines[1] == undefined)
			{
				thisPhraseLines[1] = "";
			}
			
			thisPhraseLines[1] = thisPhraseLines[1] + thisPinyin + " ";

			if (thisPhraseLines[2] == undefined)
			{
				thisPhraseLines[2] = "";
			}
			
			thisPhraseLines[2] = thisPhraseLines[2] + thisEnglish + " ";
			
			thisPhrase = thisPhraseLines.join("\n");
			
			document.getElementById("thisPhrase").value = thisPhrase;
			
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			thisChinese = thisChinese + thisCharacter;
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
			document.getElementById("startCharacter").value = "";
			
			memoryPlus();
			
		} // end function addToPhrase

		function togglePinyinKeyboard()
		{
			//debugLog("togglePinyinKeyboard");

			var currentVisibility = document.getElementById("pinyinKeyboard").style.visibility;
			
			if (currentVisibility == "visible")
			{
				document.getElementById("pinyinKeyboard").style.visibility = "hidden";
				document.getElementById("pinyinKeyboard").style.height = "0px";
				document.getElementById("pinyinKeyboard").style.width = "0px";
			} else {
				document.getElementById("pinyinKeyboard").style.visibility = "visible";
				document.getElementById("pinyinKeyboard").style.height = "auto";
				document.getElementById("pinyinKeyboard").style.width = "auto";
			}
		} // end function togglePinyinKeyboard

		function toggleRadicalKeyboard()
		{
			//debugLog("toggleRadicalKeyboard");

			var currentVisibility = document.getElementById("radicalKeyboard").style.visibility;

			if (currentVisibility == "visible")
			{
				document.getElementById("radicalKeyboard").style.visibility = "hidden";
				document.getElementById("radicalKeyboard").style.height = "0px";
				document.getElementById("radicalKeyboard").style.width = "0px";
			} else {
				document.getElementById("radicalKeyboard").style.visibility = "visible";
				document.getElementById("radicalKeyboard").style.height = "auto";
				document.getElementById("radicalKeyboard").style.width = "auto";
			}
		} // end function toggleRadicalKeyboard
		
		function toggleDecomposeBopomofoKeyboard()
		{
			//debugLog("toggleDecomposeBopomofoKeyboard");

			var currentVisibility = document.getElementById("decomposeBopomofoKeyboard").style.visibility;

			if (currentVisibility == "visible")
			{
				document.getElementById("decomposeBopomofoKeyboard").style.visibility = "hidden";
				document.getElementById("decomposeBopomofoKeyboard").style.height = "0px";
				document.getElementById("decomposeBopomofoKeyboard").style.width = "0px";
			} else {
				document.getElementById("decomposeBopomofoKeyboard").style.visibility = "visible";
				document.getElementById("decomposeBopomofoKeyboard").style.height = "auto";
				document.getElementById("decomposeBopomofoKeyboard").style.width = "auto";
			}
		} // end function decomposeBopomofoKeyboard
		
		
		
		function clearLocalStorage()
		{
			//debugLog("clearLocalStorage");

			localStorage["phrase"] = "";
			
		} // end function clearLocalStorage
		
		function saveToLocalStorage(key, thisText)
		{
			//debugLog("saveToLocalStorage(" + key + "," + thisText + ")");
			
			var oldText = localStorage[key];
			
			if (oldText == undefined)
			{
				oldText = "";
			}
			
			localStorage[key] = oldText + thisText + "\n";
			
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				appendToFile(key + ".txt", thisText);
			}
		} // end function saveToLocalStorage
		
		function memoryPlus()
		{
			//debugLog("memoryPlus");

			var thisPhrase = document.getElementById("chineseTextArea").value;
			
			var thisKey = "phrase";
			
			saveToLocalStorage(thisKey, thisPhrase);
			
		} // end function memoryPlus

		function loadFromLocalStorage()
		{
			//debugLog("loadFromLocalStorage");

			document.getElementById("chineseTextArea").value = localStorage["phrase"];
		} // end function load

		function clearButtonClicked()
		{
			//debugLog("clearButtonClicked");

			document.getElementById("chineseTextArea").value = "";
			document.getElementById("englishTextArea").value = "";

			//document.getElementById("startCharacter").value = "";
		} // end function clear

		function copyToTranslator()
		{
			//debugLog("copyToTranslator");

			var thisText = document.getElementById("thisPhrase").value;
			
			var thisTextArray = thisText.split("\n");
			
			var thisChinese = thisTextArray[0];
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
			deradicalizeButtonClicked();
			
			wordSpaceButtonClicked();
			
			translateBilingual();
		} // end function copyToTranslator

		function buildMatrix(thisPhrase)
		{
			//debugLog("buildMatrix(" + thisPhrase + ")");

			var thisPhraseArray = thisPhrase.split("");
			
			var numberCharacters = thisPhraseArray.length;
			
			var thisPhraseGenealogies = new Array();
			
			var matrixHtml = "";
			
			var longestGenealogy = 0;
			
			
			
			// Create spaces for the drops in the table
			matrixHtml = matrixHtml + "<tr>";
			
			for (var currentColumn = 0; currentColumn < numberCharacters; currentColumn++)
			{
				matrixHtml = matrixHtml + "<td><p id=\"dropP" + currentColumn + "\"><table id=\"dropTable" + currentColumn + "\"></table></p></td>";				
			}
			
			matrixHtml = matrixHtml + "</tr></table>";

			var matrixTable = document.getElementById("matrix");
			matrixTable.innerHTML = matrixHtml;
			
			
			
			
			// Build the genealogies
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisPhraseArray[currentCharacter];
				var thisGenealogy = textBetween(genealogiesData, thisCharacter + " ", "\n");
				
				// If there's no genealogy data, figure it out
				if (thisGenealogy == "")
				{
					findGenealogy(thisCharacter);
					thisGenealogy = getGenealogy();
				}
				
				thisGenealogy = thisCharacter + "," + thisGenealogy;
				
				var thisGenealogyArray = thisGenealogy.split(",");
				
				var cleanGenealogy = "";
				var genealogyLength = 0;
				
				for (var currentGenealogyCharacter = 0; currentGenealogyCharacter < thisGenealogyArray.length; currentGenealogyCharacter++)
				{
					var thisGenealogyCharacter = thisGenealogyArray[currentGenealogyCharacter];
					
					if (isChinese(thisGenealogyCharacter) == true)
					{
						cleanGenealogy = cleanGenealogy + thisGenealogyCharacter + ",";
						genealogyLength = genealogyLength + 1;
					}
				} // end filter only real characters in the genealogy
				
				
				if (longestGenealogy < genealogyLength)
				{
					longestGenealogy = genealogyLength;
				}
				
				thisPhraseGenealogies.push(cleanGenealogy);
				
				//alert(cleanGenealogy);
				
			} // end for every character
			
			
			// New algorithm idea: generate a one-column table for each drop (thisPhraseGenealogies.pop), and display within a larger multi-column table of all drops. 
						
			matrixHtml = matrixHtml + "<table><tr>";
			
			var numberRows = longestGenealogy - 1;
			numberColumns = numberCharacters;
			
			for (var currentColumn = 0; currentColumn < numberColumns; currentColumn++)
			{
			
				var dropHtml = "";
			
				var thisGenealogy = thisPhraseGenealogies[currentColumn];
			
				for (var currentRow = 0; currentRow <= numberRows; currentRow++)
				{
					dropHtml = dropHtml + "<tr><td>";
				
					var inverseRow = numberRows - currentRow;
					
					var thisGenealogyArray = thisGenealogy.split(",");
					
					var thisGenealogyLength = thisGenealogyArray.length;
					
					if (thisGenealogyLength > inverseRow)
					{
						var thisCharacter = thisGenealogyArray[inverseRow];

						var rowProportion = inverseRow / thisGenealogyLength;
				
						var colourRow = Math.floor(12 * rowProportion) + 3;
						var thisColour = "#00FF00";
						
						colourRow = 16 - colourRow;
				
						//123,456,789,ABC,DEF
						switch (colourRow)
						{
							case 15: thisColour = "#00FF00"; break;
							case 14: thisColour = "#00EE00"; break;
							case 13: thisColour = "#00DD00"; break;
							case 12: thisColour = "#00CC00"; break;
							case 11: thisColour = "#00BB00"; break;
							case 10: thisColour = "#00AA00"; break;
							default: thisColour = "#00" + colourRow + colourRow + "00"; break;
						}
						
						if (thisCharacter == "")
						{
							dropHtml = dropHtml + "&nbsp;";
							
						} else {

						
							if (currentRow < numberRows)
							{
								dropHtml = dropHtml + "<div class=\"row" + colourRow + "\" style=\"color: " + thisColour + ";\">";
							} else {
								dropHtml = dropHtml + "<div class=\"row" + colourRow + "\" style=\"color: #EEEEEE;\">";
							}
						
						
							dropHtml = dropHtml + thisCharacter;
							
							dropHtml = dropHtml + "</div>";
							
						} // end if this character is not blank
						
						
					} else {
						
						dropHtml = dropHtml + "&nbsp;";
						
					}// end if the genealogy is long enough
					
					dropHtml = dropHtml + "</td></tr>";

				} // end for every row
							
				var dropTable = document.getElementById("dropTable" + currentColumn);
				dropTable.innerHTML = dropHtml;
				
				var dropP = document.getElementById("dropP" + currentColumn);
				dropP.className += "load";

			} // end for every column
			
			/*
			var numberRows = longestGenealogy - 1;
			
			numberColumns = numberCharacters;
			
			for (var currentRow = 0; currentRow <= numberRows; currentRow++)
			{
				var inverseRow = numberRows - currentRow;
							
				matrixHtml = matrixHtml + "<tr>";
			
				for (var currentColumn = 0; currentColumn < numberColumns; currentColumn++)
				{
					var thisGenealogy = thisPhraseGenealogies[currentColumn];
					
					matrixHtml = matrixHtml + "<td>";
					
					var thisGenealogyArray = thisGenealogy.split(",");
					
					var thisGenealogyLength = thisGenealogyArray.length;
					
					if (thisGenealogyLength > inverseRow)
					{
						var thisCharacter = thisGenealogyArray[inverseRow];

						var rowProportion = inverseRow / thisGenealogyLength;
				
						var colourRow = Math.floor(12 * rowProportion) + 3;
						var thisColour = "#00FF00";
						
						colourRow = 16 - colourRow;
				
						//123,456,789,ABC,DEF
						switch (colourRow)
						{
							case 15: thisColour = "#00FF00"; break;
							case 14: thisColour = "#00EE00"; break;
							case 13: thisColour = "#00DD00"; break;
							case 12: thisColour = "#00CC00"; break;
							case 11: thisColour = "#00BB00"; break;
							case 10: thisColour = "#00AA00"; break;
							default: thisColour = "#00" + colourRow + colourRow + "00"; break;
						}
				
						if (currentRow < numberRows)
						{
							matrixHtml = matrixHtml + "<div class=\"row" + colourRow + "\" style=\"color: " + thisColour + ";\">";
						} else {
							matrixHtml = matrixHtml + "<div class=\"row" + colourRow + "\" style=\"color: #EEEEEE;\">";
						}

						matrixHtml = matrixHtml + thisCharacter;
						
						matrixHtml = matrixHtml + "</div>";
						
						
					} // end if the genealogy is long enough
					
					matrixHtml = matrixHtml + "</td>";
					
				} // end for every column
				
				matrixHtml = matrixHtml + "</tr>";
				
			} // end for every row
			*/
			
			// Hide all rows
			/*
			for (var currentColour = 0; currentColour <= 16; currentColour = currentColour + 1)
			{
				var rowName = "row" + currentColour;
			
				var thisColourCells = document.getElementsByClassName(rowName);
				
				var numberCells = thisColourCells.length;
				
				for (var currentCell = 0; currentCell < numberCells; currentCell = currentCell + 1) 
				{
					thisColourCells[currentCell].style.visibility = "hidden";
				}
			} // end for every row
			*/
			
			// Show rows slowly
			//showRow(0);
			
			//console.log(thisPhraseGenealogies);

			
		} // end function buildMatrix

		function showRow(currentColour)
		{
			//debugLog("showRow(" + currentColour + ")");
		
			var rowName = "row" + currentColour;
			
			var thisColourCells = document.getElementsByClassName(rowName);
				
			var numberCells = thisColourCells.length;
				
			for (var currentCell = 0; currentCell < numberCells; currentCell = currentCell + 1) 
			{
				thisColourCells[currentCell].style.visibility = "visible";
			}
			
			//alert(rowName);
			
			currentColour = currentColour + 1;
			
			if (currentColour <= 16)
			{
				setTimeout(showRow(currentColour),1000); 		
			}
			
		} // end function showRow

		function matrixButtonClicked()
		{
			//debugLog("matrixButtonClicked");

			var thisText = document.getElementById("chineseTextArea").value;
			
			var thisTextArray = thisText.split("\n");
			
			var thisChinese = thisTextArray[0];
			
			buildMatrix(thisChinese);
			
			
			
		} // end function matrixButtonClicked
		
		function b64EncodeUnicode(str) 
		{
			//debugLog("b64EncodeUnicode(" + str + ")");

	    	return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, 
	    		function(match, p1) 
	    		{
	        		return String.fromCharCode('0x' + p1);
    			}));
		} // end function b64EncodeUnicode
		
		function printButtonClicked()
		{
			//debugLog ("printButtonClicked");

			var thisString = document.getElementById("outputHtml").innerHTML;
			
			var htmlHeaders = "<!DOCTYPE html>\n<html>\n  <head>\n	<meta charset=\"utf-8\" />\n        <style>\n\n@font-face {\n    font-family: \"Charcoal CY\";\n    src: url(\"fonts/Charcoal.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Virtue\";\n    src: url(\"fonts/virtue.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"SimSun\";\n    src: url(\"fonts/SimSun.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"Jhenghei\";\n    src: url(\"fonts/MicrosoftJhengHeiRegular.ttf\") format(\"truetype\");\n}\n\n@font-face {\n    font-family: \"PingfangLocal\";\n    src: local(\"PingFang-TC-Regular\");\n}\n\n@font-face {\n    font-family: \"Pingfang\";\n    src: url(\"fonts/PingFang1.ttf\") format(\"truetype\");\n}\n\n      body {\n        font-family: Tahoma, Geneva, sans-serif;\n      }\n      \n      table td {\n      white-space: nowrap;\n      }\n		\n	a:hover, a:visited, a:link, a:active\n	{\n		color:#000000;\n	    text-decoration: none;\n	}\n		\n      .chinese_1 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .chinese_2 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_3 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_4 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_5 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_6 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .chinese_7 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n      \n      .chinese_8 {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n      .pinyin_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .pinyin_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\ndisplay:inline;\n      }\n\n      .pinyin_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\ndisplay:inline;\n      }\n\n      .pinyin_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .pinyin_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .taiwanese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#787878;\n		display:inline;\n      }\n\n      .taiwanese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\ndisplay:inline;\n      }\n\n      .taiwanese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .taiwanese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#505050;\ndisplay:inline;\n      }\n\n      .taiwanese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .taiwanese_7 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n      \n      .taiwanese_8 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#929292;\ndisplay:inline;\n      }\n\n      .cantonese_1 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#929292;\n		display:inline;\n      }\n\n      .cantonese_2 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#FF8080;\ndisplay:inline;\n      }\n\n      .cantonese_3 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#787878;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .cantonese_4 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#0000FF;\ndisplay:inline;\n      }\n\n      .cantonese_5 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#F82423;\ndisplay:inline;\n      }\n\n      .cantonese_6 {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .hangul {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:#000000;\n		font-size: 26px;\n		display:inline;\n      }\n\n      .tang {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .japanese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .vietnamese {\n        font-family: \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .englishInChinese {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .literal {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n      .english {\n        font-family: \"Pingfang\", \"Jhenghei\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#000000;\ndisplay:inline;\n      }\n\n\n		.DefaultButtonOuter\n		{\n			border: 2px solid black ;\n			border-radius: 8px;\n			width: 96px;\n			height: 26px;\n			text-align: center;\n			\n			/*background-color: #99999a;*/\n			background: #99999a; /* For browsers that do not support gradients */\n			/*background: -webkit-linear-gradient(left top, red, yellow);*/ /* For Safari 5.1 to 6.0 */\n			/*background: -o-linear-gradient(bottom right, red, yellow);*/ /* For Opera 11.1 to 12.0 */\n			/*background: -moz-linear-gradient(bottom right, red, yellow); */ /* For Firefox 3.6 to 15 */\n			background: linear-gradient(to bottom right, #dcdbde, #737374); /* Standard syntax */\n		}\n\n		.ButtonInner\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 88px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: \"Charcoal CY\", \"Virtue\", Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n		\n		.ButtonInner:active\n		{\n		    background:#666666;\n		    color: #ffffff;\n		}\n\n		.key\n		{\n			border: 1px solid black ;\n			border-radius: 5px;\n			background-color: #dcdbde;\n			width: 18px;\n			height: 18px;\n			text-align: center;\n			margin: 3px;\n			\n		    line-height: 18px;\n	        font-family: Geneva, sans-serif;\n			font-size: 11px;\n			color: #000000;\n		}\n\n\n			#matrix {\n				background: black;\n				float: center;\n			}\n\n			#matrix td {\n			    padding: 7px;\n    			margin: 0px;\n    			float: center;\n				background: black;\n				font: 54px arial;\n				\n				height: 80px;\n			}\n\n			#matrix tr {\n				height: 80px;\n			}\n\n\n			#matrix p {\n			    opacity: 0;\n			    margin-top: -25px;\n			    text-align: center;\n\n				height: 80px;\n\n			    -webkit-transition: margin-top 2s ease-in;\n			    -moz-transition: margin-top 2s ease-in;\n			    -o-transition: margin-top 2s ease-in;\n			    -ms-transition: margin-top 2s ease-in;\n			    transition: margin-top 2s ease-in;\n			}\n			\n			#matrix p.load {\n			    opacity: 1;\n			    margin-top: 25px;\n			}\n\n     .dialogWithDropShadow\n     {\n         -webkit-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1);\n         -moz-box-shadow: 1px 1px 0px rgba(0, 0, 0, 1); \n     }\n\n@font-face {\n    font-family: \"SmallSealScript\";\n    src: url(\"fonts/FangzhengXiaozhuantiFont-TraditionalChinese.ttf\") format(\"truetype\");\n}\n\n      .smallSealScript_1 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .smallSealScript_2 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_3 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .smallSealScript_4 {\n        font-family: \"SmallSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n@font-face {\n    font-family: \"LargeSealScript\";\n    src: url(\"fonts/JDFZHUANF.ttf\") format(\"truetype\");\n}\n\n      .largeSealScript_1 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .largeSealScript_2 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_3 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .largeSealScript_4 {\n        font-family: \"LargeSealScript\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n@font-face {\n    font-family: \"OracleBones\";\n    src: url(\"fonts/bnujgw.ttf\") format(\"truetype\");\n}\n\n      .oracleBones_1 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\n        color:black;\n		font-size: 30px;\n		display:inline;\n      }\n\n      .oracleBones_2 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#f82423;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_3 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#189c19;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n      .oracleBones_4 {\n        font-family: \"OracleBones\", \"Heiti TC Light\", Tahoma, Geneva, sans-serif;\ncolor:#178FD1;\nfont-size: 30px;\ndisplay:inline;\n      }\n\n\n    </style>\n\n  </head>\n  <body>\n	";
			
			var htmlFooters = "\n  </body>\n</html>\n";
			
			var thisHtml = htmlHeaders + thisString + htmlFooters;
			
			var thisHtmlBase64 = b64EncodeUnicode(thisHtml);
			
			window.open("data:text/html;charset=UTF-8;base64," + thisHtmlBase64,'_blank');
			
		} // end function printButtonClicked
		
		function removeTones(thisString)
		{
			var vowels = ["a", "e", "i", "o", "u"];
			var tonesUp = ["á", "é", "í", "ó", "ú"];
			var tonesDown = ["à", "è", "ì", "ò", "ù"];
			var tonesDownUp = ["ǎ", "ě", "ǐ", "ǒ", "ǔ"];
			var tonesFlat = ["ā", "ē", "ī", "ō", "ū"];
			
			thisString = replaceChars(thisString, "ń", "n");
			thisString = replaceChars(thisString, "ế", "e");
			thisString = replaceChars(thisString, "ǘ", "u");
			thisString = replaceChars(thisString, "ń", "n");
			thisString = replaceChars(thisString, "ḿ", "m");
			thisString = replaceChars(thisString, "ề", "e");
			thisString = replaceChars(thisString, "ǜ", "u");
			thisString = replaceChars(thisString, "ǹ", "n");
			thisString = replaceChars(thisString, "̀", "");
			thisString = replaceChars(thisString, "ǎ", "a");
			thisString = replaceChars(thisString, "ê̌", "e");
			thisString = replaceChars(thisString, "ě", "e");
			thisString = replaceChars(thisString, "ǐ", "i");
			thisString = replaceChars(thisString, "ǒ", "o");
			thisString = replaceChars(thisString, "ǚ", "u");
			thisString = replaceChars(thisString, "ň", "n");
			thisString = replaceChars(thisString, "ê", "e");
			thisString = replaceChars(thisString, "ü", "u");
			thisString = replaceChars(thisString, "̄", "");
			thisString = replaceChars(thisString, "̄", "");

			thisString = replaceChars(thisString, "ǚ", "u");
			thisString = replaceChars(thisString, "ǒ", "o");
			thisString = replaceChars(thisString, "ǐ", "i");
			
			
			var numberTones = vowels.length;
			
			for (var currentTone = 0; currentTone < numberTones; currentTone++)
			{
				var thisVowel = vowels[currentTone];
				
				var thisTone = tonesUp[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);
				
				thisTone = tonesDown[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);

				thisTone = tonesDownUp[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);

				thisTone = tonesFlat[currentTone];
				thisString = replaceChars(thisString, thisTone, thisVowel);
			} // end for every tone
			
			return thisString;
			
		} // end function removeTones
		
		function getTones(thisString)
		{
			var tonesUp = ["á", "é", "í", "ó", "ú", "ế", "ǘ", "ń", "ḿ"];
			var tonesDown = ["à", "è", "ì", "ò", "ù", "ề", "ǜ", "ǹ", "̀"];
			var tonesDownUp = ["ǎ", "ě", "ǐ", "ǒ", "ǔ", "ǎ", "ê̌", "ě", "ǐ", "ǒ", "ǚ", "ň"];
			var tonesFlat = ["ā", "ē", "ī", "ō", "ū", "ê", "ü", "̄", "̄"];
		
			var thisStringWords = thisString.split(" ");
			
			var numberWords = thisStringWords.length;
			
			var theseTones = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisStringWords[currentWord];
				
				var thisWordTone = "";
				
				var numberTones = tonesFlat.length;
				
				for (var currentTone = 0; currentTone < numberTones; currentTone++)
				{
					if (thisWordTone == "")
					{
						var thisTone = tonesFlat[currentTone];
					
						if (contains(thisWord,thisTone))
						{
							thisWordTone = thisWordTone + "1";
						}
					} // if we didn't find the tone yet
				} // end for every tone
				
				numberTones = tonesUp.length;
				
				for (var currentTone = 0; currentTone < numberTones; currentTone++)
				{
					if (thisWordTone == "")
					{
						var thisTone = tonesUp[currentTone];
					
						if (contains(thisWord,thisTone))
						{
							thisWordTone = thisWordTone + "2";
						}
					} // if we didn't find the tone yet
				} // end for every tone
				
				numberTones = tonesDownUp.length;
				
				for (var currentTone = 0; currentTone < numberTones; currentTone++)
				{
					if (thisWordTone == "")
					{
						var thisTone = tonesDownUp[currentTone];
					
						if (contains(thisWord,thisTone))
						{
							thisWordTone = thisWordTone + "3";
						}
					} // if we didn't find the tone yet
				} // end for every tone

				numberTones = tonesDown.length;
				
				for (var currentTone = 0; currentTone < numberTones; currentTone++)
				{
					if (thisWordTone == "")
					{
						var thisTone = tonesDown[currentTone];
					
						if (contains(thisWord,thisTone))
						{
							thisWordTone = thisWordTone + "4";
						}
					} // if we didn't find the tone yet
				} // end for every tone

				if (thisWordTone == "")
				{
					thisWordTone = "1";
				}
				
				theseTones = theseTones + thisWordTone;
				
			} // end for every word
			
			return theseTones;
			
		} // end function getTones
		
		function toggleCheckbox(checkboxId)
		{
			//debugLog("toggleCheckbox");

			document.getElementById(checkboxId).checked = !document.getElementById(checkboxId).checked;
		} // end function toggleCheckbox
		
		function toggleReviewingTheHanzi(checkboxId)
		{
			//debugLog("toggleReviewingTheHanzi");
			
			var isChecked = document.getElementById(checkboxId).checked;
		
			document.getElementById(checkboxId).checked = !isChecked;
			
			if (isChecked == false)
			{
				if (reviewingTheHanziData == "\n")
				{
					loadReviewingTheHanzi("ReviewingTheHanzi.txt");
				}
			}
			
		} // end function toggleReviewingTheHanzi

		
		function translateButtonClicked()
		{
			//debugLog("translateButtonClicked");

			var addSimplified = document.getElementById('simplifiedSpacedCheckbox').checked;
			
			if (addSimplified == true)
			{
				simplifiedToTraditionalButtonClicked();
			}

			deradicalizeButtonClicked();
			wordSpaceButtonClicked();
			
			if (addSimplified == true)
			{
				spacedToSimplifiedButtonClicked();
			}
			
			var thisEnglish = document.getElementById("englishTextArea").value;
			
			if (thisEnglish == "")
			{
				translateBilingual();			
			} else {
				translateInterface();
			}
			
			if (commonWords != "")
			{
				//var addCommon = true;
				
				commonStatistics();
				
			} // end if we should count common words
						
		} // end function translateButtonClicked
		
		function commonStatistics()
		{
			//debugLog(commonStatistics);

			var thisSpaced = document.getElementById("chineseSpacedTextArea").value;
			thisSpaced = thisSpaced.split(" ");
			var numberWords = thisSpaced.length;
		   
			var uniqueWordsArray = [];
			var commonWordsUniqueArray = [];
			var commonWordsTotalArray = [];
		   
			var totalWords = 0;
		   
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisSpaced[currentWord];
			   
				if (isChineseString(thisWord) == true)
				{
					if (contains(uniqueWordsArray,thisWord) == false)
					{
						uniqueWordsArray.push(thisWord);
					} // if the word is new

					if (contains(commonWords,thisWord) == true)
					{
						if (contains(commonWordsUniqueArray,thisWord) == false)
						{
							commonWordsUniqueArray.push(thisWord);
						}
				   
						commonWordsTotalArray.push(thisWord);
					} // end if the word is common
				   
					totalWords = totalWords + 1;
				   
				} // if the word is Chinese
			   
			} // end for every word
			
			//debugLog(commonWordsUniqueArray.join(" "));
		   
			var commonWordsTotal = commonWordsTotalArray.length - 1;
			var commonWordsUnique = commonWordsUniqueArray.length - 1;
			var uniqueWordsCount = uniqueWordsArray.length - 1;
		   
			var commonPercentTotal = Math.floor((commonWordsTotal / totalWords) * 100);
			var commonPercentUnique = Math.floor((commonWordsUnique / uniqueWordsCount) * 100);
		   
			var commonPercent = commonWordsTotal + "/" + totalWords + " = " + commonPercentTotal + "% Total";
			commonPercent = commonPercent + ", " + commonWordsUnique + "/" + uniqueWordsCount + " = " + commonPercentUnique + "% Unique";
			document.getElementById("wordListPercent").innerHTML = commonPercent;
			
		} // end function commonStatistics
		
		function setPinyinOpacity()
		{
			//debugLog("setPinyinOpacity");

			var pinyinOpacityPercent = document.getElementById("pinyinOpacity").value;
			
			var pinyinOpacityValue = pinyinOpacityPercent / 100;
			
			var theseClasses = "pinyin_1,pinyin_2,pinyin_3,pinyin_4".split(",");
			
			var numberClasses = theseClasses.length;
			
			for (var currentClass = 0; currentClass < numberClasses; currentClass++)
			{
				var thisClass = theseClasses[currentClass];
			
				var theseElements = document.getElementsByClassName(thisClass);
			
				var numberElements = theseElements.length;
			
				for (var currentElement = 0; currentElement < numberElements; currentElement++)
				{
					var thisElement = theseElements[currentElement];
					thisElement.style.opacity = pinyinOpacityValue;
				} // end for every element
				
			} // end for every class

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
		} // end function setPinyinOpacity

		function setLiteralOpacity()
		{
			//debugLog("setLiteralOpacity");

			var literalOpacityPercent = document.getElementById("literalOpacity").value;
			
			var literalOpacityValue = literalOpacityPercent / 100;
			
			var thisClass = "literal";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.opacity = literalOpacityValue;
			} // end for every element

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
		} // end function setLiteralOpacity

		function setEnglishOpacity()
		{
			//debugLog("setEnglishOpacity");

			var englishOpacityPercent = document.getElementById("englishOpacity").value;
			
			var englishOpacityValue = englishOpacityPercent / 100;
			
			var thisClass = "english";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.opacity = englishOpacityValue;
			} // end for every element

			//document.getElementsByClassName("pinyin_1").style.opacity = literalOpacityValue;
			
		} // end function setEnglishOpacity
		
		function debugLog(thisString)
		{
			document.getElementById("debugTextArea").value = document.getElementById("debugTextArea").value + thisString + "\n";
		} // end function debugLog
		
		function googleTranslatePhraseButtonClicked()
		{
			//debugLog("googleTranslateButtonClicked");
			var thisChinese = document.getElementById("chineseTextArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');
		} // end function googleTranslatePhraseButtonClicked

		function googleTranslateWordsButtonClicked()
		{
			//debugLog("googleTranslateButtonClicked");
			var thisChinese = document.getElementById("dictionaryAddArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');
		} // end function googleTranslateWordsButtonClicked
		
		function dictionaryEditorGoogleTranslateButtonClicked()
		{
			//debugLog("dictionaryEditorGoogleTranslateButtonClicked");
			var thisChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
			
			window.open("https://translate.google.com/#zh-CN/en/" + thisChinese,'_blank');

		} // end function dictionaryEditorGoogleTranslateButtonClicked
		
		function drawGenealogyButtonClicked()
		{
			//debugLog("drawGenealogyButtonClicked");

			var thisCharacter = document.getElementById("startCharacter").value;
		
			var turtleSheetUrl = "turtlesheet.html?command=drawGenealogy(%22" + thisCharacter + "%22);"
			
			window.open(turtleSheetUrl,'_blank');
		
		} // end function drawGenealogyButtonClicked
		
		function setColour(thisClass, thisColour)
		{
			//debugLog("setColour(" + thisColour + ", " + thisClass + ")");
			
			var theseElements = document.getElementsByClassName(thisClass);
		
			var numberElements = theseElements.length;
			
			//debugLog(thisClass + " has " + numberElements);
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.color = thisColour;
			} // end for every element

		} // end function setColour
		
		function setColours(theseClasses, theseColours)
		{
			//debugLog("setColours(theseColours, theseClasses)");
			
			var numberColours = theseColours.length;
			
			for (var currentColour = 0; currentColour < numberColours; currentColour++)
			{
				var thisColour = "#" + theseColours[currentColour];

				var thisClass = theseClasses[currentColour];
				
				setColour(thisClass, thisColour);
				
			} // end for every class
			
		} // end function setColours
		
		function updateColours()
		{
			//debugLog("updateColours");
			
			var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
			var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
			var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
			var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
			var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
			var chineseColourSix = document.getElementById("chineseColourPickerSix").value;
			var chineseColourSeven = document.getElementById("chineseColourPickerSeven").value;
			
			var theseClasses = ["chinese_1","chinese_2","chinese_3","chinese_4","chinese_5","chinese_6","chinese_7"];
			var theseColours = [chineseColourOne, chineseColourTwo, chineseColourThree, chineseColourFour, chineseColourFive, chineseColourSix, chineseColourSeven];
			
			setColours(theseClasses, theseColours);
			
			var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
			var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
			var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
			var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
			var pinyinClasses = ["pinyin_1","pinyin_2","pinyin_3","pinyin_4"];
			
			theseClasses = ["pinyin_1","pinyin_2","pinyin_3","pinyin_4"];
			theseColours = [pinyinColourOne, pinyinColourTwo, pinyinColourThree, pinyinColourFour];
			
			setColours(theseClasses, theseColours);
			
			var taiwaneseColourOne = document.getElementById("taiwaneseColourPickerOne").value;
			var taiwaneseColourTwo = document.getElementById("taiwaneseColourPickerTwo").value;
			var taiwaneseColourThree = document.getElementById("taiwaneseColourPickerThree").value;
			var taiwaneseColourFour = document.getElementById("taiwaneseColourPickerFour").value;
			var taiwaneseColourFive = document.getElementById("taiwaneseColourPickerFive").value;
			var taiwaneseColourSeven = document.getElementById("taiwaneseColourPickerSeven").value;
			var taiwaneseColourEight = document.getElementById("taiwaneseColourPickerEight").value;
			
			theseClasses = ["taiwanese_1","taiwanese_2","taiwanese_3","taiwanese_4","taiwanese_5","taiwanese_7","taiwanese_8"];
			theseColours = [taiwaneseColourOne, taiwaneseColourTwo, taiwaneseColourThree, taiwaneseColourFour, taiwaneseColourFive, taiwaneseColourSeven, taiwaneseColourEight];
			
			setColours(theseClasses, theseColours);
			
			var cantoneseColourOne = document.getElementById("cantoneseColourPickerOne").value;
			var cantoneseColourTwo = document.getElementById("cantoneseColourPickerTwo").value;
			var cantoneseColourThree = document.getElementById("cantoneseColourPickerThree").value;
			var cantoneseColourFour = document.getElementById("cantoneseColourPickerFour").value;
			var cantoneseColourFive = document.getElementById("cantoneseColourPickerFive").value;
			var cantoneseColourSix = document.getElementById("cantoneseColourPickerSix").value;
			
			theseClasses = ["cantonese_1","cantonese_2","cantonese_3","cantonese_4","cantonese_5","cantonese_6"];
			theseColours = [cantoneseColourOne, cantoneseColourTwo, cantoneseColourThree, cantoneseColourFour, cantoneseColourFive, cantoneseColourSix];
			
			setColours(theseClasses, theseColours);
			
		} // function updateColours
		
		function setChineseColours(chineseColourOne, chineseColourTwo, chineseColourThree, chineseColourFour, chineseColourFive, chineseColourSix, chineseColourSeven)
		{
			document.getElementById("chineseColourPickerOne").value = chineseColourOne;
			document.getElementById("chineseColourPickerOne").style.backgroundColor = "#" + chineseColourOne;
			document.getElementById("chineseColourPickerTwo").value = chineseColourTwo;
			document.getElementById("chineseColourPickerTwo").style.backgroundColor = "#" + chineseColourTwo;
			document.getElementById("chineseColourPickerThree").value = chineseColourThree;
			document.getElementById("chineseColourPickerThree").style.backgroundColor = "#" + chineseColourThree;
			document.getElementById("chineseColourPickerFour").value = chineseColourFour;
			document.getElementById("chineseColourPickerFour").style.backgroundColor = "#" + chineseColourFour;
			document.getElementById("chineseColourPickerFive").value = chineseColourFive;
			document.getElementById("chineseColourPickerFive").style.backgroundColor = "#" + chineseColourFive;
			document.getElementById("chineseColourPickerSix").value = chineseColourSix;
			document.getElementById("chineseColourPickerSix").style.backgroundColor = "#" + chineseColourSix;
			document.getElementById("chineseColourPickerSeven").value = chineseColourSeven;
			document.getElementById("chineseColourPickerSeven").style.backgroundColor = "#" + chineseColourSeven;
		} // end function setChineseColours

		function setPinyinColours(pinyinColourOne, pinyinColourTwo, pinyinColourThree, pinyinColourFour)
		{
			document.getElementById("pinyinColourPickerOne").value = pinyinColourOne;
			document.getElementById("pinyinColourPickerOne").style.backgroundColor = "#" + pinyinColourOne;
			document.getElementById("pinyinColourPickerTwo").value = pinyinColourTwo;
			document.getElementById("pinyinColourPickerTwo").style.backgroundColor = "#" + pinyinColourTwo;
			document.getElementById("pinyinColourPickerThree").value = pinyinColourThree;
			document.getElementById("pinyinColourPickerThree").style.backgroundColor = "#" + pinyinColourThree;
			document.getElementById("pinyinColourPickerFour").value = pinyinColourFour;
			document.getElementById("pinyinColourPickerFour").style.backgroundColor = "#" + pinyinColourFour;
		} // end function setPinyinColours
		
		function setTaiwaneseColours(taiwaneseColourOne, taiwaneseColourTwo, taiwaneseColourThree, taiwaneseColourFour, taiwaneseColourFive, taiwaneseColourSeven, taiwaneseColourEight)
		{
			document.getElementById("taiwaneseColourPickerOne").value = taiwaneseColourOne;
			document.getElementById("taiwaneseColourPickerOne").style.backgroundColor = "#" + taiwaneseColourOne;
			document.getElementById("taiwaneseColourPickerTwo").value = taiwaneseColourTwo;
			document.getElementById("taiwaneseColourPickerTwo").style.backgroundColor = "#" + taiwaneseColourTwo;
			document.getElementById("taiwaneseColourPickerThree").value = taiwaneseColourThree;
			document.getElementById("taiwaneseColourPickerThree").style.backgroundColor = "#" + taiwaneseColourThree;
			document.getElementById("taiwaneseColourPickerFour").value = taiwaneseColourFour;
			document.getElementById("taiwaneseColourPickerFour").style.backgroundColor = "#" + taiwaneseColourFour;
			document.getElementById("taiwaneseColourPickerFive").value = taiwaneseColourFive;
			document.getElementById("taiwaneseColourPickerFive").style.backgroundColor = "#" + taiwaneseColourFive;
			document.getElementById("taiwaneseColourPickerSeven").value = taiwaneseColourSeven;
			document.getElementById("taiwaneseColourPickerSeven").style.backgroundColor = "#" + taiwaneseColourSeven;
			document.getElementById("taiwaneseColourPickerEight").value = taiwaneseColourEight;
			document.getElementById("taiwaneseColourPickerEight").style.backgroundColor = "#" + taiwaneseColourEight;
		} // end function setTaiwaneseColours
		
		function setCantoneseColours(cantoneseColourOne, cantoneseColourTwo, cantoneseColourThree, cantoneseColourFour, cantoneseColourFive, cantoneseColourSix)
		{
			document.getElementById("cantoneseColourPickerOne").value = cantoneseColourOne;
			document.getElementById("cantoneseColourPickerOne").style.backgroundColor = "#" + cantoneseColourOne;
			document.getElementById("cantoneseColourPickerTwo").value = cantoneseColourTwo;
			document.getElementById("cantoneseColourPickerTwo").style.backgroundColor = "#" + cantoneseColourTwo;
			document.getElementById("cantoneseColourPickerThree").value = cantoneseColourThree;
			document.getElementById("cantoneseColourPickerThree").style.backgroundColor = "#" + cantoneseColourThree;
			document.getElementById("cantoneseColourPickerFour").value = cantoneseColourFour;
			document.getElementById("cantoneseColourPickerFour").style.backgroundColor = "#" + cantoneseColourFour;
			document.getElementById("cantoneseColourPickerFive").value = cantoneseColourFive;
			document.getElementById("cantoneseColourPickerFive").style.backgroundColor = "#" + cantoneseColourFive;
			document.getElementById("cantoneseColourPickerSix").value = cantoneseColourSix;
			document.getElementById("cantoneseColourPickerSix").style.backgroundColor = "#" + cantoneseColourSix;
		} // end function setCantoneseColours
		
		function blackColours()
		{
			//debugLog("blackColours");
			
			var flatColour = "000000";
			var upColour = "000000";
			var downUpColour = "000000";
			var downColour = "000000";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setCantoneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour);
			
			updateColours();
		} // end function blackColours
		
		function greyColours()
		{
			//debugLog("greyColours");
			
			var flatColour = "000000";
			var upColour = "929292";
			var downUpColour = "787878";
			var downColour = "505050";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setCantoneseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour);
			
			updateColours();
		} // end function greyColours
		
		function peterColours()
		{
			//debugLog("peterColours");
			
			var flatColour = "000000";
			var upColour = "f82423";
			var downUpColour = "189c19";
			var downColour = "178FD1";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";

			var taiwaneseOneColour = "787878";
			var taiwaneseTwoColour = "178FD1";
			var taiwaneseThreeColour = "0000FF";
			var taiwaneseFourColour = "505050";
			var taiwaneseFiveColour = "000000";
			var taiwaneseSevenColour = "F82423";
			var taiwaneseEightColour = "929292";

			var cantonneseOneColour = "929292";
			var cantoneseTwoColour = "F82423";
			var cantoneseThreeColour = "787878";
			var cantoneseFourColour = "0000FF";
			var cantoneseFiveColour = "F82423";
			var cantoneseSixColour = "000000";

			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			setTaiwaneseColours(taiwaneseOneColour, taiwaneseTwoColour, taiwaneseThreeColour, taiwaneseFourColour, taiwaneseFiveColour, taiwaneseSevenColour, taiwaneseEightColour);
			setCantoneseColours(cantonneseOneColour, cantoneseTwoColour, cantoneseThreeColour, cantoneseFourColour, cantoneseFiveColour, cantoneseSixColour);
			
			updateColours();
		} // end function peterColours
		
		function plecoColours()
		{
			//debugLog("plecoColours");
			
			// See http://laowaichinese.net/tone-colors-and-what-pleco-did-with-them.htm
			
			var flatColour = "e30000";
			var upColour = "02b31c";
			var downUpColour = "1510f0";
			var downColour = "8900bf";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function plecoColours

		function nathanColours()
		{
			//debugLog("nathanColours");

			var flatColour = "f41d2f";
			var upColour = "f9761b";
			var downUpColour = "97cd5d";
			var downColour = "589bc8";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function nathanColours

		function mdbgColours()
		{
			//debugLog("mdbgColours");

			var flatColour = "ff0000";
			var upColour = "d89000";
			var downUpColour = "00a000";
			var downColour = "0000ff";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function mdbgColours

		function hanpingColours()
		{
			//debugLog("hanpingColours");

			var flatColour = "64b4ff";
			var upColour = "30b030";
			var downUpColour = "f08000";
			var downColour = "d00020";
			var fiveColour = "000000";
			var sixColour = "000000";
			var sevenColour = "000000";
			
			setChineseColours(flatColour, upColour, downUpColour, downColour, fiveColour, sixColour, sevenColour);
			setPinyinColours(flatColour, upColour, downUpColour, downColour);
			
			updateColours();
		} // end function hanpingColours
		
		function taiwaneseColours()
		{
			//debugLog("taiwaneseColours");
			
			var taiwaneseOneColour = document.getElementById("taiwaneseColourPickerOne").value;
			var taiwaneseTwoColour = document.getElementById("taiwaneseColourPickerTwo").value;
			var taiwaneseThreeColour = document.getElementById("taiwaneseColourPickerThree").value;
			var taiwaneseFourColour = document.getElementById("taiwaneseColourPickerFour").value;
			var taiwaneseFiveColour = document.getElementById("taiwaneseColourPickerFive").value;
			var taiwaneseSevenColour = document.getElementById("taiwaneseColourPickerSeven").value;
			var taiwaneseEightColour = document.getElementById("taiwaneseColourPickerEight").value;
			
			setChineseColours(taiwaneseOneColour, taiwaneseTwoColour, taiwaneseThreeColour, taiwaneseFourColour, taiwaneseFiveColour, taiwaneseSevenColour, taiwaneseEightColour);
			
			updateColours();
		} // end function taiwaneseColours

		function cantoneseColours()
		{
			//debugLog("cantoneseColours");
			
			var cantoneseOneColour = document.getElementById("cantoneseColourPickerOne").value;
			var cantoneseTwoColour = document.getElementById("cantoneseColourPickerTwo").value;
			var cantoneseThreeColour = document.getElementById("cantoneseColourPickerThree").value;
			var cantoneseFourColour = document.getElementById("cantoneseColourPickerFour").value;
			var cantoneseFiveColour = document.getElementById("cantoneseColourPickerFive").value;
			var cantoneseSixColour = document.getElementById("cantoneseColourPickerSix").value;
			var sevenColour = "000000";
			
			setChineseColours(cantoneseOneColour, cantoneseTwoColour, cantoneseThreeColour, cantoneseFourColour, cantoneseFiveColour, cantoneseSixColour, sevenColour);
			
			updateColours();
		} // end function cantoneseColours

		
		function loadDictionaries()
		{
			//debugLog("loadDictionaries");
			
			combinedDictionaryData = "";
			
			var cnltDictionaryChecked = document.getElementById('cnltDictionaryCheckbox').checked;
			var cunpDictionaryChecked = document.getElementById('cunpDictionaryCheckbox').checked;
			var unihanDictionaryChecked = document.getElementById('unihanDictionaryCheckbox').checked;
			var cedictDictionaryChecked = document.getElementById('cedictDictionaryCheckbox').checked;
			var zhWiktionaryDictionaryChecked = document.getElementById('zhWiktionaryDictionaryCheckbox').checked;
			var enWiktionaryDictionaryChecked = document.getElementById('enWiktionaryDictionaryCheckbox').checked;
			var pingtypeDictionaryChecked = document.getElementById('pingtypeDictionaryCheckbox').checked;
						
			if (pingtypeDictionaryChecked == true)
			{
				if ((cnltDictionaryChecked == false) && (cunpDictionaryChecked == false) && (unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}

				loadDictionary("PinyinDefinitionsTonesSorted.txt");
			}

			if (cnltDictionaryChecked == true)
			{
				if ((cunpDictionaryChecked == false) && (unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cnltDictionary.txt");
			}

			if (cunpDictionaryChecked == true)
			{
				if ((unihanDictionaryChecked == false) && (cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cunpDictionary.txt");
			}

			if (unihanDictionaryChecked == true)
			{
				if ((cedictDictionaryChecked == false) && (zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("UnihanDictionary.txt");
			}

			if (cedictDictionaryChecked == true)
			{
				if ((zhWiktionaryDictionaryChecked == false) && (enWiktionaryDictionaryChecked == false))
				{
					lastDictionary = true;
				}
			
				loadDictionary("cedictPlusAndtsu8Dictionary.txt");
			}

			if (zhWiktionaryDictionaryChecked == true)
			{
				if (enWiktionaryDictionaryChecked == false)
				{
					lastDictionary = true;
				}
			
				loadDictionary("zhWiktionaryDictionary.txt");
			}

			if (enWiktionaryDictionaryChecked == true)
			{
				lastDictionary = true;
			
				loadDictionary("enWiktionaryDictionary.txt");
			}
			
		} // end function loadDictionaries
		
		function dictionaryEditorBopomofoButtonClicked()
		{
			//debugLog("dictionaryEditorBopomofoButtonClicked");
			
			if (document.getElementById("bopomofoKeyboard").style.visibility == "hidden")
			{
				document.getElementById("bopomofoKeyboard").style.visibility = "visible";
				document.getElementById("bopomofoKeyboard").style.height = "auto";
				document.getElementById("bopomofoKeyboard").style.width = "auto";
			} else {
				document.getElementById("bopomofoKeyboard").style.visibility = "hidden";
				document.getElementById("bopomofoKeyboard").style.height = "0px";
				document.getElementById("bopomofoKeyboard").style.width = "0px";
			}
			
		} // end function dictionaryEditorBopomofoButtonClicked
		
		function dictionaryEditorCharsButtonClicked()
		{
			//debugLog("dictionaryEditorCharsButtonClicked");
			
			var thisChineseString = document.getElementById("dictionaryEditorChineseTextArea").value;
						
			var numberCharacters = thisChineseString.length;
			
			var thisPinyinArray = [];
			var thisTones = "";
			
			for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
			{
				var thisCharacter = thisChineseString[currentCharacter];
								
				var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisCharacter + "	", "\n");
								
				var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
				var lineLength = thisDictionaryLineArray.length;
				
				var thisDefinition = "";
				var thisCharacterPinyin = "";
				var thisToneless = "";
				var thisTone = "";
				
				thisDefinition = thisDictionaryLineArray[0];

				if (lineLength >= 1)
				{
					thisCharacterPinyin = thisDictionaryLineArray[1];
				}
				
				if (lineLength >= 2)
				{
					thisToneless = thisDictionaryLineArray[2];
				}
				
				if (lineLength >= 3)
				{
					thisTone = thisDictionaryLineArray[3];
				}
						
				
				
				thisPinyinArray.push(thisCharacterPinyin);
				
				thisTones = thisTones + thisTone;
			} // end for every character
			
			var thisPinyin = thisPinyinArray.join(" ");
			
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
			
		} // end function dictionaryEditorCharsButtonClicked
		
		function typeBopomofo(thisCharacter)
		{
			//debugLog("typeBopomofo(" + thisCharacter + ")");

			var thisPinyin = document.getElementById("dictionaryEditorPinyinTextArea").value;

			if (thisCharacter == "delete")
			{
				var inputLength = thisPinyin.length;
				
				if (inputLength == 1)
				{
					thisPinyin = "";
				} else {
					thisPinyin = thisPinyin.substring(0, inputLength - 1);
				}
			} else {
				thisPinyin = thisPinyin + thisCharacter;
			}
								
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
			
		} // end function typeBopomofo
		
		function toneMarksToNumbers(thisPinyinString)
		{
			//debugLog("toneMarksToNumbers");
			
			var thisPinyinArray = thisPinyinString.split(" ");
			
			var numberWords = thisPinyinArray.length;
			
			var toneSuperscripts = ["", "¹", "²", "³", "⁴", "⁵"];
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisPinyinArray[currentWord];
				
				var searchRegexString = "^" + "(.*" + thisWord + ")";
			
				searchRegexString = searchRegexString + "$";
				
				var searchRegex = new RegExp(searchRegexString, "gm");
			
				//document.write(searchRegex);
			
				var searchResultsArray = toneNumbersMarks.match(searchRegex);
				
				// If there are search results
				if (searchResultsArray != null)
				{
					thisWord = searchResultsArray[0];
					thisWord = textBetween(thisWord, "start", "	");
					
					var thisToneless = thisWord.replace(/[0-9]/g,'');
					var thisTone = thisWord.replace(/[^0-9]/g,'');
					
					if ((thisTone > 0) && (thisTone <= 5))
					{
						thisTone = toneSuperscripts[thisTone];
					}
					
					thisWord = thisToneless + thisTone;
				}
				
				thisPinyinArray[currentWord] = thisWord;
			} // end for every letter in the alphabet
			
			thisPinyinString = thisPinyinArray.join(" ");
			
			return thisPinyinString;
			
		} // end function toneMarksToNumbers
		
		function toneNumbersToToneMarks()
		{
			//debugLog("toneNumbersToToneMarks");

			var thisPinyinString = document.getElementById("dictionaryEditorPinyinTextArea").value;
			
			var thisPinyinArray = thisPinyinString.split(" ");
			
			var numberWords = thisPinyinArray.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisPinyinArray[currentWord];
				
				if (contains(toneNumbersMarks, "\n" + thisWord + "	") == true)
				{
					thisWord = textBetween(toneNumbersMarks, "\n" + thisWord + "	", "\n");
				}
				
				thisPinyinArray[currentWord] = thisWord;
			} // end for every letter in the alphabet
			
			thisPinyinString = thisPinyinArray.join(" ");
			
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyinString;
		
		} // end function toneNumbersToToneMarks
		
		function bopomofoToPinyin()
		{
			//debugLog("bopomofoToPinyin");

			var thisBopomofoString = document.getElementById("dictionaryEditorPinyinTextArea").value;
			
			/* Bopomofo to pinyin with tone numbers */
			var bopomofoAlphabet = ["ㄅ", "ㄆ", "ㄇ", "ㄈ", "ㄉ", "ㄊ", "ㄋ", "ㄌ", "ㄍ", "ㄎ", "ㄏ", "ㄐ", "ㄑ", "ㄒ", "ㄓ", "ㄔ", "ㄕ", "ㄖ", "ㄗ", "ㄘ", "ㄙ", "ㄩㄝ", "ㄩㄢ", "ㄩㄣ", "ㄩㄥ", "ㄩ", "ㄨㄚ", "ㄨㄛ", "ㄨㄞ", "ㄨㄟ", "ㄨㄢ", "ㄨㄣ", "ㄨㄤ", "ㄨㄥ", "ㄨ", "ㄧㄚ", "ㄧㄛ", "ㄧㄝ", "ㄧㄞ", "ㄧㄠ", "ㄧㄡ", "ㄧㄢ", "ㄧㄣ", "ㄧㄤ", "ㄧㄥ", "ㄧ", "ㄚ", "ㄛ", "ㄜ", "ㄝ", "ㄞ", "ㄟ", "ㄠ", "ㄡ", "ㄢ", "ㄣ", "ㄤ", "ㄥ", "ㄦ", "˙", "ˊ", "ˇ", "ˋ"];
			var pinyinAlphabet = ["b", "p", "m", "f", "d", "t", "n", "l", "g", "k", "h", "j", "q", "x", "zh", "ch", "sh", "r", "z", "c", "s", "üe", "üan", "ün", "iong", "ü", "ua", "uo", "uai", "ui", "uan", "un", "uang", "ong", "u", "ia", "io", "ie", "iai", "iao", "iu", "ian", "in", "iang", "ing", "i", "a", "o", "e", "ê", "ai", "ei", "ao", "ou", "an", "en", "ang", "eng", "er", "5", "2", "3", "4"];
			
			var numberLetters = bopomofoAlphabet.length;
			
			for (var currentLetter = 0; currentLetter < numberLetters; currentLetter++)
			{
				var thisBopomofoLetter = bopomofoAlphabet[currentLetter];
				var thisPinyinLetter = pinyinAlphabet[currentLetter];
				
				thisBopomofoString = replaceChars(thisBopomofoString, thisBopomofoLetter, thisPinyinLetter);
				
			} // end for every letter in the alphabet
			
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisBopomofoString;
			
			toneNumbersToToneMarks();
			
		} // end function bopomofoToPinyin
		
		function dictionaryEditorSearch()
		{
			//debugLog("dictionaryEditorSearch");
			
			var thisChineseString = document.getElementById("dictionaryEditorChineseTextArea").value;
			
			thisChineseString = replaceChars(thisChineseString, "	", "");
			
			document.getElementById("dictionaryEditorChineseTextArea").value = thisChineseString;
			
			var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisChineseString + "	", "\n");
				
			var thisDictionaryLineArray = thisDictionaryLine.split("	");
						
			var lineLength = thisDictionaryLineArray.length;
			
			var thisDefinition = "";
			var thisPinyin = "";
			var thisToneless = "";
			var thisTone = "";
			
			thisDefinition = thisDictionaryLineArray[0];

			if (lineLength >= 1)
			{
				thisPinyin = thisDictionaryLineArray[1];
			}
			
			if (lineLength >= 2)
			{
				thisToneless = thisDictionaryLineArray[2];
			}
			
			if (lineLength >= 3)
			{
				thisTone = thisDictionaryLineArray[3];
			}
			
			document.getElementById("dictionaryEditorPinyinTextArea").value = thisPinyin;
			document.getElementById("dictionaryEditorEnglishTextArea").value = thisDefinition;
			
		} // end function dictionaryEditorSearch
		
		function dictionaryEditorEditCounts()
		{
			//debugLog("dictionaryEditorEditCounts()");
			
			var addWords = localStorage["addWords"];
			
			if (addWords == undefined)
			{
				addWords = "";
				localStorage["addWords"] = "";
			}
			
			var addWordsLength = addWords.split("\n").length - 1;
			
			document.getElementById("addedLabel").innerText = addWordsLength + " added";
			
			var editWords = localStorage["editWords"];
			
			if (editWords == undefined)
			{
				editWords = "";
				localStorage["editWords"] = "";
			}

			var editWordsLength = editWords.split("\n").length - 1;
			
			document.getElementById("editedLabel").innerText = editWordsLength + " edited";
			
			var removeWords = localStorage["removeWords"];

			if (removeWords == undefined)
			{
				removeWords = "";
				localStorage["removeWords"] = "";
			}

			var removeWordsLength = removeWords.split("\n").length - 1;
			
			document.getElementById("deletedLabel").innerText = removeWordsLength + " deleted";
			
			var uploadedCount = localStorage["uploadedCount"];
			
			if (uploadedCount == undefined)
			{
				uploadedCount = 0;
			}
			
			document.getElementById("uploadedLabel").innerText = uploadedCount + " uploaded";
			
		} // end function dictionaryEditorEditCounts
		
		function addWordsButtonClicked()
		{
			//debugLog("addWordsButtonClicked()");
			
			var wordDefinitions = document.getElementById("chineseTextArea").value;
			
			var wordDefinitionsLines = wordDefinitions.split("\n");
			
			var numberWords = wordDefinitionsLines.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisDefinition = wordDefinitionsLines[currentWord];
				
				var thisDefinitionArray = thisDefinition.split("	");
				
				var thisWordChinese = thisDefinitionArray[0];
				var thisWordPinyin = thisDefinitionArray[1];
				//var thisWordTones = thisDefinitionArray[2];
				var thisWordEnglish = thisDefinitionArray[2];
				
				if ((thisWordChinese != undefined) && (thisWordPinyin != undefined) && (thisWordEnglish != undefined))
				{
				
					var thisWordTones = getTones(thisWordPinyin);
				
					addWordTones(thisWordChinese, thisWordPinyin, thisWordTones, thisWordEnglish)
					
					
				} // end if there is a valid definition
				
			} // end for every word
			
			writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			
		} // end function addWordsButtonClicked
		
		function addWordTones(thisWordChinese, thisWordPinyin, thisWordTones, thisWordEnglish)
		{
			//debugLog("addWordDefinition");
			
			var thisWordPinyinToneless = removeTones(thisWordPinyin);
						
			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	";
			
			if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == false)
			{
				// Add the word to the dictionary
				combinedDictionaryData = combinedDictionaryData + thisDefinition + "\n";
				
				//var addText = thisDefinition + "	" + getDateString();
				
				// Save to the file
				//appendToFile("addWords.txt", addText);
				//saveToLocalStorage("addWords", addText);
				
			} else {
				// Edit the word
				
				var newDefintion = thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	" ;
				
				// Get the existing word
				var oldDefinition = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
				
				var oldDefinitionArray = oldDefinition.split("	");
				var oldWordEnglish = oldDefinitionArray[0];
				var oldWordPinyin = oldDefinitionArray[1];
				var oldWordToneless = oldDefinitionArray[2];
				var oldWordTones = oldDefinitionArray[3];
				
				//if (oldWordTones != thisWordTones)
				//{
					//if (oldWordTones != 5)
					//{
						//if (oldWordEnglish.length > thisWordEnglish.length)
						//{
							// Replace the definition in the dictionary
							//combinedDictionaryData = replaceChars(combinedDictionaryData,oldDefinition,newDefintion);
						//}
					//}
				//} // end if there is a valid definition
			
				//var editText = thisDefinition + "	" + getDateString();
					
				// Save to the file
				//appendToFile("editWords.txt", editText);
				//saveToLocalStorage("editWords", editText);
				
			} // if the dictionary contains the word already
			
			// Save the new dictionary
	  		//var useGithub = document.getElementById("useGithubCheckbox").checked;

			//if (useGithub == false)
			//{
			//	writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			//} else {
			//	saveDictionaryToLocalStorage(combinedDictionaryData.length);
			//}
			
		} // end function addWordTones
		
				
		function addWord(thisWordChinese, thisWordPinyin, thisWordEnglish)
		{
			//debugLog("addWord");
			
			var thisWordPinyinToneless = removeTones(thisWordPinyin);
			var thisWordTones = getTones(thisWordPinyin);
						
			var thisDefinition = thisWordChinese + "	" + thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	";
			
			if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == false)
			{
				// Add the word to the dictionary
				combinedDictionaryData = combinedDictionaryData + thisDefinition + "\n";
				
				//var addText = thisDefinition + "	" + getDateString();
				
				// Save to the file
				//appendToFile("addWords.txt", addText);
				//saveToLocalStorage("addWords", addText);
				
			} else {
				// Edit the word
			
				// Get the existing word
				var oldDefinition = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
						
				var newDefintion = thisWordEnglish + "	" + thisWordPinyin + "	" + thisWordPinyinToneless + "	" + thisWordTones + "	" ;
						
				// Replace the definition in the dictionary
				combinedDictionaryData = replaceChars(combinedDictionaryData,oldDefinition,newDefintion);
				
				//var editText = thisDefinition + "	" + getDateString();
				
				// Save to the file
				//appendToFile("editWords.txt", editText);
				//saveToLocalStorage("editWords", editText);
				
			} // if the dictionary contains the word already
			
			// Save the new dictionary
	  		//var useGithub = document.getElementById("useGithubCheckbox").checked;

			//if (useGithub == false)
			//{
			//	writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			//} else {
			//	saveDictionaryToLocalStorage(combinedDictionaryData.length);
			//}
			
		} // end function addWord
		
		function dictionaryEditorAddButtonClicked()
		{
			//debugLog("dictionaryEditorAddButtonClicked");

			var thisWordChinese = document.getElementById("dictionaryEditorChineseTextArea").value;
			var thisWordPinyin = document.getElementById("dictionaryEditorPinyinTextArea").value;
			var thisWordEnglish = document.getElementById("dictionaryEditorEnglishTextArea").value;
			
			addWord(thisWordChinese, thisWordPinyin, thisWordEnglish);
			
			document.getElementById("dictionaryEditorChineseTextArea").value = "";
			document.getElementById("dictionaryEditorPinyinTextArea").value = "";
			document.getElementById("dictionaryEditorEnglishTextArea").value = "";
			
			dictionaryEditorEditCounts();
			
		} // end function dictionaryEditorAddButtonClicked
				
		function dictionaryEditorRemoveButtonClicked()
		{
			//debugLog("dictionaryEditorRemoveButtonClicked");
			
			var thisWord = document.getElementById("dictionaryEditorRemoveTextArea").value;
			
			if (thisWord != "")
			{
				var thisDefinition = textBetween(combinedDictionaryData,"\n"+thisWord+"	","\n");
				
				var thisDictionaryParts = combinedDictionaryData.split("\n"+thisWord+"	");
				
				var newDictionary = "";
				
				var numberParts = thisDictionaryParts.length - 1;
				
				for (var currentPart = 0; currentPart <= numberParts; currentPart++)
				{
					var thisPart = thisDictionaryParts[currentPart];
				
					// Remove the first line if it's not the first part
					if (currentPart != 0)
					{
						thisPart = thisPart.substring(thisPart.indexOf("\n") + 1);
					} // end remove first lines

					// Remove the last line if it's not the last part
					if (currentPart != numberParts)
					{
						thisPart = thisPart.substring(0, thisPart.lastIndexOf("\n"));
					} // end remove last lines
					
					newDictionary = newDictionary + "\n" + thisPart;
					
				} // end for every dictionary part
				
				combinedDictionaryData = newDictionary;
				
				// Update the user interface
				//var removeAreaWords = document.getElementById("dictionaryRemoveArea").value;
				//removeAreaWords = replaceChars(removeAreaWords,thisWord,"");
				//document.getElementById("dictionaryRemoveArea").value = removeAreaWords;
				
				var removeText = thisWord + "	" + getDateString();

				// Save to the file
				//appendToFile("removeWords.txt", removeText);
				saveToLocalStorage("removeWords", removeText);
				
			} // if the word is not blank
			
			// Save the new dictionary
	  		var useGithub = document.getElementById("useGithubCheckbox").checked;

			if (useGithub == false)
			{
				writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			} else {
				saveDictionaryToLocalStorage(combinedDictionaryData.length);
			}
			
			document.getElementById("dictionaryEditorRemoveTextArea").value = "";
						
			dictionaryEditorEditCounts();
			
		} // end function dictionaryEditorRemoveButtonClicked
		
		function dictionariesLoaded()
		{
			//debugLog("dictionariesLoaded");

			if ((combinedDictionaryData == "") || (combinedDictionaryData == undefined))
			{
				combinedDictionaryData = localStorage["dictionary"];
			}

			if ((combinedDictionaryData == "") || (combinedDictionaryData == undefined))
			{
			    document.getElementById("chineseTextArea").value = "Error loading dictionaries";
			    
			    return;
			}
					
			// If we have parameters
			if ((QueryString.command != "") && (QueryString.command != undefined))
			{
			    eval(QueryString.command);
			}

			// If we have a word list
			if ((QueryString.wordList != "") && (QueryString.wordList != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var wordList = QueryString.wordList;
				
				debugLog(wordList);
				
				if (wordList == "tocfl")
				{
					loadCommonWords("wordLists/TOCFL/tocfl.txt");
				}
			}

			// If we have an english file
			if ((QueryString.englishFile != "") && (QueryString.englishFile != undefined))
			{
				//var englishUrl = encodeURI(QueryString.englishFile);
				var englishUrl = QueryString.englishFile;
			
			    loadEnglish(englishUrl);
			}
			
			// If we have a Chinese file
			if ((QueryString.chineseFile != "") && (QueryString.chineseFile != undefined))
			{
				//var chineseUrl = encodeURI(QueryString.chineseFile);
				var chineseUrl = QueryString.chineseFile;

			    loadChinese(chineseUrl);
			}

			// If we have parameters
			if ((QueryString.text != "") && (QueryString.text != undefined))
			{
			    document.getElementById("chineseTextArea").value = QueryString.text;
			    document.getElementById("englishTextArea").value = "";
			    
			    wordSpaceButtonClicked();
			    
			    translateInterface();
			}
			


		} // end function dictionariesLoaded
		
		function isPhpRunningResponseHandler(request)
		{
		  //debugLog("appendToFileResponseHandler");
		  if (request.readyState == 4)
		  {
			// The request is done
			if (request.status == 200)
			{
			  // All is well
			  
			  
			}
		  }

		  return;
		}
		  		
		function isPhpRunning()
		{
			//debugLog("isPhpRunning");
			
			var url = "whoami.php";

			var thisRequest = new XMLHttpRequest();
		    thisRequest.open("GET",url,true);
    		thisRequest.send();

    		thisRequest.onreadystatechange = function(){
    			if (thisRequest.readyState== 4 && thisRequest.status == 200)
    			{
					//debugLog(thisRequest.responseText);

    				if (contains(thisRequest.responseText, "php"))
    				{
    					document.getElementById("useGithubCheckbox").checked = true;
    				} else {
    					document.getElementById("useGithubCheckbox").checked = false;
    				}
                } else {
    				document.getElementById("useGithubCheckbox").checked = true;
                }
            }
		} // end function isPhpRunning
		
		function uploadButtonClicked()
		{
			//debugLog("uploadButtonClicked");
			
			var uploadedCount = localStorage["uploadedCount"];
			
			if (uploadedCount == undefined)
			{
				uploadedCount = 0;
			} else {
				uploadedCount = uploadedCount * 1;
			}
			
			var addWords = localStorage["addWords"];
			
			if (addWords == undefined)
			{
				addWords = "";
			}
			
			if (addWords != "")
			{
				appendToGithub("addWords.txt", addWords);
				
				uploadedCount = uploadedCount + addWords.split("\n").length - 1;

				localStorage["addWords"] = "";
			}

			var editWords = localStorage["editWords"];
			
			if (editWords == undefined)
			{
				editWords = "";
			}
			
			if (editWords != "")
			{
				appendToGithub("editWords.txt", editWords);

				uploadedCount = uploadedCount + editWords.split("\n").length - 1;
				
				localStorage["editWords"] = "";
			}

			var removeWords = localStorage["removeWords"];
			
			if (removeWords == undefined)
			{
				removeWords = "";
			}
			
			if (removeWords != "")
			{
				appendToGithub("removeWords.txt", removeWords);

				uploadedCount = uploadedCount + removeWords.split("\n").length - 1;

				localStorage["removeWords"] = "";
			}

			localStorage["uploadedCount"] = uploadedCount;
			
			dictionaryEditorEditCounts();
			
		} // end function uploadButtonClicked
		
		function helpButtonClicked()
		{
			//debugLog("helpButtonClicked");
			
			var thisUrl = "docs/index.html";
			window.open(thisUrl,'_blank');
			
		} // end function helpButtonClicked
		
		function simplifiedToTraditional(thisChinese)
		{
			//debugLog("simplifiedToTraditional");
			
			var traditionalChinese = "";
			
			var thisChineseLines = thisChinese.split("\n");
			
			for (var currentLine = 0; currentLine < thisChineseLines.length; currentLine++)
			{
			
				var thisChineseLine = thisChineseLines[currentLine];
				
				var numberCharacters = thisChineseLine.length;
				var lastWasNotChinese = false;
				var traditionalChineseLine = "";
				
				var lineIsEnglish = true;
								
				for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
				{
					var thisWord = "";
				
					var wordFound = false;
					
					for (var wordLength = 5; wordLength >= 2; wordLength--)
					{
				
						var lastCharacter = currentCharacter + wordLength;
						
						if (lastCharacter > numberCharacters)
						{
							lastCharacter = numberCharacters;
						}
						
						thisWord = thisChineseLine.substring(currentCharacter, lastCharacter);
						
						var thisCharacter = thisChineseLine[currentCharacter];

						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							//traditionalChineseLine = traditionalChineseLine + thisCharacter;
						
							//lastWasNotChinese = true;
							
							// Move the character along in the string
							//currentCharacter = currentCharacter + 1;
							
							wordFound == false;
							
						} else {

							//lastWasNotChinese = false;
							
							var inDictionary = contains(simplifiedData, "\n" + thisWord + "	");
							
							//if (contains(longWords, " " + thisWord) == true)
							if (inDictionary == true)
							{
								// Move the character along in the string
								currentCharacter = currentCharacter + wordLength - 1;
							
								wordFound = true;
						
								// Exit the loop cleanly
								wordLength = 0;
							} // end if the character is not Chinese
							
						} // if the word exists
					
					} // end for every word length
				
					// If the word is not found, just use the character
					if (wordFound == false)
					{
						var thisCharacter = thisChineseLine[currentCharacter];
					
						if (isChinese(thisCharacter) == false)
						{
							// Don't add spaces between non-Chinese characters
							traditionalChineseLine = traditionalChineseLine + thisCharacter;
							
							lastWasNotChinese = true;
						
						} else {
						
							// Add a space if we're back to parsing Chinese
							if (lastWasNotChinese == true)
							{
								//traditionalChineseLine = traditionalChineseLine + " ";
								lastWasNotChinese = false;
							}
							
							if (contains(simplifiedData, "\n" + thisCharacter + "	"))
							{
								var traditionalCharacter = textBetween(simplifiedData, "\n" + thisCharacter + "	", "\n");
								traditionalCharacter = textBetween(traditionalCharacter, "start", " ");
								//traditionalChineseLine = traditionalChineseLine + traditionalCharacter + " ";
								traditionalChineseLine = traditionalChineseLine + traditionalCharacter;
							} else {
								//traditionalChineseLine = traditionalChineseLine + thisCharacter + " ";					
								traditionalChineseLine = traditionalChineseLine + thisCharacter;
							}
							

						} // end if this character is not Chinese
					
					} else {

						// Add a space if we're back to parsing Chinese
						if (lastWasNotChinese == true)
						{
							traditionalChineseLine = traditionalChineseLine + " ";
							lastWasNotChinese = false;
						}
						
						var traditionalWord = textBetween(simplifiedData, "\n" + thisWord + "	", "\n");
						traditionalWord = textBetween(traditionalWord, "start", " ");

						//traditionalChineseLine = traditionalChineseLine + traditionalWord + " ";
						traditionalChineseLine = traditionalChineseLine + traditionalWord;

					} // end if the word was not found
								
				
				} // end for every character
				
				traditionalChinese = traditionalChinese + traditionalChineseLine + "\n";

			} // end for every line
			
			return traditionalChinese;
			
		} // end function simplifiedToTraditional
		
		function simplifiedToTraditionalButtonClicked()
		{
			//debugLog("simplifiedToTraditionalButtonClicked");

			var thisChinese = document.getElementById("simplifiedInputTextArea").value;
			
			var traditionalChinese = simplifiedToTraditional(thisChinese);
			
			document.getElementById("chineseTextArea").value = traditionalChinese;
			
		} // end function simplifiedToTraditionalButtonClicked
		
		function spacedToSimplifiedButtonClicked()
		{
			//debugLog("spacedToSimplifiedButtonClicked");
			
			var spacedTraditional = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedWords = spacedTraditional.split(" ");
			
			var numberWords = spacedWords.length;
			
			var spacedSimplified = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedWords[currentWord];
				
				// Translate the word
				if (contains(traditionalData, "\n" + thisWord + "	", "\n"))
				{
					var simplifiedWord = textBetween(traditionalData, "\n" + thisWord + "	", "\n");
					simplifiedWord = textBetween(simplifiedWord, "start", " ");
					
					spacedSimplified = spacedSimplified + simplifiedWord + " ";
					
				} else {
					
					// Translate the characters
					
					var thisWordCharacters = thisWord.split("");
					var numberCharacters = thisWordCharacters.length;
					
					var thisWordSimplified = "";
					
					for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
					{
						var thisCharacter = thisWordCharacters[currentCharacter];
						
						if (contains(traditionalData, "\n" + thisCharacter + "	", "\n"))
						{
							var simplifiedCharacter = textBetween(traditionalData, "\n" + thisCharacter + "	", "\n");
							simplifiedCharacter = textBetween(simplifiedCharacter, "start", " ");
							thisWordSimplified = thisWordSimplified + simplifiedCharacter;
						} else {
							thisWordSimplified = thisWordSimplified + thisCharacter;
						} // end if the character is in the dictionary
						
					} // end for every character
					
					
					spacedSimplified = spacedSimplified + thisWordSimplified + " ";
				
				} // end if the word is in the traditional phrases
				
				
			} // end for every word
			
			document.getElementById("simplifiedSpacedTextArea").value = spacedSimplified;
			
		} // end function spacedToSimplifiedButtonClicked

		function hongKongButtonClicked()
		{
			//debugLog("hongKongButtonClicked");
			
			var spacedChinese = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedChineseWordsArray = spacedChinese.split(" ");
			
			var numberWords = spacedChineseWordsArray.length;
			
			var hongKongeseChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedChineseWordsArray[currentWord];
			
				if (contains(hongKongData, "\n" + thisWord + "	"))
				{
					var thishongKongeseWord = textBetween(hongKongData, "\n" + thisWord + "	", "\n");
					thishongKongeseWord = textBetween(thishongKongeseWord, "start", " ");
					
					hongKongeseChinese = hongKongeseChinese + thishongKongeseWord + " ";
				} else {
					hongKongeseChinese = hongKongeseChinese + thisWord + " ";
				}
			} // end for every word
			
			document.getElementById("chineseSpacedTextArea").value = hongKongeseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			translateInterface();
			
		} // end function hongKongButtonClicked

		function taiwanButtonClicked()
		{
			//debugLog("taiwanButtonClicked");
			
			var spacedChinese = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedChineseWordsArray = spacedChinese.split(" ");
			
			var numberWords = spacedChineseWordsArray.length;
			
			var taiwaneseChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedChineseWordsArray[currentWord];
			
				if (contains(taiwanData, "\n" + thisWord + "	"))
				{
					var thisTaiwaneseWord = textBetween(taiwanData, "\n" + thisWord + "	", "\n");
					thisTaiwaneseWord = textBetween(thisTaiwaneseWord, "start", " ");
					
					taiwaneseChinese = taiwaneseChinese + thisTaiwaneseWord + " ";
				} else {
					taiwaneseChinese = taiwaneseChinese + thisWord + " ";
				}
			} // end for every word
			
			document.getElementById("chineseSpacedTextArea").value = taiwaneseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			translateInterface();
			
		} // end function taiwanButtonClicked

		function japanButtonClicked()
		{
			//debugLog("japanButtonClicked");
			
			var spacedChinese = document.getElementById("chineseSpacedTextArea").value;
			
			var spacedChineseWordsArray = spacedChinese.split(" ");
			
			var numberWords = spacedChineseWordsArray.length;
			
			var japaneseChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = spacedChineseWordsArray[currentWord];
			
				if (contains(japanData, "\n" + thisWord + "	"))
				{
					var thisjapaneseWord = textBetween(japanData, "\n" + thisWord + "	", "\n");
					thisjapaneseWord = textBetween(thisjapaneseWord, "start", " ");
					
					japaneseChinese = japaneseChinese + thisjapaneseWord + " ";
				} else {
					japaneseChinese = japaneseChinese + thisWord + " ";
				}
			} // end for every word
			
			document.getElementById("chineseSpacedTextArea").value = japaneseChinese;
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;

			document.getElementById('chineseCheckbox').checked = true;
			
			translateInterface();
			
		} // end function japanButtonClicked

		function hexToChineseButtonClicked()
		{
			//debugLog("hexToChineseButtonClicked");

			var thisInputPhrase = document.getElementById("simplifiedInputTextArea").value;
			
			var thisInputPhraseArray = thisInputPhrase.split(" ");
			
			if (thisInputPhraseArray == null)
			{
				return;
			}
			
			var numberWords = thisInputPhraseArray.length;
			
			var thisChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisInputPhraseArray[currentWord];
				
				var thisWordChinese = hexToCharacter(thisWord);
				
				thisChinese = thisChinese + thisWordChinese;
				
			} // end for every hex word
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
		} // end function hexToChineseButtonClicked

		function unitypeToChineseButtonClicked()
		{
			//debugLog("unitypeToChineseButtonClicked");

			var thisInputPhrase = document.getElementById("simplifiedInputTextArea").value;
			
			var thisInputPhraseArray = thisInputPhrase.split(" ");
			
			if (thisInputPhraseArray == null)
			{
				return;
			}
			
			var numberWords = thisInputPhraseArray.length;
			
			var thisChinese = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = thisInputPhraseArray[currentWord];
				
				var thisWordChinese = unitypeToCharacter(thisWord);
				
				thisChinese = thisChinese + thisWordChinese;
				
			} // end for every hex word
			
			document.getElementById("chineseTextArea").value = thisChinese;
			
		} // end function unitypeToChineseButtonClicked

		function useSimplified()
		{
			//debugLog("useSimplified");
			
			document.getElementById('simplifiedSpacedCheckbox').checked = true;
		} // end function useSimplified
		
		function cleanHtml(thisString)
		{
			//debugLog("cleanHtml(" + thisString + ")");
			
			var regex = /(<([^>]+)>)/ig;
			
			var cleanText = thisString.replace(regex, "");
			
			return cleanText;
			
		} // end function cleanHtml
		
		function listOffset(thisArray, thisString)
		{
			//debugLog("listOffset(" + thisArray.join("	") + "," + thisString + ")");
			
			thisString = " " + thisString + " ";
			
			var foundOffset = -1;
			
			var arrayLength = thisArray.length;
			
			for (var currentItem = 0; currentItem < arrayLength; currentItem++)
			{
				var thisItem = " " + thisArray[currentItem] + " ";
				
				if (contains(thisItem, thisString) == true)
				{
					foundOffset = currentItem;
					break;
				} // end
				
			} // end for every item in the array
			
			
			//debugLog(foundOffset);
			
			return foundOffset;
			
		} // end function listOffset

		function zeroPad(thisNumber, thisLength) 
		{
			var thisText = "" + thisNumber;
		
			var startLength = thisText.length;

			for (var currentLength = startLength; currentLength < thisLength; currentLength++)
			{
				thisText = "0" + thisText;
			}
			
			//debugLog(thisText);
			
			return thisText;
		} // end function zeroPad
		
		function numberToTime(thisEndTimeNumber)
		{
			//debugLog("numberToTime");

			thisEndTimeSeconds = Math.floor(thisEndTimeNumber);
			thisEndTimeMilliseconds = thisEndTimeNumber - thisEndTimeSeconds;
			
			thisEndTimeMilliseconds = Math.floor(thisEndTimeMilliseconds * 1000);
			
			thisEndTimeHours = 0;
			
			while (thisEndTimeSeconds > 3600)
			{
				thisEndTimeHours = thisEndTimeHours + 1;
				thisEndTimeSeconds = thisEndTimeSeconds - 3600;
			}
							
			thisEndTimeMinutes = Math.floor(thisEndTimeSeconds / 60);
			
			thisEndTimeSeconds = thisEndTimeSeconds - (thisEndTimeMinutes * 60);
			
			thisEndTimeHours = zeroPad(thisEndTimeHours, 2);
			thisEndTimeMinutes = zeroPad(thisEndTimeMinutes, 2);
			thisEndTimeSeconds = zeroPad(thisEndTimeSeconds, 2);
			thisEndTimeMilliseconds = zeroPad(thisEndTimeMilliseconds, 3);
			
			thisEndTime = thisEndTimeHours + ":" + thisEndTimeMinutes + ":" + thisEndTimeSeconds + "," + thisEndTimeMilliseconds;
			
			return thisEndTime;
		} // end function numberToTime
		
		function subtitlesButtonClicked()
		{
			//debugLog("subtitlesButtonClicked");
			
			document.getElementById('simplifiedSpacedCheckbox').checked = false;
			document.getElementById('breakMissingWordsCheckbox').checked = true;
			document.getElementById('monospaceTextCheckbox').checked = false;
			
			var subtitlesText = document.getElementById("simplifiedInputTextArea").value;
			
			var subtitlesLines = subtitlesText.split("\n");
			
			var numberLines = subtitlesLines.length;
			
			// Combine subtitles into correctly alternating lines
			var numbersText = "";
			var timesText = "";
			var englishText = "";
			var chineseText = "";
			var thisSubtitleNumber = "";
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = subtitlesLines[currentLine];
				
				var lineLength = thisLine.length;
				
				if (thisLine == "")
				{
					numbersText = numbersText + "\n";
					timesText = timesText + "\n";
					englishText = englishText + "\n";
					chineseText = chineseText + "\n";
					thisSubtitleNumber = "";
				} else {
					if ((isNumberString(thisLine) == true) && (thisSubtitleNumber == ""))
					{
						numbersText = numbersText + thisLine;
						thisSubtitleNumber = thisLine;
					} else {
						// If this line is a time
						if (contains(thisLine, " --> ") == true)
						{
							timesText = timesText + thisLine;
						} else {
							var cleanText = cleanHtml(thisLine);
							
							if (containsChineseString(cleanText) == true)
							{
								chineseText = chineseText + cleanText + " ";
							} else {
								// extra spaces in case we concatenate two lines
								englishText = englishText + cleanText + " ";
							}
						} // end if time
					} // end if number string
				} // end if blank line

			} // end for every line in the subtitles
			
			chineseText = replaceChars(chineseText, " \n", "\n");
			englishText = replaceChars(englishText, " \n", "\n");
			
			// Process the Chinese text
			
			chineseText = despace(chineseText);
			
			var despacedChineseText = chineseText;
			var despacedChineseTextArray = chineseText.split("\n");
			
			//chineseText = simplifiedToTraditional(chineseText);
			chineseText = wordSpace(chineseText);
			chineseText = replaceChars(chineseText, "\n ", "\n");
			
			// For every line in the numbers/times/chinese/english text
			
			var numbersTextArray = numbersText.split("\n");
			var timesTextArray = timesText.split("\n");
			var englishTextArray = englishText.split("\n");
			var chineseTextArray = chineseText.split("\n");
			
			
			
			numberLines = numbersTextArray.length;
			
			var subtitlesOutput = "";
			
			var chineseHtmlArray = [];
			
			var pinyinTextArray = [];
			var pinyinHtmlArray = [];
			
			var literalHtmlArray = [];
			var literalTextArray = [];
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var numbersTextLine = numbersTextArray[currentLine];
				var timesTextLine = timesTextArray[currentLine];
				var englishTextLine = englishTextArray[currentLine];				
				var chineseTextLine = chineseTextArray[currentLine];
				
				var translationOutput = translateText(chineseTextLine, englishTextLine);
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
								
				var translatedTextArray = translatedText.split("\n");
				var translatedTextChinese = translatedTextArray[0];
				var translatedTextPinyin = translatedTextArray[1];
				var translatedTextLiteral = translatedTextArray[2];
				var translatedTextEnglish = translatedTextArray[3];
				
				pinyinTextArray.push(translatedTextPinyin);
				
				/*
				translatedTextChinese = "<font size=\"17\">" + translatedTextChinese + "</font>";
				
				subtitlesOutput = subtitlesOutput + "\n" + numbersTextLine + "\n" + timesTextLine + "\n" + translatedTextChinese + "\n"  + translatedTextPinyin + "\n" + translatedTextLiteral + "\n" + translatedTextEnglish + "\n" + "\n";
				*/
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				var translatedHtmlArray = translatedHtml.split("</tr><tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];

				var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
				var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
				var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
				var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
				var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");

				chineseHtmlArray.push(translatedHtmlChinese);
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</div>", "</font>");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<div class=\"englishInChinese\">", "<font color=#" + chineseColourOne + ">");
				
				while (contains(translatedHtmlChinese, "  ") == true)
				{
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "  ", " ");
				}

				translatedHtmlChinese = "<font size=\"20\">" + translatedHtmlChinese + "</font>";
				
				var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
				var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
				var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
				var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
				var pinyinColourFive = pinyinColourOne;

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<tr>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</tr>", "");

				pinyinHtmlArray.push(translatedHtmlPinyin);

				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</td>", " ");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</div>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_6\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_7\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<div class=\"englishInChinese\">", "<font color=#" + pinyinColourOne + ">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "px\">", "\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</span>", "</font>");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<b>", "");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "</b>", "");
				
				while (contains(translatedHtmlPinyin, "   ") == true)
				{
					translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "   ", "  ");
				}

				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "<tr>", "");
				translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "</tr>", "");
				translatedHtmlLiteral = textBetween(translatedHtmlLiteral, "start", "<div class=\"english\">");

				while (contains(translatedHtmlLiteral, "   ") == true)
				{
					translatedHtmlLiteral = replaceChars(translatedHtmlLiteral, "   ", "  ");
				}
				// Change the font size
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"14\">", "<font size=\"10\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"15\">", "<font size=\"11\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"16\">", "<font size=\"12\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"17\">", "<font size=\"13\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"18\">", "<font size=\"14\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"19\">", "<font size=\"15\">");
				translatedHtmlPinyin = replaceChars(translatedHtmlPinyin, "<font size=\"20\">", "<font size=\"16\">");
				
				literalHtmlArray.push(translatedHtmlLiteral);
				
				literalTextArray.push(translatedTextLiteral);
				
				translatedTextLiteral = "<font size=\"12\"><font color=#000000>" + translatedTextLiteral + "</font></font>";
				
				translatedTextEnglish = "<font size=\"12\"><font color=#000000>" + translatedTextEnglish + "</font></font>";
				
				var thisSubtitle = numbersTextLine + "\n" + timesTextLine + "\n" + translatedHtmlChinese + "\n"  + translatedHtmlPinyin + "\n" + translatedTextLiteral + "\n" + translatedTextEnglish;
				
				thisSubtitle = replaceChars(thisSubtitle, "	", "  ");
				
				while (contains(thisSubtitle, "   "))
				{
					thisSubtitle = replaceChars(thisSubtitle, "   ", "  ");
				}
				
				thisSubtitle = replaceChars(thisSubtitle, "\n ", "\n");
				
				subtitlesOutput = subtitlesOutput + thisSubtitle + "\n" + "\n";
				
			} // end for every line
			
			document.getElementById("chineseTextArea").value = chineseText;
			document.getElementById("englishTextArea").value = englishText;
			document.getElementById("simplifiedSpacedTextArea").value = subtitlesOutput;
			
			var vocabularyArray = getVocabulary(chineseText);
			
			var vocabularyHtml = vocabularyArray[0];
			var vocabularyText = vocabularyArray[1];
			
			var vocabularyExamplesHtml = "";
			var vocabularyExamplesText = "";
			
			// Add examples to vocabulary
			vocabularyHtml = replaceChars(vocabularyHtml, "<table>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "\n", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "<tr>", "");
			vocabularyHtml = replaceChars(vocabularyHtml, "</table>", "");
			
			var vocabularyHtmlArray = vocabularyHtml.split("</tr>");
			
			var vocabularyTextArray = vocabularyText.split("\n");
			var numberLines = vocabularyTextArray.length;
			
			var addLiteral = true;
			
			var vocabularyExamplesSubtitles = "";
			var currentWordDefinitionSubtitle = 1;
			var vocabularyCommands = "";
			var audioCommands = "";
			var currentWordDefinitionSubtitleStartTime = 0;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLineHtml = vocabularyHtmlArray[currentLine];
				var thisLineText = vocabularyTextArray[currentLine];
				
				var thisWord = textBetween(thisLineText, "	", "	");
				
				if (thisWord != "")
				{
					var thisLineHtmlArray = thisLineHtml.split("</td>");
					
					var thisLineHtmlChinese = thisLineHtmlArray[1];
					var thisLineHtmlPinyin = thisLineHtmlArray[2];
					var thisLineHtmlLiteral = thisLineHtmlArray[3];
					
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</div>", "</font>");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
					thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<td>", "");
					
					thisLineHtmlChinese = "<font size=\"80\">" + thisLineHtmlChinese + "</font>";
					
					var thisWordChinese = cleanHtml(thisLineHtmlChinese);
					thisWordChinese = replaceChars(thisWordChinese, " ", "");
					
					var thisWordPinyin = "";
					
					if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == true)
					{
						var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
				
						var thisDictionaryLineArray = thisDictionaryLine.split("	");
				
						var lineLength = thisDictionaryLineArray.length;
				
						var thisDefinition = "";
						var thisCharacterPinyin = "";
						var thisToneless = "";
						var thisTone = "";
				
						thisDefinition = thisDictionaryLineArray[0];

						if (lineLength >= 1)
						{
							thisCharacterPinyin = thisDictionaryLineArray[1];
						}
				
						if (lineLength >= 2)
						{
							thisToneless = thisDictionaryLineArray[2];
						}
				
						if (lineLength >= 3)
						{
							thisTone = thisDictionaryLineArray[3];
						}
						
						var thisPinyinArray = thisCharacterPinyin.split(" ");
						var thisTonelessArray = thisToneless.split(" ");
						var thisTonesArray = thisTone.split("");
						
						var numberCharacters = thisWordChinese.length;
						
						var thisAudioCommand = "";
						
						if (numberCharacters > 1)
						{
							thisAudioCommand = "cat ";
						}
						
						for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
						{
							var thisCharacterToneless = thisTonelessArray[currentCharacter];
							var thisCharacterTone = thisTonesArray[currentCharacter];
							
							if (thisCharacterToneless == "")
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							if (thisCharacterTone == undefined)
							{
								addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
							}

							
							thisWordPinyin = thisWordPinyin + thisCharacterToneless + thisCharacterTone;

							if (numberCharacters > 1)
							{
								thisAudioCommand = thisAudioCommand + "\"PinyinAudio/" + thisCharacterToneless + thisCharacterTone + ".mp3\" ";
							}
							
						} // end for every character
						
						if (numberCharacters > 1)
						{							
							thisAudioCommand = thisAudioCommand + "> \"PinyinAudio/" + thisWordPinyin + ".mp3\"";
							
							audioCommands = audioCommands + thisAudioCommand + "\n";
						}

						
					} else {
					
						// Break the word into characters - not needed because all vocabulary words are in dictionary

					} // if the word is in the dictionary
					
					var wordSubtitleOffset = -1;
					
					var numberSubtitles = chineseTextArray.length;
					for (var currentSubtitle = 0; currentSubtitle < numberSubtitles; currentSubtitle++)
					{
						var thisWordSubtitleText = chineseTextArray[currentSubtitle];
						
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, " ", "");
						thisWordSubtitleText = replaceChars(thisWordSubtitleText, "	", "");
						
						if (contains(thisWordSubtitleText,thisWord))
						{
							wordSubtitleOffset = currentSubtitle;
							break;
						}
					} // go through the subtitles again because list offset doesn't work
					
					//debugLog(wordSubtitleOffset+" "+thisWord);
					
					var thisWordTime = timesTextArray[wordSubtitleOffset];
					var thisWordSubtitleHtml = chineseHtmlArray[wordSubtitleOffset];
					var thisWordSubtitleText = chineseTextArray[wordSubtitleOffset];
					var thisWordExamplePinyinHtml = pinyinHtmlArray[wordSubtitleOffset];
					var thisWordExamplePinyinText = pinyinTextArray[wordSubtitleOffset];
					var thisWordExampleLiteralHtml = literalHtmlArray[wordSubtitleOffset];
					var thisWordExampleLiteralText = literalTextArray[wordSubtitleOffset];
					var thisWordExampleEnglish = englishTextArray[wordSubtitleOffset];
				
					thisWordTime = textBetween(thisWordTime, "start", " -->");
					thisWordTime = textBetween(thisWordTime, "start", ",");
				
					var thisLineExampleHtml = thisLineHtml + "<td>" + thisWordTime + "</td><td>" + "<table><tr><td>" + "<table><tr>" + thisWordSubtitleHtml + "</tr><tr>" + thisWordExamplePinyinHtml + "</tr>";
					
					if (addLiteral == true)
					{
						thisLineExampleHtml = thisLineExampleHtml + "<tr>" + thisWordExampleLiteralHtml + "</tr>";
					}
					
					thisLineExampleHtml = thisLineExampleHtml + "</table></td></tr><tr><td>" + thisWordExampleEnglish + "</td></tr></table>" + "</td>";
						
					var thisLineExampleText = thisLineText + "	" + thisWordTime + "	" + thisWordSubtitleText + "	" + thisWordExamplePinyinText + "	" + thisWordExampleLiteralText + "	" + thisWordExampleEnglish;
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						vocabularyExamplesHtml = vocabularyExamplesHtml + "<tr id=\"" + thisWordChinese + "\">" + thisLineExampleHtml + "</tr>" + "\n";
						vocabularyExamplesText = vocabularyExamplesText + thisLineExampleText + "\n";
					}
					
					var thisWordSubtitleStartTime = currentWordDefinitionSubtitleStartTime;
					var thisWordSubtitleEndTime = thisWordSubtitleStartTime + 4;
					
					var thisWordSubtitleStartTimeString = numberToTime(thisWordSubtitleStartTime);
					var thisWordSubtitleEndTimeString = numberToTime(thisWordSubtitleEndTime);
					
					var thisWordSubtitleTime = thisWordSubtitleStartTimeString + " --> " + thisWordSubtitleEndTimeString;
					
					
					if (contains(commonWords,thisWordChinese) == true)
					{
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</div>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "px\">", "\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</span>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<b>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</b>", "");

						// Change the font size
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"14\">", "<font size=\"36\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"15\">", "<font size=\"40\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"16\">", "<font size=\"44\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"17\">", "<font size=\"48\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"18\">", "<font size=\"52\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"19\">", "<font size=\"56\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"20\">", "<font size=\"60\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</font></font> <font", " </font></font><font");
						
						thisLineHtmlLiteral = textBetween(thisLineHtml, "<div class=\"literal\">", "</div>");
					
						thisLineHtmlLiteral = "<font size=\"50\"><font color=#000000>" + thisLineHtmlLiteral + "</font></font>";
					
						var thisWordDefinitionSubtitle = currentWordDefinitionSubtitle + "\n" + thisWordSubtitleTime + "\n" + thisLineHtmlChinese + "\n" + thisLineHtmlPinyin + "\n" + thisLineHtmlLiteral + "\n";
					
						vocabularyExamplesSubtitles = vocabularyExamplesSubtitles + thisWordDefinitionSubtitle + "\n";
						
						var thisWordSubtitleStartTimeSeconds = replaceChars(thisWordSubtitleStartTimeString, ",000");
						var thisWordSubtitleEndTimeSeconds = replaceChars(thisWordSubtitleEndTimeString, ",000");
						
						//var thisVocabularyCommand = "ffmpeg -ss " + thisWordSubtitleStartTimeSeconds + " -to " + thisWordSubtitleEndTimeSeconds + " -async 1 -threads 9 -preset ultrafast -strict -2 \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						var thisVocabularyCommand = "ffmpeg -i \"last4SecondsPad5.mp4\" -i \"Audio/" + thisWordPinyin + ".mp3\" -vf subtitles=\"WordSubtitles/" + thisWordChinese + ".srt:force_style='FontName=PingFangTC-Regular,Outline=0'\" -map 0:v -map 1:a -threads 9 -preset ultrafast \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						vocabularyCommands = vocabularyCommands + thisVocabularyCommand + "\n";
						
						currentWordDefinitionSubtitle = currentWordDefinitionSubtitle + 1;
						currentWordDefinitionSubtitleStartTime = thisWordSubtitleEndTime;
					}

				} // end if the word is not blank
			} // end for every line in the vocabulary
			
			vocabularyExamplesHtml = "<table>" + vocabularyExamplesHtml + "</table>";
			
			//debugLog(vocabularyExamplesHtml);
			
			vocabularyCommands = audioCommands + vocabularyCommands;
			
			document.getElementById("outputHtml").innerHTML = vocabularyExamplesHtml;
			document.getElementById("outputTextArea").value = vocabularyExamplesSubtitles;
			document.getElementById("chineseSpacedTextArea").value = vocabularyCommands;
			
		}  // end function subtitlesButtonClicked
		
		function examplesButtonClicked()
		{
			//debugLog("examplesButtonClicked");
			
			var vocabularyExamplesHtml = "";
			
			var theseWords = "一半\n中部\n以外\n來賓\n分鐘\n剛好\n國家\n大清早\n就是說\n市區\n得了\n想不到\n懂得\n有些\n有意\n有趣\n正在\n測驗\n演唱\n經過\n至於\n話題\n車票\n道理";
			
			var theseChinese = "聽說 有 一批 大陸 偷渡客   偷渡 到一 半就 淹死 了 \n六年 前   剛剛 踏進 精誠 中學 國中 部 的時候 \n所以 外號 叫 「  勃起 」 \n沒 聽說 過來 賓 要 親新娘 \n十分 鐘 \n剛剛 好啦 \n大概 真的 很想 換 個國 家 打手槍 吧 \n一大 清早 就 這麼 \n也就 是說 我 有機 會 囉 \n就 直接 跳進 彰化市 區 了 啊 \n贏得 了 五 燈獎 的 冠軍 \n只是 還 想不到 書 名   不知道 怎麼 開頭 \n你們 這樣 很 壞 耶   一點 都 不懂 得 祝福 \n真實 人生 裡有 些事 永遠 也沒有 答案 \n很多 事 不用 做 就 知道 沒有 意義 啊 \n聽起來 很有 趣 耶 \n等到 真正 在 一起 了 \n馬上 把 隨堂測 驗 紙 拿出來 \n下個月 他們 要 來 開演 唱會 \n學期 已經 過了 三分之一 了 \n甚至 於 想 打 老師 的 \n幸好   我們 還有 共 通 的 話題 \n阿和 則 買 了 最近 一 班 的 火車 票 \n妳 真的 很 喜歡 學 大人 講道 理 耶 ";
			var theseTimes = "00:33:23,459 --> 00:33:27,500\n00:48:09,542 --> 00:48:15,333\n00:02:41,876 --> 00:02:45,584\n01:39:10,876 --> 01:39:12,583\n00:30:06,292 --> 00:30:08,334\n00:03:12,167 --> 00:03:15,042\n01:33:14,417 --> 01:33:17,833\n00:06:55,959 --> 00:06:57,209\n01:17:54,792 --> 01:17:56,917\n00:34:35,376 --> 00:34:38,458\n00:02:11,917 --> 00:02:14,709\n01:46:01,167 --> 01:46:04,917\n01:36:21,334 --> 01:36:25,126\n00:47:39,042 --> 00:47:43,001\n00:32:25,084 --> 00:32:29,000\n00:17:41,001 --> 00:17:42,625\n01:29:06,501 --> 01:29:08,958\n00:44:54,959 --> 00:44:58,208\n00:17:27,959 --> 00:17:29,750\n00:19:28,209 --> 00:19:30,500\n00:09:59,126 --> 00:10:01,500\n01:02:18,709 --> 01:02:22,876\n01:18:05,001 --> 01:18:09,042\n00:32:12,959 --> 00:32:16,541\n";
			
			var theseEnglish = "I heard some stowaways from China were drowned.\nSix years ago, when we first stepped in to Jing-Cheng high school\nthat's why we named him \"Boner\".\nBullshit!\n10 minutes.\nWhy not?\nPerhaps he wanted to masturbate in a different country.\nIt's early morning and everyone looks half asleep.\nOh yes, so I have a chance now?\nand jumped directly into Changhua city.\nfor five consecutive rounds.\nI just haven't come up a good name to start with.\nYou guys are mean. Can't you just show some love to the couple?\nyou never find a correct answer in life.\nYou know something is meaningless without trying it.\nSounds fun.\nWhen two people are together.\nTake out your paper right now.\nThey are coming next month.\nwe have gone through a third of this semester.\nOr even those who beat up teachers!\nLuckily, we had some common interests to talk about.\nA-Ho, on the other hand, bought a ticket for the next train.\nYou really like to pitch high notes like adults, don't you?\n";
			
			var theseWordsArray = theseWords.split("\n");
			var theseChineseArray = theseChinese.split("\n");
			var theseTimesArray = theseTimes.split("\n");
			var theseEnglishArray = theseEnglish.split("\n");
			
			var numberWords = theseWordsArray.length;
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWordChinese = theseWordsArray[currentWord];
				
				var thisExampleChinese = theseChineseArray[currentWord];
				
				var thisWordTime = theseTimesArray[currentWord];
				
				thisWordTime = textBetween(thisWordTime, "start", ",");
				
				var thisWordExampleEnglish = theseEnglishArray[currentWord];
				
				
				var translationOutput = translateText(thisWordChinese, "");
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				// Not sure why there's an undefined line in here, but this fixes the symptoms
				//var undefinedLine = translatedHtmlArray[1];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");
				
				var thisFrequency = 1;
				
				var thisLineHtml = "<td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>";
				
				
				translationOutput = translateText(thisExampleChinese, "");
				
				translatedHtml = translationOutput[0];
				translatedText = translationOutput[1];
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var thisWordSubtitleHtml = translatedHtmlArray[0];
				var thisWordExamplePinyinHtml = translatedHtmlArray[1];
				var thisWordExampleLiteralHtml = translatedHtmlArray[2];
								
				var thisLineExampleHtml = thisLineHtml + "<td>" + thisWordTime + "</td><td>" + "<table><tr><td>" + "<table><tr>" + thisWordSubtitleHtml + "</tr><tr>" + thisWordExamplePinyinHtml + "</tr><tr>" + thisWordExampleLiteralHtml + "</tr>";
			   			   
				thisLineExampleHtml = thisLineExampleHtml + "</table></td></tr><tr><td>" + thisWordExampleEnglish + "</td></tr></table>" + "</td>";
							   
				vocabularyExamplesHtml = vocabularyExamplesHtml + "<tr id=\"" + thisWordChinese + "\">" + thisLineExampleHtml + "</tr>" + "\n";
				
			} // end for every word

			vocabularyExamplesHtml = "<table>" + vocabularyExamplesHtml + "</table>";

			document.getElementById("outputHtml").innerHTML = vocabularyExamplesHtml;
			
		} // end function examplesButtonClicked
		
		function countWords(inputText)
		{
			//debugLog("countWords");
		
  			// Split after verse numbers
  			/*
  			inputText = inputText.replace(/([0-9])([A-Za-z])/g, '$1 $2');
  			inputText = replaceChars(inputText, "(", " ( ");
  			inputText = replaceChars(inputText, ")", " ) ");
  			inputText = replaceChars(inputText, ".", " . ");
  			inputText = inputText.replace(/:/g, ' ');
  			inputText = inputText.replace(/,/g, ' , ');
  			inputText = inputText.replace(/  /g, ' ');
  			*/
  			
  			inputText = replaceChars(inputText, "\n", " ");
  			
  			var inputWords = inputText.split(" ");
  			
  			var numberWords = inputWords.length;
  			
  			var uniqueWords = [];
  			var uniqueWordsCounts = [];
  			
  			var onlyCommon = false;
  			
			if (commonWords != "")
			{
				onlyCommon = true;
			}
  			
  			
  			for (var currentWord = 0; currentWord < numberWords; currentWord++)
  			{
  				var thisWord = inputWords[currentWord];
  				
  				var addWord = true;
  				
  				if (onlyCommon == true)
  				{
  					if (contains(commonWords,thisWord) == false)
  					{
  						addWord = false;
  					}
  				}
  				
  				var thisWordIndex = uniqueWords.indexOf(thisWord);
  				
  				if (thisWordIndex != -1)
  				{
  					var thisCount = uniqueWordsCounts[thisWordIndex];
  					thisCount = thisCount + 1;
  					uniqueWordsCounts[thisWordIndex] = thisCount;
  					
  				} else {
  					uniqueWords.push(thisWord);
  					uniqueWordsCounts.push(1);
  				} // end if the word is unique
  				
  			} // end for every word
  			
  			var numberUniqueWords = uniqueWords.length;
  			
  			var wordsArray = [];
  			
  			for (var currentWord = 0; currentWord < numberUniqueWords; currentWord++)
  			{
  				var thisWord = uniqueWords[currentWord];
  				var thisWordCount = uniqueWordsCounts[currentWord];
  				
  				var outputLine = thisWordCount + " " + thisWord;
  				
  				if (thisWord != "")
  				{
  					wordsArray.push(outputLine);
  				}
  				
  			} // end for every unique word
  			
  			var wordsArraySorted = wordsArray.sort(
  			function(a,b)
				{
				    var c = parseInt(a,10);
				    var d = parseInt(b,10);
			    	return c-d;
				}
			);
			
			var outputArray = wordsArraySorted.reverse();
			
			var outputText = outputArray.join("\n");
			
			return outputText;
					
		} // end function countWords
		
		function getTocflVocabulary(chineseText)
		{
			//debugLog("getVocabulary");
			
			var commonWordsArray = commonWords.split("\n");
			
			var numberWords = commonWordsArray.length;
			
			var vocabularyHtml = "";
			var vocabularyText = "";

			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = commonWordsArray[currentWord];
				
				if (contains(chineseText, thisWord))
				{
					var wordCountArray = chineseText.split(thisWord);
					
					var thisFrequency = wordCountArray.length;
					
					var translationOutput = translateText(thisWord, "");
				
					var translatedHtml = translationOutput[0];
					var translatedText = translationOutput[1];
				
					var translatedTextArray = translatedText.split("\n");
					var translatedTextChinese = translatedTextArray[0];
					var translatedTextPinyin = translatedTextArray[1];
					var translatedTextLiteral = translatedTextArray[2];
					var translatedTextEnglish = translatedTextArray[3];
					
					var thisTextLine = thisFrequency + "	" + thisWord + "	" + translatedTextPinyin + "	" + translatedTextLiteral;
					
					if (contains(vocabularyText,thisTextLine) == false)
					{
						vocabularyText = vocabularyText + thisTextLine + "\n";
					}
					
					translatedHtml = replaceChars(translatedHtml, "<p>", "");
					translatedHtml = replaceChars(translatedHtml, "</p>", "");
					translatedHtml = replaceChars(translatedHtml, "<table>", "");
					translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
					translatedHtml = replaceChars(translatedHtml, "<tr>", "");
					var translatedHtmlArray = translatedHtml.split("</tr>");
					var translatedHtmlChinese = translatedHtmlArray[0];
					var translatedHtmlPinyin = translatedHtmlArray[1];
					var translatedHtmlLiteral = translatedHtmlArray[2];
					var translatedHtmlEnglish = translatedHtmlArray[3];
				
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
					translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");

					var thisHtmlLine = "<tr><td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>" + "</tr>";
					
					if (contains(vocabularyHtml,thisHtmlLine) == false)
					{
						vocabularyHtml = vocabularyHtml + thisHtmlLine + "\n";
					}
					
				} // end if the text contains the word
				
			} // end for every word in TOCFL
			
			vocabularyHtml = "<table>" + vocabularyHtml + "</table>";

			return [vocabularyHtml, vocabularyText];

		} // end function getTocflVocabulary
					
		function getVocabulary(chineseText)
		{
			//debugLog("getVocabulary");
			
			if (commonWords != "")
			{
				return getTocflVocabulary(chineseText);
			}
						
			var addPageBreaks = document.getElementById('pageBreaksCheckbox').checked;

			if (addPageBreaks == true)
			{
				var pageBreaksLine = pageBreaksTextArea.value;
			} // end if addPageBreaks

			var wordFrequencies = countWords(chineseText);
			
			var wordFrequenciesArray = wordFrequencies.split("\n");
			
			var numberUniqueWords = wordFrequenciesArray.length;
			
			var vocabularyHtml = "";
			var vocabularyText = "";
			
			for (var currentLine = 0; currentLine < numberUniqueWords; currentLine++)
			{
				var thisFrequencyWord = wordFrequenciesArray[currentLine];
			
				var thisFrequency = textBetween(thisFrequencyWord, "start", " ");
				var thisWord = textBetween(thisFrequencyWord, " ", "end");
								
				var translationOutput = translateText(thisWord, "");
				
				var translatedHtml = translationOutput[0];
				var translatedText = translationOutput[1];
				
				var translatedTextArray = translatedText.split("\n");
				var translatedTextChinese = translatedTextArray[0];
				var translatedTextPinyin = translatedTextArray[1];
				var translatedTextLiteral = translatedTextArray[2];
				var translatedTextEnglish = translatedTextArray[3];
				
				vocabularyText = vocabularyText + thisFrequency + "	" + thisWord + "	" + translatedTextPinyin + "	" + translatedTextLiteral + "\n";
				
				translatedHtml = replaceChars(translatedHtml, "<p>", "");
				translatedHtml = replaceChars(translatedHtml, "</p>", "");
				translatedHtml = replaceChars(translatedHtml, "<table>", "");
				translatedHtml = replaceChars(translatedHtml, "</table>", "");
				
				translatedHtml = replaceChars(translatedHtml, "<tr>", "");
				var translatedHtmlArray = translatedHtml.split("</tr>");
				var translatedHtmlChinese = translatedHtmlArray[0];
				var translatedHtmlPinyin = translatedHtmlArray[1];
				var translatedHtmlLiteral = translatedHtmlArray[2];
				var translatedHtmlEnglish = translatedHtmlArray[3];
				
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</tr>", "");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "<td>", " ");
				translatedHtmlChinese = replaceChars(translatedHtmlChinese, "</td>", " ");

				vocabularyHtml = vocabularyHtml + "<tr><td>" + thisFrequency + "</td><td>" + translatedHtmlChinese + "</td><td>" + translatedHtmlPinyin + "</td><td>" + translatedHtmlLiteral + "</td>" + "</tr>\n";
				
				if (addPageBreaks == true)
				{
					if ((currentLine % pageBreaksLine) == (pageBreaksLine - 1))
					{
						vocabularyHtml = vocabularyHtml + "</table><br></br>" + "<br></br><table>";
					}
				} // end if addPageBreaks
				
			} // end for every word
			
			vocabularyHtml = "<table>" + vocabularyHtml + "</table>";
			
			return [vocabularyHtml, vocabularyText];
		
		} // end function getVocabulary
		
		function vocabularyButtonClicked()
		{
			//debugLog("vocabularyButtonClicked");
			
			var chineseText = document.getElementById("chineseTextArea").value;
			
			var vocabularyArray = getVocabulary(chineseText);
			
			var vocabularyHtml = vocabularyArray[0];
			var vocabularyText = vocabularyArray[1];
			
			// Add examples to vocabulary
			
			document.getElementById("outputHtml").innerHTML = vocabularyHtml;
			document.getElementById("outputTextArea").value = vocabularyText;
			
		} // end function vocabularyButtonClicked
		
		function audioButtonClicked()
		{
			//debugLog("audioButtonClicked");

			var chineseText = document.getElementById("chineseTextArea").value;
			
			var theseLines = chineseText.split("\n");
			
			var numberLines = theseLines.length;
			
			var vocabularyExamplesSubtitles = "";
			var vocabularyCommands = "";
			var audioCommands = "";
			var missingWords = "";

			var chineseColourOne = document.getElementById("chineseColourPickerOne").value;
			var chineseColourTwo = document.getElementById("chineseColourPickerTwo").value;
			var chineseColourThree = document.getElementById("chineseColourPickerThree").value;
			var chineseColourFour = document.getElementById("chineseColourPickerFour").value;
			var chineseColourFive = document.getElementById("chineseColourPickerFive").value;
			var pinyinColourOne = document.getElementById("pinyinColourPickerOne").value;
			var pinyinColourTwo = document.getElementById("pinyinColourPickerTwo").value;
			var pinyinColourThree = document.getElementById("pinyinColourPickerThree").value;
			var pinyinColourFour = document.getElementById("pinyinColourPickerFour").value;
			var pinyinColourFive = pinyinColourOne;
			
			for (var currentLine = 0; currentLine < numberLines; currentLine++)
			{
				var thisLine = theseLines[currentLine];
				
				var thisLineWords = thisLine.split(" ");
				
				var numberWords = thisLineWords.length;
				
				for (var currentWord = 0; currentWord < numberWords; currentWord++)
				{
					var thisWord = thisLineWords[currentWord];

					if (thisWord != "")
					{
						var translationOutput = translateText(thisWord, "");
				
						var translatedHtml = translationOutput[0];
						var translatedText = translationOutput[1];
						
						var thisLineHtmlArray = translatedHtml.split("</tr>");
					
						var thisLineHtmlChinese = thisLineHtmlArray[0];
						var thisLineHtmlPinyin = thisLineHtmlArray[1];
						var thisLineHtmlLiteral = thisLineHtmlArray[2];
					
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<table>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<tr>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<p>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</td>", "");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "</div>", "</font>");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_1\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_2\">", "<font color=#" + chineseColourTwo + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_3\">", "<font color=#" + chineseColourThree + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_4\">", "<font color=#" + chineseColourFour + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_5\">", "<font color=#" + chineseColourFive + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_6\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_7\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<div class=\"chinese_8\">", "<font color=#" + chineseColourOne + ">");
						thisLineHtmlChinese = replaceChars(thisLineHtmlChinese, "<td>", "");
					
						thisLineHtmlChinese = "<font size=\"80\">" + thisLineHtmlChinese + "</font>";
					
						var thisWordChinese = cleanHtml(thisLineHtmlChinese);
						thisWordChinese = replaceChars(thisWordChinese, " ", "");
						
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</div>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<tr>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_1\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_2\">", "<font color=#" + pinyinColourTwo + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_3\">", "<font color=#" + pinyinColourThree + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_4\">", "<font color=#" + pinyinColourFour + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_5\">", "<font color=#" + pinyinColourFive + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<div class=\"pinyin_8\">", "<font color=#" + pinyinColourOne + ">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<span style=\"font-size:", "<font size=\"");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "px\">", "\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</span>", "</font>");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<td>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<b>", "");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</b>", "");

						// Change the font size
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"14\">", "<font size=\"36\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"15\">", "<font size=\"40\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"16\">", "<font size=\"44\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"17\">", "<font size=\"48\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"18\">", "<font size=\"52\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"19\">", "<font size=\"56\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "<font size=\"20\">", "<font size=\"60\">");
						thisLineHtmlPinyin = replaceChars(thisLineHtmlPinyin, "</font></font> <font", " </font></font><font");
						
						thisLineHtmlLiteral = textBetween(translatedHtml, "<div class=\"literal\">", "</div>");
					
						thisLineHtmlLiteral = "<font size=\"50\"><font color=#000000>" + thisLineHtmlLiteral + "</font></font>";
						
						var thisWordPinyin = "";
				   
						if (contains(combinedDictionaryData, "\n" + thisWordChinese + "	") == true)
						{
							var thisDictionaryLine = textBetween(combinedDictionaryData, "\n" + thisWordChinese + "	", "\n");
			   
							var thisDictionaryLineArray = thisDictionaryLine.split("	");
			   
							var lineLength = thisDictionaryLineArray.length;
			   
							var thisDefinition = "";
							var thisCharacterPinyin = "";
							var thisToneless = "";
							var thisTone = "";
			   
							thisDefinition = thisDictionaryLineArray[0];

							if (lineLength >= 1)
							{
								thisCharacterPinyin = thisDictionaryLineArray[1];
							}
			   
							if (lineLength >= 2)
							{
								thisToneless = thisDictionaryLineArray[2];
							}
			   
							if (lineLength >= 3)
							{
								thisTone = thisDictionaryLineArray[3];
							}
					   
							var thisPinyinArray = thisCharacterPinyin.split(" ");
							var thisTonelessArray = thisToneless.split(" ");
							var thisTonesArray = thisTone.split("");
					   
							var numberCharacters = thisWordChinese.length;
					   
							var thisAudioCommand = "";
					   
							if (numberCharacters > 1)
							{
								thisAudioCommand = "cat ";
							}
					   	
							for (var currentCharacter = 0; currentCharacter < numberCharacters; currentCharacter++)
							{
								var thisCharacterToneless = thisTonelessArray[currentCharacter];
								var thisCharacterTone = thisTonesArray[currentCharacter];
						   		
						   		/*
						   		if (thisCharacterToneless == undefined)
						   		{
									addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
						   		} else {
						   		
									if (thisCharacterToneless.length <  thisCharacterPinyin.length)
									{
										addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
									} else {

										if (thisCharacterTone == undefined)
										{
											addWord(thisWordChinese, thisCharacterPinyin, thisDefinition);
										}
									}
								}
								*/
						   
								thisWordPinyin = thisWordPinyin + thisCharacterToneless + thisCharacterTone;

								if (numberCharacters > 1)
								{
									thisAudioCommand = thisAudioCommand + "\"PinyinAudio/" + thisCharacterToneless + thisCharacterTone + ".mp3\" ";
								}
						   
							} // end for every character
					   
							if (numberCharacters > 1)
							{							
								thisAudioCommand = thisAudioCommand + "> \"PinyinAudio/" + thisWordPinyin + ".mp3\"";
						   
								audioCommands = audioCommands + thisAudioCommand + "\n";
							}

					   
						} else {
				   
							// Break the word into characters - is still needed because not all vocabulary words are in dictionary
							missingWords = missingWords + thisWordChinese + "\n";

						} // if the word is in the dictionary
						
						
						var thisWordDefinitionSubtitle = "0" + "\n" + "0:00:00,000" + "\n" + thisLineHtmlChinese + "\n" + thisLineHtmlPinyin + "\n" + thisLineHtmlLiteral + "\n";
					
						vocabularyExamplesSubtitles = vocabularyExamplesSubtitles + thisWordDefinitionSubtitle + "\n";
						
						var thisVocabularyCommand = "ffmpeg -i \"last4SecondsPad5.mp4\" -i \"Audio/" + thisWordPinyin + ".mp3\" -vf subtitles=\"WordSubtitles/" + thisWordChinese + ".srt:force_style='FontName=PingFangTC-Regular,Outline=0'\" -map 0:v -map 1:a -threads 9 -preset ultrafast \"WordHeadings/" + thisWordChinese + ".mp4\"";
						
						vocabularyCommands = vocabularyCommands + thisVocabularyCommand + "\n";
						
					} // end if this word is blank				
					
				} // end for every word in the line
				
			} // end for every line
			
			//writeToFile("PinyinDefinitionsTonesSorted.txt", combinedDictionaryData);
			
			//vocabularyCommands = audioCommands + vocabularyCommands;
			
			showMissingWords(missingWords);
			
			document.getElementById("englishTextArea").value = audioCommands;
			document.getElementById("outputTextArea").value = vocabularyExamplesSubtitles;
			document.getElementById("chineseSpacedTextArea").value = vocabularyCommands;

		} // end function audioButtonClicked
		
		function loadRegionalButtonClicked()
		{
			//debugLog("loadRegionalButtonClicked");

			document.getElementById("simplifiedInputTitle").style.width = "auto";
			document.getElementById("simplifiedInputTitle").style.visibility = "visible";

			document.getElementById("simplifiedInputTextArea").style.width = "250px";
			document.getElementById("simplifiedInputTextArea").style.visibility = "visible";
			
			document.getElementById("simplifiedSpacedTitle").style.width = "auto";
			document.getElementById("simplifiedSpacedTitle").style.visibility = "visible";

			document.getElementById("simplifiedSpacedTextArea").style.width = "250px";
			document.getElementById("simplifiedSpacedTextArea").style.visibility = "visible";
			
			document.getElementById("chineseTextArea").style.width = "250px";
			document.getElementById("englishTextArea").style.width = "250px";
			document.getElementById("chineseSpacedTextArea").style.width = "250px";
			document.getElementById("outputTextArea").style.width = "250px";
			
			document.getElementById("simplifiedButtonsDiv").style.height = "auto";
			document.getElementById("simplifiedButtonsDiv").style.visibility = "visible";
			
			document.getElementById("simplifiedCheckboxSpan").style.visibility = "visible";
			
			loadSimplified("opencc/dictionary/STCharacters.txt");
			loadSimplified("opencc/dictionary/STPhrases.txt");
			loadTraditional("opencc/dictionary/TSCharacters.txt");
			loadTraditional("opencc/dictionary/TSPhrases.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesIT.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesName.txt");
			loadTaiwan("opencc/dictionary/TWPhrasesOther.txt");
			loadTaiwan("opencc/dictionary/TWVariants.txt");
			loadTaiwan("opencc/dictionary/TWVariantsRevPhrases.txt");
			loadHongKong("opencc/dictionary/HKVariants.txt");
			loadHongKong("opencc/dictionary/HKVariantsPhrases.txt");
			loadHongKong("opencc/dictionary/HKVariantsRevPhrases.txt");
			loadJapan("opencc/dictionary/JPVariants.txt");
			
			loadTaiwanese("TaiwaneseDictionaryTaiyuNumbers.txt");
			loadCantonese("cantoneseChineseWordsTones.txt");
			loadHangul("hangulChineseKorean.txt");
			loadTang("tangChineseWords.txt");
			loadJapanese("japaneseOnChineseWords.txt");
			loadVietnamese("vietnameseChineseWords.txt");
			
			//document.getElementById("simplifiedInputTextArea").value = "中国电信设备制造商华为(Huawei)正在低迷的个人电脑(PC)市场寻求扩张，没有被PC销售下滑和较小参与者出局的现实吓倒。";
			
			//document.getElementById('chineseCheckbox').checked = false;
			//document.getElementById('simplifiedSpacedCheckbox').checked = true;
			
			var thisClass = "regional";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.visibility = "visible";
				thisElement.style.height = "auto";
				thisElement.style.width = "auto";
			} // end for every element
			
			
			document.getElementById("taiwaneseButton").style.width = "70px";
			document.getElementById("cantoneseButton").style.width = "70px";
			
			document.getElementById("wadeGilesButton").style.width = "70px";
			document.getElementById("vietnameseButton").style.width = "70px";

			document.getElementById("searchCantoneseButton").style.width = "70px";
			document.getElementById("searchTaiwaneseButton").style.width = "70px";
			
			document.getElementById("subtitlesButton").style.width = "70px";
			document.getElementById("vocabularyButton").style.width = "80px";
			
		} // end function loadRegionalButtonClicked
		
		function loadWordLists()
		{
			//debugLog("loadWordLists");
			
			var bibleWords = document.getElementById('commonCheckbox').checked;

			commonWords = "";

			var tocflZeroWords = document.getElementById('tocflZeroCheckbox').checked;
			var tocflOneWords = document.getElementById('tocflOneCheckbox').checked;
			var tocflTwoWords = document.getElementById('tocflTwoCheckbox').checked;
			var tocflThreeWords = document.getElementById('tocflThreeCheckbox').checked;
			var tocflFourWords = document.getElementById('tocflFourCheckbox').checked;
			var tocflFiveWords = document.getElementById('tocflFiveCheckbox').checked;
			var tocflSixWords = document.getElementById('tocflSixCheckbox').checked;
			var tocflAllWords = document.getElementById('tocflAllCheckbox').checked;
			
			var hskOneWords = document.getElementById('hskOneCheckbox').checked;
			var hskTwoWords = document.getElementById('hskTwoCheckbox').checked;
			var hskThreeWords = document.getElementById('hskThreeCheckbox').checked;
			var hskFourWords = document.getElementById('hskFourCheckbox').checked;
			var hskFiveWords = document.getElementById('hskFiveCheckbox').checked;
			var hskSixWords = document.getElementById('hskSixCheckbox').checked;
			var hskAllWords = document.getElementById('hskAllCheckbox').checked;
			
			if (bibleWords == true)
			{
				loadCommonWords("wordLists/bibleWords.txt");
			}

			if (tocflZeroWords == true)
			{
				loadCommonWords("wordLists/TOCFL/0.txt");
			}

			if (tocflOneWords == true)
			{
				loadCommonWords("wordLists/TOCFL/1.txt");
			}

			if (tocflTwoWords == true)
			{
				loadCommonWords("wordLists/TOCFL/2.txt");
			}

			if (tocflThreeWords == true)
			{
				loadCommonWords("wordLists/TOCFL/3.txt");
			}

			if (tocflFourWords == true)
			{
				loadCommonWords("wordLists/TOCFL/4.txt");
			}

			if (tocflFiveWords == true)
			{
				loadCommonWords("wordLists/TOCFL/5.txt");
			}

			if (tocflSixWords == true)
			{
				loadCommonWords("wordLists/TOCFL/6.txt");
			}

			if (tocflAllWords == true)
			{
				loadCommonWords("wordLists/TOCFL/tocfl.txt");
			}
			
			if (hskOneWords == true)
			{
				loadCommonWords("wordLists/HSK/1.txt");
			}

			if (hskTwoWords == true)
			{
				loadCommonWords("wordLists/HSK/2.txt");
			}

			if (hskThreeWords == true)
			{
				loadCommonWords("wordLists/HSK/3.txt");
			}

			if (hskFourWords == true)
			{
				loadCommonWords("wordLists/HSK/4.txt");
			}

			if (hskFiveWords == true)
			{
				loadCommonWords("wordLists/HSK/5.txt");
			}

			if (hskSixWords == true)
			{
				loadCommonWords("wordLists/HSK/6.txt");
			}

			if (hskAllWords == true)
			{
				loadCommonWords("wordLists/HSK/hsk.txt");
			}
			
		} // end function loadWordLists
		
		function findNewWords()
		{
			//debugLog("findNewWords");
			
			document.getElementById('breakMissingWordsCheckbox').checked = false;

			var checkText = document.getElementById("chineseSpacedTextArea").value;

			if (checkText == "")
			{
				wordSpaceButtonClicked();
				
				checkText = document.getElementById("chineseSpacedTextArea").value;
			} // end if we didn't already space
			
			checkText = replaceChars(checkText,"\n"," ");
		
			var checkTextArray = checkText.split(" ");
			
			var numberWords = checkTextArray.length;
			
			var newWords = "";
			
			for (var currentWord = 0; currentWord < numberWords; currentWord++)
			{
				var thisWord = checkTextArray[currentWord];
				
				if (contains(combinedDictionaryData, thisWord) == false)
				{
					if (isChineseString(thisWord) == true)
					{
						newWords = newWords + thisWord + "\n";
					}
				}
			
			} // end for every word
						
			showMissingWords(newWords);
			
		} // end function findNewWords
		
		function advancedButtonClicked()
		{
			//debugLog("advancedButtonClicked");
			
			loadBopomofo("zhuyin.txt");
			
			document.getElementById("translateButton").innerText = "Deradicalize, Space, and Translate";
			document.getElementById("translateButton").style.width = "193px";
			document.getElementById("defaultTranslateButton").style.width = "200px";
			document.getElementById("thisPhraseTable").style.height = "auto";
			document.getElementById("thisPhraseTable").style.width = "auto";

			document.getElementById("advancedRows").style.height = "auto";

			document.getElementById("chineseSpacedTitle").style.width = "auto";
			document.getElementById("chineseSpacedTextArea").style.width = "auto";
			
			var thisClass = "advanced";
			
			var theseElements = document.getElementsByClassName(thisClass);
			
			var numberElements = theseElements.length;
			
			for (var currentElement = 0; currentElement < numberElements; currentElement++)
			{
				var thisElement = theseElements[currentElement];
				thisElement.style.visibility = "visible";
			} // end for every element
			
		} // end function advancedButtonClicked
		
		function keyPressed()
		{
			//debugLog("keyPressed");

    		var key = window.event.keyCode;
    		
				// If the user has pressed return
				if (key === 13) 
				{
					var defaultButtons = document.getElementsByClassName("DefaultButtonOuter");
					
					if (defaultButtons == null)
					{
						return;
					}
					
					for (var currentButton = 0; currentButton < defaultButtons.length; currentButton++)
					{
						var thisDefaultButton = defaultButtons[currentButton];
						
						var thisButton = thisDefaultButton.firstElementChild;
						
						thisButton.click();
					} // end for every default button
					
				} // end if this key is return
		} // end function keyPressed
		
		
		
		
		// Don't reload dictionaries unless the user presses the button. 
		/*
		combinedDictionaryData = localStorage["dictionary"];
		
		if (combinedDictionaryData == "")
		{
			loadDictionaries();
		}
		*/
		
		loadDictionaries();
		
		//loadDictionary("cedictPlusAndtsu8Dictionary.txt");
		//loadDictionary("PinyinDefinitionsTonesSorted.txt");
		//loadDictionary("cedictPlusAndtsu8PinyinDefinitionsTones.txt");
		//loadDictionary("combinedPinyinDefinitionsTones.txt");
		
		//loadLongWords("cedictPlusAndtsu8AndBibleWords2-5.txt");
		loadRadicals("radicals.txt");
  
		document.getElementById("pinyinKeyboard").style.visibility = "hidden";
		//document.getElementById("radicalKeyboard").style.visibility = "hidden";

		loadComposition("cjk-decomp-0.4.0.txt");
		loadGenealogies("Genealogies.txt");

		loadToken();
		
		loadToneNumbersMarks("ToneNumbersMarks.txt");
		
		isPhpRunning();
  		
  </script>
  
  <!-- jQuery scripts -->
  <script>
  	
  	function openDictionaryEditor()
  	{
  		//debuglog("openDictionaryEditor");
  		
		document.getElementById("dictionaryEditor").style.visibility = "visible";

		dictionaryEditorEditCounts();
  		
		var thisDialog = $( "#dictionaryEditor" ).dialog(
			{
				width: 450,
				maxWidth: 768,
				height: 400,
			    closeText: "",
			    position: 
			    { 
    				my: 'left top',
    				at: 'right bottom',
				    of: $('#editButton')
				},
			    dialogClass: 'dialogWithDropShadow'
			}
		); 

		//dictionaryEditorDiv.dialog('open');
				
  	} // end function openDictionaryEditor
  	
  	//openDictionaryEditor();
  	
  </script>
  
</html>
